(()=>{"use strict";const t=t=>t[Math.floor(Math.random()*t.length)],e=t=>{let e,r=t.length;for(;0!=r;)e=Math.floor(Math.random()*r),r--,[t[r],t[e]]=[t[e],t[r]];return t},r=(t,e)=>e?r(e,t%e):t,n=t=>{let e=0;for(let n=1;n<=t;n++)1===r(n,t)&&e++;return e},o=(t=>{const e=[];for(let r=0;r<=t;r++)e.push(!0);e[0]=!1,e[1]=!1;for(let r=2;r*r<=t;r++)if(!0===e[r])for(let n=r*r;n<=t;n+=r)e[n]=!1;let r=[];for(let n=0;n<=t;n++)e[n]&&r.push(n);return r})(999),a=t=>o.filter((e=>e<=t)).length,l=e=>{let r=[],o=[],l=[];for(let t=1;t<=999;t++)n(t)===e&&r.push(t),a(t)===e&&o.push(t);if(r.length>0){let e=t(r);l.push(`\\varphi(${e})`)}if(o.length>0){let e=t(o);l.push(`\\pi(${e})`)}return(0===l.length||Math.random()<.3)&&l.push(`${e}`),t(l)},i=t=>{if(0===t)return`{\\lim_{x \\to \\infty}{${Math.floor(20*Math.random())}x^{-1}}}`;if(1===t)return"{\\lim_{x \\to \\infty}{x^{1/x}}}";{let e=Math.floor(5*Math.random())+1,r=Math.floor(3*Math.random())+2,n=r-1,o=["-","+"],a=`${e*t}x^{${r}} `,l=`${e}x^{${r}} `;for(let t=r-1;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;a+=`${o[Math.floor(2*Math.random())]} ${e}x${r} `}for(let t=n;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;l+=`${o[Math.floor(2*Math.random())]} ${e}x${r} `}return`{ \\lim_{x \\to \\infty} { \\frac{${a}}{${l}}} }`}},h=t=>0!==t?`{-${t}e^{\\pi i}}`:"{(e^{\\pi i} + 1)}",m=t=>{let e=Math.floor(10*Math.random())+1;if(Math.random()<.5)var r=`\\lim_{x \\to ${t-e}} \\frac{x^2 - ${e**2}}{x - ${e}}`;else r=`\\lim_{x \\to ${t+e}} \\frac{x^2 - ${e**2}}{x + ${e}}`;return`{${r}}`},d=t=>`${t}`,u=(t,e)=>{let r=(t=>{let e=[];for(let r=0;r<=t;r++)t%r==0&&e.push(r);return e})(t),n=r[Math.floor(Math.random()*r.length)],o=t/n,a=Math.floor(30*Math.random())+1;return Math.random()<.2?`{{\\left({${e[0](n)}}\\right)}{\\left({${e[1](o)}}\\right)}}`:`{ \\left({${e[0](n)} - ${e[1](a)}}\\right) \\left({${e[2](o)} + ${e[3](a)}}\\right) + {${e[3](a)}}{\\left({${e[3](o)} - ${e[3](n)} + ${e[3](a)}} \\right)} }`},s=(t,e)=>{let r=t**2;return`{\\sqrt{${e[0](r)}}}`},c=(t,e)=>{let r=Math.floor(t/2),n=Math.ceil(t/2);return Math.ceil(t/2)**2<100&&Math.random()<.7?`{${e[0](n**2)} - ${e[0](r**2)}}`:`{ \\left({${e[0](n)}}\\right)^2 -  \\left({${e[1](r)}}\\right)^2}`},f=(t,e)=>{let r=Math.floor(Math.random()*t+1)+1,n=t%r,o=Math.floor(t/r);return`${e[0](o)} \\times {${e[1](r)}} + ${e[2](n)}`},g=(t,e)=>{let r=Math.floor(5*Math.random())+1;return`\\frac{${e[0](t*r)}} {${e[1](r)}}`};let $=document.getElementById("download-img");const p=()=>{var t=document.querySelector("svg"),e=document.getElementById("input").value;let r=parseInt(t.getAttribute("width")),n=parseInt(t.getAttribute("height"));const o=(new XMLSerializer).serializeToString(t),a=`data:image/svg+xml;base64,${btoa(o)}`,l=document.createElement("canvas");let i=Math.max(2,800/n);l.width=r*i,l.height=n*i,console.log({w:l.width,h:l.height});const h=l.getContext("2d"),m=new Image;m.onload=()=>{h.drawImage(m,0,0,l.width,l.height),l.toBlob((t=>{if(null===t)throw new Error("Failed to serialize canvas to blob");((t,e)=>{const r=window.document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t,r.click()})(`complicated-expression-that-equals-${e}`,t)}))},m.src=a},M=(t,r)=>{if(isNaN(t)||t>1e3||t<0)return;let n=[];r.eulersIdentity&&n.push(h),r.exponentialLimits&&(n.push((t=>((t,e)=>0===t?"{\\lim_{x \\to \\infty}{ \\frac{\\ln(x)}{x} }}":1===t?"{\\lim_{x \\to 1}  {\\frac{\\ln(x)}{x - 1}}}":`{\\lim_{x \\to 0}{ \\frac{-\\ln(1 + ${e?l(t):t}(e^{-x} - 1))}{x} }}`)(t,r.numberTheory))),n.push((t=>((t,e)=>0===t?"{\\lim_{x \\to \\infty}{xe^{-x}}}":1===t?"{\\lim_{x \\to 0}{ \\frac{e^x - 1}{x} }}":`{\\lim_{x \\to 0}{ \\frac{e^{${e?l(t):t}x} - 1}{x} }}`)(t,r.numberTheory)))),r.polynomialLimits&&(n.push(m),n.push(i)),r.geometricSeries&&n.push((t=>((t,e)=>{if(0===t){let t=Math.floor(10*Math.random())+3;return`{\\sum\\limits_{k=0}^{${t-1}} {\\sin \\left({ \\frac{2 \\pi k}{${t}} } \\right)}}`}return 1===t?"{\\lim_{\\epsilon \\to 0}{ \\epsilon \\zeta(1 + \\epsilon) }}":`{\\sum\\limits_{k=0}^\\infty {\\left({\\frac{${e?l(t-1):t-1}}{${e?l(t):t}}}\\right)^{k}}}`})(t,r.numberTheory))),n=n.map((t=>((t,e)=>r=>{if(Math.random()<=.5){const t=(t=>{const e={2:2,6:3,24:4,120:5,720:6};return t in e&&e[t]})(r);if(t)return((t,e)=>Math.random()<.5&&e?`{\\Gamma (${t+1})}`:`{\\prod_{k=1}^{${t}} k}`)(t,e.gammaFunction);if((t=>t>=2&&Number.isInteger(Math.log2(t)))(r))return((t,e)=>`{\\sum_{k=0}^{${e?l(t):t}} {${t} \\choose k}}`)(Math.log2(r),e.numberTheory)}return t(r)})(t,r)));let o=((t,r)=>{let n=t=>r[Math.floor(Math.random()*r.length)](t),o=n,a=n,l=n;0===r.length&&(o=d,a=d,l=d,n=d),r.length>=3&&([o,a,l]=e(r).slice(0,3));const i=[];return 0!==t&&t<100&&(2===t||!(t=>{if(t<=1||t%2==0&&t>2)return!1;for(let e=3;e<=Math.sqrt(t);e+=2)if(t%e==0)return!1;return!0})(t))&&i.push(u),t<10&&i.push(s),t>1&&(t=>Number.isInteger(Math.sqrt(t)))(t)&&i.push(s),(t=>t%2!=0)(t)&&i.push(c),t<=200&&i.push(g),i.push(f),e(i)[0](t,r)})(t,n);var a=document.getElementById("display"),$=document.getElementById("render");$.disabled=a.disabled=!0;let p=document.getElementById("download-img"),M=document.getElementById("output");M.innerHTML="",MathJax.texReset();var x=MathJax.getMetricsFor(M);x.display=a.checked,MathJax.tex2svgPromise(o,x).then((function(t){M.appendChild(t),MathJax.startup.document.clear(),MathJax.startup.document.updateDocument(),p.style.display="block"})).catch((function(t){M.appendChild(document.createElement("pre")).appendChild(document.createTextNode(t.message))})).then((function(){$.disabled=a.disabled=!1}))};(()=>{const t=document.getElementById("form"),e=document.getElementById("input"),r=document.getElementById("gamma-function"),n=document.getElementById("eulers-identity"),o=document.getElementById("limits-exponential"),a=document.getElementById("limits-polynomial"),l=document.getElementById("number-theory"),i=document.getElementById("geometric-series");t.addEventListener("submit",(t=>{t.preventDefault(),M(parseInt(e.value),{gammaFunction:r.checked,eulersIdentity:n.checked,exponentialLimits:o.checked,polynomialLimits:a.checked,numberTheory:l.checked,geometricSeries:i.checked})})),$.addEventListener("click",p)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUN6QzRDLEVBQW9CN0MsU0FBU0MsZUFBZSxzQkFDNUMrQyxFQUFtQmhELFNBQVNDLGVBQWUscUJBQzNDOEMsRUFBZS9DLFNBQVNDLGVBQWUsaUJBQ3ZDZ0QsRUFBa0JqRCxTQUFTQyxlQUFlLG9CQUVoRGtHLEVBQUtDLGlCQUFpQixVQUFVQyxJQUM1QkEsRUFBTUMsaUJBRU43RCxFQUFRbEMsU0FBU3BCLEVBQU9rQixPQUFRLENBQzVCb0QsY0FBZUEsRUFBYzZCLFFBQzdCekcsZUFBZ0JBLEVBQWV5RyxRQUMvQnpDLGtCQUFtQkEsRUFBa0J5QyxRQUNyQ3RDLGlCQUFrQkEsRUFBaUJzQyxRQUNuQ3ZDLGFBQWNBLEVBQWF1QyxRQUMzQnJDLGdCQUFpQkEsRUFBZ0JxQyxTQUNuQyxJRGhETnZGLEVBQVlxRyxpQkFBaUIsUUFBU2xHLEVDbURuQixFQUd2QixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbnVtMm1hdGgvLi9zcmMvdXRpbHMudHMiLCJ3ZWJwYWNrOi8vbnVtMm1hdGgvLi9zcmMvcmVwcmVzZW50YXRpb25zLnRzIiwid2VicGFjazovL251bTJtYXRoLy4vc3JjL2RlY29tcG9zaXRpb25zLnRzIiwid2VicGFjazovL251bTJtYXRoLy4vc3JjL2Rvd25sb2FkLXBuZy50cyIsIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy9zY3JpcHQudHMiXSwic291cmNlc0NvbnRlbnQiOlsidHlwZSBvcGVyYXRpb24gPSAobjogbnVtYmVyKSA9PiBzdHJpbmc7XG5cbnR5cGUgQ29udmVydE9wdGlvbnMgPSB7XG4gICAgZ2FtbWFGdW5jdGlvbjogYm9vbGVhbjtcbiAgICBldWxlcnNJZGVudGl0eTogYm9vbGVhbjtcbiAgICBleHBvbmVudGlhbExpbWl0czogYm9vbGVhbjtcbiAgICBwb2x5bm9taWFsTGltaXRzOiBib29sZWFuO1xuICAgIG51bWJlclRoZW9yeTogYm9vbGVhbjtcbiAgICBnZW9tZXRyaWNTZXJpZXM6IGJvb2xlYW47XG59O1xuXG5jb25zdCByYW5kb21FbGVtZW50ID0gPEE+KGFycmF5OiBBW10pID0+IHtcbiAgICByZXR1cm4gYXJyYXlbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJyYXkubGVuZ3RoKV07XG59O1xuXG5jb25zdCBzaHVmZmxlID0gPEE+KGFycmF5OiBBW10pID0+IHtcbiAgICBsZXQgY3VycmVudEluZGV4ID0gYXJyYXkubGVuZ3RoLFxuICAgICAgICByYW5kb21JbmRleDtcblxuICAgIC8vIFdoaWxlIHRoZXJlIHJlbWFpbiBlbGVtZW50cyB0byBzaHVmZmxlLlxuICAgIHdoaWxlIChjdXJyZW50SW5kZXggIT0gMCkge1xuICAgICAgICAvLyBQaWNrIGEgcmVtYWluaW5nIGVsZW1lbnQuXG4gICAgICAgIHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY3VycmVudEluZGV4KTtcbiAgICAgICAgY3VycmVudEluZGV4LS07XG5cbiAgICAgICAgLy8gQW5kIHN3YXAgaXQgd2l0aCB0aGUgY3VycmVudCBlbGVtZW50LlxuICAgICAgICBbYXJyYXlbY3VycmVudEluZGV4XSwgYXJyYXlbcmFuZG9tSW5kZXhdXSA9IFthcnJheVtyYW5kb21JbmRleF0sIGFycmF5W2N1cnJlbnRJbmRleF1dO1xuICAgIH1cblxuICAgIHJldHVybiBhcnJheTtcbn07XG5cbmNvbnN0IGlzT2RkID0gKG46IG51bWJlcikgPT4gbiAlIDIgIT09IDA7XG5cbmNvbnN0IGlzU3F1YXJlID0gKG46IG51bWJlcikgPT4gTnVtYmVyLmlzSW50ZWdlcihNYXRoLnNxcnQobikpO1xuXG5jb25zdCBpc1ByaW1lID0gKG46IG51bWJlcikgPT4ge1xuICAgIGlmIChuIDw9IDEgfHwgKG4gJSAyID09IDAgJiYgbiA+IDIpKSByZXR1cm4gZmFsc2U7XG5cbiAgICBmb3IgKGxldCBpID0gMzsgaSA8PSBNYXRoLnNxcnQobik7IGkgKz0gMikge1xuICAgICAgICBpZiAobiAlIGkgPT09IDApIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59O1xuXG5jb25zdCBnZXRGYWN0b3JzID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCBmYWN0b3JzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbjsgaSsrKSB7XG4gICAgICAgIGlmIChuICUgaSA9PT0gMCkge1xuICAgICAgICAgICAgZmFjdG9ycy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWN0b3JzO1xufTtcblxuLy8gQ2hlY2tpbmcgaWYgYSBudW1iZXIgY2FuIGJlIGZvcm1lZCB1c2luZyBmYWN0b3JpYWxcbmNvbnN0IGlzRmFjdG9yaWFsID0gKG46IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IGZhY3RvcmlhbHM6IHsgW2tleTogbnVtYmVyXTogbnVtYmVyIH0gPSB7XG4gICAgICAgIDI6IDIsXG4gICAgICAgIDY6IDMsXG4gICAgICAgIDI0OiA0LFxuICAgICAgICAxMjA6IDUsXG4gICAgICAgIDcyMDogNixcbiAgICB9O1xuXG4gICAgaWYgKG4gaW4gZmFjdG9yaWFscykge1xuICAgICAgICByZXR1cm4gZmFjdG9yaWFsc1tuXTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufTtcblxuY29uc3QgaXNQb3cyID0gKG46IG51bWJlcikgPT4gbiA+PSAyICYmIE51bWJlci5pc0ludGVnZXIoTWF0aC5sb2cyKG4pKTtcblxuY29uc3QgZ2NkID0gKGE6IG51bWJlciwgYjogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgICBpZiAoIWIpIHtcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfVxuXG4gICAgcmV0dXJuIGdjZChiLCBhICUgYik7XG59O1xuXG5leHBvcnQge1xuICAgIG9wZXJhdGlvbixcbiAgICBDb252ZXJ0T3B0aW9ucyxcbiAgICByYW5kb21FbGVtZW50LFxuICAgIHNodWZmbGUsXG4gICAgaXNPZGQsXG4gICAgaXNTcXVhcmUsXG4gICAgaXNQcmltZSxcbiAgICBnZXRGYWN0b3JzLFxuICAgIGlzRmFjdG9yaWFsLFxuICAgIGlzUG93MixcbiAgICBnY2QsXG59O1xuIiwiLyoqXG4gKiBFeHBsb2l0cyB0aGUgW1N0cm9uZyBsYXcgb2Ygc21hbGwgbnVtYmVyc10oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU3Ryb25nX2xhd19vZl9zbWFsbF9udW1iZXJzKSB0b1xuICogZmluZCBwcm9wZXJ0aWVzIG9mIHRoZSBzbWFsbGVyIG51bWJlcnMgZ2l2ZW4gYnkgdGhlIGRlY29tcG9zaXRpb25zLCBzdWNoIGFzIHRoZSBldWxlciBwaGkgYW5kIHByaW1lIGNvdW50aW5nIGZ1bmN0aW9ucyxcbiAqIGZhY3RvcmlhbC9nYW1tYSwgYW5kIG1vcmUuXG4gKi9cblxuaW1wb3J0IHsgZ2NkLCByYW5kb21FbGVtZW50IH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IF9ldWxlclBoaSA9IChuOiBudW1iZXIpID0+IHtcbiAgICBsZXQgeCA9IDA7XG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgaWYgKGdjZChpLCBuKSA9PT0gMSkge1xuICAgICAgICAgICAgeCsrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHg7XG59O1xuXG5jb25zdCBfcHJpbWVTaWV2ZSA9IChuOiBudW1iZXIpID0+IHtcbiAgICBjb25zdCBwcmltZVNpZXZlID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbjsgaSsrKSB7XG4gICAgICAgIHByaW1lU2lldmUucHVzaCh0cnVlKTtcbiAgICB9XG4gICAgcHJpbWVTaWV2ZVswXSA9IGZhbHNlO1xuICAgIHByaW1lU2lldmVbMV0gPSBmYWxzZTtcblxuICAgIGZvciAobGV0IHAgPSAyOyBwICogcCA8PSBuOyBwKyspIHtcbiAgICAgICAgaWYgKHByaW1lU2lldmVbcF0gPT09IHRydWUpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBwICogcDsgaSA8PSBuOyBpICs9IHApIHtcbiAgICAgICAgICAgICAgICBwcmltZVNpZXZlW2ldID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgcmVzUHJpbWVzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbjsgaSsrKSB7XG4gICAgICAgIGlmIChwcmltZVNpZXZlW2ldKSB7XG4gICAgICAgICAgICByZXNQcmltZXMucHVzaChpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzUHJpbWVzO1xufTtcblxuY29uc3QgX2NhY2hlZFByaW1lcyA9IF9wcmltZVNpZXZlKDk5OSk7XG5cbmNvbnN0IF9wcmltZUNvdW50aW5nRnVuY3Rpb24gPSAobjogbnVtYmVyKSA9PiB7XG4gICAgcmV0dXJuIF9jYWNoZWRQcmltZXMuZmlsdGVyKHggPT4geCA8PSBuKS5sZW5ndGg7XG59O1xuXG5jb25zdCBudW1iZXJUaGVvcnlGdW5jdGlvbnMgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgbGV0IG1hdGNoaW5nUGhpSW5wdXRzID0gW107XG4gICAgbGV0IG1hdGNoaW5nUGlJbnB1dHMgPSBbXTtcbiAgICBsZXQgZnVuY3Rpb25PcHRpb25zID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSA5OTk7IGkrKykge1xuICAgICAgICBpZiAoX2V1bGVyUGhpKGkpID09PSBuKSB7XG4gICAgICAgICAgICBtYXRjaGluZ1BoaUlucHV0cy5wdXNoKGkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF9wcmltZUNvdW50aW5nRnVuY3Rpb24oaSkgPT09IG4pIHtcbiAgICAgICAgICAgIG1hdGNoaW5nUGlJbnB1dHMucHVzaChpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChtYXRjaGluZ1BoaUlucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBtYXRjaGluZ0lucHV0ID0gcmFuZG9tRWxlbWVudChtYXRjaGluZ1BoaUlucHV0cyk7XG4gICAgICAgIGZ1bmN0aW9uT3B0aW9ucy5wdXNoKGBcXFxcdmFycGhpKCR7bWF0Y2hpbmdJbnB1dH0pYCk7XG4gICAgfVxuXG4gICAgaWYgKG1hdGNoaW5nUGlJbnB1dHMubGVuZ3RoID4gMCkge1xuICAgICAgICBsZXQgbWF0Y2hpbmdJbnB1dCA9IHJhbmRvbUVsZW1lbnQobWF0Y2hpbmdQaUlucHV0cyk7XG4gICAgICAgIGZ1bmN0aW9uT3B0aW9ucy5wdXNoKGBcXFxccGkoJHttYXRjaGluZ0lucHV0fSlgKTtcbiAgICB9XG5cbiAgICBpZiAoZnVuY3Rpb25PcHRpb25zLmxlbmd0aCA9PT0gMCB8fCBNYXRoLnJhbmRvbSgpIDwgMC4zKSB7XG4gICAgICAgIGZ1bmN0aW9uT3B0aW9ucy5wdXNoKGAke259YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJhbmRvbUVsZW1lbnQoZnVuY3Rpb25PcHRpb25zKTtcbn07XG5cbmNvbnN0IGZhY3RvcmlhbCA9IChuOiBudW1iZXIsIGdhbW1hRnVuY3Rpb25FbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjUgJiYgZ2FtbWFGdW5jdGlvbkVuYWJsZWQpIHtcbiAgICAgICAgLy8gzpMobikgPSAobi0xKSFcbiAgICAgICAgcmV0dXJuIGB7XFxcXEdhbW1hICgke24gKyAxfSl9YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBVc2luZyB0aGUgcGkgcHJvZHVjdCBub3RhdGlvbiBvZiBmYWN0b3JpYWxcbiAgICAgICAgcmV0dXJuIGB7XFxcXHByb2Rfe2s9MX1eeyR7bn19IGt9YDtcbiAgICB9XG59O1xuXG4vLyByZXByZXNlbnRhdGlvbiBvZiAyXm5cbmNvbnN0IHBvdzJDaG9vc2UgPSAobjogbnVtYmVyLCBudW1iZXJUaGVvcnlFbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgbGV0IHggPSBudW1iZXJUaGVvcnlFbmFibGVkID8gbnVtYmVyVGhlb3J5RnVuY3Rpb25zKG4pIDogbjtcbiAgICByZXR1cm4gYHtcXFxcc3VtX3trPTB9Xnske3h9fSB7JHtufSBcXFxcY2hvb3NlIGt9fWA7XG59O1xuXG4vLyBMaW1pdHMgb2YgbmF0dXJhbCBsb2cgZnVuY3Rpb25zOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX2xpbWl0cyNOYXR1cmFsX2xvZ2FyaXRobXNcbmNvbnN0IGxpbWl0TmF0dXJhbExvZyA9IChuOiBudW1iZXIsIG51bWJlclRoZW9yeUVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9eyBcXFxcZnJhY3tcXFxcbG4oeCl9e3h9IH19YDtcbiAgICB9IGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGB7XFxcXGxpbV97eCBcXFxcdG8gMX0gIHtcXFxcZnJhY3tcXFxcbG4oeCl9e3ggLSAxfX19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgeCA9IG51bWJlclRoZW9yeUVuYWJsZWQgPyBudW1iZXJUaGVvcnlGdW5jdGlvbnMobikgOiBuO1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byAwfXsgXFxcXGZyYWN7LVxcXFxsbigxICsgJHt4fShlXnsteH0gLSAxKSl9e3h9IH19YDtcbiAgICB9XG59O1xuXG4vLyBMaW1pdHMgb2YgZXhwb25lbnRpYWwgZnVuY3Rpb25zOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX2xpbWl0cyNTdW1zLF9wcm9kdWN0c19hbmRfY29tcG9zaXRlc1xuY29uc3QgbGltaXRFeHBvbmVudGlhbCA9IChuOiBudW1iZXIsIG51bWJlclRoZW9yeUVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9e3hlXnsteH19fWA7XG4gICAgfSBlbHNlIGlmIChuID09PSAxKSB7XG4gICAgICAgIHJldHVybiBge1xcXFxsaW1fe3ggXFxcXHRvIDB9eyBcXFxcZnJhY3tlXnggLSAxfXt4fSB9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHggPSBudW1iZXJUaGVvcnlFbmFibGVkID8gbnVtYmVyVGhlb3J5RnVuY3Rpb25zKG4pIDogbjtcbiAgICAgICAgcmV0dXJuIGB7XFxcXGxpbV97eCBcXFxcdG8gMH17IFxcXFxmcmFje2VeeyR7eH14fSAtIDF9e3h9IH19YDtcbiAgICB9XG59O1xuXG4vLyBMaW1pdHMgb2YgcG9seW5vbWlhbCBmdW5jdGlvbnNcbmNvbnN0IGxpbWl0UG9seW5vbWlhbCA9IChuOiBudW1iZXIpID0+IHtcbiAgICAvLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX2xpbWl0cyNGdW5jdGlvbnNfb2ZfdGhlX2Zvcm1feGFcbiAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICBsZXQgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIwKTtcbiAgICAgICAgcmV0dXJuIGB7XFxcXGxpbV97eCBcXFxcdG8gXFxcXGluZnR5fXske3J9eF57LTF9fX1gO1xuICAgIH1cblxuICAgIC8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI0Z1bmN0aW9uc19vZl90aGVfZm9ybV94Zyh4KVxuICAgIGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGB7XFxcXGxpbV97eCBcXFxcdG8gXFxcXGluZnR5fXt4XnsxL3h9fX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGdlbmVyYXRlIHJhbmRvbSBwb2x5bm9taWFsIGxpbWl0cyBsaWtlIGxpbSB4IC0+IOKIniAoMjh4XjIgLSAxMXgpLyg0eF4yICsgMTB4KVxuICAgICAgICAvLyBzaW5jZSB0aGUgaGlnaGVzdCBwb3dlciB0ZXJtcyBkb21pbmF0ZSBpbiB0aGUgbGltaXRzLCB0aGUgcmVzdCBhcmUgaWdub3JlZCBhbmQgY2FuIGJlIHJhbmRvbVxuXG4gICAgICAgIC8vIEdldCByYW5kb20gbXVsdGlwbGllciBncmVhdGVyIHRoYW4gMVxuICAgICAgICBsZXQgbSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDUpICsgMTtcbiAgICAgICAgLy8gQ2hvb3NlIGEgcmFuZG9tIGhpZ2hlc3QgcG93ZXIuIFRoaXMgZGV0ZXJtaW5lcyB0aGUgZmluYWwgc29sdXRpb24gb2YgdGhlIGxpbWl0XG4gICAgICAgIGxldCBoaWdoZXN0UG93ZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzKSArIDI7XG5cbiAgICAgICAgbGV0IG51bWVyYXRvck51bWJlck9mVGVybXMgPSBoaWdoZXN0UG93ZXIgLSAxO1xuICAgICAgICBsZXQgZGVub21pbmF0b3JOdW1iZXJPZlRlcm1zID0gaGlnaGVzdFBvd2VyIC0gMTtcblxuICAgICAgICBsZXQgc2lnbnMgPSBbJy0nLCAnKyddO1xuICAgICAgICBsZXQgbnVtZXJhdG9yID0gYCR7bSAqIG59eF57JHtoaWdoZXN0UG93ZXJ9fSBgO1xuICAgICAgICBsZXQgZGVub21pbmF0b3IgPSBgJHttfXheeyR7aGlnaGVzdFBvd2VyfX0gYDtcblxuICAgICAgICAvLyBHZW5lcmF0ZSBhIHBvbHlub21pYWwgbnVtZXJhdG9yIHdpdGggcmFuZG9tIGxlbmd0aCBhbmQgY29lZmZpY2llbnRzXG4gICAgICAgIC8vZXg6IDE1eF4yXG4gICAgICAgIGZvciAobGV0IGkgPSBudW1lcmF0b3JOdW1iZXJPZlRlcm1zOyBpID4gMDsgaS0tKSB7XG4gICAgICAgICAgICBsZXQgY29lZiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSArIDI7XG5cbiAgICAgICAgICAgIGxldCBwb3dlciA9IGkgPCAyID8gJycgOiBgXnske2l9fWA7XG4gICAgICAgICAgICBsZXQgc2lnbiA9IHNpZ25zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpXTtcblxuICAgICAgICAgICAgbnVtZXJhdG9yICs9IGAke3NpZ259ICR7Y29lZn14JHtwb3dlcn0gYDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdlbmVyYXRlIGEgcG9seW5vbWlhbCBkZW5vbWluYXRvciB3aXRoIHJhbmRvbSBsZW5ndGggYW5kIGNvZWZmaWNpZW50c1xuICAgICAgICBmb3IgKGxldCBpID0gZGVub21pbmF0b3JOdW1iZXJPZlRlcm1zOyBpID4gMDsgaS0tKSB7XG4gICAgICAgICAgICBsZXQgY29lZiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSArIDI7XG5cbiAgICAgICAgICAgIGxldCBwb3dlciA9IGkgPCAyID8gJycgOiBgXnske2l9fWA7XG4gICAgICAgICAgICBsZXQgc2lnbiA9IHNpZ25zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpXTtcblxuICAgICAgICAgICAgZGVub21pbmF0b3IgKz0gYCR7c2lnbn0gJHtjb2VmfXgke3Bvd2VyfSBgO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGB7IFxcXFxsaW1fe3ggXFxcXHRvIFxcXFxpbmZ0eX0geyBcXFxcZnJhY3ske251bWVyYXRvcn19eyR7ZGVub21pbmF0b3J9fX0gfWA7XG4gICAgfVxufTtcblxuLy8gVXNpbmcgZXVsZXIncyBpZGVudGl0eS4gVGhhdCBpcywgZV4ocGkqaSkgPSAtMVxuY29uc3QgZXVsZXJzSWRlbnRpdHkgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgLy8gZS5nIOKIkjZlXihwaSppKT02XG5cbiAgICBpZiAobiAhPT0gMCkge1xuICAgICAgICByZXR1cm4gYHstJHtufWVee1xcXFxwaSBpfX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBgeyhlXntcXFxccGkgaX0gKyAxKX1gO1xuICAgIH1cbn07XG5cbi8vIEluZmluaXRlIGdlb21ldHJpYyBzZXJpZXMgdGhhdCBldmFsdWF0ZXMgdG8gYSBmaW5pdGUgdmFsdWVcbmNvbnN0IGluZmluaXRlR2VvbWV0cmljU2VyaWVzID0gKG46IG51bWJlciwgbnVtYmVyVGhlb3J5RW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIC8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbWF0aGVtYXRpY2FsX3NlcmllcyNUcmlnb25vbWV0cmljX2Z1bmN0aW9uc1xuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMztcbiAgICAgICAgcmV0dXJuIGB7XFxcXHN1bVxcXFxsaW1pdHNfe2s9MH1eeyR7ciAtXG4gICAgICAgICAgICAxfX0ge1xcXFxzaW4gXFxcXGxlZnQoeyBcXFxcZnJhY3syIFxcXFxwaSBrfXske3J9fSB9IFxcXFxyaWdodCl9fWA7XG4gICAgfVxuXG4gICAgLy8gVXNpbmcgdGhlIFJpZW1hbm4gemV0YSBmdW5jdGlvbjogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGFydGljdWxhcl92YWx1ZXNfb2ZfdGhlX1JpZW1hbm5femV0YV9mdW5jdGlvbiNUaGVfUmllbWFubl96ZXRhX2Z1bmN0aW9uX2F0XzBfYW5kXzFcbiAgICBlbHNlIGlmIChuID09PSAxKSB7XG4gICAgICAgIHJldHVybiBge1xcXFxsaW1fe1xcXFxlcHNpbG9uIFxcXFx0byAwfXsgXFxcXGVwc2lsb24gXFxcXHpldGEoMSArIFxcXFxlcHNpbG9uKSB9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVXNpbmcgdGhlIGluZmluaXRlIGdlb21ldHJpYyBzZXJpZXMgcnVsZTogV2hlbiDiiJIxPHg8MSwgc3VtbWF0aW9uIGZyb20gaSA9IDAgdG8gaW5maW5pdHkgb2Ygcl5pID0gMS8oMS1yKSBvciAoci0xKS9yLlxuICAgICAgICAvLyBEZWNpbWFsIGNhbiBiZSByZXByZXNlbnRlZCBhcyBmcmFjdGlvbiB0b28uIGUuZyAoMC4yNSleaSA9ICgxLzQpXmkgPSA0Xi1pXG4gICAgICAgIGxldCB4MSA9IG51bWJlclRoZW9yeUVuYWJsZWQgPyBudW1iZXJUaGVvcnlGdW5jdGlvbnMobiAtIDEpIDogbiAtIDE7XG4gICAgICAgIGxldCB4MiA9IG51bWJlclRoZW9yeUVuYWJsZWQgPyBudW1iZXJUaGVvcnlGdW5jdGlvbnMobikgOiBuO1xuICAgICAgICByZXR1cm4gYHtcXFxcc3VtXFxcXGxpbWl0c197az0wfV5cXFxcaW5mdHkge1xcXFxsZWZ0KHtcXFxcZnJhY3ske3gxfX17JHt4Mn19fVxcXFxyaWdodClee2t9fX1gO1xuICAgIH1cbn07XG5cbi8vIFVzaW5nIHRoZSB0cmlnIGlkZW50aXR5IChjb3NeMil4ICsgKHNpbl4yKXggPSAxXG5jb25zdCB0cmlnSWRlbnRpdHkgPSAoZXhwcmVzc2lvbjogc3RyaW5nKSA9PiB7XG4gICAgbGV0IHJhbmRvbVZhbHVlID0gTWF0aC5yYW5kb20oKTtcbiAgICBpZiAocmFuZG9tVmFsdWUgPCAwLjI1KSB7XG4gICAgICAgIHJldHVybiBgXFxcXGxlZnQoXFxcXGZyYWN7JHtleHByZXNzaW9ufX17KFxcXFxjb3NeMnggKyBcXFxcc2luXjJ4KX1cXFxccmlnaHQpYDtcbiAgICB9IGVsc2UgaWYgKHJhbmRvbVZhbHVlIDwgMC41KSB7XG4gICAgICAgIHJldHVybiBgXFxcXGxlZnQoeyR7ZXhwcmVzc2lvbn0gXFxcXHRpbWVzIChcXFxcY29zXjJ4ICsgXFxcXHNpbl4yeCl9XFxcXHJpZ2h0KWA7XG4gICAgfVxufTtcblxuLyogVXNpbmcgdGhlIGRpZmZlcmVuY2Ugb2YgdHdvIHNxdWFyZXMgaW4gbGltaXRzICovXG5jb25zdCBsaW1EaWZmVHdvU3F1YXJlcyA9IChuOiBudW1iZXIpID0+IHtcbiAgICBsZXQgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSArIDE7XG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjUpIHtcbiAgICAgICAgdmFyIHRleCA9IGBcXFxcbGltX3t4IFxcXFx0byAke24gLSByfX0gXFxcXGZyYWN7eF4yIC0gJHtyICoqIDJ9fXt4IC0gJHtyfX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB0ZXggPSBgXFxcXGxpbV97eCBcXFxcdG8gJHtuICsgcn19IFxcXFxmcmFje3heMiAtICR7ciAqKiAyfX17eCArICR7cn19YDtcbiAgICB9XG4gICAgcmV0dXJuIGB7JHt0ZXh9fWA7XG59O1xuXG5jb25zdCBzYW1lTnVtYmVyID0gKG46IG51bWJlcikgPT4gYCR7bn1gO1xuXG5leHBvcnQge1xuICAgIG51bWJlclRoZW9yeUZ1bmN0aW9ucyxcbiAgICBmYWN0b3JpYWwsXG4gICAgcG93MkNob29zZSxcbiAgICBsaW1pdE5hdHVyYWxMb2csXG4gICAgbGltaXRFeHBvbmVudGlhbCxcbiAgICBsaW1pdFBvbHlub21pYWwsXG4gICAgZXVsZXJzSWRlbnRpdHksXG4gICAgaW5maW5pdGVHZW9tZXRyaWNTZXJpZXMsXG4gICAgdHJpZ0lkZW50aXR5LFxuICAgIGxpbURpZmZUd29TcXVhcmVzLFxuICAgIHNhbWVOdW1iZXIsXG59O1xuIiwiLyoqXG4gKiBUaGlzIGZpbGUgY29udGFpbnMgZGVjb21wb3NpdGlvbiBmdW5jdGlvbnMuIFRoZXkgYnJlYWsgbGFyZ2VyIG51bWJlcnMgKDMtZGlnaXQpIGludG8gc21hbGxlciBvbmVzICgyLTEgZGlnaXRzKSxcbiAqIHdoZXJlIHRoZSBbU3Ryb25nIGxhdyBvZiBzbWFsbCBudW1iZXJzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TdHJvbmdfbGF3X29mX3NtYWxsX251bWJlcnMpIGNhbiB0YWtlIG9mIHRoZW1cbiAqIGFzIHRoZXkgaGF2ZSBtdWNoIG1vcmUgcHJvcGVydGllcyB0aGFuIGxhcmdlciBudW1iZXJzLlxuICovXG5cbmltcG9ydCB7XG4gICAgb3BlcmF0aW9uLFxuICAgIGdldEZhY3RvcnMsXG4gICAgQ29udmVydE9wdGlvbnMsXG4gICAgaXNGYWN0b3JpYWwsXG4gICAgaXNQb3cyLFxuICAgIHNodWZmbGUsXG4gICAgaXNQcmltZSxcbiAgICBpc1NxdWFyZSxcbiAgICBpc09kZCxcbn0gZnJvbSAnLi91dGlscyc7XG5cbnR5cGUgZGVjb21wb3NpdGlvbiA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHN0cmluZztcblxuaW1wb3J0ICogYXMgcmVwcmVzZW50YXRpb25zIGZyb20gJy4vcmVwcmVzZW50YXRpb25zJztcblxuLy8gZm9yIG4gPSBhYiBhbmQg4oiAYywgZWl0aGVyIHJldHVybiBuID0gYWIgb3IgKGEtYykoYitjKSArIGMoYi1hK2MpXG5jb25zdCBkZWNvbXBvc2VBQkMgPSAobnVtYmVyOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgZmFjdG9ycyA9IGdldEZhY3RvcnMobnVtYmVyKTtcbiAgICBsZXQgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBmYWN0b3JzLmxlbmd0aCk7XG4gICAgbGV0IGEgPSBmYWN0b3JzW3JhbmRvbUluZGV4XTtcbiAgICBsZXQgYiA9IG51bWJlciAvIGE7XG4gICAgbGV0IGMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzMCkgKyAxO1xuXG4gICAgLy8gYWJcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMikge1xuICAgICAgICByZXR1cm4gYHt7XFxcXGxlZnQoeyR7b3BzWzBdKGEpfX1cXFxccmlnaHQpfXtcXFxcbGVmdCh7JHtvcHNbMV0oYil9fVxcXFxyaWdodCl9fWA7XG4gICAgfVxuXG4gICAgLy8gKGEgLSBjKShiICsgYykgKyBjIChiIC0gYSArIGMpXG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBgeyBcXFxcbGVmdCh7JHtvcHNbMF0oYSl9IC0gJHtvcHNbMV0oYyl9fVxcXFxyaWdodCkgXFxcXGxlZnQoeyR7b3BzWzJdKGIpfSArICR7b3BzWzNdKFxuICAgICAgICAgICAgY1xuICAgICAgICApfX1cXFxccmlnaHQpICsgeyR7b3BzWzNdKGMpfX17XFxcXGxlZnQoeyR7b3BzWzNdKGIpfSAtICR7b3BzWzNdKGEpfSArICR7b3BzWzNdKFxuICAgICAgICAgICAgY1xuICAgICAgICApfX0gXFxcXHJpZ2h0KX0gfWA7XG4gICAgfVxufTtcblxuLy8gNSA9IHNxcnQoMjUpXG5jb25zdCBkZWNvbXBvc2VTcXJ0ID0gKG46IG51bWJlciwgb3BzOiBvcGVyYXRpb25bXSkgPT4ge1xuICAgIGxldCBzcXVhcmUgPSBuICoqIDI7XG4gICAgcmV0dXJuIGB7XFxcXHNxcnR7JHtvcHNbMF0oc3F1YXJlKX19fWA7XG59O1xuXG4vLyAyNSA9IDEgKyAzICsgNSArIDcgKyA5XG5jb25zdCBkZWNvbXBvc2VTcXVhcmUgPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgbGV0IHNxdWFyZVJvb3QgPSBNYXRoLnNxcnQobik7XG4gICAgbGV0IHN1bSA9IGAke29wc1swXSgxKX1gO1xuICAgIGxldCBvZGRWYWwgPSAxO1xuXG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzcXVhcmVSb290IC0gMTsgaSsrKSB7XG4gICAgICAgICAgICBvZGRWYWwgKz0gMjtcbiAgICAgICAgICAgIHN1bSArPSBgKyAke29wc1szXShvZGRWYWwpfWA7XG4gICAgICAgIH1cbiAgICAgICAgc3VtID0gYHsgJHtzdW19IH1gO1xuICAgICAgICByZXR1cm4gc3VtO1xuICAgIH1cblxuICAgIC8vIChhICsgYileMiA9IGFeMiArIDJhYiArIGJeMlxuICAgIGVsc2Uge1xuICAgICAgICBsZXQgYSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNxdWFyZVJvb3QgLSAxKSArIDE7XG4gICAgICAgIGxldCBiID0gc3F1YXJlUm9vdCAtIGE7XG5cbiAgICAgICAgLy8gUmVwcmVzZW50aW5nIChhICsgYileMlxuICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSkge1xuICAgICAgICAgICAgcmV0dXJuIGB7IHtcXFxcbGVmdCgke29wc1swXShhKX0gKyAke29wc1swXShiKX1cXFxccmlnaHQpfV4yfWA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXByZXNlbnRpbmcgYV4yICsgMmFiICsgYl4yXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGB7IHtcXFxcbGVmdCgke29wc1swXShhKX1cXFxccmlnaHQpfV4yICsgeyR7b3BzWzNdKDIpfX17XFxcXGxlZnQoJHtvcHNbMV0oXG4gICAgICAgICAgICAgICAgYVxuICAgICAgICAgICAgKX1cXFxccmlnaHQpfXtcXFxcbGVmdCgke29wc1syXShiKX1cXFxccmlnaHQpfSArIHtcXFxcbGVmdCgke29wc1szXShiKX1cXFxccmlnaHQpfV4yfWA7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vLyAyNSA9IDEzXjIgLSAxMl4yXG5jb25zdCBkZWNvbXBvc2VEaWZmZXJlbmNlU3F1YXJlcyA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgYSA9IE1hdGguZmxvb3IobiAvIDIpO1xuICAgIGxldCBiID0gTWF0aC5jZWlsKG4gLyAyKTtcblxuICAgIGlmIChNYXRoLmNlaWwobiAvIDIpICoqIDIgPCAxMDAgJiYgTWF0aC5yYW5kb20oKSA8IDAuNykge1xuICAgICAgICByZXR1cm4gYHske29wc1swXShiICoqIDIpfSAtICR7b3BzWzBdKGEgKiogMil9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGB7IFxcXFxsZWZ0KHske29wc1swXShiKX19XFxcXHJpZ2h0KV4yIC0gIFxcXFxsZWZ0KHske29wc1sxXShhKX19XFxcXHJpZ2h0KV4yfWA7XG4gICAgfVxufTtcblxuLy8gNyA9IDIgKiAzICsgMVxuY29uc3QgZGVjb21wb3NlQWRkTXVsdGlwbHkgPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgbGV0IHJhbmROdW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBuICsgMSkgKyAxO1xuICAgIGxldCByID0gbiAlIHJhbmROdW07XG4gICAgbGV0IGEgPSBNYXRoLmZsb29yKG4gLyByYW5kTnVtKTtcbiAgICByZXR1cm4gYCR7b3BzWzBdKGEpfSBcXFxcdGltZXMgeyR7b3BzWzFdKHJhbmROdW0pfX0gKyAke29wc1syXShyKX1gO1xufTtcblxuLy8gNyA9IDcqOC84XG5jb25zdCBkZWNvbXBvc2VNdWxEaXZpZGUgPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgbGV0IHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA1KSArIDE7XG4gICAgcmV0dXJuIGBcXFxcZnJhY3ske29wc1swXShuICogcil9fSB7JHtvcHNbMV0ocil9fWA7XG59O1xuLyogZW5kIGRlY29tcG9zZSBmdW5jdGlvbnMgKi9cblxuY29uc3QgY29uZGl0aW9uYWxEZWNvbXBvc2l0aW9uID0gKFxuICAgIHdyYXBwZWRGdW5jdGlvbjogb3BlcmF0aW9uLFxuICAgIG9wdGlvbnM6IENvbnZlcnRPcHRpb25zXG4pOiBvcGVyYXRpb24gPT4ge1xuICAgIHJldHVybiAobjogbnVtYmVyKSA9PiB7XG4gICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDw9IDAuNSkge1xuICAgICAgICAgICAgLy8gaW52ZXJzZSBmYWN0b3JpYWwgb2Ygbiwgc3VjaCB0aGF0IGZhYyEgPSBuXG4gICAgICAgICAgICBjb25zdCBmYWMgPSBpc0ZhY3RvcmlhbChuKTtcbiAgICAgICAgICAgIGlmIChmYWMpIHtcbiAgICAgICAgICAgICAgICAvLyBmYWN0b3JpYWwoZmFjKSA9IGZhYyEgPSBuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJlc2VudGF0aW9ucy5mYWN0b3JpYWwoZmFjLCBvcHRpb25zLmdhbW1hRnVuY3Rpb24pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNQb3cyKG4pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJlc2VudGF0aW9ucy5wb3cyQ2hvb3NlKE1hdGgubG9nMihuKSwgb3B0aW9ucy5udW1iZXJUaGVvcnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHdyYXBwZWRGdW5jdGlvbihuKTtcbiAgICB9O1xufTtcblxuLy8gQnJlYWsgYSBudW1iZXIgZG93biBpbnRvIHNtYWxsZXIgbnVtYmVycyBzZXBhcmF0ZWQgYnkgb3BlcmF0b3JzXG5jb25zdCBkZWNvbXBvc2UgPSAobjogbnVtYmVyLCBvcGVyYXRpb25zOiBvcGVyYXRpb25bXSkgPT4ge1xuICAgIC8vIEdldCB0aHJlZSBvcGVyYXRpb25bXSB0aGF0IGNhbiBiZSB1c2VkXG4gICAgbGV0IG1vcmVSYW5kb21PcHRpb25zID0gKG51bTogbnVtYmVyKSA9PiB7XG4gICAgICAgIHJldHVybiBvcGVyYXRpb25zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG9wZXJhdGlvbnMubGVuZ3RoKV0obnVtKTtcbiAgICB9O1xuXG4gICAgbGV0IHJhbmRvbU9wdGlvbjEgPSBtb3JlUmFuZG9tT3B0aW9ucztcbiAgICBsZXQgcmFuZG9tT3B0aW9uMiA9IG1vcmVSYW5kb21PcHRpb25zO1xuICAgIGxldCByYW5kb21PcHRpb24zID0gbW9yZVJhbmRvbU9wdGlvbnM7XG5cbiAgICAvLyBpZiB0aGVyZSBhcmUgbm8gb3BlcmF0aW9uW10gdG8gYmUgZG9uZVxuICAgIGlmIChvcGVyYXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByYW5kb21PcHRpb24xID0gcmVwcmVzZW50YXRpb25zLnNhbWVOdW1iZXI7XG4gICAgICAgIHJhbmRvbU9wdGlvbjIgPSByZXByZXNlbnRhdGlvbnMuc2FtZU51bWJlcjtcbiAgICAgICAgcmFuZG9tT3B0aW9uMyA9IHJlcHJlc2VudGF0aW9ucy5zYW1lTnVtYmVyO1xuICAgICAgICBtb3JlUmFuZG9tT3B0aW9ucyA9IHJlcHJlc2VudGF0aW9ucy5zYW1lTnVtYmVyO1xuICAgIH1cblxuICAgIGlmIChvcGVyYXRpb25zLmxlbmd0aCA+PSAzKSB7XG4gICAgICAgIFtyYW5kb21PcHRpb24xLCByYW5kb21PcHRpb24yLCByYW5kb21PcHRpb24zXSA9IHNodWZmbGUob3BlcmF0aW9ucykuc2xpY2UoMCwgMyk7XG4gICAgfVxuXG4gICAgY29uc3QgZGVjb21wb3NpdGlvbnM6IGRlY29tcG9zaXRpb25bXSA9IFtdO1xuXG4gICAgLy8gMS4gYWIgPSAoYSAtIGMpKGIgKyBjKSArIGMgKGIgLSBhICsgYyksIHdoZXJlIGMgaXMgYW55IHJhbmRvbSBwb3NpdGl2ZSBudW1iZXJcbiAgICBpZiAobiAhPT0gMCAmJiBuIDwgMTAwICYmIChuID09PSAyIHx8ICFpc1ByaW1lKG4pKSkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZUFCQyk7XG4gICAgfVxuXG4gICAgLy8gMi4gUmVwcmVzZW50IChzbWFsbCkgbnVtYmVycyB1c2luZyB0aGVpciBzcXVhcmUgYW5kIHNxdWFyZSByb290XG4gICAgaWYgKG4gPCAxMCkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZVNxcnQpO1xuICAgIH1cblxuICAgIC8vIDMuIFRoZSBzdW0gb2YgdGhlIGZpcnN0IG4gb2RkIG51bWJlcnMgaXMgZXF1YWwgdG8gbl4yIGUuZyAxICsgMyArIDUgPSAzXjJcbiAgICBpZiAobiA+IDEgJiYgaXNTcXVhcmUobikpIHtcbiAgICAgICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VTcXJ0KTtcbiAgICB9XG5cbiAgICAvLyA0LiBUaGUgc3VtIG9mIHR3byBjb25zZWN1dGl2ZSBpbnRlZ2VycyBpcyB0aGUgZGlmZmVyZW5jZSBvZiB0aGVpciBzcXVhcmVzIGUuZyAzICsgMiA9IDNeMiAtIDJeMlxuICAgIGlmIChpc09kZChuKSkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZURpZmZlcmVuY2VTcXVhcmVzKTtcbiAgICB9XG5cbiAgICAvLyA1LiBFeHByZXNzIGEgbnVtYmVyIHVzaW5nIG11bHRpcGxpY2F0aW9uIGFuZCBhZGRpdGlvbi4gRS5nIDQgPSAxICogMyArIDFcbiAgICBpZiAobiA8PSAyMDApIHtcbiAgICAgICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VNdWxEaXZpZGUpO1xuICAgIH1cblxuICAgIC8vIDYuIE11bHRpcGx5IGFuZCBkaXZpZGUgYnkgYSByYW5kb20gbnVtYmVyLiBlLmcgMiA9ICgyKjUpLzVcbiAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZUFkZE11bHRpcGx5KTtcblxuICAgIHJldHVybiBzaHVmZmxlKGRlY29tcG9zaXRpb25zKVswXShuLCBvcGVyYXRpb25zKTtcbn07XG5cbmV4cG9ydCB7IGRlY29tcG9zZSwgY29uZGl0aW9uYWxEZWNvbXBvc2l0aW9uIH07XG4iLCIvKipcbiAqIENvbnZlcnRzIHRoZSBNYXRoSmF4IFNWRyAoVE9ETzogdGhpcyBjb2RlIHByb2R1Y2VzIHRoZSBlcnJvciBpZiB0aGUgTWF0aEpheCBpcyBodG1sKSB0byBhIHBuZyxcbiAqIGJ5IHNlcmlhbGl6aW5nIHRoZSBzdmcgaW50byBhIGRhdGEgdXJsIGFuZCBkcmF3aW5nIHRvIHRoZSBjYW52YXMsIHdoZXJlIGl0IGNhbiB0aGFuIGJlIHNlcmlhbGl6ZWRcbiAqIGludG8gYSBwbmcuXG4gKi9cblxubGV0IGRvd25sb2FkQnRuID0gPEhUTUxCdXR0b25FbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZC1pbWcnKTtcblxuLy8gSW5pdGlhdGUgZG93bmxvYWQgb2YgYmxvYlxuY29uc3QgZG93bmxvYWQgPSAoZmlsZW5hbWU6IHN0cmluZywgYmxvYjogQmxvYikgPT4ge1xuICAgIGNvbnN0IGVsZW0gPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgIGVsZW0uaHJlZiA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgIGVsZW0uZG93bmxvYWQgPSBmaWxlbmFtZTtcbiAgICBlbGVtLmNsaWNrKCk7XG59O1xuXG5jb25zdCBkb3dubG9hZFBORyA9ICgpID0+IHtcbiAgICAvLyBHZXQgdGhlIHN2ZyBmcm9tIHRoZSBwYWdlXG4gICAgdmFyIHN2ZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpITtcblxuICAgIC8vIEdldCB0aGUgY3VycmVudCBudW1iZXJcbiAgICB2YXIgbnVtYmVyID0gKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnB1dCcpKS52YWx1ZTtcblxuICAgIC8vIEluY3JlYXNlIHRoZSBTVkcncyB3aWR0aCBhbmQgaGVpZ2h0IHRvIHByb2R1Y2UgYSBiaWdnZXIgaW1hZ2VcbiAgICBsZXQgdyA9IHBhcnNlSW50KHN2Zy5nZXRBdHRyaWJ1dGUoJ3dpZHRoJykhKTtcbiAgICBsZXQgaCA9IHBhcnNlSW50KHN2Zy5nZXRBdHRyaWJ1dGUoJ2hlaWdodCcpISk7XG5cbiAgICAvLyBDb252ZXJ0IFNWRyB0byBzdHJpbmcgZGF0YVxuICAgIGNvbnN0IGRhdGEgPSBuZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKHN2Zyk7XG5cbiAgICBjb25zdCBzdmdEYXRhVXJsID0gYGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJHtidG9hKGRhdGEpfWA7XG5cbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAvLyB1cHNjYWxlIGhlaWdodCB0byBhdCBsZWFzdCA4MDBweFxuICAgIGxldCBzY2FsZUZhY3RvciA9IE1hdGgubWF4KDIsIDgwMCAvIGgpO1xuICAgIGNhbnZhcy53aWR0aCA9IHcgKiBzY2FsZUZhY3RvcjtcbiAgICBjYW52YXMuaGVpZ2h0ID0gaCAqIHNjYWxlRmFjdG9yO1xuXG4gICAgY29uc29sZS5sb2coeyB3OiBjYW52YXMud2lkdGgsIGg6IGNhbnZhcy5oZWlnaHQgfSk7XG4gICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJykhO1xuXG4gICAgY29uc3Qgc3ZnRGF0YUltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgc3ZnRGF0YUltYWdlLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgY3R4LmRyYXdJbWFnZShzdmdEYXRhSW1hZ2UsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cbiAgICAgICAgY2FudmFzLnRvQmxvYihibG9iID0+IHtcbiAgICAgICAgICAgIGlmIChibG9iID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2VyaWFsaXplIGNhbnZhcyB0byBibG9iJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb3dubG9hZChgY29tcGxpY2F0ZWQtZXhwcmVzc2lvbi10aGF0LWVxdWFscy0ke251bWJlcn1gLCBibG9iKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHN2Z0RhdGFJbWFnZS5zcmMgPSBzdmdEYXRhVXJsO1xufTtcblxuY29uc3QgbWFpbiA9ICgpID0+IHtcbiAgICBkb3dubG9hZEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGRvd25sb2FkUE5HKTtcbn07XG5leHBvcnQgeyBtYWluIH07XG4iLCJkZWNsYXJlIHZhciBNYXRoSmF4OiBhbnk7XG5cbmltcG9ydCAqIGFzIHJlcHJlc2VudGF0aW9ucyBmcm9tICcuL3JlcHJlc2VudGF0aW9ucyc7XG5pbXBvcnQgeyBDb252ZXJ0T3B0aW9ucywgb3BlcmF0aW9uIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBkZWNvbXBvc2UsIGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiB9IGZyb20gJy4vZGVjb21wb3NpdGlvbnMnO1xuaW1wb3J0ICogYXMgZG93bmxvYWRfcG5nIGZyb20gJy4vZG93bmxvYWQtcG5nJztcblxuY29uc3QgY29udmVydCA9IChudW1iZXI6IG51bWJlciwgb3B0aW9uczogQ29udmVydE9wdGlvbnMpID0+IHtcbiAgICAvLyBWYWxpZGF0aW5nIGlucHV0XG4gICAgaWYgKGlzTmFOKG51bWJlcikgfHwgbnVtYmVyID4gMTAwMCB8fCBudW1iZXIgPCAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKiBOZWVkIHRvIGFkZCBhbm90aGVyIHNsYXNoIHRvIGxhdGV4IHN0cmluZ3MgdG8gcHJldmVudCBzbGFzaCBlc2NhcGUgKi9cblxuICAgIC8vIExpc3Qgb2YgZnVuY3Rpb25zIHRoYXQgZ2VuZXJhdGUgTGFUZVggbWF0aCBleHByZXNzaW9uc1xuICAgIC8vIEZ1bmN0aW9ucyBhcmUgY2hvc2VuIHJhbmRvbWx5XG4gICAgbGV0IHBvc3NpYmxlX29wdGlvbnM6IG9wZXJhdGlvbltdID0gW107XG5cbiAgICBpZiAob3B0aW9ucy5ldWxlcnNJZGVudGl0eSkge1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gocmVwcmVzZW50YXRpb25zLmV1bGVyc0lkZW50aXR5KTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuZXhwb25lbnRpYWxMaW1pdHMpIHtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKG4gPT4gcmVwcmVzZW50YXRpb25zLmxpbWl0TmF0dXJhbExvZyhuLCBvcHRpb25zLm51bWJlclRoZW9yeSkpO1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gobiA9PiByZXByZXNlbnRhdGlvbnMubGltaXRFeHBvbmVudGlhbChuLCBvcHRpb25zLm51bWJlclRoZW9yeSkpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5wb2x5bm9taWFsTGltaXRzKSB7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChyZXByZXNlbnRhdGlvbnMubGltRGlmZlR3b1NxdWFyZXMpO1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gocmVwcmVzZW50YXRpb25zLmxpbWl0UG9seW5vbWlhbCk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuZ2VvbWV0cmljU2VyaWVzKSB7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChuID0+XG4gICAgICAgICAgICByZXByZXNlbnRhdGlvbnMuaW5maW5pdGVHZW9tZXRyaWNTZXJpZXMobiwgb3B0aW9ucy5udW1iZXJUaGVvcnkpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gZGVjb3JhdGUgZWFjaCBvcGVyYXRpb24gd2l0aCBhIGZ1bmN0aW9uIHRoYXQgY2hlY2tzIGlmIHRoZSBpbnB1dCBpcyBvZiBhIGNlcnRhaW4gZm9ybSwgYW5kIGlmIGl0IGlzIGl0IG92ZXJyaWRlcyB0aGUgZGVjb3JhdGVkIGZ1bmN0aW9uJ3MgdXN1YWwgcmVzdWx0IHdpdGggaXQncyBvd24uXG4gICAgcG9zc2libGVfb3B0aW9ucyA9IHBvc3NpYmxlX29wdGlvbnMubWFwKGYgPT4ge1xuICAgICAgICByZXR1cm4gY29uZGl0aW9uYWxEZWNvbXBvc2l0aW9uKGYsIG9wdGlvbnMpO1xuICAgIH0pO1xuXG4gICAgbGV0IGlucHV0ID0gZGVjb21wb3NlKG51bWJlciwgcG9zc2libGVfb3B0aW9ucyk7XG5cbiAgICAvLyAgRGlzYWJsZSB0aGUgZGlzcGxheSBhbmQgcmVuZGVyIGJ1dHRvbnMgdW50aWwgTWF0aEpheCBpcyBkb25lXG4gICAgdmFyIGRpc3BsYXkgPSA8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlzcGxheScpO1xuICAgIHZhciBidXR0b24gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbmRlcicpO1xuICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGRpc3BsYXkuZGlzYWJsZWQgPSB0cnVlO1xuICAgIGxldCBkb3dubG9hZEJ0biA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQtaW1nJyk7XG5cbiAgICAvLyAgQ2xlYXIgdGhlIG9sZCBvdXRwdXRcblxuICAgIGxldCBvdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3V0cHV0JykhO1xuICAgIG91dHB1dC5pbm5lckhUTUwgPSAnJztcblxuICAgIC8vICBSZXNldCB0aGUgdGV4IGxhYmVscyAoYW5kIGF1dG9tYXRpYyBlcXVhdGlvbiBudW1iZXJzLCB0aG91Z2ggdGhlcmUgYXJlbid0IGFueSBoZXJlKS5cbiAgICAvLyAgR2V0IHRoZSBjb252ZXJzaW9uIG9wdGlvbnMgKG1ldHJpY3MgYW5kIGRpc3BsYXkgc2V0dGluZ3MpXG4gICAgLy8gIENvbnZlcnQgdGhlIGlucHV0IHRvIENvbW1vbkhUTUwgb3V0cHV0IGFuZCB1c2UgYSBwcm9taXNlIHRvIHdhaXQgZm9yIGl0IHRvIGJlIHJlYWR5XG4gICAgLy8gICAgKGluIGNhc2UgYW4gZXh0ZW5zaW9uIG5lZWRzIHRvIGJlIGxvYWRlZCBkeW5hbWljYWxseSkuXG4gICAgTWF0aEpheC50ZXhSZXNldCgpO1xuICAgIHZhciBtYXRoSmF4T3B0aW9ucyA9IE1hdGhKYXguZ2V0TWV0cmljc0ZvcihvdXRwdXQpO1xuICAgIG1hdGhKYXhPcHRpb25zLmRpc3BsYXkgPSBkaXNwbGF5LmNoZWNrZWQ7XG4gICAgTWF0aEpheC50ZXgyc3ZnUHJvbWlzZShpbnB1dCwgbWF0aEpheE9wdGlvbnMpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKG5vZGU6IGFueSkge1xuICAgICAgICAgICAgLy8gIFRoZSBwcm9taXNlIHJldHVybnMgdGhlIHR5cGVzZXQgbm9kZSwgd2hpY2ggd2UgYWRkIHRvIHRoZSBvdXRwdXRcbiAgICAgICAgICAgIC8vICBUaGVuIHVwZGF0ZSB0aGUgZG9jdW1lbnQgdG8gaW5jbHVkZSB0aGUgYWRqdXN0ZWQgQ1NTIGZvciB0aGVcbiAgICAgICAgICAgIC8vICAgIGNvbnRlbnQgb2YgdGhlIG5ldyBlcXVhdGlvbi5cbiAgICAgICAgICAgIG91dHB1dC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgICAgICAgIE1hdGhKYXguc3RhcnR1cC5kb2N1bWVudC5jbGVhcigpO1xuICAgICAgICAgICAgTWF0aEpheC5zdGFydHVwLmRvY3VtZW50LnVwZGF0ZURvY3VtZW50KCk7XG4gICAgICAgICAgICAvLyBEaXNwbGF5IGRvd25sb2FkIGJ1dHRvblxuICAgICAgICAgICAgZG93bmxvYWRCdG4uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnI6IEVycm9yKSB7XG4gICAgICAgICAgICAvLyAgSWYgdGhlcmUgd2FzIGFuIGVycm9yLCBwdXQgdGhlIG1lc3NhZ2UgaW50byB0aGUgb3V0cHV0IGluc3RlYWRcbiAgICAgICAgICAgIG91dHB1dFxuICAgICAgICAgICAgICAgIC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwcmUnKSlcbiAgICAgICAgICAgICAgICAuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZXJyLm1lc3NhZ2UpKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyAgRXJyb3Igb3Igbm90LCByZS1lbmFibGUgdGhlIGRpc3BsYXkgYW5kIHJlbmRlciBidXR0b25zXG4gICAgICAgICAgICBidXR0b24uZGlzYWJsZWQgPSBkaXNwbGF5LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIH0pO1xufTtcbmNvbnN0IG1haW4gPSAoKSA9PiB7XG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JtJykgYXMgSFRNTEZvcm1FbGVtZW50O1xuICAgIGNvbnN0IG51bWJlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG5cbiAgICBjb25zdCBnYW1tYUZ1bmN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbW1hLWZ1bmN0aW9uJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBldWxlcnNJZGVudGl0eSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldWxlcnMtaWRlbnRpdHknKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGV4cG9uZW50aWFsTGltaXRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpbWl0cy1leHBvbmVudGlhbCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgcG9seW5vbWlhbExpbWl0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW1pdHMtcG9seW5vbWlhbCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgbnVtYmVyVGhlb3J5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bWJlci10aGVvcnknKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGdlb21ldHJpY1NlcmllcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW9tZXRyaWMtc2VyaWVzJykgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZXZlbnQgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGNvbnZlcnQocGFyc2VJbnQobnVtYmVyLnZhbHVlKSwge1xuICAgICAgICAgICAgZ2FtbWFGdW5jdGlvbjogZ2FtbWFGdW5jdGlvbi5jaGVja2VkLFxuICAgICAgICAgICAgZXVsZXJzSWRlbnRpdHk6IGV1bGVyc0lkZW50aXR5LmNoZWNrZWQsXG4gICAgICAgICAgICBleHBvbmVudGlhbExpbWl0czogZXhwb25lbnRpYWxMaW1pdHMuY2hlY2tlZCxcbiAgICAgICAgICAgIHBvbHlub21pYWxMaW1pdHM6IHBvbHlub21pYWxMaW1pdHMuY2hlY2tlZCxcbiAgICAgICAgICAgIG51bWJlclRoZW9yeTogbnVtYmVyVGhlb3J5LmNoZWNrZWQsXG4gICAgICAgICAgICBnZW9tZXRyaWNTZXJpZXM6IGdlb21ldHJpY1Nlcmllcy5jaGVja2VkLFxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRvd25sb2FkX3BuZy5tYWluKCk7XG59O1xuXG5tYWluKCk7XG4iXSwibmFtZXMiOlsicmFuZG9tRWxlbWVudCIsImFycmF5IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibGVuZ3RoIiwic2h1ZmZsZSIsInJhbmRvbUluZGV4IiwiY3VycmVudEluZGV4IiwiZ2NkIiwiYSIsImIiLCJfZXVsZXJQaGkiLCJuIiwieCIsImkiLCJfY2FjaGVkUHJpbWVzIiwicHJpbWVTaWV2ZSIsInB1c2giLCJwIiwicmVzUHJpbWVzIiwiX3ByaW1lU2lldmUiLCJfcHJpbWVDb3VudGluZ0Z1bmN0aW9uIiwiZmlsdGVyIiwibnVtYmVyVGhlb3J5RnVuY3Rpb25zIiwibWF0Y2hpbmdQaGlJbnB1dHMiLCJtYXRjaGluZ1BpSW5wdXRzIiwiZnVuY3Rpb25PcHRpb25zIiwibWF0Y2hpbmdJbnB1dCIsImxpbWl0UG9seW5vbWlhbCIsIm0iLCJoaWdoZXN0UG93ZXIiLCJkZW5vbWluYXRvck51bWJlck9mVGVybXMiLCJzaWducyIsIm51bWVyYXRvciIsImRlbm9taW5hdG9yIiwiY29lZiIsInBvd2VyIiwiZXVsZXJzSWRlbnRpdHkiLCJsaW1EaWZmVHdvU3F1YXJlcyIsInIiLCJ0ZXgiLCJzYW1lTnVtYmVyIiwiZGVjb21wb3NlQUJDIiwibnVtYmVyIiwib3BzIiwiZmFjdG9ycyIsImdldEZhY3RvcnMiLCJjIiwiZGVjb21wb3NlU3FydCIsInNxdWFyZSIsImRlY29tcG9zZURpZmZlcmVuY2VTcXVhcmVzIiwiY2VpbCIsImRlY29tcG9zZUFkZE11bHRpcGx5IiwicmFuZE51bSIsImRlY29tcG9zZU11bERpdmlkZSIsImRvd25sb2FkQnRuIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImRvd25sb2FkUE5HIiwic3ZnIiwicXVlcnlTZWxlY3RvciIsInZhbHVlIiwidyIsInBhcnNlSW50IiwiZ2V0QXR0cmlidXRlIiwiaCIsImRhdGEiLCJYTUxTZXJpYWxpemVyIiwic2VyaWFsaXplVG9TdHJpbmciLCJzdmdEYXRhVXJsIiwiYnRvYSIsImNhbnZhcyIsImNyZWF0ZUVsZW1lbnQiLCJzY2FsZUZhY3RvciIsIm1heCIsIndpZHRoIiwiaGVpZ2h0IiwiY29uc29sZSIsImxvZyIsImN0eCIsImdldENvbnRleHQiLCJzdmdEYXRhSW1hZ2UiLCJJbWFnZSIsIm9ubG9hZCIsImRyYXdJbWFnZSIsInRvQmxvYiIsImJsb2IiLCJFcnJvciIsImZpbGVuYW1lIiwiZWxlbSIsIndpbmRvdyIsImhyZWYiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJkb3dubG9hZCIsImNsaWNrIiwic3JjIiwiY29udmVydCIsIm9wdGlvbnMiLCJpc05hTiIsInBvc3NpYmxlX29wdGlvbnMiLCJleHBvbmVudGlhbExpbWl0cyIsIm51bWJlclRoZW9yeUVuYWJsZWQiLCJudW1iZXJUaGVvcnkiLCJwb2x5bm9taWFsTGltaXRzIiwiZ2VvbWV0cmljU2VyaWVzIiwibWFwIiwiZiIsIndyYXBwZWRGdW5jdGlvbiIsImZhYyIsImZhY3RvcmlhbHMiLCJpc0ZhY3RvcmlhbCIsImdhbW1hRnVuY3Rpb25FbmFibGVkIiwiZ2FtbWFGdW5jdGlvbiIsIk51bWJlciIsImlzSW50ZWdlciIsImxvZzIiLCJpc1BvdzIiLCJjb25kaXRpb25hbERlY29tcG9zaXRpb24iLCJpbnB1dCIsIm9wZXJhdGlvbnMiLCJtb3JlUmFuZG9tT3B0aW9ucyIsIm51bSIsInJhbmRvbU9wdGlvbjEiLCJyYW5kb21PcHRpb24yIiwicmFuZG9tT3B0aW9uMyIsInNsaWNlIiwiZGVjb21wb3NpdGlvbnMiLCJzcXJ0IiwiaXNQcmltZSIsImlzU3F1YXJlIiwiaXNPZGQiLCJkZWNvbXBvc2UiLCJkaXNwbGF5IiwiYnV0dG9uIiwiZGlzYWJsZWQiLCJvdXRwdXQiLCJpbm5lckhUTUwiLCJNYXRoSmF4IiwidGV4UmVzZXQiLCJtYXRoSmF4T3B0aW9ucyIsImdldE1ldHJpY3NGb3IiLCJjaGVja2VkIiwidGV4MnN2Z1Byb21pc2UiLCJ0aGVuIiwibm9kZSIsImFwcGVuZENoaWxkIiwic3RhcnR1cCIsImNsZWFyIiwidXBkYXRlRG9jdW1lbnQiLCJzdHlsZSIsImNhdGNoIiwiZXJyIiwiY3JlYXRlVGV4dE5vZGUiLCJtZXNzYWdlIiwiZm9ybSIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInByZXZlbnREZWZhdWx0Il0sInNvdXJjZVJvb3QiOiIifQ==