(()=>{"use strict";const t=t=>t[Math.floor(Math.random()*t.length)],e=t=>{let e,r=t.length;for(;0!=r;)e=Math.floor(Math.random()*r),r--,[t[r],t[e]]=[t[e],t[r]];return t},r=t=>{if(t<=1||t%2==0&&t>2)return!1;for(let e=3;e<=Math.sqrt(t);e+=2)if(t%e==0)return!1;return!0},n=t=>{let e=[];for(let r=0;r<=t;r++)t%r==0&&e.push(r);return e},i=t=>t>=2&&Number.isInteger(Math.log2(t)),o=(t,e)=>e?o(e,t%e):t,a=(t,e)=>`\\href{${e}}{\\color{black}{${t}}}`,l=t=>{let e=0;for(let r=1;r<=t;r++)1===o(r,t)&&e++;return e},h=(t=>{const e=[];for(let r=0;r<=t;r++)e.push(!0);e[0]=!1,e[1]=!1;for(let r=2;r*r<=t;r++)if(!0===e[r])for(let n=r*r;n<=t;n+=r)e[n]=!1;let r=[];for(let n=0;n<=t;n++)e[n]&&r.push(n);return r})(999),s=t=>h.filter((e=>e<=t)).length,m=e=>{let r=[],n=[],i=[];for(let t=1;t<=999;t++)l(t)===e&&r.push(t),s(t)===e&&n.push(t);if(r.length>0){let e=t(r);i.push(`${a("\\varphi","https://en.wikipedia.org/wiki/Euler%27s_totient_function")}(${e})`)}if(n.length>0){let e=t(n);i.push(`${a("\\pi","https://en.wikipedia.org/wiki/Prime-counting_function")}(${e})`)}return(0===i.length||Math.random()<.3)&&i.push(`${e}`),t(i)},u=t=>{if(0===t){let t=Math.floor(20*Math.random());return`{${a("\\lim_{x \\to \\infty}","https://en.wikipedia.org/wiki/List_of_limits#Functions_of_the_form_xa")}{${t}x^{-1}}}`}if(1===t)return`{${a("\\lim_{x \\to \\infty}","https://en.wikipedia.org/wiki/List_of_limits#Functions_of_the_form_xg(x)")}{x^{1/x}}}`;{let e=Math.floor(5*Math.random())+1,r=Math.floor(3*Math.random())+2,n=r-1,i=["-","+"],o=`${e*t}x^{${r}} `,a=`${e}x^{${r}} `;for(let t=r-1;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;o+=`${i[Math.floor(2*Math.random())]} ${e}x${r} `}for(let t=n;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;a+=`${i[Math.floor(2*Math.random())]} ${e}x${r} `}return`{ \\lim_{x \\to \\infty} { \\frac{${o}}{${a}}} }`}},d=t=>{const e="https://en.wikipedia.org/wiki/Euler%27s_identity";return 0!==t?`{-${t}${a("e^{\\pi i}",e)}}`:`{(${a("e^{\\pi i}",e)} + 1)}`},c=t=>{let e=Math.floor(10*Math.random())+1;if(Math.random()<.5)var r=`\\lim_{x \\to ${t-e}} \\frac{x^2 - ${e**2}}{x - ${e}}`;else r=`\\lim_{x \\to ${t+e}} \\frac{x^2 - ${e**2}}{x + ${e}}`;return`{${r}}`},f=t=>`${t}`,$=(t,e)=>{let r=n(t),i=r[Math.floor(Math.random()*r.length)],o=t/i,a=Math.floor(30*Math.random())+1;return Math.random()<.2?`{{\\left({${e[0](i)}}\\right)}{\\left({${e[1](o)}}\\right)}}`:`{ \\left({${e[0](i)} - ${e[1](a)}}\\right) \\left({${e[2](o)} + ${e[3](a)}}\\right) + {${e[3](a)}}{\\left({${e[3](o)} - ${e[3](i)} + ${e[3](a)}} \\right)} }`},p=(t,e)=>{let r=t**2;return`{\\sqrt{${e[0](r)}}}`},g=(t,e)=>{let r=Math.sqrt(t),n=`${e[0](1)}`,i=1;if(Math.random()<.2){for(let t=0;t<r-1;t++)i+=2,n+=`+ ${e[3](i)}`;return n=`{ ${n} }`,n}{let t=Math.floor(Math.random()*r-1)+1,n=r-t;return Math.random()<.5?`{ {\\left(${e[0](t)} + ${e[0](n)}\\right)}^2}`:`{ {\\left(${e[0](t)}\\right)}^2 + {${e[3](2)}}{\\left(${e[1](t)}\\right)}{\\left(${e[2](n)}\\right)} + {\\left(${e[3](n)}\\right)}^2}`}},M=(t,e)=>{let r=Math.floor(t/2),n=Math.ceil(t/2);return Math.ceil(t/2)**2<100&&Math.random()<.7?`{${e[0](n**2)} - ${e[0](r**2)}}`:`{ \\left({${e[0](n)}}\\right)^2 -  \\left({${e[1](r)}}\\right)^2}`},_=(t,e)=>{let r=Math.floor(Math.random()*t+1)+1,n=t%r,i=Math.floor(t/r);return`${e[0](i)} \\times {${e[1](r)}} + ${e[2](n)}`},x=(t,e)=>{let r=Math.floor(5*Math.random())+1;return`\\frac{${e[0](t*r)}} {${e[1](r)}}`},k=(t,r)=>{const n=(t=>{const e=[];let r=2;for(;t>=2;)t%r==0?(e.push(r),t/=r):r++;return e})(t);let i=new Map;for(const t of n)i.set(t,i.has(t)?i.get(t)+1:1);const o=e(Array.from(i.keys()));let a=Math.floor(Math.random()*(o.length-1))+1,l=o.slice(0,a),h=o.slice(a),s=l.map((t=>t**i.get(t))).reduce(((t,e)=>t*e),1),m=h.map((t=>t**i.get(t))).reduce(((t,e)=>t*e),1);return`\\operatorname{lcm}\\left(${r[0](s)}, ${r[1](m)}\\right)`},y=(t,e)=>{const r=n(t).filter((t=>t%2==1&&1!==t)),i=r[Math.floor(Math.random()*r.length)],o=t/i-(i-1)/2,a=o<0?"-":"+";return`\\sum_{k=0}^{${e[0](i-1)}} \\left(k ${a} ${e[1](Math.abs(o))}\\right)`},w=(t,e)=>{const r=t=>e[Math.floor(Math.random()*e.length)](t),n=Math.floor(Math.log10(t))+Math.floor(3*Math.random()),[i,o]=((t,e)=>{let r,n=[];for(;0!==t&&0!==e;){let i=Math.floor(t/e);void 0===r?r=i:n.push(i),[t,e]=[e,t-e*i]}return[r,n]})(t,10**n);return`{10^{${n}} \\times \\left[${r(i)};${o.map((t=>r(t))).join(",")}\\right]}`};let b=document.getElementById("download-img");const I=()=>{var t=document.querySelector("svg"),e=document.getElementById("input").value;let r=parseInt(t.getAttribute("width")),n=parseInt(t.getAttribute("height"));const i=(new XMLSerializer).serializeToString(t),o=`data:image/svg+xml;base64,${btoa(i)}`,a=document.createElement("canvas");let l=Math.max(2,800/n);a.width=r*l,a.height=n*l,console.log({w:a.width,h:a.height});const h=a.getContext("2d"),s=new Image;s.onload=()=>{h.drawImage(s,0,0,a.width,a.height),a.toBlob((t=>{if(null===t)throw new Error("Failed to serialize canvas to blob");((t,e)=>{const r=window.document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t,r.click()})(`complicated-expression-that-equals-${e}`,t)}))},s.src=o},E=(t,n)=>{if(isNaN(t)||t<0)return;let o=[];n.eulersIdentity&&o.push(d),n.exponentialLimits&&(o.push((t=>((t,e)=>{const r="https://en.wikipedia.org/wiki/List_of_limits#Natural_logarithms";if(0===t)return`{${a("\\lim_{x \\to \\infty}",r)}{ \\frac{\\ln(x)}{x} }}`;if(1===t)return`{${a("\\lim_{x \\to 1}",r)}  {\\frac{\\ln(x)}{x - 1}}}`;{let n=e?m(t):t;return`{${a("\\lim_{x \\to 0}",r)}{ \\frac{-\\ln(1 + ${n}(e^{-x} - 1))}{x} }}`}})(t,n.numberTheory))),o.push((t=>((t,e)=>{const r="https://en.wikipedia.org/wiki/List_of_limits#Sums,_products_and_composites";if(0===t)return`{${a("\\lim_{x \\to \\infty}",r)}{xe^{-x}}}`;if(1===t)return`{${a("\\lim_{x \\to 0}",r)}{ \\frac{e^x - 1}{x} }}`;{let n=e?m(t):t;return`{${a("\\lim_{x \\to 0}",r)}{ \\frac{e^{${n}x} - 1}{x} }}`}})(t,n.numberTheory)))),n.polynomialLimits&&(o.push(c),o.push(u)),n.geometricSeries&&o.push((t=>((t,e)=>{if(0===t){let t="https://en.wikipedia.org/wiki/List_of_mathematical_series#Trigonometric_functions",e=Math.floor(10*Math.random())+3;return`{${a("\\sum",t)}\\limits_{k=0}^{${e-1}} {\\sin \\left({ \\frac{2 \\pi k}{${e}} } \\right)}}`}return 1===t?`{${a("\\lim_{\\epsilon \\to 0}","https://en.wikipedia.org/wiki/Particular_values_of_the_Riemann_zeta_function#The_Riemann_zeta_function_at_0_and_1")}{ \\epsilon \\zeta(1 + \\epsilon) }}`:`{\\sum\\limits_{k=0}^\\infty {\\left({\\frac{${e?m(t-1):t-1}}{${e?m(t):t}}}\\right)^{k}}}`})(t,n.numberTheory))),o=o.map((t=>((t,e)=>r=>{if(Math.random()<=.5){const t=(t=>{const e={2:2,6:3,24:4,120:5,720:6};return t in e&&e[t]})(r);if(t)return((t,e)=>Math.random()<.5&&e?`{${a("\\Gamma","https://en.wikipedia.org/wiki/Gamma_function")} (${t+1})}`:`{\\prod_{k=1}^{${t}} k}`)(t,e.gammaFunction);if(i(r))return((t,e)=>{let r=e?m(t):t;return`{${a(`\\sum_{k=0}^{${r}}`,"https://en.wikipedia.org/wiki/List_of_mathematical_series#Binomial_coefficients_2")} {${t} \\choose k}}`})(Math.log2(r),e.numberTheory)}return t(r)})(t,n)));let l=((t,n,o)=>{let a=n;for(;a.length<4;)a.push(f);a=e(a).slice(0,4);const l=[];return 0!==t&&t<100&&(2===t||!r(t))&&l.push($),t<10&&l.push(p),t>1&&(t=>Number.isInteger(Math.sqrt(t)))(t)&&t<100&&l.push(g),(t=>t%2!=0)(t)&&l.push(M),t<=200&&l.push(x),!r(t)&&t>1&&l.push(k),!i(t)&&t>1&&l.push(y),t>1&&o.continuedFractions&&l.push(w),l.push(_),e(l)[0](t,a)})(t,o,n);var h=document.getElementById("display"),s=document.getElementById("render");s.disabled=h.disabled=!0;let b=document.getElementById("download-img"),I=document.getElementById("output");I.innerHTML="",MathJax.texReset();var E=MathJax.getMetricsFor(I);E.display=h.checked,MathJax.tex2svgPromise(l,E).then((function(t){I.appendChild(t),MathJax.startup.document.clear(),MathJax.startup.document.updateDocument(),b.style.display="block"})).catch((function(t){I.appendChild(document.createElement("pre")).appendChild(document.createTextNode(t.message))})).then((function(){s.disabled=h.disabled=!1}))};(()=>{const t=document.getElementById("form"),e=document.getElementById("input"),r=document.getElementById("gamma-function"),n=document.getElementById("eulers-identity"),i=document.getElementById("limits-exponential"),o=document.getElementById("limits-polynomial"),a=document.getElementById("number-theory"),l=document.getElementById("geometric-series"),h=document.getElementById("continued-fractions");t.addEventListener("submit",(t=>{t.preventDefault(),E(parseInt(e.value),{gammaFunction:r.checked,eulersIdentity:n.checked,exponentialLimits:i.checked,polynomialLimits:o.checked,numberTheory:a.checked,geometricSeries:l.checked,continuedFractions:h.checked})})),b.addEventListener("click",I)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwibWFwcGluZ3MiOiJtQkFZQSxNQUFNQSxFQUFvQkMsR0FDZkEsRUFBTUMsS0FBS0MsTUFBTUQsS0FBS0UsU0FBV0gsRUFBTUksU0FHNUNDLEVBQWNMLElBQ2hCLElBQ0lNLEVBREFDLEVBQWVQLEVBQU1JLE9BSXpCLEtBQXVCLEdBQWhCRyxHQUVIRCxFQUFjTCxLQUFLQyxNQUFNRCxLQUFLRSxTQUFXSSxHQUN6Q0EsS0FHQ1AsRUFBTU8sR0FBZVAsRUFBTU0sSUFBZ0IsQ0FBQ04sRUFBTU0sR0FBY04sRUFBTU8sSUFHM0UsT0FBT1AsQ0FBSyxFQU9WUSxFQUFXQyxJQUNiLEdBQUlBLEdBQUssR0FBTUEsRUFBSSxHQUFLLEdBQUtBLEVBQUksRUFBSSxPQUFPLEVBRTVDLElBQUssSUFBSUMsRUFBSSxFQUFHQSxHQUFLVCxLQUFLVSxLQUFLRixHQUFJQyxHQUFLLEVBQ3BDLEdBQUlELEVBQUlDLEdBQU0sRUFBRyxPQUFPLEVBRTVCLE9BQU8sQ0FBSSxFQUdURSxFQUFjSCxJQUNoQixJQUFJSSxFQUFVLEdBQ2QsSUFBSyxJQUFJSCxFQUFJLEVBQUdBLEdBQUtELEVBQUdDLElBQ2hCRCxFQUFJQyxHQUFNLEdBQ1ZHLEVBQVFDLEtBQUtKLEdBR3JCLE9BQU9HLENBQU8sRUFvQ1pFLEVBQVVOLEdBQWNBLEdBQUssR0FBS08sT0FBT0MsVUFBVWhCLEtBQUtpQixLQUFLVCxJQUU3RFUsRUFBTSxDQUFDQyxFQUFXQyxJQUNmQSxFQUlFRixFQUFJRSxFQUFHRCxFQUFJQyxHQUhQRCxFQU1URSxFQUFPLENBQUNDLEVBQVdDLElBQ2QsVUFBVUEscUJBQXVCRCxNQzVGdENFLEVBQWFoQixJQUNmLElBQUlpQixFQUFJLEVBRVIsSUFBSyxJQUFJaEIsRUFBSSxFQUFHQSxHQUFLRCxFQUFHQyxJQUNGLElBQWRTLEVBQUlULEVBQUdELElBQ1BpQixJQUlSLE9BQU9BLENBQUMsRUE0Qk5DLEVBekJjLENBQUNsQixJQUNqQixNQUFNbUIsRUFBYSxHQUNuQixJQUFLLElBQUlsQixFQUFJLEVBQUdBLEdBQUtELEVBQUdDLElBQ3BCa0IsRUFBV2QsTUFBSyxHQUVwQmMsRUFBVyxJQUFLLEVBQ2hCQSxFQUFXLElBQUssRUFFaEIsSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUlBLEdBQUtwQixFQUFHb0IsSUFDeEIsSUFBc0IsSUFBbEJELEVBQVdDLEdBQ1gsSUFBSyxJQUFJbkIsRUFBSW1CLEVBQUlBLEVBQUduQixHQUFLRCxFQUFHQyxHQUFLbUIsRUFDN0JELEVBQVdsQixJQUFLLEVBSzVCLElBQUlvQixFQUFZLEdBQ2hCLElBQUssSUFBSXBCLEVBQUksRUFBR0EsR0FBS0QsRUFBR0MsSUFDaEJrQixFQUFXbEIsSUFDWG9CLEVBQVVoQixLQUFLSixHQUd2QixPQUFPb0IsQ0FBUyxFQUdFQyxDQUFZLEtBRTVCQyxFQUEwQnZCLEdBQ3JCa0IsRUFBY00sUUFBT1AsR0FBS0EsR0FBS2pCLElBQUdMLE9BR3ZDOEIsRUFBeUJ6QixJQUMzQixJQUFJMEIsRUFBb0IsR0FDcEJDLEVBQW1CLEdBQ25CQyxFQUFrQixHQUV0QixJQUFLLElBQUkzQixFQUFJLEVBQUdBLEdBQUssSUFBS0EsSUFDbEJlLEVBQVVmLEtBQU9ELEdBQ2pCMEIsRUFBa0JyQixLQUFLSixHQUd2QnNCLEVBQXVCdEIsS0FBT0QsR0FDOUIyQixFQUFpQnRCLEtBQUtKLEdBSTlCLEdBQUl5QixFQUFrQi9CLE9BQVMsRUFBRyxDQUM5QixJQUFJa0MsRUFBZ0J2QyxFQUFjb0MsR0FFbENFLEVBQWdCdkIsS0FDWixHQUFHUSxFQUNDLFdBQ0EsK0RBQ0NnQixLLENBSWIsR0FBSUYsRUFBaUJoQyxPQUFTLEVBQUcsQ0FDN0IsSUFBSWtDLEVBQWdCdkMsRUFBY3FDLEdBQ2xDQyxFQUFnQnZCLEtBQ1osR0FBR1EsRUFDQyxPQUNBLDREQUNDZ0IsSyxDQVFiLE9BSitCLElBQTNCRCxFQUFnQmpDLFFBQWdCSCxLQUFLRSxTQUFXLEtBQ2hEa0MsRUFBZ0J2QixLQUFLLEdBQUdMLEtBR3JCVixFQUFjc0MsRUFBZ0IsRUFtRG5DRSxFQUFtQjlCLElBRXJCLEdBQVUsSUFBTkEsRUFBUyxDQUNULElBQUkrQixFQUFJdkMsS0FBS0MsTUFBc0IsR0FBaEJELEtBQUtFLFVBQ3hCLE1BQU8sSUFBSW1CLEVBQUsseUJBSFIsNEVBRzBDa0IsVyxDQUMvQyxHQUFVLElBQU4vQixFQUVQLE1BQU8sSUFBSWEsRUFBSyx5QkFESCx3RkFFVixDQUtILElBQUltQixFQUFJeEMsS0FBS0MsTUFBc0IsRUFBaEJELEtBQUtFLFVBQWdCLEVBRXBDdUMsRUFBZXpDLEtBQUtDLE1BQXNCLEVBQWhCRCxLQUFLRSxVQUFnQixFQUcvQ3dDLEVBQTJCRCxFQUFlLEVBRTFDRSxFQUFRLENBQUMsSUFBSyxLQUNkQyxFQUFZLEdBQUdKLEVBQUloQyxPQUFPaUMsTUFDMUJJLEVBQWMsR0FBR0wsT0FBT0MsTUFJNUIsSUFBSyxJQUFJaEMsRUFUb0JnQyxFQUFlLEVBU1BoQyxFQUFJLEVBQUdBLElBQUssQ0FDN0MsSUFBSXFDLEVBQU85QyxLQUFLQyxNQUFzQixHQUFoQkQsS0FBS0UsVUFBaUIsRUFFeEM2QyxFQUFRdEMsRUFBSSxFQUFJLEdBQUssS0FBS0EsS0FHOUJtQyxHQUFhLEdBRkZELEVBQU0zQyxLQUFLQyxNQUFzQixFQUFoQkQsS0FBS0UsY0FFVDRDLEtBQVFDLEksQ0FJcEMsSUFBSyxJQUFJdEMsRUFBSWlDLEVBQTBCakMsRUFBSSxFQUFHQSxJQUFLLENBQy9DLElBQUlxQyxFQUFPOUMsS0FBS0MsTUFBc0IsR0FBaEJELEtBQUtFLFVBQWlCLEVBRXhDNkMsRUFBUXRDLEVBQUksRUFBSSxHQUFLLEtBQUtBLEtBRzlCb0MsR0FBZSxHQUZKRixFQUFNM0MsS0FBS0MsTUFBc0IsRUFBaEJELEtBQUtFLGNBRVA0QyxLQUFRQyxJLENBR3RDLE1BQU8scUNBQXFDSCxNQUFjQyxPLEdBSzVERyxFQUFrQnhDLElBR3BCLE1BQU1lLEVBQU0sbURBRVosT0FBVSxJQUFOZixFQUNPLEtBQUtBLElBQUlhLEVBQUssYUFBY0UsTUFFNUIsS0FBS0YsRUFBSyxhQUFjRSxVLEVBd0NqQzBCLEVBQXFCekMsSUFDdkIsSUFBSStCLEVBQUl2QyxLQUFLQyxNQUFzQixHQUFoQkQsS0FBS0UsVUFBaUIsRUFDekMsR0FBSUYsS0FBS0UsU0FBVyxHQUNoQixJQUFJZ0QsRUFBTSxpQkFBaUIxQyxFQUFJK0IsbUJBQW1CQSxHQUFLLFVBQVVBLFVBRTdEVyxFQUFNLGlCQUFpQjFDLEVBQUkrQixtQkFBbUJBLEdBQUssVUFBVUEsS0FFckUsTUFBTyxJQUFJVyxJQUFNLEVBR2ZDLEVBQWMzQyxHQUFjLEdBQUdBLElDak8vQjRDLEVBQWUsQ0FBQ0MsRUFBZ0JDLEtBQ2xDLElBQUkxQyxFQUFVRCxFQUFXMEMsR0FFckJsQyxFQUFJUCxFQURVWixLQUFLQyxNQUFNRCxLQUFLRSxTQUFXVSxFQUFRVCxTQUVqRGlCLEVBQUlpQyxFQUFTbEMsRUFDYm9DLEVBQUl2RCxLQUFLQyxNQUFzQixHQUFoQkQsS0FBS0UsVUFBaUIsRUFHekMsT0FBSUYsS0FBS0UsU0FBVyxHQUNULGFBQWFvRCxFQUFJLEdBQUduQyx3QkFBd0JtQyxFQUFJLEdBQUdsQyxnQkFLbkQsYUFBYWtDLEVBQUksR0FBR25DLFFBQVFtQyxFQUFJLEdBQUdDLHVCQUF1QkQsRUFBSSxHQUFHbEMsUUFBUWtDLEVBQUksR0FDaEZDLGtCQUNhRCxFQUFJLEdBQUdDLGVBQWVELEVBQUksR0FBR2xDLFFBQVFrQyxFQUFJLEdBQUduQyxRQUFRbUMsRUFBSSxHQUNyRUMsaUIsRUFNTkMsRUFBZ0IsQ0FBQ2hELEVBQVc4QyxLQUM5QixJQUFJRyxFQUFTakQsR0FBSyxFQUNsQixNQUFPLFdBQVc4QyxFQUFJLEdBQUdHLE1BQVcsRUFJbENDLEVBQWtCLENBQUNsRCxFQUFXOEMsS0FDaEMsSUFBSUssRUFBYTNELEtBQUtVLEtBQUtGLEdBQ3ZCb0QsRUFBTSxHQUFHTixFQUFJLEdBQUcsS0FDaEJPLEVBQVMsRUFFYixHQUFJN0QsS0FBS0UsU0FBVyxHQUFLLENBQ3JCLElBQUssSUFBSU8sRUFBSSxFQUFHQSxFQUFJa0QsRUFBYSxFQUFHbEQsSUFDaENvRCxHQUFVLEVBQ1ZELEdBQU8sS0FBS04sRUFBSSxHQUFHTyxLQUd2QixPQURBRCxFQUFNLEtBQUtBLE1BQ0pBLEMsQ0FJTixDQUNELElBQUl6QyxFQUFJbkIsS0FBS0MsTUFBTUQsS0FBS0UsU0FBV3lELEVBQWEsR0FBSyxFQUNqRHZDLEVBQUl1QyxFQUFheEMsRUFHckIsT0FBSW5CLEtBQUtFLFNBQVcsR0FDVCxhQUFhb0QsRUFBSSxHQUFHbkMsUUFBUW1DLEVBQUksR0FBR2xDLGlCQUtuQyxhQUFha0MsRUFBSSxHQUFHbkMsb0JBQW9CbUMsRUFBSSxHQUFHLGNBQWNBLEVBQUksR0FDcEVuQyxzQkFDaUJtQyxFQUFJLEdBQUdsQyx5QkFBeUJrQyxFQUFJLEdBQUdsQyxnQixHQU1sRTBDLEVBQTZCLENBQUN0RCxFQUFXOEMsS0FDM0MsSUFBSW5DLEVBQUluQixLQUFLQyxNQUFNTyxFQUFJLEdBQ25CWSxFQUFJcEIsS0FBSytELEtBQUt2RCxFQUFJLEdBRXRCLE9BQUlSLEtBQUsrRCxLQUFLdkQsRUFBSSxJQUFNLEVBQUksS0FBT1IsS0FBS0UsU0FBVyxHQUN4QyxJQUFJb0QsRUFBSSxHQUFHbEMsR0FBSyxRQUFRa0MsRUFBSSxHQUFHbkMsR0FBSyxNQUVwQyxhQUFhbUMsRUFBSSxHQUFHbEMsNEJBQTRCa0MsRUFBSSxHQUFHbkMsZ0IsRUFLaEU2QyxFQUF1QixDQUFDeEQsRUFBVzhDLEtBQ3JDLElBQUlXLEVBQVVqRSxLQUFLQyxNQUFNRCxLQUFLRSxTQUFXTSxFQUFJLEdBQUssRUFDOUMrQixFQUFJL0IsRUFBSXlELEVBQ1I5QyxFQUFJbkIsS0FBS0MsTUFBTU8sRUFBSXlELEdBQ3ZCLE1BQU8sR0FBR1gsRUFBSSxHQUFHbkMsZUFBZW1DLEVBQUksR0FBR1csU0FBZVgsRUFBSSxHQUFHZixJQUFJLEVBSS9EMkIsRUFBcUIsQ0FBQzFELEVBQVc4QyxLQUNuQyxJQUFJZixFQUFJdkMsS0FBS0MsTUFBc0IsRUFBaEJELEtBQUtFLFVBQWdCLEVBQ3hDLE1BQU8sVUFBVW9ELEVBQUksR0FBRzlDLEVBQUkrQixRQUFRZSxFQUFJLEdBQUdmLEtBQUssRUFHOUM0QixFQUFlLENBQUMzRCxFQUFXOEMsS0FFN0IsTUFBTTFDLEVGMURjLENBQUNKLElBQ3JCLE1BQU1JLEVBQVUsR0FDaEIsSUFBSXdELEVBQVUsRUFFZCxLQUFPNUQsR0FBSyxHQUNKQSxFQUFJNEQsR0FBVyxHQUNmeEQsRUFBUUMsS0FBS3VELEdBQ2I1RCxHQUFLNEQsR0FFTEEsSUFHUixPQUFPeEQsQ0FBTyxFRThDRXlELENBQWdCN0QsR0FHaEMsSUFBSThELEVBQWlDLElBQUlDLElBQ3pDLElBQUssTUFBTUMsS0FBSzVELEVBQ1owRCxFQUFVRyxJQUFJRCxFQUFHRixFQUFVSSxJQUFJRixHQUFLRixFQUFVSyxJQUFJSCxHQUFNLEVBQUksR0FJaEUsTUFBTUksRUFBZXhFLEVBQVF5RSxNQUFNQyxLQUFLUixFQUFVUyxTQUdsRCxJQUFJQyxFQUFXaEYsS0FBS0MsTUFBTUQsS0FBS0UsVUFBWTBFLEVBQWF6RSxPQUFTLElBQU0sRUFHbkU4RSxFQUFTTCxFQUFhTSxNQUFNLEVBQUdGLEdBQy9CRyxFQUFTUCxFQUFhTSxNQUFNRixHQUU1QkksRUFBY0gsRUFBT0ksS0FBSTdDLEdBQUtBLEdBQUs4QixFQUFVSyxJQUFJbkMsS0FBSzhDLFFBQU8sQ0FBQ25FLEVBQUdDLElBQU1ELEVBQUlDLEdBQUcsR0FDOUVtRSxFQUFjSixFQUFPRSxLQUFJN0MsR0FBS0EsR0FBSzhCLEVBQVVLLElBQUluQyxLQUFLOEMsUUFBTyxDQUFDbkUsRUFBR0MsSUFBTUQsRUFBSUMsR0FBRyxHQUVsRixNQUFPLDZCQUE2QmtDLEVBQUksR0FBRzhCLE9BQWlCOUIsRUFBSSxHQUFHaUMsWUFBc0IsRUFHdkZDLEVBQTBCLENBQUNoRixFQUFXOEMsS0FDeEMsTUFBTW1DLEVBQWE5RSxFQUFXSCxHQUFHd0IsUUFBT3dDLEdBQUtBLEVBQUksR0FBSyxHQUFXLElBQU5BLElBRXJEa0IsRUFBZUQsRUFBV3pGLEtBQUtDLE1BQU1ELEtBQUtFLFNBQVd1RixFQUFXdEYsU0FLaEV3RixFQUpTbkYsRUFBSWtGLEdBRUNBLEVBQWUsR0FBSyxFQUdsQ0UsRUFBZUQsRUFBVyxFQUFJLElBQU0sSUFFMUMsTUFBTyxnQkFBZ0JyQyxFQUFJLEdBQUdvQyxFQUFlLGdCQUFnQkUsS0FBZ0J0QyxFQUFJLEdBQzdFdEQsS0FBSzZGLElBQUlGLGFBQ0YsRUFHVEcsRUFBNkIsQ0FBQ3RGLEVBQVc4QyxLQUUzQyxNQUFNZixFQUFLL0IsR0FDQThDLEVBQUl0RCxLQUFLQyxNQUFNRCxLQUFLRSxTQUFXb0QsRUFBSW5ELFNBQVNLLEdBR2pEdUYsRUFBUS9GLEtBQUtDLE1BQU1ELEtBQUtnRyxNQUFNeEYsSUFBTVIsS0FBS0MsTUFBc0IsRUFBaEJELEtBQUtFLFdBRW5EK0YsRUFBU0MsR0Y1RE0sRUFBQ3RELEVBQW1CQyxLQUMxQyxJQUFJc0QsRUFDQUMsRUFBa0MsR0FDdEMsS0FBcUIsSUFBZHhELEdBQW1DLElBQWhCQyxHQUFtQixDQUN6QyxJQUFJd0QsRUFBWXJHLEtBQUtDLE1BQU0yQyxFQUFZQyxRQUVKeUQsSUFBL0JILEVBQ0FBLEVBQTZCRSxFQUU3QkQsRUFBc0J2RixLQUFLd0YsSUFHOUJ6RCxFQUFXQyxHQUFlLENBQUNBLEVBQWFELEVBQVlDLEVBQWN3RCxFLENBR3ZFLE1BQU8sQ0FBQ0YsRUFBNkJDLEVBQXNCLEVFNkNwQ0csQ0FBa0IvRixFQUFHLElBQU11RixHQUVsRCxNQUFPLFFBQVFBLHFCQUF5QnhELEVBQUUwRCxNQUFZQyxFQUFJYixLQUFJN0MsR0FBS0QsRUFBRUMsS0FBSWdFLEtBQUssZUFBZSxFQy9KakcsSUFBSUMsRUFBaUNDLFNBQVNDLGVBQWUsZ0JBRzdELE1BT01DLEVBQWMsS0FFaEIsSUFBSUMsRUFBTUgsU0FBU0ksY0FBYyxPQUc3QnpELEVBQTRCcUQsU0FBU0MsZUFBZSxTQUFVSSxNQUdsRSxJQUFJQyxFQUFJQyxTQUFTSixFQUFJSyxhQUFhLFVBQzlCQyxFQUFJRixTQUFTSixFQUFJSyxhQUFhLFdBR2xDLE1BQU1FLEdBQU8sSUFBSUMsZUFBZ0JDLGtCQUFrQlQsR0FFN0NVLEVBQWEsNkJBQTZCQyxLQUFLSixLQUUvQ0ssRUFBU2YsU0FBU2dCLGNBQWMsVUFFdEMsSUFBSUMsRUFBYzNILEtBQUs0SCxJQUFJLEVBQUcsSUFBTVQsR0FDcENNLEVBQU9JLE1BQVFiLEVBQUlXLEVBQ25CRixFQUFPSyxPQUFTWCxFQUFJUSxFQUVwQkksUUFBUUMsSUFBSSxDQUFFaEIsRUFBR1MsRUFBT0ksTUFBT1YsRUFBR00sRUFBT0ssU0FDekMsTUFBTUcsRUFBTVIsRUFBT1MsV0FBVyxNQUV4QkMsRUFBZSxJQUFJQyxNQUN6QkQsRUFBYUUsT0FBUyxLQUNsQkosRUFBSUssVUFBVUgsRUFBYyxFQUFHLEVBQUdWLEVBQU9JLE1BQU9KLEVBQU9LLFFBRXZETCxFQUFPYyxRQUFPQyxJQUNWLEdBQWEsT0FBVEEsRUFDQSxNQUFNLElBQUlDLE1BQU0sc0NBdENmLEVBQUNDLEVBQWtCRixLQUNoQyxNQUFNRyxFQUFPQyxPQUFPbEMsU0FBU2dCLGNBQWMsS0FDM0NpQixFQUFLdEgsS0FBT3VILE9BQU9DLElBQUlDLGdCQUFnQk4sR0FDdkNHLEVBQUtJLFNBQVdMLEVBQ2hCQyxFQUFLSyxPQUFPLEVBb0NKRCxDQUFTLHNDQUFzQzFGLElBQVVtRixFQUFLLEdBQ2hFLEVBR05MLEVBQWFjLElBQU0xQixDQUFVLEVDOUMzQjJCLEVBQVUsQ0FBQzdGLEVBQWdCOEYsS0FFN0IsR0FBSUMsTUFBTS9GLElBQVdBLEVBQVMsRUFDMUIsT0FPSixJQUFJZ0csRUFBZ0MsR0FFaENGLEVBQVFuRyxnQkFDUnFHLEVBQWlCeEksS0FBSyxHQUV0QnNJLEVBQVFHLG9CQUNSRCxFQUFpQnhJLE1BQUtMLEdIMkZOLEVBQUNBLEVBQVcrSSxLQUNoQyxNQUFNaEksRUFBTSxrRUFFWixHQUFVLElBQU5mLEVBQ0EsTUFBTyxJQUFJYSxFQUFLLHlCQUEwQkUsNEJBQ3ZDLEdBQVUsSUFBTmYsRUFDUCxNQUFPLElBQUlhLEVBQUssbUJBQW9CRSxnQ0FDakMsQ0FDSCxJQUFJRSxFQUFJOEgsRUFBc0J0SCxFQUFzQnpCLEdBQUtBLEVBQ3pELE1BQU8sSUFBSWEsRUFBSyxtQkFBb0JFLHdCQUEwQkUsdUIsR0dwR25DLENBQWdDakIsRUFBRzJJLEVBQVFLLGdCQUN0RUgsRUFBaUJ4SSxNQUFLTCxHSHdHTCxFQUFDQSxFQUFXK0ksS0FDakMsTUFBTWhJLEVBQU0sNkVBRVosR0FBVSxJQUFOZixFQUNBLE1BQU8sSUFBSWEsRUFBSyx5QkFBMEJFLGVBQ3ZDLEdBQVUsSUFBTmYsRUFDUCxNQUFPLElBQUlhLEVBQUssbUJBQW9CRSw0QkFDakMsQ0FDSCxJQUFJRSxFQUFJOEgsRUFBc0J0SCxFQUFzQnpCLEdBQUtBLEVBQ3pELE1BQU8sSUFBSWEsRUFBSyxtQkFBb0JFLGlCQUFtQkUsZ0IsR0dqSDVCLENBQWlDakIsRUFBRzJJLEVBQVFLLGlCQUV2RUwsRUFBUU0sbUJBQ1JKLEVBQWlCeEksS0FBSyxHQUN0QndJLEVBQWlCeEksS0FBSyxJQUd0QnNJLEVBQVFPLGlCQUNSTCxFQUFpQnhJLE1BQUtMLEdINktFLEVBQUNBLEVBQVcrSSxLQUN4QyxHQUFVLElBQU4vSSxFQUFTLENBQ1QsSUFBSWUsRUFDQSxvRkFDQWdCLEVBQUl2QyxLQUFLQyxNQUFzQixHQUFoQkQsS0FBS0UsVUFBaUIsRUFDekMsTUFBTyxJQUFJbUIsRUFBSyxRQUFTRSxxQkFBdUJnQixFQUM1Qyx1Q0FBdUNBLGlCLENBSTFDLE9BQVUsSUFBTi9CLEVBSUUsSUFBSWEsRUFBSywyQkFGWiwySkFRRyxnREFGRWtJLEVBQXNCdEgsRUFBc0J6QixFQUFJLEdBQUtBLEVBQUksTUFDekQrSSxFQUFzQnRILEVBQXNCekIsR0FBS0EsbUIsRUcvTHRELENBQXdDQSxFQUFHMkksRUFBUUssZ0JBSzNESCxFQUFtQkEsRUFBaUJoRSxLQUFJYixHRm9JWCxFQUM3Qm1GLEVBQ0FSLElBRVEzSSxJQUNKLEdBQUlSLEtBQUtFLFVBQVksR0FBSyxDQUV0QixNQUFNMEosRUZ4R0UsQ0FBQ3BKLElBQ2pCLE1BQU1xSixFQUF3QyxDQUMxQyxFQUFHLEVBQ0gsRUFBRyxFQUNILEdBQUksRUFDSixJQUFLLEVBQ0wsSUFBSyxHQUdULE9BQUlySixLQUFLcUosR0FDRUEsRUFBV3JKLEUsRUU4RkZzSixDQUFZdEosR0FDeEIsR0FBSW9KLEVBRUEsTUR0RkUsRUFBQ3BKLEVBQVd1SixJQUN0Qi9KLEtBQUtFLFNBQVcsSUFBTzZKLEVBRWhCLElBQUkxSSxFQUFLLFVBQVcsb0RBQW9EYixFQUFJLE1BRzVFLGtCQUFrQkEsUUNnRlYsQ0FBMEJvSixFQUFLVCxFQUFRYSxlQUdsRCxHQUFJbEosRUFBT04sR0FDUCxNRC9FRyxFQUFDQSxFQUFXK0ksS0FDM0IsSUFBSTlILEVBQUk4SCxFQUFzQnRILEVBQXNCekIsR0FBS0EsRUFDekQsTUFBTyxJQUFJYSxFQUNQLGdCQUFnQkksS0FDaEIseUZBQ0VqQixnQkFBZ0IsRUMwRUgsQ0FBMkJSLEtBQUtpQixLQUFLVCxHQUFJMkksRUFBUUssYSxDQUloRSxPQUFPRyxFQUFnQm5KLEVBQUUsRUVySmxCeUosQ0FBeUJ6RixFQUFHMkUsS0FHdkMsSUFBSWUsRUZ1SlUsRUFBQzFKLEVBQVcySixFQUFtQ2hCLEtBQzdELElBQUlpQixFQUFhRCxFQUdqQixLQUFPQyxFQUFXakssT0FBUyxHQUN2QmlLLEVBQVd2SixLQUFLLEdBR3BCdUosRUFBYWhLLEVBQVFnSyxHQUFZbEYsTUFBTSxFQUFHLEdBRTFDLE1BQU1tRixFQUFrQyxHQTBDeEMsT0F2Q1UsSUFBTjdKLEdBQVdBLEVBQUksTUFBYyxJQUFOQSxJQUFZRCxFQUFRQyxLQUMzQzZKLEVBQWV4SixLQUFLdUMsR0FJcEI1QyxFQUFJLElBQ0o2SixFQUFleEosS0FBSzJDLEdBSXBCaEQsRUFBSSxHRnJMSyxDQUFDQSxHQUFjTyxPQUFPQyxVQUFVaEIsS0FBS1UsS0FBS0YsSUVxTDFDOEosQ0FBUzlKLElBQU1BLEVBQUksS0FDNUI2SixFQUFleEosS0FBSzZDLEdGeExkLENBQUNsRCxHQUFjQSxFQUFJLEdBQU0sRUU0TC9CK0osQ0FBTS9KLElBQ042SixFQUFleEosS0FBS2lELEdBSXBCdEQsR0FBSyxLQUNMNkosRUFBZXhKLEtBQUtxRCxJQUduQjNELEVBQVFDLElBQU1BLEVBQUksR0FDbkI2SixFQUFleEosS0FBS3NELElBR25CckQsRUFBT04sSUFBTUEsRUFBSSxHQUNsQjZKLEVBQWV4SixLQUFLMkUsR0FHcEJoRixFQUFJLEdBQUsySSxFQUFRcUIsb0JBQ2pCSCxFQUFleEosS0FBS2lGLEdBSXhCdUUsRUFBZXhKLEtBQUttRCxHQUViNUQsRUFBUWlLLEdBQWdCLEdBQUc3SixFQUFHNEosRUFBVyxFRTNNcENLLENBQVVwSCxFQUFRZ0csRUFBa0JGLEdBR2hELElBQUl1QixFQUE0QmhFLFNBQVNDLGVBQWUsV0FDcERnRSxFQUE0QmpFLFNBQVNDLGVBQWUsVUFDeERnRSxFQUFPQyxTQUFXRixFQUFRRSxVQUFXLEVBQ3JDLElBQUluRSxFQUFpQ0MsU0FBU0MsZUFBZSxnQkFJekRrRSxFQUFTbkUsU0FBU0MsZUFBZSxVQUNyQ2tFLEVBQU9DLFVBQVksR0FNbkJDLFFBQVFDLFdBQ1IsSUFBSUMsRUFBaUJGLFFBQVFHLGNBQWNMLEdBQzNDSSxFQUFlUCxRQUFVQSxFQUFRUyxRQUNqQ0osUUFBUUssZUFBZWxCLEVBQU9lLEdBQ3pCSSxNQUFLLFNBQVNDLEdBSVhULEVBQU9VLFlBQVlELEdBQ25CUCxRQUFRUyxRQUFROUUsU0FBUytFLFFBQ3pCVixRQUFRUyxRQUFROUUsU0FBU2dGLGlCQUV6QmpGLEVBQVlrRixNQUFNakIsUUFBVSxPQUNoQyxJQUNDa0IsT0FBTSxTQUFTQyxHQUVaaEIsRUFDS1UsWUFBWTdFLFNBQVNnQixjQUFjLFFBQ25DNkQsWUFBWTdFLFNBQVNvRixlQUFlRCxFQUFJRSxTQUNqRCxJQUNDVixNQUFLLFdBRUZWLEVBQU9DLFNBQVdGLEVBQVFFLFVBQVcsQ0FDekMsR0FBRSxFQUVHLE1BQ1QsTUFBTW9CLEVBQU90RixTQUFTQyxlQUFlLFFBQy9CdEQsRUFBU3FELFNBQVNDLGVBQWUsU0FFakNxRCxFQUFnQnRELFNBQVNDLGVBQWUsa0JBQ3hDM0QsRUFBaUIwRCxTQUFTQyxlQUFlLG1CQUN6QzJDLEVBQW9CNUMsU0FBU0MsZUFBZSxzQkFDNUM4QyxFQUFtQi9DLFNBQVNDLGVBQWUscUJBQzNDNkMsRUFBZTlDLFNBQVNDLGVBQWUsaUJBQ3ZDK0MsRUFBa0JoRCxTQUFTQyxlQUFlLG9CQUMxQzZELEVBQXFCOUQsU0FBU0MsZUFBZSx1QkFFbkRxRixFQUFLQyxpQkFBaUIsVUFBVUMsSUFDNUJBLEVBQU1DLGlCQUVOakQsRUFBUWpDLFNBQVM1RCxFQUFPMEQsT0FBUSxDQUM1QmlELGNBQWVBLEVBQWNtQixRQUM3Qm5JLGVBQWdCQSxFQUFlbUksUUFDL0I3QixrQkFBbUJBLEVBQWtCNkIsUUFDckMxQixpQkFBa0JBLEVBQWlCMEIsUUFDbkMzQixhQUFjQSxFQUFhMkIsUUFDM0J6QixnQkFBaUJBLEVBQWdCeUIsUUFDakNYLG1CQUFvQkEsRUFBbUJXLFNBQ3pDLElEbEROMUUsRUFBWXdGLGlCQUFpQixRQUFTckYsRUNxRG5CLEVBR3ZCLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy91dGlscy50cyIsIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy9yZXByZXNlbnRhdGlvbnMudHMiLCJ3ZWJwYWNrOi8vbnVtMm1hdGgvLi9zcmMvZGVjb21wb3NpdGlvbnMudHMiLCJ3ZWJwYWNrOi8vbnVtMm1hdGgvLi9zcmMvZG93bmxvYWQtcG5nLnRzIiwid2VicGFjazovL251bTJtYXRoLy4vc3JjL3NjcmlwdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIG9wZXJhdGlvbiA9IChuOiBudW1iZXIpID0+IHN0cmluZztcblxudHlwZSBDb252ZXJ0T3B0aW9ucyA9IHtcbiAgICBnYW1tYUZ1bmN0aW9uOiBib29sZWFuO1xuICAgIGV1bGVyc0lkZW50aXR5OiBib29sZWFuO1xuICAgIGV4cG9uZW50aWFsTGltaXRzOiBib29sZWFuO1xuICAgIHBvbHlub21pYWxMaW1pdHM6IGJvb2xlYW47XG4gICAgbnVtYmVyVGhlb3J5OiBib29sZWFuO1xuICAgIGdlb21ldHJpY1NlcmllczogYm9vbGVhbjtcbiAgICBjb250aW51ZWRGcmFjdGlvbnM6IGJvb2xlYW47XG59O1xuXG5jb25zdCByYW5kb21FbGVtZW50ID0gPEE+KGFycmF5OiBBW10pID0+IHtcbiAgICByZXR1cm4gYXJyYXlbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJyYXkubGVuZ3RoKV07XG59O1xuXG5jb25zdCBzaHVmZmxlID0gPEE+KGFycmF5OiBBW10pID0+IHtcbiAgICBsZXQgY3VycmVudEluZGV4ID0gYXJyYXkubGVuZ3RoLFxuICAgICAgICByYW5kb21JbmRleDtcblxuICAgIC8vIFdoaWxlIHRoZXJlIHJlbWFpbiBlbGVtZW50cyB0byBzaHVmZmxlLlxuICAgIHdoaWxlIChjdXJyZW50SW5kZXggIT0gMCkge1xuICAgICAgICAvLyBQaWNrIGEgcmVtYWluaW5nIGVsZW1lbnQuXG4gICAgICAgIHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY3VycmVudEluZGV4KTtcbiAgICAgICAgY3VycmVudEluZGV4LS07XG5cbiAgICAgICAgLy8gQW5kIHN3YXAgaXQgd2l0aCB0aGUgY3VycmVudCBlbGVtZW50LlxuICAgICAgICBbYXJyYXlbY3VycmVudEluZGV4XSwgYXJyYXlbcmFuZG9tSW5kZXhdXSA9IFthcnJheVtyYW5kb21JbmRleF0sIGFycmF5W2N1cnJlbnRJbmRleF1dO1xuICAgIH1cblxuICAgIHJldHVybiBhcnJheTtcbn07XG5cbmNvbnN0IGlzT2RkID0gKG46IG51bWJlcikgPT4gbiAlIDIgIT09IDA7XG5cbmNvbnN0IGlzU3F1YXJlID0gKG46IG51bWJlcikgPT4gTnVtYmVyLmlzSW50ZWdlcihNYXRoLnNxcnQobikpO1xuXG5jb25zdCBpc1ByaW1lID0gKG46IG51bWJlcikgPT4ge1xuICAgIGlmIChuIDw9IDEgfHwgKG4gJSAyID09IDAgJiYgbiA+IDIpKSByZXR1cm4gZmFsc2U7XG5cbiAgICBmb3IgKGxldCBpID0gMzsgaSA8PSBNYXRoLnNxcnQobik7IGkgKz0gMikge1xuICAgICAgICBpZiAobiAlIGkgPT09IDApIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59O1xuXG5jb25zdCBnZXRGYWN0b3JzID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCBmYWN0b3JzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbjsgaSsrKSB7XG4gICAgICAgIGlmIChuICUgaSA9PT0gMCkge1xuICAgICAgICAgICAgZmFjdG9ycy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWN0b3JzO1xufTtcblxuLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzUzNjQzMzQwLzEzOTk2Mzg5XG5jb25zdCBnZXRQcmltZUZhY3RvcnMgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgZmFjdG9ycyA9IFtdO1xuICAgIGxldCBkaXZpc29yID0gMjtcblxuICAgIHdoaWxlIChuID49IDIpIHtcbiAgICAgICAgaWYgKG4gJSBkaXZpc29yID09IDApIHtcbiAgICAgICAgICAgIGZhY3RvcnMucHVzaChkaXZpc29yKTtcbiAgICAgICAgICAgIG4gLz0gZGl2aXNvcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRpdmlzb3IrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFjdG9ycztcbn07XG5cbi8vIENoZWNraW5nIGlmIGEgbnVtYmVyIGNhbiBiZSBmb3JtZWQgdXNpbmcgZmFjdG9yaWFsXG5jb25zdCBpc0ZhY3RvcmlhbCA9IChuOiBudW1iZXIpID0+IHtcbiAgICBjb25zdCBmYWN0b3JpYWxzOiB7IFtrZXk6IG51bWJlcl06IG51bWJlciB9ID0ge1xuICAgICAgICAyOiAyLFxuICAgICAgICA2OiAzLFxuICAgICAgICAyNDogNCxcbiAgICAgICAgMTIwOiA1LFxuICAgICAgICA3MjA6IDYsXG4gICAgfTtcblxuICAgIGlmIChuIGluIGZhY3RvcmlhbHMpIHtcbiAgICAgICAgcmV0dXJuIGZhY3RvcmlhbHNbbl07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn07XG5cbmNvbnN0IGlzUG93MiA9IChuOiBudW1iZXIpID0+IG4gPj0gMiAmJiBOdW1iZXIuaXNJbnRlZ2VyKE1hdGgubG9nMihuKSk7XG5cbmNvbnN0IGdjZCA9IChhOiBudW1iZXIsIGI6IG51bWJlcik6IG51bWJlciA9PiB7XG4gICAgaWYgKCFiKSB7XG4gICAgICAgIHJldHVybiBhO1xuICAgIH1cblxuICAgIHJldHVybiBnY2QoYiwgYSAlIGIpO1xufTtcblxuY29uc3QgaHJlZiA9IChzOiBzdHJpbmcsIHVybDogc3RyaW5nKSA9PiB7XG4gICAgcmV0dXJuIGBcXFxcaHJlZnske3VybH19e1xcXFxjb2xvcntibGFja317JHtzfX19YDtcbn07XG5cbmNvbnN0IGNvbnRpbnVlZEZyYWN0aW9uID0gKG51bWVyYXRvcjogbnVtYmVyLCBkZW5vbWluYXRvcjogbnVtYmVyKTogW251bWJlciwgbnVtYmVyW11dID0+IHtcbiAgICBsZXQgY29udGludWVkRnJhY3Rpb25XaG9sZVBhcnQ6IG51bWJlciB8IHVuZGVmaW5lZDtcbiAgICBsZXQgY29udGludWVkRnJhY3Rpb25QYXJ0OiBudW1iZXJbXSA9IFtdO1xuICAgIHdoaWxlIChudW1lcmF0b3IgIT09IDAgJiYgZGVub21pbmF0b3IgIT09IDApIHtcbiAgICAgICAgbGV0IHdob2xlUGFydCA9IE1hdGguZmxvb3IobnVtZXJhdG9yIC8gZGVub21pbmF0b3IpO1xuXG4gICAgICAgIGlmIChjb250aW51ZWRGcmFjdGlvbldob2xlUGFydCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb250aW51ZWRGcmFjdGlvbldob2xlUGFydCA9IHdob2xlUGFydDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRpbnVlZEZyYWN0aW9uUGFydC5wdXNoKHdob2xlUGFydCk7XG4gICAgICAgIH1cblxuICAgICAgICBbbnVtZXJhdG9yLCBkZW5vbWluYXRvcl0gPSBbZGVub21pbmF0b3IsIG51bWVyYXRvciAtIGRlbm9taW5hdG9yICogd2hvbGVQYXJ0XTtcbiAgICB9XG5cbiAgICByZXR1cm4gW2NvbnRpbnVlZEZyYWN0aW9uV2hvbGVQYXJ0ISwgY29udGludWVkRnJhY3Rpb25QYXJ0XTtcbn07XG5cbmV4cG9ydCB7XG4gICAgb3BlcmF0aW9uLFxuICAgIENvbnZlcnRPcHRpb25zLFxuICAgIHJhbmRvbUVsZW1lbnQsXG4gICAgc2h1ZmZsZSxcbiAgICBpc09kZCxcbiAgICBpc1NxdWFyZSxcbiAgICBpc1ByaW1lLFxuICAgIGdldEZhY3RvcnMsXG4gICAgZ2V0UHJpbWVGYWN0b3JzLFxuICAgIGlzRmFjdG9yaWFsLFxuICAgIGlzUG93MixcbiAgICBnY2QsXG4gICAgaHJlZixcbiAgICBjb250aW51ZWRGcmFjdGlvbixcbn07XG4iLCIvKipcbiAqIEV4cGxvaXRzIHRoZSBbU3Ryb25nIGxhdyBvZiBzbWFsbCBudW1iZXJzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TdHJvbmdfbGF3X29mX3NtYWxsX251bWJlcnMpIHRvXG4gKiBmaW5kIHByb3BlcnRpZXMgb2YgdGhlIHNtYWxsZXIgbnVtYmVycyBnaXZlbiBieSB0aGUgZGVjb21wb3NpdGlvbnMsIHN1Y2ggYXMgdGhlIGV1bGVyIHBoaSBhbmQgcHJpbWUgY291bnRpbmcgZnVuY3Rpb25zLFxuICogZmFjdG9yaWFsL2dhbW1hLCBhbmQgbW9yZS5cbiAqL1xuXG5pbXBvcnQgeyBnY2QsIHJhbmRvbUVsZW1lbnQsIGhyZWYgfSBmcm9tICcuL3V0aWxzJztcblxuY29uc3QgX2V1bGVyUGhpID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCB4ID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IG47IGkrKykge1xuICAgICAgICBpZiAoZ2NkKGksIG4pID09PSAxKSB7XG4gICAgICAgICAgICB4Kys7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geDtcbn07XG5cbmNvbnN0IF9wcmltZVNpZXZlID0gKG46IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHByaW1lU2lldmUgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgcHJpbWVTaWV2ZS5wdXNoKHRydWUpO1xuICAgIH1cbiAgICBwcmltZVNpZXZlWzBdID0gZmFsc2U7XG4gICAgcHJpbWVTaWV2ZVsxXSA9IGZhbHNlO1xuXG4gICAgZm9yIChsZXQgcCA9IDI7IHAgKiBwIDw9IG47IHArKykge1xuICAgICAgICBpZiAocHJpbWVTaWV2ZVtwXSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHAgKiBwOyBpIDw9IG47IGkgKz0gcCkge1xuICAgICAgICAgICAgICAgIHByaW1lU2lldmVbaV0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxldCByZXNQcmltZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgaWYgKHByaW1lU2lldmVbaV0pIHtcbiAgICAgICAgICAgIHJlc1ByaW1lcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXNQcmltZXM7XG59O1xuXG5jb25zdCBfY2FjaGVkUHJpbWVzID0gX3ByaW1lU2lldmUoOTk5KTtcblxuY29uc3QgX3ByaW1lQ291bnRpbmdGdW5jdGlvbiA9IChuOiBudW1iZXIpID0+IHtcbiAgICByZXR1cm4gX2NhY2hlZFByaW1lcy5maWx0ZXIoeCA9PiB4IDw9IG4pLmxlbmd0aDtcbn07XG5cbmNvbnN0IG51bWJlclRoZW9yeUZ1bmN0aW9ucyA9IChuOiBudW1iZXIpID0+IHtcbiAgICBsZXQgbWF0Y2hpbmdQaGlJbnB1dHMgPSBbXTtcbiAgICBsZXQgbWF0Y2hpbmdQaUlucHV0cyA9IFtdO1xuICAgIGxldCBmdW5jdGlvbk9wdGlvbnMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDk5OTsgaSsrKSB7XG4gICAgICAgIGlmIChfZXVsZXJQaGkoaSkgPT09IG4pIHtcbiAgICAgICAgICAgIG1hdGNoaW5nUGhpSW5wdXRzLnB1c2goaSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoX3ByaW1lQ291bnRpbmdGdW5jdGlvbihpKSA9PT0gbikge1xuICAgICAgICAgICAgbWF0Y2hpbmdQaUlucHV0cy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1hdGNoaW5nUGhpSW5wdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IG1hdGNoaW5nSW5wdXQgPSByYW5kb21FbGVtZW50KG1hdGNoaW5nUGhpSW5wdXRzKTtcblxuICAgICAgICBmdW5jdGlvbk9wdGlvbnMucHVzaChcbiAgICAgICAgICAgIGAke2hyZWYoXG4gICAgICAgICAgICAgICAgJ1xcXFx2YXJwaGknLFxuICAgICAgICAgICAgICAgICdodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdWxlciUyN3NfdG90aWVudF9mdW5jdGlvbidcbiAgICAgICAgICAgICl9KCR7bWF0Y2hpbmdJbnB1dH0pYFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGlmIChtYXRjaGluZ1BpSW5wdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IG1hdGNoaW5nSW5wdXQgPSByYW5kb21FbGVtZW50KG1hdGNoaW5nUGlJbnB1dHMpO1xuICAgICAgICBmdW5jdGlvbk9wdGlvbnMucHVzaChcbiAgICAgICAgICAgIGAke2hyZWYoXG4gICAgICAgICAgICAgICAgJ1xcXFxwaScsXG4gICAgICAgICAgICAgICAgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1ByaW1lLWNvdW50aW5nX2Z1bmN0aW9uJ1xuICAgICAgICAgICAgKX0oJHttYXRjaGluZ0lucHV0fSlgXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGZ1bmN0aW9uT3B0aW9ucy5sZW5ndGggPT09IDAgfHwgTWF0aC5yYW5kb20oKSA8IDAuMykge1xuICAgICAgICBmdW5jdGlvbk9wdGlvbnMucHVzaChgJHtufWApO1xuICAgIH1cblxuICAgIHJldHVybiByYW5kb21FbGVtZW50KGZ1bmN0aW9uT3B0aW9ucyk7XG59O1xuXG5jb25zdCBmYWN0b3JpYWwgPSAobjogbnVtYmVyLCBnYW1tYUZ1bmN0aW9uRW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC41ICYmIGdhbW1hRnVuY3Rpb25FbmFibGVkKSB7XG4gICAgICAgIC8vIM6TKG4pID0gKG4tMSkhXG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXEdhbW1hJywgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0dhbW1hX2Z1bmN0aW9uJyl9ICgke24gKyAxfSl9YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBVc2luZyB0aGUgcGkgcHJvZHVjdCBub3RhdGlvbiBvZiBmYWN0b3JpYWxcbiAgICAgICAgcmV0dXJuIGB7XFxcXHByb2Rfe2s9MX1eeyR7bn19IGt9YDtcbiAgICB9XG59O1xuXG4vLyByZXByZXNlbnRhdGlvbiBvZiAyXm5cbmNvbnN0IHBvdzJDaG9vc2UgPSAobjogbnVtYmVyLCBudW1iZXJUaGVvcnlFbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgbGV0IHggPSBudW1iZXJUaGVvcnlFbmFibGVkID8gbnVtYmVyVGhlb3J5RnVuY3Rpb25zKG4pIDogbjtcbiAgICByZXR1cm4gYHske2hyZWYoXG4gICAgICAgIGBcXFxcc3VtX3trPTB9Xnske3h9fWAsXG4gICAgICAgICdodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX21hdGhlbWF0aWNhbF9zZXJpZXMjQmlub21pYWxfY29lZmZpY2llbnRzXzInXG4gICAgKX0geyR7bn0gXFxcXGNob29zZSBrfX1gO1xufTtcblxuLy8gTGltaXRzIG9mIG5hdHVyYWwgbG9nIGZ1bmN0aW9uczogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjTmF0dXJhbF9sb2dhcml0aG1zXG5jb25zdCBsaW1pdE5hdHVyYWxMb2cgPSAobjogbnVtYmVyLCBudW1iZXJUaGVvcnlFbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI05hdHVyYWxfbG9nYXJpdGhtcyc7XG5cbiAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICByZXR1cm4gYHske2hyZWYoJ1xcXFxsaW1fe3ggXFxcXHRvIFxcXFxpbmZ0eX0nLCB1cmwpfXsgXFxcXGZyYWN7XFxcXGxuKHgpfXt4fSB9fWA7XG4gICAgfSBlbHNlIGlmIChuID09PSAxKSB7XG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXGxpbV97eCBcXFxcdG8gMX0nLCB1cmwpfSAge1xcXFxmcmFje1xcXFxsbih4KX17eCAtIDF9fX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCB4ID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuKSA6IG47XG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXGxpbV97eCBcXFxcdG8gMH0nLCB1cmwpfXsgXFxcXGZyYWN7LVxcXFxsbigxICsgJHt4fShlXnsteH0gLSAxKSl9e3h9IH19YDtcbiAgICB9XG59O1xuXG4vLyBMaW1pdHMgb2YgZXhwb25lbnRpYWwgZnVuY3Rpb25zOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX2xpbWl0cyNTdW1zLF9wcm9kdWN0c19hbmRfY29tcG9zaXRlc1xuY29uc3QgbGltaXRFeHBvbmVudGlhbCA9IChuOiBudW1iZXIsIG51bWJlclRoZW9yeUVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjU3VtcyxfcHJvZHVjdHNfYW5kX2NvbXBvc2l0ZXMnO1xuXG4gICAgaWYgKG4gPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9JywgdXJsKX17eGVeey14fX19YDtcbiAgICB9IGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byAwfScsIHVybCl9eyBcXFxcZnJhY3tlXnggLSAxfXt4fSB9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHggPSBudW1iZXJUaGVvcnlFbmFibGVkID8gbnVtYmVyVGhlb3J5RnVuY3Rpb25zKG4pIDogbjtcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byAwfScsIHVybCl9eyBcXFxcZnJhY3tlXnske3h9eH0gLSAxfXt4fSB9fWA7XG4gICAgfVxufTtcblxuLy8gTGltaXRzIG9mIHBvbHlub21pYWwgZnVuY3Rpb25zXG5jb25zdCBsaW1pdFBvbHlub21pYWwgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI0Z1bmN0aW9uc19vZl90aGVfZm9ybV94YSc7XG4gICAgaWYgKG4gPT09IDApIHtcbiAgICAgICAgbGV0IHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyMCk7XG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXGxpbV97eCBcXFxcdG8gXFxcXGluZnR5fScsIHVybCl9eyR7cn14XnstMX19fWA7XG4gICAgfSBlbHNlIGlmIChuID09PSAxKSB7XG4gICAgICAgIGNvbnN0IHVybDIgPSAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjRnVuY3Rpb25zX29mX3RoZV9mb3JtX3hnKHgpJztcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9JywgdXJsMil9e3heezEveH19fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZ2VuZXJhdGUgcmFuZG9tIHBvbHlub21pYWwgbGltaXRzIGxpa2UgbGltIHggLT4g4oieICgyOHheMiAtIDExeCkvKDR4XjIgKyAxMHgpXG4gICAgICAgIC8vIHNpbmNlIHRoZSBoaWdoZXN0IHBvd2VyIHRlcm1zIGRvbWluYXRlIGluIHRoZSBsaW1pdHMsIHRoZSByZXN0IGFyZSBpZ25vcmVkIGFuZCBjYW4gYmUgcmFuZG9tXG5cbiAgICAgICAgLy8gR2V0IHJhbmRvbSBtdWx0aXBsaWVyIGdyZWF0ZXIgdGhhbiAxXG4gICAgICAgIGxldCBtID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNSkgKyAxO1xuICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gaGlnaGVzdCBwb3dlci4gVGhpcyBkZXRlcm1pbmVzIHRoZSBmaW5hbCBzb2x1dGlvbiBvZiB0aGUgbGltaXRcbiAgICAgICAgbGV0IGhpZ2hlc3RQb3dlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMpICsgMjtcblxuICAgICAgICBsZXQgbnVtZXJhdG9yTnVtYmVyT2ZUZXJtcyA9IGhpZ2hlc3RQb3dlciAtIDE7XG4gICAgICAgIGxldCBkZW5vbWluYXRvck51bWJlck9mVGVybXMgPSBoaWdoZXN0UG93ZXIgLSAxO1xuXG4gICAgICAgIGxldCBzaWducyA9IFsnLScsICcrJ107XG4gICAgICAgIGxldCBudW1lcmF0b3IgPSBgJHttICogbn14Xnske2hpZ2hlc3RQb3dlcn19IGA7XG4gICAgICAgIGxldCBkZW5vbWluYXRvciA9IGAke219eF57JHtoaWdoZXN0UG93ZXJ9fSBgO1xuXG4gICAgICAgIC8vIEdlbmVyYXRlIGEgcG9seW5vbWlhbCBudW1lcmF0b3Igd2l0aCByYW5kb20gbGVuZ3RoIGFuZCBjb2VmZmljaWVudHNcbiAgICAgICAgLy9leDogMTV4XjJcbiAgICAgICAgZm9yIChsZXQgaSA9IG51bWVyYXRvck51bWJlck9mVGVybXM7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgIGxldCBjb2VmID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMjtcblxuICAgICAgICAgICAgbGV0IHBvd2VyID0gaSA8IDIgPyAnJyA6IGBeeyR7aX19YDtcbiAgICAgICAgICAgIGxldCBzaWduID0gc2lnbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMildO1xuXG4gICAgICAgICAgICBudW1lcmF0b3IgKz0gYCR7c2lnbn0gJHtjb2VmfXgke3Bvd2VyfSBgO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBwb2x5bm9taWFsIGRlbm9taW5hdG9yIHdpdGggcmFuZG9tIGxlbmd0aCBhbmQgY29lZmZpY2llbnRzXG4gICAgICAgIGZvciAobGV0IGkgPSBkZW5vbWluYXRvck51bWJlck9mVGVybXM7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgIGxldCBjb2VmID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMjtcblxuICAgICAgICAgICAgbGV0IHBvd2VyID0gaSA8IDIgPyAnJyA6IGBeeyR7aX19YDtcbiAgICAgICAgICAgIGxldCBzaWduID0gc2lnbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMildO1xuXG4gICAgICAgICAgICBkZW5vbWluYXRvciArPSBgJHtzaWdufSAke2NvZWZ9eCR7cG93ZXJ9IGA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYHsgXFxcXGxpbV97eCBcXFxcdG8gXFxcXGluZnR5fSB7IFxcXFxmcmFjeyR7bnVtZXJhdG9yfX17JHtkZW5vbWluYXRvcn19fSB9YDtcbiAgICB9XG59O1xuXG4vLyBVc2luZyBldWxlcidzIGlkZW50aXR5LiBUaGF0IGlzLCBlXihwaSppKSA9IC0xXG5jb25zdCBldWxlcnNJZGVudGl0eSA9IChuOiBudW1iZXIpID0+IHtcbiAgICAvLyBlLmcg4oiSNmVeKHBpKmkpPTZcblxuICAgIGNvbnN0IHVybCA9ICdodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdWxlciUyN3NfaWRlbnRpdHknO1xuXG4gICAgaWYgKG4gIT09IDApIHtcbiAgICAgICAgcmV0dXJuIGB7LSR7bn0ke2hyZWYoJ2Vee1xcXFxwaSBpfScsIHVybCl9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGB7KCR7aHJlZignZV57XFxcXHBpIGl9JywgdXJsKX0gKyAxKX1gO1xuICAgIH1cbn07XG5cbi8vIEluZmluaXRlIGdlb21ldHJpYyBzZXJpZXMgdGhhdCBldmFsdWF0ZXMgdG8gYSBmaW5pdGUgdmFsdWVcbmNvbnN0IGluZmluaXRlR2VvbWV0cmljU2VyaWVzID0gKG46IG51bWJlciwgbnVtYmVyVGhlb3J5RW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIGxldCB1cmwgPVxuICAgICAgICAgICAgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbWF0aGVtYXRpY2FsX3NlcmllcyNUcmlnb25vbWV0cmljX2Z1bmN0aW9ucyc7XG4gICAgICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMztcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcc3VtJywgdXJsKX1cXFxcbGltaXRzX3trPTB9Xnske3IgLVxuICAgICAgICAgICAgMX19IHtcXFxcc2luIFxcXFxsZWZ0KHsgXFxcXGZyYWN7MiBcXFxccGkga317JHtyfX0gfSBcXFxccmlnaHQpfX1gO1xuICAgIH1cblxuICAgIC8vIFVzaW5nIHRoZSBSaWVtYW5uIHpldGEgZnVuY3Rpb25cbiAgICBlbHNlIGlmIChuID09PSAxKSB7XG4gICAgICAgIGxldCB1cmwgPVxuICAgICAgICAgICAgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1BhcnRpY3VsYXJfdmFsdWVzX29mX3RoZV9SaWVtYW5uX3pldGFfZnVuY3Rpb24jVGhlX1JpZW1hbm5femV0YV9mdW5jdGlvbl9hdF8wX2FuZF8xJztcblxuICAgICAgICByZXR1cm4gYHske2hyZWYoJ1xcXFxsaW1fe1xcXFxlcHNpbG9uIFxcXFx0byAwfScsIHVybCl9eyBcXFxcZXBzaWxvbiBcXFxcemV0YSgxICsgXFxcXGVwc2lsb24pIH19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBVc2luZyB0aGUgaW5maW5pdGUgZ2VvbWV0cmljIHNlcmllcyBydWxlOiBXaGVuIOKIkjE8eDwxLCBzdW1tYXRpb24gZnJvbSBpID0gMCB0byBpbmZpbml0eSBvZiByXmkgPSAxLygxLXIpIG9yIChyLTEpL3IuXG4gICAgICAgIC8vIERlY2ltYWwgY2FuIGJlIHJlcHJlc2VudGVkIGFzIGZyYWN0aW9uIHRvby4gZS5nICgwLjI1KV5pID0gKDEvNCleaSA9IDReLWlcbiAgICAgICAgbGV0IHgxID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuIC0gMSkgOiBuIC0gMTtcbiAgICAgICAgbGV0IHgyID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuKSA6IG47XG4gICAgICAgIHJldHVybiBge1xcXFxzdW1cXFxcbGltaXRzX3trPTB9XlxcXFxpbmZ0eSB7XFxcXGxlZnQoe1xcXFxmcmFjeyR7eDF9fXske3gyfX19XFxcXHJpZ2h0KV57a319fWA7XG4gICAgfVxufTtcblxuLy8gVXNpbmcgdGhlIHRyaWcgaWRlbnRpdHkgKGNvc14yKXggKyAoc2luXjIpeCA9IDFcbmNvbnN0IHRyaWdJZGVudGl0eSA9IChleHByZXNzaW9uOiBzdHJpbmcpID0+IHtcbiAgICBsZXQgcmFuZG9tVmFsdWUgPSBNYXRoLnJhbmRvbSgpO1xuICAgIGlmIChyYW5kb21WYWx1ZSA8IDAuMjUpIHtcbiAgICAgICAgcmV0dXJuIGBcXFxcbGVmdChcXFxcZnJhY3ske2V4cHJlc3Npb259fXsoXFxcXGNvc14yeCArIFxcXFxzaW5eMngpfVxcXFxyaWdodClgO1xuICAgIH0gZWxzZSBpZiAocmFuZG9tVmFsdWUgPCAwLjUpIHtcbiAgICAgICAgcmV0dXJuIGBcXFxcbGVmdCh7JHtleHByZXNzaW9ufSBcXFxcdGltZXMgKFxcXFxjb3NeMnggKyBcXFxcc2luXjJ4KX1cXFxccmlnaHQpYDtcbiAgICB9XG59O1xuXG4vKiBVc2luZyB0aGUgZGlmZmVyZW5jZSBvZiB0d28gc3F1YXJlcyBpbiBsaW1pdHMgKi9cbmNvbnN0IGxpbURpZmZUd29TcXVhcmVzID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMTtcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSkge1xuICAgICAgICB2YXIgdGV4ID0gYFxcXFxsaW1fe3ggXFxcXHRvICR7biAtIHJ9fSBcXFxcZnJhY3t4XjIgLSAke3IgKiogMn19e3ggLSAke3J9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHRleCA9IGBcXFxcbGltX3t4IFxcXFx0byAke24gKyByfX0gXFxcXGZyYWN7eF4yIC0gJHtyICoqIDJ9fXt4ICsgJHtyfX1gO1xuICAgIH1cbiAgICByZXR1cm4gYHske3RleH19YDtcbn07XG5cbmNvbnN0IHNhbWVOdW1iZXIgPSAobjogbnVtYmVyKSA9PiBgJHtufWA7XG5cbmV4cG9ydCB7XG4gICAgbnVtYmVyVGhlb3J5RnVuY3Rpb25zLFxuICAgIGZhY3RvcmlhbCxcbiAgICBwb3cyQ2hvb3NlLFxuICAgIGxpbWl0TmF0dXJhbExvZyxcbiAgICBsaW1pdEV4cG9uZW50aWFsLFxuICAgIGxpbWl0UG9seW5vbWlhbCxcbiAgICBldWxlcnNJZGVudGl0eSxcbiAgICBpbmZpbml0ZUdlb21ldHJpY1NlcmllcyxcbiAgICB0cmlnSWRlbnRpdHksXG4gICAgbGltRGlmZlR3b1NxdWFyZXMsXG4gICAgc2FtZU51bWJlcixcbn07XG4iLCIvKipcbiAqIFRoaXMgZmlsZSBjb250YWlucyBkZWNvbXBvc2l0aW9uIGZ1bmN0aW9ucy4gVGhleSBicmVhayBsYXJnZXIgbnVtYmVycyAoMy1kaWdpdCkgaW50byBzbWFsbGVyIG9uZXMgKDItMSBkaWdpdHMpLFxuICogd2hlcmUgdGhlIFtTdHJvbmcgbGF3IG9mIHNtYWxsIG51bWJlcnNdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1N0cm9uZ19sYXdfb2Zfc21hbGxfbnVtYmVycykgY2FuIHRha2Ugb2YgdGhlbVxuICogYXMgdGhleSBoYXZlIG11Y2ggbW9yZSBwcm9wZXJ0aWVzIHRoYW4gbGFyZ2VyIG51bWJlcnMuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBvcGVyYXRpb24sXG4gICAgZ2V0RmFjdG9ycyxcbiAgICBnZXRQcmltZUZhY3RvcnMsXG4gICAgQ29udmVydE9wdGlvbnMsXG4gICAgaXNGYWN0b3JpYWwsXG4gICAgaXNQb3cyLFxuICAgIHNodWZmbGUsXG4gICAgaXNQcmltZSxcbiAgICBpc1NxdWFyZSxcbiAgICBpc09kZCxcbiAgICBjb250aW51ZWRGcmFjdGlvbixcbn0gZnJvbSAnLi91dGlscyc7XG5cbnR5cGUgZGVjb21wb3NpdGlvbiA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHN0cmluZztcblxuaW1wb3J0ICogYXMgcmVwcmVzZW50YXRpb25zIGZyb20gJy4vcmVwcmVzZW50YXRpb25zJztcblxuLy8gZm9yIG4gPSBhYiBhbmQg4oiAYywgZWl0aGVyIHJldHVybiBuID0gYWIgb3IgKGEtYykoYitjKSArIGMoYi1hK2MpXG5jb25zdCBkZWNvbXBvc2VBQkMgPSAobnVtYmVyOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgZmFjdG9ycyA9IGdldEZhY3RvcnMobnVtYmVyKTtcbiAgICBsZXQgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBmYWN0b3JzLmxlbmd0aCk7XG4gICAgbGV0IGEgPSBmYWN0b3JzW3JhbmRvbUluZGV4XTtcbiAgICBsZXQgYiA9IG51bWJlciAvIGE7XG4gICAgbGV0IGMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzMCkgKyAxO1xuXG4gICAgLy8gYWJcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMikge1xuICAgICAgICByZXR1cm4gYHt7XFxcXGxlZnQoeyR7b3BzWzBdKGEpfX1cXFxccmlnaHQpfXtcXFxcbGVmdCh7JHtvcHNbMV0oYil9fVxcXFxyaWdodCl9fWA7XG4gICAgfVxuXG4gICAgLy8gKGEgLSBjKShiICsgYykgKyBjIChiIC0gYSArIGMpXG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBgeyBcXFxcbGVmdCh7JHtvcHNbMF0oYSl9IC0gJHtvcHNbMV0oYyl9fVxcXFxyaWdodCkgXFxcXGxlZnQoeyR7b3BzWzJdKGIpfSArICR7b3BzWzNdKFxuICAgICAgICAgICAgY1xuICAgICAgICApfX1cXFxccmlnaHQpICsgeyR7b3BzWzNdKGMpfX17XFxcXGxlZnQoeyR7b3BzWzNdKGIpfSAtICR7b3BzWzNdKGEpfSArICR7b3BzWzNdKFxuICAgICAgICAgICAgY1xuICAgICAgICApfX0gXFxcXHJpZ2h0KX0gfWA7XG4gICAgfVxufTtcblxuLy8gNSA9IHNxcnQoMjUpXG5jb25zdCBkZWNvbXBvc2VTcXJ0ID0gKG46IG51bWJlciwgb3BzOiBvcGVyYXRpb25bXSkgPT4ge1xuICAgIGxldCBzcXVhcmUgPSBuICoqIDI7XG4gICAgcmV0dXJuIGB7XFxcXHNxcnR7JHtvcHNbMF0oc3F1YXJlKX19fWA7XG59O1xuXG4vLyAyNSA9IDEgKyAzICsgNSArIDcgKyA5XG5jb25zdCBkZWNvbXBvc2VTcXVhcmUgPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgbGV0IHNxdWFyZVJvb3QgPSBNYXRoLnNxcnQobik7XG4gICAgbGV0IHN1bSA9IGAke29wc1swXSgxKX1gO1xuICAgIGxldCBvZGRWYWwgPSAxO1xuXG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzcXVhcmVSb290IC0gMTsgaSsrKSB7XG4gICAgICAgICAgICBvZGRWYWwgKz0gMjtcbiAgICAgICAgICAgIHN1bSArPSBgKyAke29wc1szXShvZGRWYWwpfWA7XG4gICAgICAgIH1cbiAgICAgICAgc3VtID0gYHsgJHtzdW19IH1gO1xuICAgICAgICByZXR1cm4gc3VtO1xuICAgIH1cblxuICAgIC8vIChhICsgYileMiA9IGFeMiArIDJhYiArIGJeMlxuICAgIGVsc2Uge1xuICAgICAgICBsZXQgYSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNxdWFyZVJvb3QgLSAxKSArIDE7XG4gICAgICAgIGxldCBiID0gc3F1YXJlUm9vdCAtIGE7XG5cbiAgICAgICAgLy8gUmVwcmVzZW50aW5nIChhICsgYileMlxuICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSkge1xuICAgICAgICAgICAgcmV0dXJuIGB7IHtcXFxcbGVmdCgke29wc1swXShhKX0gKyAke29wc1swXShiKX1cXFxccmlnaHQpfV4yfWA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXByZXNlbnRpbmcgYV4yICsgMmFiICsgYl4yXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGB7IHtcXFxcbGVmdCgke29wc1swXShhKX1cXFxccmlnaHQpfV4yICsgeyR7b3BzWzNdKDIpfX17XFxcXGxlZnQoJHtvcHNbMV0oXG4gICAgICAgICAgICAgICAgYVxuICAgICAgICAgICAgKX1cXFxccmlnaHQpfXtcXFxcbGVmdCgke29wc1syXShiKX1cXFxccmlnaHQpfSArIHtcXFxcbGVmdCgke29wc1szXShiKX1cXFxccmlnaHQpfV4yfWA7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vLyAyNSA9IDEzXjIgLSAxMl4yXG5jb25zdCBkZWNvbXBvc2VEaWZmZXJlbmNlU3F1YXJlcyA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgYSA9IE1hdGguZmxvb3IobiAvIDIpO1xuICAgIGxldCBiID0gTWF0aC5jZWlsKG4gLyAyKTtcblxuICAgIGlmIChNYXRoLmNlaWwobiAvIDIpICoqIDIgPCAxMDAgJiYgTWF0aC5yYW5kb20oKSA8IDAuNykge1xuICAgICAgICByZXR1cm4gYHske29wc1swXShiICoqIDIpfSAtICR7b3BzWzBdKGEgKiogMil9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGB7IFxcXFxsZWZ0KHske29wc1swXShiKX19XFxcXHJpZ2h0KV4yIC0gIFxcXFxsZWZ0KHske29wc1sxXShhKX19XFxcXHJpZ2h0KV4yfWA7XG4gICAgfVxufTtcblxuLy8gNyA9IDIgKiAzICsgMVxuY29uc3QgZGVjb21wb3NlQWRkTXVsdGlwbHkgPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgbGV0IHJhbmROdW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBuICsgMSkgKyAxO1xuICAgIGxldCByID0gbiAlIHJhbmROdW07XG4gICAgbGV0IGEgPSBNYXRoLmZsb29yKG4gLyByYW5kTnVtKTtcbiAgICByZXR1cm4gYCR7b3BzWzBdKGEpfSBcXFxcdGltZXMgeyR7b3BzWzFdKHJhbmROdW0pfX0gKyAke29wc1syXShyKX1gO1xufTtcblxuLy8gNyA9IDcqOC84XG5jb25zdCBkZWNvbXBvc2VNdWxEaXZpZGUgPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgbGV0IHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA1KSArIDE7XG4gICAgcmV0dXJuIGBcXFxcZnJhY3ske29wc1swXShuICogcil9fSB7JHtvcHNbMV0ocil9fWA7XG59O1xuXG5jb25zdCBkZWNvbXBvc2VMY20gPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgLy8gYWxsIGZhY3RvcnMsIGUuZy4gWzIsIDIsIDIsIDMsIDMsIC4uLl1cbiAgICBjb25zdCBmYWN0b3JzID0gZ2V0UHJpbWVGYWN0b3JzKG4pO1xuXG4gICAgLy8gZmFjdG9ycyB3aXRoIGNvcnJlc3BvbmRpbmcgZXhwb25lbnRzLCBlLmcuIHsyOiAzLCAzOiAyLCA3OiAxLCAuLi59XG4gICAgbGV0IGZhY3RvckV4cDogTWFwPG51bWJlciwgbnVtYmVyPiA9IG5ldyBNYXAoKTtcbiAgICBmb3IgKGNvbnN0IGYgb2YgZmFjdG9ycykge1xuICAgICAgICBmYWN0b3JFeHAuc2V0KGYsIGZhY3RvckV4cC5oYXMoZikgPyBmYWN0b3JFeHAuZ2V0KGYpISArIDEgOiAxKTtcbiAgICB9XG5cbiAgICAvLyBkaXN0aW5jdCBwcmltZSBmYWN0b3JzLCBlLmcuIFs3LCAzLCA1LCAyXVxuICAgIGNvbnN0IHByaW1lRmFjdG9ycyA9IHNodWZmbGUoQXJyYXkuZnJvbShmYWN0b3JFeHAua2V5cygpKSk7XG5cbiAgICAvLyBpbiByYW5nZSBbMSwgbGVuZ3RoLTFdXG4gICAgbGV0IHNsaWNlSWR4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHByaW1lRmFjdG9ycy5sZW5ndGggLSAxKSkgKyAxO1xuXG4gICAgLy8gc3BsaXQgaW50byBjb21wbGVtZW50c1xuICAgIGxldCBncm91cDEgPSBwcmltZUZhY3RvcnMuc2xpY2UoMCwgc2xpY2VJZHgpO1xuICAgIGxldCBncm91cDIgPSBwcmltZUZhY3RvcnMuc2xpY2Uoc2xpY2VJZHgpO1xuXG4gICAgbGV0IGdyb3VwMVZhbHVlID0gZ3JvdXAxLm1hcChtID0+IG0gKiogZmFjdG9yRXhwLmdldChtKSEpLnJlZHVjZSgoYSwgYikgPT4gYSAqIGIsIDEpO1xuICAgIGxldCBncm91cDJWYWx1ZSA9IGdyb3VwMi5tYXAobSA9PiBtICoqIGZhY3RvckV4cC5nZXQobSkhKS5yZWR1Y2UoKGEsIGIpID0+IGEgKiBiLCAxKTtcblxuICAgIHJldHVybiBgXFxcXG9wZXJhdG9ybmFtZXtsY219XFxcXGxlZnQoJHtvcHNbMF0oZ3JvdXAxVmFsdWUpfSwgJHtvcHNbMV0oZ3JvdXAyVmFsdWUpfVxcXFxyaWdodClgO1xufTtcblxuY29uc3QgZGVjb21wb3NlU3VtQ29uc2VjdXRpdmUgPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgY29uc3Qgb2RkRmFjdG9ycyA9IGdldEZhY3RvcnMobikuZmlsdGVyKGYgPT4gZiAlIDIgPT0gMSAmJiBmICE9PSAxKTtcblxuICAgIGNvbnN0IGNob3NlbkZhY3RvciA9IG9kZEZhY3RvcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogb2RkRmFjdG9ycy5sZW5ndGgpXTtcbiAgICBjb25zdCBtaWRkbGUgPSBuIC8gY2hvc2VuRmFjdG9yO1xuXG4gICAgY29uc3Qgc2lkZUxlbmd0aCA9IChjaG9zZW5GYWN0b3IgLSAxKSAvIDI7XG5cbiAgICBjb25zdCBtaW5WYWx1ZSA9IG1pZGRsZSAtIHNpZGVMZW5ndGg7XG4gICAgY29uc3QgbWluVmFsdWVTaWduID0gbWluVmFsdWUgPCAwID8gJy0nIDogJysnO1xuXG4gICAgcmV0dXJuIGBcXFxcc3VtX3trPTB9Xnske29wc1swXShjaG9zZW5GYWN0b3IgLSAxKX19IFxcXFxsZWZ0KGsgJHttaW5WYWx1ZVNpZ259ICR7b3BzWzFdKFxuICAgICAgICBNYXRoLmFicyhtaW5WYWx1ZSlcbiAgICApfVxcXFxyaWdodClgO1xufTtcblxuY29uc3QgZGVjb21wb3NlQ29udGludWVkRnJhY3Rpb24gPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgLy8gbG9nXzEwKG4pICsgeCwgd2hlcmUgeCBpcyBpbiBbMCwgMSwgMl1cbiAgICBjb25zdCByID0gKG46IG51bWJlcikgPT4ge1xuICAgICAgICByZXR1cm4gb3BzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG9wcy5sZW5ndGgpXShuKTtcbiAgICB9O1xuXG4gICAgY29uc3QgZXhwMTAgPSBNYXRoLmZsb29yKE1hdGgubG9nMTAobikpICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMyk7XG5cbiAgICBjb25zdCBbbGVhZGluZywgc2VxXSA9IGNvbnRpbnVlZEZyYWN0aW9uKG4sIDEwICoqIGV4cDEwKTtcblxuICAgIHJldHVybiBgezEwXnske2V4cDEwfX0gXFxcXHRpbWVzIFxcXFxsZWZ0WyR7cihsZWFkaW5nKX07JHtzZXEubWFwKG0gPT4gcihtKSkuam9pbignLCcpfVxcXFxyaWdodF19YDtcbn07XG5cbi8qIGVuZCBkZWNvbXBvc2UgZnVuY3Rpb25zICovXG5cbmNvbnN0IGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiA9IChcbiAgICB3cmFwcGVkRnVuY3Rpb246IG9wZXJhdGlvbixcbiAgICBvcHRpb25zOiBDb252ZXJ0T3B0aW9uc1xuKTogb3BlcmF0aW9uID0+IHtcbiAgICByZXR1cm4gKG46IG51bWJlcikgPT4ge1xuICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8PSAwLjUpIHtcbiAgICAgICAgICAgIC8vIGludmVyc2UgZmFjdG9yaWFsIG9mIG4sIHN1Y2ggdGhhdCBmYWMhID0gblxuICAgICAgICAgICAgY29uc3QgZmFjID0gaXNGYWN0b3JpYWwobik7XG4gICAgICAgICAgICBpZiAoZmFjKSB7XG4gICAgICAgICAgICAgICAgLy8gZmFjdG9yaWFsKGZhYykgPSBmYWMhID0gblxuICAgICAgICAgICAgICAgIHJldHVybiByZXByZXNlbnRhdGlvbnMuZmFjdG9yaWFsKGZhYywgb3B0aW9ucy5nYW1tYUZ1bmN0aW9uKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGlzUG93MihuKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXByZXNlbnRhdGlvbnMucG93MkNob29zZShNYXRoLmxvZzIobiksIG9wdGlvbnMubnVtYmVyVGhlb3J5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB3cmFwcGVkRnVuY3Rpb24obik7XG4gICAgfTtcbn07XG5cbi8vIEJyZWFrIGEgbnVtYmVyIGRvd24gaW50byBzbWFsbGVyIG51bWJlcnMgc2VwYXJhdGVkIGJ5IG9wZXJhdG9yc1xuY29uc3QgZGVjb21wb3NlID0gKG46IG51bWJlciwgYXZhaWxhYmxlX29wZXJhdGlvbnM6IG9wZXJhdGlvbltdLCBvcHRpb25zOiBDb252ZXJ0T3B0aW9ucykgPT4ge1xuICAgIGxldCBvcGVyYXRpb25zID0gYXZhaWxhYmxlX29wZXJhdGlvbnM7XG5cbiAgICAvLyBwYWQgb3BlcmF0aW9ucyB0byBhdCBsZWFzdCA0IGVsZW1lbnRzXG4gICAgd2hpbGUgKG9wZXJhdGlvbnMubGVuZ3RoIDwgNCkge1xuICAgICAgICBvcGVyYXRpb25zLnB1c2gocmVwcmVzZW50YXRpb25zLnNhbWVOdW1iZXIpO1xuICAgIH1cblxuICAgIG9wZXJhdGlvbnMgPSBzaHVmZmxlKG9wZXJhdGlvbnMpLnNsaWNlKDAsIDQpO1xuXG4gICAgY29uc3QgZGVjb21wb3NpdGlvbnM6IGRlY29tcG9zaXRpb25bXSA9IFtdO1xuXG4gICAgLy8gMS4gYWIgPSAoYSAtIGMpKGIgKyBjKSArIGMgKGIgLSBhICsgYyksIHdoZXJlIGMgaXMgYW55IHJhbmRvbSBwb3NpdGl2ZSBudW1iZXJcbiAgICBpZiAobiAhPT0gMCAmJiBuIDwgMTAwICYmIChuID09PSAyIHx8ICFpc1ByaW1lKG4pKSkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZUFCQyk7XG4gICAgfVxuXG4gICAgLy8gMi4gUmVwcmVzZW50IChzbWFsbCkgbnVtYmVycyB1c2luZyB0aGVpciBzcXVhcmUgYW5kIHNxdWFyZSByb290XG4gICAgaWYgKG4gPCAxMCkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZVNxcnQpO1xuICAgIH1cblxuICAgIC8vIDMuIFRoZSBzdW0gb2YgdGhlIGZpcnN0IG4gb2RkIG51bWJlcnMgaXMgZXF1YWwgdG8gbl4yIGUuZyAxICsgMyArIDUgPSAzXjJcbiAgICBpZiAobiA+IDEgJiYgaXNTcXVhcmUobikgJiYgbiA8IDEwMCkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZVNxdWFyZSk7XG4gICAgfVxuXG4gICAgLy8gNC4gVGhlIHN1bSBvZiB0d28gY29uc2VjdXRpdmUgaW50ZWdlcnMgaXMgdGhlIGRpZmZlcmVuY2Ugb2YgdGhlaXIgc3F1YXJlcyBlLmcgMyArIDIgPSAzXjIgLSAyXjJcbiAgICBpZiAoaXNPZGQobikpIHtcbiAgICAgICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VEaWZmZXJlbmNlU3F1YXJlcyk7XG4gICAgfVxuXG4gICAgLy8gNS4gRXhwcmVzcyBhIG51bWJlciB1c2luZyBtdWx0aXBsaWNhdGlvbiBhbmQgYWRkaXRpb24uIEUuZyA0ID0gMSAqIDMgKyAxXG4gICAgaWYgKG4gPD0gMjAwKSB7XG4gICAgICAgIGRlY29tcG9zaXRpb25zLnB1c2goZGVjb21wb3NlTXVsRGl2aWRlKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzUHJpbWUobikgJiYgbiA+IDEpIHtcbiAgICAgICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VMY20pO1xuICAgIH1cblxuICAgIGlmICghaXNQb3cyKG4pICYmIG4gPiAxKSB7XG4gICAgICAgIGRlY29tcG9zaXRpb25zLnB1c2goZGVjb21wb3NlU3VtQ29uc2VjdXRpdmUpO1xuICAgIH1cblxuICAgIGlmIChuID4gMSAmJiBvcHRpb25zLmNvbnRpbnVlZEZyYWN0aW9ucykge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZUNvbnRpbnVlZEZyYWN0aW9uKTtcbiAgICB9XG5cbiAgICAvLyA2LiBNdWx0aXBseSBhbmQgZGl2aWRlIGJ5IGEgcmFuZG9tIG51bWJlci4gZS5nIDIgPSAoMio1KS81XG4gICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VBZGRNdWx0aXBseSk7XG5cbiAgICByZXR1cm4gc2h1ZmZsZShkZWNvbXBvc2l0aW9ucylbMF0obiwgb3BlcmF0aW9ucyk7XG59O1xuXG5leHBvcnQgeyBkZWNvbXBvc2UsIGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiB9O1xuIiwiLyoqXG4gKiBDb252ZXJ0cyB0aGUgTWF0aEpheCBTVkcgKFRPRE86IHRoaXMgY29kZSBwcm9kdWNlcyB0aGUgZXJyb3IgaWYgdGhlIE1hdGhKYXggaXMgaHRtbCkgdG8gYSBwbmcsXG4gKiBieSBzZXJpYWxpemluZyB0aGUgc3ZnIGludG8gYSBkYXRhIHVybCBhbmQgZHJhd2luZyB0byB0aGUgY2FudmFzLCB3aGVyZSBpdCBjYW4gdGhhbiBiZSBzZXJpYWxpemVkXG4gKiBpbnRvIGEgcG5nLlxuICovXG5cbmxldCBkb3dubG9hZEJ0biA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQtaW1nJyk7XG5cbi8vIEluaXRpYXRlIGRvd25sb2FkIG9mIGJsb2JcbmNvbnN0IGRvd25sb2FkID0gKGZpbGVuYW1lOiBzdHJpbmcsIGJsb2I6IEJsb2IpID0+IHtcbiAgICBjb25zdCBlbGVtID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBlbGVtLmhyZWYgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICBlbGVtLmRvd25sb2FkID0gZmlsZW5hbWU7XG4gICAgZWxlbS5jbGljaygpO1xufTtcblxuY29uc3QgZG93bmxvYWRQTkcgPSAoKSA9PiB7XG4gICAgLy8gR2V0IHRoZSBzdmcgZnJvbSB0aGUgcGFnZVxuICAgIHZhciBzdmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdzdmcnKSE7XG5cbiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgbnVtYmVyXG4gICAgdmFyIG51bWJlciA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5wdXQnKSkudmFsdWU7XG5cbiAgICAvLyBJbmNyZWFzZSB0aGUgU1ZHJ3Mgd2lkdGggYW5kIGhlaWdodCB0byBwcm9kdWNlIGEgYmlnZ2VyIGltYWdlXG4gICAgbGV0IHcgPSBwYXJzZUludChzdmcuZ2V0QXR0cmlidXRlKCd3aWR0aCcpISk7XG4gICAgbGV0IGggPSBwYXJzZUludChzdmcuZ2V0QXR0cmlidXRlKCdoZWlnaHQnKSEpO1xuXG4gICAgLy8gQ29udmVydCBTVkcgdG8gc3RyaW5nIGRhdGFcbiAgICBjb25zdCBkYXRhID0gbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyhzdmcpO1xuXG4gICAgY29uc3Qgc3ZnRGF0YVVybCA9IGBkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCR7YnRvYShkYXRhKX1gO1xuXG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgLy8gdXBzY2FsZSBoZWlnaHQgdG8gYXQgbGVhc3QgODAwcHhcbiAgICBsZXQgc2NhbGVGYWN0b3IgPSBNYXRoLm1heCgyLCA4MDAgLyBoKTtcbiAgICBjYW52YXMud2lkdGggPSB3ICogc2NhbGVGYWN0b3I7XG4gICAgY2FudmFzLmhlaWdodCA9IGggKiBzY2FsZUZhY3RvcjtcblxuICAgIGNvbnNvbGUubG9nKHsgdzogY2FudmFzLndpZHRoLCBoOiBjYW52YXMuaGVpZ2h0IH0pO1xuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpITtcblxuICAgIGNvbnN0IHN2Z0RhdGFJbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIHN2Z0RhdGFJbWFnZS5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2Uoc3ZnRGF0YUltYWdlLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgICAgIGNhbnZhcy50b0Jsb2IoYmxvYiA9PiB7XG4gICAgICAgICAgICBpZiAoYmxvYiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHNlcmlhbGl6ZSBjYW52YXMgdG8gYmxvYicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZG93bmxvYWQoYGNvbXBsaWNhdGVkLWV4cHJlc3Npb24tdGhhdC1lcXVhbHMtJHtudW1iZXJ9YCwgYmxvYik7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBzdmdEYXRhSW1hZ2Uuc3JjID0gc3ZnRGF0YVVybDtcbn07XG5cbmNvbnN0IG1haW4gPSAoKSA9PiB7XG4gICAgZG93bmxvYWRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBkb3dubG9hZFBORyk7XG59O1xuZXhwb3J0IHsgbWFpbiB9O1xuIiwiZGVjbGFyZSB2YXIgTWF0aEpheDogYW55O1xuXG5pbXBvcnQgKiBhcyByZXByZXNlbnRhdGlvbnMgZnJvbSAnLi9yZXByZXNlbnRhdGlvbnMnO1xuaW1wb3J0IHsgQ29udmVydE9wdGlvbnMsIG9wZXJhdGlvbiB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgZGVjb21wb3NlLCBjb25kaXRpb25hbERlY29tcG9zaXRpb24gfSBmcm9tICcuL2RlY29tcG9zaXRpb25zJztcbmltcG9ydCAqIGFzIGRvd25sb2FkX3BuZyBmcm9tICcuL2Rvd25sb2FkLXBuZyc7XG5cbmNvbnN0IGNvbnZlcnQgPSAobnVtYmVyOiBudW1iZXIsIG9wdGlvbnM6IENvbnZlcnRPcHRpb25zKSA9PiB7XG4gICAgLy8gVmFsaWRhdGluZyBpbnB1dFxuICAgIGlmIChpc05hTihudW1iZXIpIHx8IG51bWJlciA8IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qIE5lZWQgdG8gYWRkIGFub3RoZXIgc2xhc2ggdG8gbGF0ZXggc3RyaW5ncyB0byBwcmV2ZW50IHNsYXNoIGVzY2FwZSAqL1xuXG4gICAgLy8gTGlzdCBvZiBmdW5jdGlvbnMgdGhhdCBnZW5lcmF0ZSBMYVRlWCBtYXRoIGV4cHJlc3Npb25zXG4gICAgLy8gRnVuY3Rpb25zIGFyZSBjaG9zZW4gcmFuZG9tbHlcbiAgICBsZXQgcG9zc2libGVfb3B0aW9uczogb3BlcmF0aW9uW10gPSBbXTtcblxuICAgIGlmIChvcHRpb25zLmV1bGVyc0lkZW50aXR5KSB7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChyZXByZXNlbnRhdGlvbnMuZXVsZXJzSWRlbnRpdHkpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5leHBvbmVudGlhbExpbWl0cykge1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gobiA9PiByZXByZXNlbnRhdGlvbnMubGltaXROYXR1cmFsTG9nKG4sIG9wdGlvbnMubnVtYmVyVGhlb3J5KSk7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChuID0+IHJlcHJlc2VudGF0aW9ucy5saW1pdEV4cG9uZW50aWFsKG4sIG9wdGlvbnMubnVtYmVyVGhlb3J5KSk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnBvbHlub21pYWxMaW1pdHMpIHtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKHJlcHJlc2VudGF0aW9ucy5saW1EaWZmVHdvU3F1YXJlcyk7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChyZXByZXNlbnRhdGlvbnMubGltaXRQb2x5bm9taWFsKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5nZW9tZXRyaWNTZXJpZXMpIHtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKG4gPT5cbiAgICAgICAgICAgIHJlcHJlc2VudGF0aW9ucy5pbmZpbml0ZUdlb21ldHJpY1NlcmllcyhuLCBvcHRpb25zLm51bWJlclRoZW9yeSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBkZWNvcmF0ZSBlYWNoIG9wZXJhdGlvbiB3aXRoIGEgZnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgdGhlIGlucHV0IGlzIG9mIGEgY2VydGFpbiBmb3JtLCBhbmQgaWYgaXQgaXMgaXQgb3ZlcnJpZGVzIHRoZSBkZWNvcmF0ZWQgZnVuY3Rpb24ncyB1c3VhbCByZXN1bHQgd2l0aCBpdCdzIG93bi5cbiAgICBwb3NzaWJsZV9vcHRpb25zID0gcG9zc2libGVfb3B0aW9ucy5tYXAoZiA9PiB7XG4gICAgICAgIHJldHVybiBjb25kaXRpb25hbERlY29tcG9zaXRpb24oZiwgb3B0aW9ucyk7XG4gICAgfSk7XG5cbiAgICBsZXQgaW5wdXQgPSBkZWNvbXBvc2UobnVtYmVyLCBwb3NzaWJsZV9vcHRpb25zLCBvcHRpb25zKTtcblxuICAgIC8vICBEaXNhYmxlIHRoZSBkaXNwbGF5IGFuZCByZW5kZXIgYnV0dG9ucyB1bnRpbCBNYXRoSmF4IGlzIGRvbmVcbiAgICB2YXIgZGlzcGxheSA9IDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXNwbGF5Jyk7XG4gICAgdmFyIGJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVuZGVyJyk7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gZGlzcGxheS5kaXNhYmxlZCA9IHRydWU7XG4gICAgbGV0IGRvd25sb2FkQnRuID0gPEhUTUxCdXR0b25FbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZC1pbWcnKTtcblxuICAgIC8vICBDbGVhciB0aGUgb2xkIG91dHB1dFxuXG4gICAgbGV0IG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdXRwdXQnKSE7XG4gICAgb3V0cHV0LmlubmVySFRNTCA9ICcnO1xuXG4gICAgLy8gIFJlc2V0IHRoZSB0ZXggbGFiZWxzIChhbmQgYXV0b21hdGljIGVxdWF0aW9uIG51bWJlcnMsIHRob3VnaCB0aGVyZSBhcmVuJ3QgYW55IGhlcmUpLlxuICAgIC8vICBHZXQgdGhlIGNvbnZlcnNpb24gb3B0aW9ucyAobWV0cmljcyBhbmQgZGlzcGxheSBzZXR0aW5ncylcbiAgICAvLyAgQ29udmVydCB0aGUgaW5wdXQgdG8gQ29tbW9uSFRNTCBvdXRwdXQgYW5kIHVzZSBhIHByb21pc2UgdG8gd2FpdCBmb3IgaXQgdG8gYmUgcmVhZHlcbiAgICAvLyAgICAoaW4gY2FzZSBhbiBleHRlbnNpb24gbmVlZHMgdG8gYmUgbG9hZGVkIGR5bmFtaWNhbGx5KS5cbiAgICBNYXRoSmF4LnRleFJlc2V0KCk7XG4gICAgdmFyIG1hdGhKYXhPcHRpb25zID0gTWF0aEpheC5nZXRNZXRyaWNzRm9yKG91dHB1dCk7XG4gICAgbWF0aEpheE9wdGlvbnMuZGlzcGxheSA9IGRpc3BsYXkuY2hlY2tlZDtcbiAgICBNYXRoSmF4LnRleDJzdmdQcm9taXNlKGlucHV0LCBtYXRoSmF4T3B0aW9ucylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24obm9kZTogYW55KSB7XG4gICAgICAgICAgICAvLyAgVGhlIHByb21pc2UgcmV0dXJucyB0aGUgdHlwZXNldCBub2RlLCB3aGljaCB3ZSBhZGQgdG8gdGhlIG91dHB1dFxuICAgICAgICAgICAgLy8gIFRoZW4gdXBkYXRlIHRoZSBkb2N1bWVudCB0byBpbmNsdWRlIHRoZSBhZGp1c3RlZCBDU1MgZm9yIHRoZVxuICAgICAgICAgICAgLy8gICAgY29udGVudCBvZiB0aGUgbmV3IGVxdWF0aW9uLlxuICAgICAgICAgICAgb3V0cHV0LmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgICAgICAgTWF0aEpheC5zdGFydHVwLmRvY3VtZW50LmNsZWFyKCk7XG4gICAgICAgICAgICBNYXRoSmF4LnN0YXJ0dXAuZG9jdW1lbnQudXBkYXRlRG9jdW1lbnQoKTtcbiAgICAgICAgICAgIC8vIERpc3BsYXkgZG93bmxvYWQgYnV0dG9uXG4gICAgICAgICAgICBkb3dubG9hZEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycjogRXJyb3IpIHtcbiAgICAgICAgICAgIC8vICBJZiB0aGVyZSB3YXMgYW4gZXJyb3IsIHB1dCB0aGUgbWVzc2FnZSBpbnRvIHRoZSBvdXRwdXQgaW5zdGVhZFxuICAgICAgICAgICAgb3V0cHV0XG4gICAgICAgICAgICAgICAgLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpKVxuICAgICAgICAgICAgICAgIC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShlcnIubWVzc2FnZSkpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vICBFcnJvciBvciBub3QsIHJlLWVuYWJsZSB0aGUgZGlzcGxheSBhbmQgcmVuZGVyIGJ1dHRvbnNcbiAgICAgICAgICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGRpc3BsYXkuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG59O1xuY29uc3QgbWFpbiA9ICgpID0+IHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm0nKSBhcyBIVE1MRm9ybUVsZW1lbnQ7XG4gICAgY29uc3QgbnVtYmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIGNvbnN0IGdhbW1hRnVuY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtbWEtZnVuY3Rpb24nKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGV1bGVyc0lkZW50aXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V1bGVycy1pZGVudGl0eScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgZXhwb25lbnRpYWxMaW1pdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGltaXRzLWV4cG9uZW50aWFsJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBwb2x5bm9taWFsTGltaXRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpbWl0cy1wb2x5bm9taWFsJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBudW1iZXJUaGVvcnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtYmVyLXRoZW9yeScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgZ2VvbWV0cmljU2VyaWVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlb21ldHJpYy1zZXJpZXMnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGNvbnRpbnVlZEZyYWN0aW9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250aW51ZWQtZnJhY3Rpb25zJykgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZXZlbnQgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGNvbnZlcnQocGFyc2VJbnQobnVtYmVyLnZhbHVlKSwge1xuICAgICAgICAgICAgZ2FtbWFGdW5jdGlvbjogZ2FtbWFGdW5jdGlvbi5jaGVja2VkLFxuICAgICAgICAgICAgZXVsZXJzSWRlbnRpdHk6IGV1bGVyc0lkZW50aXR5LmNoZWNrZWQsXG4gICAgICAgICAgICBleHBvbmVudGlhbExpbWl0czogZXhwb25lbnRpYWxMaW1pdHMuY2hlY2tlZCxcbiAgICAgICAgICAgIHBvbHlub21pYWxMaW1pdHM6IHBvbHlub21pYWxMaW1pdHMuY2hlY2tlZCxcbiAgICAgICAgICAgIG51bWJlclRoZW9yeTogbnVtYmVyVGhlb3J5LmNoZWNrZWQsXG4gICAgICAgICAgICBnZW9tZXRyaWNTZXJpZXM6IGdlb21ldHJpY1Nlcmllcy5jaGVja2VkLFxuICAgICAgICAgICAgY29udGludWVkRnJhY3Rpb25zOiBjb250aW51ZWRGcmFjdGlvbnMuY2hlY2tlZCxcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkb3dubG9hZF9wbmcubWFpbigpO1xufTtcblxubWFpbigpO1xuIl0sIm5hbWVzIjpbInJhbmRvbUVsZW1lbnQiLCJhcnJheSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsInNodWZmbGUiLCJyYW5kb21JbmRleCIsImN1cnJlbnRJbmRleCIsImlzUHJpbWUiLCJuIiwiaSIsInNxcnQiLCJnZXRGYWN0b3JzIiwiZmFjdG9ycyIsInB1c2giLCJpc1BvdzIiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJsb2cyIiwiZ2NkIiwiYSIsImIiLCJocmVmIiwicyIsInVybCIsIl9ldWxlclBoaSIsIngiLCJfY2FjaGVkUHJpbWVzIiwicHJpbWVTaWV2ZSIsInAiLCJyZXNQcmltZXMiLCJfcHJpbWVTaWV2ZSIsIl9wcmltZUNvdW50aW5nRnVuY3Rpb24iLCJmaWx0ZXIiLCJudW1iZXJUaGVvcnlGdW5jdGlvbnMiLCJtYXRjaGluZ1BoaUlucHV0cyIsIm1hdGNoaW5nUGlJbnB1dHMiLCJmdW5jdGlvbk9wdGlvbnMiLCJtYXRjaGluZ0lucHV0IiwibGltaXRQb2x5bm9taWFsIiwiciIsIm0iLCJoaWdoZXN0UG93ZXIiLCJkZW5vbWluYXRvck51bWJlck9mVGVybXMiLCJzaWducyIsIm51bWVyYXRvciIsImRlbm9taW5hdG9yIiwiY29lZiIsInBvd2VyIiwiZXVsZXJzSWRlbnRpdHkiLCJsaW1EaWZmVHdvU3F1YXJlcyIsInRleCIsInNhbWVOdW1iZXIiLCJkZWNvbXBvc2VBQkMiLCJudW1iZXIiLCJvcHMiLCJjIiwiZGVjb21wb3NlU3FydCIsInNxdWFyZSIsImRlY29tcG9zZVNxdWFyZSIsInNxdWFyZVJvb3QiLCJzdW0iLCJvZGRWYWwiLCJkZWNvbXBvc2VEaWZmZXJlbmNlU3F1YXJlcyIsImNlaWwiLCJkZWNvbXBvc2VBZGRNdWx0aXBseSIsInJhbmROdW0iLCJkZWNvbXBvc2VNdWxEaXZpZGUiLCJkZWNvbXBvc2VMY20iLCJkaXZpc29yIiwiZ2V0UHJpbWVGYWN0b3JzIiwiZmFjdG9yRXhwIiwiTWFwIiwiZiIsInNldCIsImhhcyIsImdldCIsInByaW1lRmFjdG9ycyIsIkFycmF5IiwiZnJvbSIsImtleXMiLCJzbGljZUlkeCIsImdyb3VwMSIsInNsaWNlIiwiZ3JvdXAyIiwiZ3JvdXAxVmFsdWUiLCJtYXAiLCJyZWR1Y2UiLCJncm91cDJWYWx1ZSIsImRlY29tcG9zZVN1bUNvbnNlY3V0aXZlIiwib2RkRmFjdG9ycyIsImNob3NlbkZhY3RvciIsIm1pblZhbHVlIiwibWluVmFsdWVTaWduIiwiYWJzIiwiZGVjb21wb3NlQ29udGludWVkRnJhY3Rpb24iLCJleHAxMCIsImxvZzEwIiwibGVhZGluZyIsInNlcSIsImNvbnRpbnVlZEZyYWN0aW9uV2hvbGVQYXJ0IiwiY29udGludWVkRnJhY3Rpb25QYXJ0Iiwid2hvbGVQYXJ0IiwidW5kZWZpbmVkIiwiY29udGludWVkRnJhY3Rpb24iLCJqb2luIiwiZG93bmxvYWRCdG4iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZG93bmxvYWRQTkciLCJzdmciLCJxdWVyeVNlbGVjdG9yIiwidmFsdWUiLCJ3IiwicGFyc2VJbnQiLCJnZXRBdHRyaWJ1dGUiLCJoIiwiZGF0YSIsIlhNTFNlcmlhbGl6ZXIiLCJzZXJpYWxpemVUb1N0cmluZyIsInN2Z0RhdGFVcmwiLCJidG9hIiwiY2FudmFzIiwiY3JlYXRlRWxlbWVudCIsInNjYWxlRmFjdG9yIiwibWF4Iiwid2lkdGgiLCJoZWlnaHQiLCJjb25zb2xlIiwibG9nIiwiY3R4IiwiZ2V0Q29udGV4dCIsInN2Z0RhdGFJbWFnZSIsIkltYWdlIiwib25sb2FkIiwiZHJhd0ltYWdlIiwidG9CbG9iIiwiYmxvYiIsIkVycm9yIiwiZmlsZW5hbWUiLCJlbGVtIiwid2luZG93IiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwiZG93bmxvYWQiLCJjbGljayIsInNyYyIsImNvbnZlcnQiLCJvcHRpb25zIiwiaXNOYU4iLCJwb3NzaWJsZV9vcHRpb25zIiwiZXhwb25lbnRpYWxMaW1pdHMiLCJudW1iZXJUaGVvcnlFbmFibGVkIiwibnVtYmVyVGhlb3J5IiwicG9seW5vbWlhbExpbWl0cyIsImdlb21ldHJpY1NlcmllcyIsIndyYXBwZWRGdW5jdGlvbiIsImZhYyIsImZhY3RvcmlhbHMiLCJpc0ZhY3RvcmlhbCIsImdhbW1hRnVuY3Rpb25FbmFibGVkIiwiZ2FtbWFGdW5jdGlvbiIsImNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiIsImlucHV0IiwiYXZhaWxhYmxlX29wZXJhdGlvbnMiLCJvcGVyYXRpb25zIiwiZGVjb21wb3NpdGlvbnMiLCJpc1NxdWFyZSIsImlzT2RkIiwiY29udGludWVkRnJhY3Rpb25zIiwiZGVjb21wb3NlIiwiZGlzcGxheSIsImJ1dHRvbiIsImRpc2FibGVkIiwib3V0cHV0IiwiaW5uZXJIVE1MIiwiTWF0aEpheCIsInRleFJlc2V0IiwibWF0aEpheE9wdGlvbnMiLCJnZXRNZXRyaWNzRm9yIiwiY2hlY2tlZCIsInRleDJzdmdQcm9taXNlIiwidGhlbiIsIm5vZGUiLCJhcHBlbmRDaGlsZCIsInN0YXJ0dXAiLCJjbGVhciIsInVwZGF0ZURvY3VtZW50Iiwic3R5bGUiLCJjYXRjaCIsImVyciIsImNyZWF0ZVRleHROb2RlIiwibWVzc2FnZSIsImZvcm0iLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCJdLCJzb3VyY2VSb290IjoiIn0=