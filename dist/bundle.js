(()=>{"use strict";const t=t=>t[Math.floor(Math.random()*t.length)],e=t=>{let e,r=t.length;for(;0!=r;)e=Math.floor(Math.random()*r),r--,[t[r],t[e]]=[t[e],t[r]];return t},r=t=>{if(t<=1||t%2==0&&t>2)return!1;for(let e=3;e<=Math.sqrt(t);e+=2)if(t%e==0)return!1;return!0},n=t=>{let e=[];for(let r=0;r<=t;r++)t%r==0&&e.push(r);return e},i=t=>t>=2&&Number.isInteger(Math.log2(t)),o=(t,e)=>e?o(e,t%e):t,a=(t,e)=>`\\href{${e}}{\\color{black}{${t}}}`,l=t=>{let e=0;for(let r=1;r<=t;r++)1===o(r,t)&&e++;return e},h=(t=>{const e=[];for(let r=0;r<=t;r++)e.push(!0);e[0]=!1,e[1]=!1;for(let r=2;r*r<=t;r++)if(!0===e[r])for(let n=r*r;n<=t;n+=r)e[n]=!1;let r=[];for(let n=0;n<=t;n++)e[n]&&r.push(n);return r})(999),s=t=>h.filter((e=>e<=t)).length,m=e=>{let r=[],n=[],i=[];for(let t=1;t<=999;t++)l(t)===e&&r.push(t),s(t)===e&&n.push(t);if(r.length>0){let e=t(r);i.push(`${a("\\varphi","https://en.wikipedia.org/wiki/Euler%27s_totient_function")}(${e})`)}if(n.length>0){let e=t(n);i.push(`${a("\\pi","https://en.wikipedia.org/wiki/Prime-counting_function")}(${e})`)}return(0===i.length||Math.random()<.3)&&i.push(`${e}`),t(i)},u=t=>{if(0===t){let t=Math.floor(20*Math.random());return`{${a("\\lim_{x \\to \\infty}","https://en.wikipedia.org/wiki/List_of_limits#Functions_of_the_form_xa")}{${t}x^{-1}}}`}if(1===t)return`{${a("\\lim_{x \\to \\infty}","https://en.wikipedia.org/wiki/List_of_limits#Functions_of_the_form_xg(x)")}{x^{1/x}}}`;{let e=Math.floor(5*Math.random())+1,r=Math.floor(3*Math.random())+2,n=r-1,i=["-","+"],o=`${e*t}x^{${r}} `,a=`${e}x^{${r}} `;for(let t=r-1;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;o+=`${i[Math.floor(2*Math.random())]} ${e}x${r} `}for(let t=n;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;a+=`${i[Math.floor(2*Math.random())]} ${e}x${r} `}return`{ \\lim_{x \\to \\infty} { \\frac{${o}}{${a}}} }`}},d=t=>{const e="https://en.wikipedia.org/wiki/Euler%27s_identity";return 0!==t?`{-${t}${a("e^{\\pi i}",e)}}`:`{(${a("e^{\\pi i}",e)} + 1)}`},c=t=>{let e=Math.floor(10*Math.random())+1;if(Math.random()<.5)var r=`\\lim_{x \\to ${t-e}} \\frac{x^2 - ${e**2}}{x - ${e}}`;else r=`\\lim_{x \\to ${t+e}} \\frac{x^2 - ${e**2}}{x + ${e}}`;return`{${r}}`},f=t=>`${t}`,$=(t,e)=>{let r=n(t),i=r[Math.floor(Math.random()*r.length)],o=t/i,a=Math.floor(30*Math.random())+1;return Math.random()<.2?`{{\\left({${e[0](i)}}\\right)}{\\left({${e[1](o)}}\\right)}}`:`{ \\left({${e[0](i)} - ${e[1](a)}}\\right) \\left({${e[2](o)} + ${e[3](a)}}\\right) + {${e[3](a)}}{\\left({${e[3](o)} - ${e[3](i)} + ${e[3](a)}} \\right)} }`},p=(t,e)=>{let r=t**2;return`{\\sqrt{${e[0](r)}}}`},g=(t,e)=>{let r=Math.sqrt(t),n=`${e[0](1)}`,i=1;if(Math.random()<.2){for(let t=0;t<r-1;t++)i+=2,n+=`+ ${e[3](i)}`;return n=`{ ${n} }`,n}{let t=Math.floor(Math.random()*r-1)+1,n=r-t;return Math.random()<.5?`{ {\\left(${e[0](t)} + ${e[0](n)}\\right)}^2}`:`{ {\\left(${e[0](t)}\\right)}^2 + {${e[3](2)}}{\\left(${e[1](t)}\\right)}{\\left(${e[2](n)}\\right)} + {\\left(${e[3](n)}\\right)}^2}`}},M=(t,e)=>{let r=Math.floor(t/2),n=Math.ceil(t/2);return Math.ceil(t/2)**2<100&&Math.random()<.7?`{${e[0](n**2)} - ${e[0](r**2)}}`:`{ \\left({${e[0](n)}}\\right)^2 -  \\left({${e[1](r)}}\\right)^2}`},_=(t,e)=>{let r=Math.floor(Math.random()*t+1)+1,n=t%r,i=Math.floor(t/r);return`${e[0](i)} \\times {${e[1](r)}} + ${e[2](n)}`},x=(t,e)=>{let r=Math.floor(5*Math.random())+1;return`\\frac{${e[0](t*r)}} {${e[1](r)}}`},k=(t,r)=>{const n=(t=>{const e=[];let r=2;for(;t>=2;)t%r==0?(e.push(r),t/=r):r++;return e})(t);let i=new Map;for(const t of n)i.set(t,i.has(t)?i.get(t)+1:1);const o=e(Array.from(i.keys()));let a=Math.floor(Math.random()*(o.length-1))+1,l=o.slice(0,a),h=o.slice(a),s=l.map((t=>t**i.get(t))).reduce(((t,e)=>t*e),1),m=h.map((t=>t**i.get(t))).reduce(((t,e)=>t*e),1);return`\\operatorname{lcm}\\left(${r[0](s)}, ${r[1](m)}\\right)`},y=(t,e)=>{const r=n(t).filter((t=>t%2==1&&1!==t)),i=r[Math.floor(Math.random()*r.length)],o=t/i-(i-1)/2,a=o<0?"-":"+";return`\\sum_{k=0}^{${e[0](i-1)}} \\left(k ${a} ${e[1](Math.abs(o))}\\right)`},w=(t,e)=>{const r=t=>e[Math.floor(Math.random()*e.length)](t),n=Math.floor(Math.log10(t))+Math.floor(3*Math.random()),[i,o]=((t,e)=>{let r,n=[];for(;0!==t&&0!==e;){let i=Math.floor(t/e);void 0===r?r=i:n.push(i),[t,e]=[e,t-e*i]}return[r,n]})(t,10**n);return`{10^{${n}}\\left[${r(i)};${o.map((t=>r(t))).join(",")}\\right]}`};let b=document.getElementById("download-img");const I=()=>{var t=document.querySelector("svg"),e=document.getElementById("input").value;let r=parseInt(t.getAttribute("width")),n=parseInt(t.getAttribute("height"));const i=(new XMLSerializer).serializeToString(t),o=`data:image/svg+xml;base64,${btoa(i)}`,a=document.createElement("canvas");let l=Math.max(2,800/n);a.width=r*l,a.height=n*l,console.log({w:a.width,h:a.height});const h=a.getContext("2d"),s=new Image;s.onload=()=>{h.drawImage(s,0,0,a.width,a.height),a.toBlob((t=>{if(null===t)throw new Error("Failed to serialize canvas to blob");((t,e)=>{const r=window.document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t,r.click()})(`complicated-expression-that-equals-${e}`,t)}))},s.src=o},E=(t,n)=>{if(isNaN(t)||t<0)return;let o=[];n.eulersIdentity&&o.push(d),n.exponentialLimits&&(o.push((t=>((t,e)=>{const r="https://en.wikipedia.org/wiki/List_of_limits#Natural_logarithms";if(0===t)return`{${a("\\lim_{x \\to \\infty}",r)}{ \\frac{\\ln(x)}{x} }}`;if(1===t)return`{${a("\\lim_{x \\to 1}",r)}  {\\frac{\\ln(x)}{x - 1}}}`;{let n=e?m(t):t;return`{${a("\\lim_{x \\to 0}",r)}{ \\frac{-\\ln(1 + ${n}(e^{-x} - 1))}{x} }}`}})(t,n.numberTheory))),o.push((t=>((t,e)=>{const r="https://en.wikipedia.org/wiki/List_of_limits#Sums,_products_and_composites";if(0===t)return`{${a("\\lim_{x \\to \\infty}",r)}{xe^{-x}}}`;if(1===t)return`{${a("\\lim_{x \\to 0}",r)}{ \\frac{e^x - 1}{x} }}`;{let n=e?m(t):t;return`{${a("\\lim_{x \\to 0}",r)}{ \\frac{e^{${n}x} - 1}{x} }}`}})(t,n.numberTheory)))),n.polynomialLimits&&(o.push(c),o.push(u)),n.geometricSeries&&o.push((t=>((t,e)=>{if(0===t){let t="https://en.wikipedia.org/wiki/List_of_mathematical_series#Trigonometric_functions",e=Math.floor(10*Math.random())+3;return`{${a("\\sum",t)}\\limits_{k=0}^{${e-1}} {\\sin \\left({ \\frac{2 \\pi k}{${e}} } \\right)}}`}return 1===t?`{${a("\\lim_{\\epsilon \\to 0}","https://en.wikipedia.org/wiki/Particular_values_of_the_Riemann_zeta_function#The_Riemann_zeta_function_at_0_and_1")}{ \\epsilon \\zeta(1 + \\epsilon) }}`:`{\\sum\\limits_{k=0}^\\infty {\\left({\\frac{${e?m(t-1):t-1}}{${e?m(t):t}}}\\right)^{k}}}`})(t,n.numberTheory))),o=o.map((t=>((t,e)=>r=>{if(Math.random()<=.5){const t=(t=>{const e={2:2,6:3,24:4,120:5,720:6};return t in e&&e[t]})(r);if(t)return((t,e)=>Math.random()<.5&&e?`{${a("\\Gamma","https://en.wikipedia.org/wiki/Gamma_function")} (${t+1})}`:`{\\prod_{k=1}^{${t}} k}`)(t,e.gammaFunction);if(i(r))return((t,e)=>{let r=e?m(t):t;return`{${a(`\\sum_{k=0}^{${r}}`,"https://en.wikipedia.org/wiki/List_of_mathematical_series#Binomial_coefficients_2")} {${t} \\choose k}}`})(Math.log2(r),e.numberTheory)}return t(r)})(t,n)));let l=((t,n,o)=>{let a=n;for(;a.length<4;)a.push(f);a=e(a).slice(0,4);const l=[];return 0!==t&&t<100&&(2===t||!r(t))&&l.push($),t<10&&l.push(p),t>1&&(t=>Number.isInteger(Math.sqrt(t)))(t)&&t<100&&l.push(g),(t=>t%2!=0)(t)&&l.push(M),t<=200&&l.push(x),!r(t)&&t>1&&l.push(k),!i(t)&&t>1&&l.push(y),t>1&&o.continuedFractions&&l.push(w),l.push(_),e(l)[0](t,a)})(t,o,n);var h=document.getElementById("display"),s=document.getElementById("render");s.disabled=h.disabled=!0;let b=document.getElementById("download-img"),I=document.getElementById("output");I.innerHTML="",MathJax.texReset();var E=MathJax.getMetricsFor(I);E.display=h.checked,MathJax.tex2svgPromise(l,E).then((function(t){I.appendChild(t),MathJax.startup.document.clear(),MathJax.startup.document.updateDocument(),b.style.display="block"})).catch((function(t){I.appendChild(document.createElement("pre")).appendChild(document.createTextNode(t.message))})).then((function(){s.disabled=h.disabled=!1}))};(()=>{const t=document.getElementById("form"),e=document.getElementById("input"),r=document.getElementById("gamma-function"),n=document.getElementById("eulers-identity"),i=document.getElementById("limits-exponential"),o=document.getElementById("limits-polynomial"),a=document.getElementById("number-theory"),l=document.getElementById("geometric-series"),h=document.getElementById("continued-fractions");t.addEventListener("submit",(t=>{t.preventDefault(),E(parseInt(e.value),{gammaFunction:r.checked,eulersIdentity:n.checked,exponentialLimits:i.checked,polynomialLimits:o.checked,numberTheory:a.checked,geometricSeries:l.checked,continuedFractions:h.checked})})),b.addEventListener("click",I)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QW1CL0MsU0FBU0MsZUFBZSxxQkFDM0M2QyxFQUFlOUMsU0FBU0MsZUFBZSxpQkFDdkMrQyxFQUFrQmhELFNBQVNDLGVBQWUsb0JBQzFDNkQsRUFBcUI5RCxTQUFTQyxlQUFlLHVCQUVuRHFGLEVBQUtDLGlCQUFpQixVQUFVQyxJQUM1QkEsRUFBTUMsaUJBRU5qRCxFQUFRakMsU0FBUzVELEVBQU8wRCxPQUFRLENBQzVCaUQsY0FBZUEsRUFBY21CLFFBQzdCbkksZUFBZ0JBLEVBQWVtSSxRQUMvQjdCLGtCQUFtQkEsRUFBa0I2QixRQUNyQzFCLGlCQUFrQkEsRUFBaUIwQixRQUNuQzNCLGFBQWNBLEVBQWEyQixRQUMzQnpCLGdCQUFpQkEsRUFBZ0J5QixRQUNqQ1gsbUJBQW9CQSxFQUFtQlcsU0FDekMsSURsRE4xRSxFQUFZd0YsaUJBQWlCLFFBQVNyRixFQ3FEbkIsRUFHdkIsRSIsInNvdXJjZXMiOlsid2VicGFjazovL251bTJtYXRoLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovL251bTJtYXRoLy4vc3JjL3JlcHJlc2VudGF0aW9ucy50cyIsIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy9kZWNvbXBvc2l0aW9ucy50cyIsIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy9kb3dubG9hZC1wbmcudHMiLCJ3ZWJwYWNrOi8vbnVtMm1hdGgvLi9zcmMvc2NyaXB0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgb3BlcmF0aW9uID0gKG46IG51bWJlcikgPT4gc3RyaW5nO1xuXG50eXBlIENvbnZlcnRPcHRpb25zID0ge1xuICAgIGdhbW1hRnVuY3Rpb246IGJvb2xlYW47XG4gICAgZXVsZXJzSWRlbnRpdHk6IGJvb2xlYW47XG4gICAgZXhwb25lbnRpYWxMaW1pdHM6IGJvb2xlYW47XG4gICAgcG9seW5vbWlhbExpbWl0czogYm9vbGVhbjtcbiAgICBudW1iZXJUaGVvcnk6IGJvb2xlYW47XG4gICAgZ2VvbWV0cmljU2VyaWVzOiBib29sZWFuO1xuICAgIGNvbnRpbnVlZEZyYWN0aW9uczogYm9vbGVhbjtcbn07XG5cbmNvbnN0IHJhbmRvbUVsZW1lbnQgPSA8QT4oYXJyYXk6IEFbXSkgPT4ge1xuICAgIHJldHVybiBhcnJheVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcnJheS5sZW5ndGgpXTtcbn07XG5cbmNvbnN0IHNodWZmbGUgPSA8QT4oYXJyYXk6IEFbXSkgPT4ge1xuICAgIGxldCBjdXJyZW50SW5kZXggPSBhcnJheS5sZW5ndGgsXG4gICAgICAgIHJhbmRvbUluZGV4O1xuXG4gICAgLy8gV2hpbGUgdGhlcmUgcmVtYWluIGVsZW1lbnRzIHRvIHNodWZmbGUuXG4gICAgd2hpbGUgKGN1cnJlbnRJbmRleCAhPSAwKSB7XG4gICAgICAgIC8vIFBpY2sgYSByZW1haW5pbmcgZWxlbWVudC5cbiAgICAgICAgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjdXJyZW50SW5kZXgpO1xuICAgICAgICBjdXJyZW50SW5kZXgtLTtcblxuICAgICAgICAvLyBBbmQgc3dhcCBpdCB3aXRoIHRoZSBjdXJyZW50IGVsZW1lbnQuXG4gICAgICAgIFthcnJheVtjdXJyZW50SW5kZXhdLCBhcnJheVtyYW5kb21JbmRleF1dID0gW2FycmF5W3JhbmRvbUluZGV4XSwgYXJyYXlbY3VycmVudEluZGV4XV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGFycmF5O1xufTtcblxuY29uc3QgaXNPZGQgPSAobjogbnVtYmVyKSA9PiBuICUgMiAhPT0gMDtcblxuY29uc3QgaXNTcXVhcmUgPSAobjogbnVtYmVyKSA9PiBOdW1iZXIuaXNJbnRlZ2VyKE1hdGguc3FydChuKSk7XG5cbmNvbnN0IGlzUHJpbWUgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgaWYgKG4gPD0gMSB8fCAobiAlIDIgPT0gMCAmJiBuID4gMikpIHJldHVybiBmYWxzZTtcblxuICAgIGZvciAobGV0IGkgPSAzOyBpIDw9IE1hdGguc3FydChuKTsgaSArPSAyKSB7XG4gICAgICAgIGlmIChuICUgaSA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5cbmNvbnN0IGdldEZhY3RvcnMgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgbGV0IGZhY3RvcnMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgaWYgKG4gJSBpID09PSAwKSB7XG4gICAgICAgICAgICBmYWN0b3JzLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhY3RvcnM7XG59O1xuXG4vLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNTM2NDMzNDAvMTM5OTYzODlcbmNvbnN0IGdldFByaW1lRmFjdG9ycyA9IChuOiBudW1iZXIpID0+IHtcbiAgICBjb25zdCBmYWN0b3JzID0gW107XG4gICAgbGV0IGRpdmlzb3IgPSAyO1xuXG4gICAgd2hpbGUgKG4gPj0gMikge1xuICAgICAgICBpZiAobiAlIGRpdmlzb3IgPT0gMCkge1xuICAgICAgICAgICAgZmFjdG9ycy5wdXNoKGRpdmlzb3IpO1xuICAgICAgICAgICAgbiAvPSBkaXZpc29yO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGl2aXNvcisrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWN0b3JzO1xufTtcblxuLy8gQ2hlY2tpbmcgaWYgYSBudW1iZXIgY2FuIGJlIGZvcm1lZCB1c2luZyBmYWN0b3JpYWxcbmNvbnN0IGlzRmFjdG9yaWFsID0gKG46IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IGZhY3RvcmlhbHM6IHsgW2tleTogbnVtYmVyXTogbnVtYmVyIH0gPSB7XG4gICAgICAgIDI6IDIsXG4gICAgICAgIDY6IDMsXG4gICAgICAgIDI0OiA0LFxuICAgICAgICAxMjA6IDUsXG4gICAgICAgIDcyMDogNixcbiAgICB9O1xuXG4gICAgaWYgKG4gaW4gZmFjdG9yaWFscykge1xuICAgICAgICByZXR1cm4gZmFjdG9yaWFsc1tuXTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufTtcblxuY29uc3QgaXNQb3cyID0gKG46IG51bWJlcikgPT4gbiA+PSAyICYmIE51bWJlci5pc0ludGVnZXIoTWF0aC5sb2cyKG4pKTtcblxuY29uc3QgZ2NkID0gKGE6IG51bWJlciwgYjogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgICBpZiAoIWIpIHtcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfVxuXG4gICAgcmV0dXJuIGdjZChiLCBhICUgYik7XG59O1xuXG5jb25zdCBocmVmID0gKHM6IHN0cmluZywgdXJsOiBzdHJpbmcpID0+IHtcbiAgICByZXR1cm4gYFxcXFxocmVmeyR7dXJsfX17XFxcXGNvbG9ye2JsYWNrfXske3N9fX1gO1xufTtcblxuY29uc3QgY29udGludWVkRnJhY3Rpb24gPSAobnVtZXJhdG9yOiBudW1iZXIsIGRlbm9taW5hdG9yOiBudW1iZXIpOiBbbnVtYmVyLCBudW1iZXJbXV0gPT4ge1xuICAgIGxldCBjb250aW51ZWRGcmFjdGlvbldob2xlUGFydDogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICAgIGxldCBjb250aW51ZWRGcmFjdGlvblBhcnQ6IG51bWJlcltdID0gW107XG4gICAgd2hpbGUgKG51bWVyYXRvciAhPT0gMCAmJiBkZW5vbWluYXRvciAhPT0gMCkge1xuICAgICAgICBsZXQgd2hvbGVQYXJ0ID0gTWF0aC5mbG9vcihudW1lcmF0b3IgLyBkZW5vbWluYXRvcik7XG5cbiAgICAgICAgaWYgKGNvbnRpbnVlZEZyYWN0aW9uV2hvbGVQYXJ0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlZEZyYWN0aW9uV2hvbGVQYXJ0ID0gd2hvbGVQYXJ0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29udGludWVkRnJhY3Rpb25QYXJ0LnB1c2god2hvbGVQYXJ0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIFtudW1lcmF0b3IsIGRlbm9taW5hdG9yXSA9IFtkZW5vbWluYXRvciwgbnVtZXJhdG9yIC0gZGVub21pbmF0b3IgKiB3aG9sZVBhcnRdO1xuICAgIH1cblxuICAgIHJldHVybiBbY29udGludWVkRnJhY3Rpb25XaG9sZVBhcnQhLCBjb250aW51ZWRGcmFjdGlvblBhcnRdO1xufTtcblxuZXhwb3J0IHtcbiAgICBvcGVyYXRpb24sXG4gICAgQ29udmVydE9wdGlvbnMsXG4gICAgcmFuZG9tRWxlbWVudCxcbiAgICBzaHVmZmxlLFxuICAgIGlzT2RkLFxuICAgIGlzU3F1YXJlLFxuICAgIGlzUHJpbWUsXG4gICAgZ2V0RmFjdG9ycyxcbiAgICBnZXRQcmltZUZhY3RvcnMsXG4gICAgaXNGYWN0b3JpYWwsXG4gICAgaXNQb3cyLFxuICAgIGdjZCxcbiAgICBocmVmLFxuICAgIGNvbnRpbnVlZEZyYWN0aW9uLFxufTtcbiIsIi8qKlxuICogRXhwbG9pdHMgdGhlIFtTdHJvbmcgbGF3IG9mIHNtYWxsIG51bWJlcnNdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1N0cm9uZ19sYXdfb2Zfc21hbGxfbnVtYmVycykgdG9cbiAqIGZpbmQgcHJvcGVydGllcyBvZiB0aGUgc21hbGxlciBudW1iZXJzIGdpdmVuIGJ5IHRoZSBkZWNvbXBvc2l0aW9ucywgc3VjaCBhcyB0aGUgZXVsZXIgcGhpIGFuZCBwcmltZSBjb3VudGluZyBmdW5jdGlvbnMsXG4gKiBmYWN0b3JpYWwvZ2FtbWEsIGFuZCBtb3JlLlxuICovXG5cbmltcG9ydCB7IGdjZCwgcmFuZG9tRWxlbWVudCwgaHJlZiB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBfZXVsZXJQaGkgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgbGV0IHggPSAwO1xuXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gbjsgaSsrKSB7XG4gICAgICAgIGlmIChnY2QoaSwgbikgPT09IDEpIHtcbiAgICAgICAgICAgIHgrKztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB4O1xufTtcblxuY29uc3QgX3ByaW1lU2lldmUgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgcHJpbWVTaWV2ZSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IG47IGkrKykge1xuICAgICAgICBwcmltZVNpZXZlLnB1c2godHJ1ZSk7XG4gICAgfVxuICAgIHByaW1lU2lldmVbMF0gPSBmYWxzZTtcbiAgICBwcmltZVNpZXZlWzFdID0gZmFsc2U7XG5cbiAgICBmb3IgKGxldCBwID0gMjsgcCAqIHAgPD0gbjsgcCsrKSB7XG4gICAgICAgIGlmIChwcmltZVNpZXZlW3BdID09PSB0cnVlKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gcCAqIHA7IGkgPD0gbjsgaSArPSBwKSB7XG4gICAgICAgICAgICAgICAgcHJpbWVTaWV2ZVtpXSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgbGV0IHJlc1ByaW1lcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IG47IGkrKykge1xuICAgICAgICBpZiAocHJpbWVTaWV2ZVtpXSkge1xuICAgICAgICAgICAgcmVzUHJpbWVzLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc1ByaW1lcztcbn07XG5cbmNvbnN0IF9jYWNoZWRQcmltZXMgPSBfcHJpbWVTaWV2ZSg5OTkpO1xuXG5jb25zdCBfcHJpbWVDb3VudGluZ0Z1bmN0aW9uID0gKG46IG51bWJlcikgPT4ge1xuICAgIHJldHVybiBfY2FjaGVkUHJpbWVzLmZpbHRlcih4ID0+IHggPD0gbikubGVuZ3RoO1xufTtcblxuY29uc3QgbnVtYmVyVGhlb3J5RnVuY3Rpb25zID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCBtYXRjaGluZ1BoaUlucHV0cyA9IFtdO1xuICAgIGxldCBtYXRjaGluZ1BpSW5wdXRzID0gW107XG4gICAgbGV0IGZ1bmN0aW9uT3B0aW9ucyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gOTk5OyBpKyspIHtcbiAgICAgICAgaWYgKF9ldWxlclBoaShpKSA9PT0gbikge1xuICAgICAgICAgICAgbWF0Y2hpbmdQaGlJbnB1dHMucHVzaChpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfcHJpbWVDb3VudGluZ0Z1bmN0aW9uKGkpID09PSBuKSB7XG4gICAgICAgICAgICBtYXRjaGluZ1BpSW5wdXRzLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobWF0Y2hpbmdQaGlJbnB1dHMubGVuZ3RoID4gMCkge1xuICAgICAgICBsZXQgbWF0Y2hpbmdJbnB1dCA9IHJhbmRvbUVsZW1lbnQobWF0Y2hpbmdQaGlJbnB1dHMpO1xuXG4gICAgICAgIGZ1bmN0aW9uT3B0aW9ucy5wdXNoKFxuICAgICAgICAgICAgYCR7aHJlZihcbiAgICAgICAgICAgICAgICAnXFxcXHZhcnBoaScsXG4gICAgICAgICAgICAgICAgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0V1bGVyJTI3c190b3RpZW50X2Z1bmN0aW9uJ1xuICAgICAgICAgICAgKX0oJHttYXRjaGluZ0lucHV0fSlgXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKG1hdGNoaW5nUGlJbnB1dHMubGVuZ3RoID4gMCkge1xuICAgICAgICBsZXQgbWF0Y2hpbmdJbnB1dCA9IHJhbmRvbUVsZW1lbnQobWF0Y2hpbmdQaUlucHV0cyk7XG4gICAgICAgIGZ1bmN0aW9uT3B0aW9ucy5wdXNoKFxuICAgICAgICAgICAgYCR7aHJlZihcbiAgICAgICAgICAgICAgICAnXFxcXHBpJyxcbiAgICAgICAgICAgICAgICAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUHJpbWUtY291bnRpbmdfZnVuY3Rpb24nXG4gICAgICAgICAgICApfSgke21hdGNoaW5nSW5wdXR9KWBcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoZnVuY3Rpb25PcHRpb25zLmxlbmd0aCA9PT0gMCB8fCBNYXRoLnJhbmRvbSgpIDwgMC4zKSB7XG4gICAgICAgIGZ1bmN0aW9uT3B0aW9ucy5wdXNoKGAke259YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJhbmRvbUVsZW1lbnQoZnVuY3Rpb25PcHRpb25zKTtcbn07XG5cbmNvbnN0IGZhY3RvcmlhbCA9IChuOiBudW1iZXIsIGdhbW1hRnVuY3Rpb25FbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjUgJiYgZ2FtbWFGdW5jdGlvbkVuYWJsZWQpIHtcbiAgICAgICAgLy8gzpMobikgPSAobi0xKSFcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcR2FtbWEnLCAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvR2FtbWFfZnVuY3Rpb24nKX0gKCR7biArIDF9KX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFVzaW5nIHRoZSBwaSBwcm9kdWN0IG5vdGF0aW9uIG9mIGZhY3RvcmlhbFxuICAgICAgICByZXR1cm4gYHtcXFxccHJvZF97az0xfV57JHtufX0ga31gO1xuICAgIH1cbn07XG5cbi8vIHJlcHJlc2VudGF0aW9uIG9mIDJeblxuY29uc3QgcG93MkNob29zZSA9IChuOiBudW1iZXIsIG51bWJlclRoZW9yeUVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBsZXQgeCA9IG51bWJlclRoZW9yeUVuYWJsZWQgPyBudW1iZXJUaGVvcnlGdW5jdGlvbnMobikgOiBuO1xuICAgIHJldHVybiBgeyR7aHJlZihcbiAgICAgICAgYFxcXFxzdW1fe2s9MH1eeyR7eH19YCxcbiAgICAgICAgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbWF0aGVtYXRpY2FsX3NlcmllcyNCaW5vbWlhbF9jb2VmZmljaWVudHNfMidcbiAgICApfSB7JHtufSBcXFxcY2hvb3NlIGt9fWA7XG59O1xuXG4vLyBMaW1pdHMgb2YgbmF0dXJhbCBsb2cgZnVuY3Rpb25zOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX2xpbWl0cyNOYXR1cmFsX2xvZ2FyaXRobXNcbmNvbnN0IGxpbWl0TmF0dXJhbExvZyA9IChuOiBudW1iZXIsIG51bWJlclRoZW9yeUVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjTmF0dXJhbF9sb2dhcml0aG1zJztcblxuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXGxpbV97eCBcXFxcdG8gXFxcXGluZnR5fScsIHVybCl9eyBcXFxcZnJhY3tcXFxcbG4oeCl9e3h9IH19YDtcbiAgICB9IGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byAxfScsIHVybCl9ICB7XFxcXGZyYWN7XFxcXGxuKHgpfXt4IC0gMX19fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHggPSBudW1iZXJUaGVvcnlFbmFibGVkID8gbnVtYmVyVGhlb3J5RnVuY3Rpb25zKG4pIDogbjtcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byAwfScsIHVybCl9eyBcXFxcZnJhY3stXFxcXGxuKDEgKyAke3h9KGVeey14fSAtIDEpKX17eH0gfX1gO1xuICAgIH1cbn07XG5cbi8vIExpbWl0cyBvZiBleHBvbmVudGlhbCBmdW5jdGlvbnM6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI1N1bXMsX3Byb2R1Y3RzX2FuZF9jb21wb3NpdGVzXG5jb25zdCBsaW1pdEV4cG9uZW50aWFsID0gKG46IG51bWJlciwgbnVtYmVyVGhlb3J5RW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIGNvbnN0IHVybCA9ICdodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX2xpbWl0cyNTdW1zLF9wcm9kdWN0c19hbmRfY29tcG9zaXRlcyc7XG5cbiAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICByZXR1cm4gYHske2hyZWYoJ1xcXFxsaW1fe3ggXFxcXHRvIFxcXFxpbmZ0eX0nLCB1cmwpfXt4ZV57LXh9fX1gO1xuICAgIH0gZWxzZSBpZiAobiA9PT0gMSkge1xuICAgICAgICByZXR1cm4gYHske2hyZWYoJ1xcXFxsaW1fe3ggXFxcXHRvIDB9JywgdXJsKX17IFxcXFxmcmFje2VeeCAtIDF9e3h9IH19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgeCA9IG51bWJlclRoZW9yeUVuYWJsZWQgPyBudW1iZXJUaGVvcnlGdW5jdGlvbnMobikgOiBuO1xuICAgICAgICByZXR1cm4gYHske2hyZWYoJ1xcXFxsaW1fe3ggXFxcXHRvIDB9JywgdXJsKX17IFxcXFxmcmFje2VeeyR7eH14fSAtIDF9e3h9IH19YDtcbiAgICB9XG59O1xuXG4vLyBMaW1pdHMgb2YgcG9seW5vbWlhbCBmdW5jdGlvbnNcbmNvbnN0IGxpbWl0UG9seW5vbWlhbCA9IChuOiBudW1iZXIpID0+IHtcbiAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjRnVuY3Rpb25zX29mX3RoZV9mb3JtX3hhJztcbiAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICBsZXQgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIwKTtcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9JywgdXJsKX17JHtyfXheey0xfX19YDtcbiAgICB9IGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgY29uc3QgdXJsMiA9ICdodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX2xpbWl0cyNGdW5jdGlvbnNfb2ZfdGhlX2Zvcm1feGcoeCknO1xuICAgICAgICByZXR1cm4gYHske2hyZWYoJ1xcXFxsaW1fe3ggXFxcXHRvIFxcXFxpbmZ0eX0nLCB1cmwyKX17eF57MS94fX19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBnZW5lcmF0ZSByYW5kb20gcG9seW5vbWlhbCBsaW1pdHMgbGlrZSBsaW0geCAtPiDiiJ4gKDI4eF4yIC0gMTF4KS8oNHheMiArIDEweClcbiAgICAgICAgLy8gc2luY2UgdGhlIGhpZ2hlc3QgcG93ZXIgdGVybXMgZG9taW5hdGUgaW4gdGhlIGxpbWl0cywgdGhlIHJlc3QgYXJlIGlnbm9yZWQgYW5kIGNhbiBiZSByYW5kb21cblxuICAgICAgICAvLyBHZXQgcmFuZG9tIG11bHRpcGxpZXIgZ3JlYXRlciB0aGFuIDFcbiAgICAgICAgbGV0IG0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA1KSArIDE7XG4gICAgICAgIC8vIENob29zZSBhIHJhbmRvbSBoaWdoZXN0IHBvd2VyLiBUaGlzIGRldGVybWluZXMgdGhlIGZpbmFsIHNvbHV0aW9uIG9mIHRoZSBsaW1pdFxuICAgICAgICBsZXQgaGlnaGVzdFBvd2VyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMykgKyAyO1xuXG4gICAgICAgIGxldCBudW1lcmF0b3JOdW1iZXJPZlRlcm1zID0gaGlnaGVzdFBvd2VyIC0gMTtcbiAgICAgICAgbGV0IGRlbm9taW5hdG9yTnVtYmVyT2ZUZXJtcyA9IGhpZ2hlc3RQb3dlciAtIDE7XG5cbiAgICAgICAgbGV0IHNpZ25zID0gWyctJywgJysnXTtcbiAgICAgICAgbGV0IG51bWVyYXRvciA9IGAke20gKiBufXheeyR7aGlnaGVzdFBvd2VyfX0gYDtcbiAgICAgICAgbGV0IGRlbm9taW5hdG9yID0gYCR7bX14Xnske2hpZ2hlc3RQb3dlcn19IGA7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBwb2x5bm9taWFsIG51bWVyYXRvciB3aXRoIHJhbmRvbSBsZW5ndGggYW5kIGNvZWZmaWNpZW50c1xuICAgICAgICAvL2V4OiAxNXheMlxuICAgICAgICBmb3IgKGxldCBpID0gbnVtZXJhdG9yTnVtYmVyT2ZUZXJtczsgaSA+IDA7IGktLSkge1xuICAgICAgICAgICAgbGV0IGNvZWYgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkgKyAyO1xuXG4gICAgICAgICAgICBsZXQgcG93ZXIgPSBpIDwgMiA/ICcnIDogYF57JHtpfX1gO1xuICAgICAgICAgICAgbGV0IHNpZ24gPSBzaWduc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKV07XG5cbiAgICAgICAgICAgIG51bWVyYXRvciArPSBgJHtzaWdufSAke2NvZWZ9eCR7cG93ZXJ9IGA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZW5lcmF0ZSBhIHBvbHlub21pYWwgZGVub21pbmF0b3Igd2l0aCByYW5kb20gbGVuZ3RoIGFuZCBjb2VmZmljaWVudHNcbiAgICAgICAgZm9yIChsZXQgaSA9IGRlbm9taW5hdG9yTnVtYmVyT2ZUZXJtczsgaSA+IDA7IGktLSkge1xuICAgICAgICAgICAgbGV0IGNvZWYgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkgKyAyO1xuXG4gICAgICAgICAgICBsZXQgcG93ZXIgPSBpIDwgMiA/ICcnIDogYF57JHtpfX1gO1xuICAgICAgICAgICAgbGV0IHNpZ24gPSBzaWduc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKV07XG5cbiAgICAgICAgICAgIGRlbm9taW5hdG9yICs9IGAke3NpZ259ICR7Y29lZn14JHtwb3dlcn0gYDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBgeyBcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9IHsgXFxcXGZyYWN7JHtudW1lcmF0b3J9fXske2Rlbm9taW5hdG9yfX19IH1gO1xuICAgIH1cbn07XG5cbi8vIFVzaW5nIGV1bGVyJ3MgaWRlbnRpdHkuIFRoYXQgaXMsIGVeKHBpKmkpID0gLTFcbmNvbnN0IGV1bGVyc0lkZW50aXR5ID0gKG46IG51bWJlcikgPT4ge1xuICAgIC8vIGUuZyDiiJI2ZV4ocGkqaSk9NlxuXG4gICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0V1bGVyJTI3c19pZGVudGl0eSc7XG5cbiAgICBpZiAobiAhPT0gMCkge1xuICAgICAgICByZXR1cm4gYHstJHtufSR7aHJlZignZV57XFxcXHBpIGl9JywgdXJsKX19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYHsoJHtocmVmKCdlXntcXFxccGkgaX0nLCB1cmwpfSArIDEpfWA7XG4gICAgfVxufTtcblxuLy8gSW5maW5pdGUgZ2VvbWV0cmljIHNlcmllcyB0aGF0IGV2YWx1YXRlcyB0byBhIGZpbml0ZSB2YWx1ZVxuY29uc3QgaW5maW5pdGVHZW9tZXRyaWNTZXJpZXMgPSAobjogbnVtYmVyLCBudW1iZXJUaGVvcnlFbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgaWYgKG4gPT09IDApIHtcbiAgICAgICAgbGV0IHVybCA9XG4gICAgICAgICAgICAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9tYXRoZW1hdGljYWxfc2VyaWVzI1RyaWdvbm9tZXRyaWNfZnVuY3Rpb25zJztcbiAgICAgICAgbGV0IHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkgKyAzO1xuICAgICAgICByZXR1cm4gYHske2hyZWYoJ1xcXFxzdW0nLCB1cmwpfVxcXFxsaW1pdHNfe2s9MH1eeyR7ciAtXG4gICAgICAgICAgICAxfX0ge1xcXFxzaW4gXFxcXGxlZnQoeyBcXFxcZnJhY3syIFxcXFxwaSBrfXske3J9fSB9IFxcXFxyaWdodCl9fWA7XG4gICAgfVxuXG4gICAgLy8gVXNpbmcgdGhlIFJpZW1hbm4gemV0YSBmdW5jdGlvblxuICAgIGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgbGV0IHVybCA9XG4gICAgICAgICAgICAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGFydGljdWxhcl92YWx1ZXNfb2ZfdGhlX1JpZW1hbm5femV0YV9mdW5jdGlvbiNUaGVfUmllbWFubl96ZXRhX2Z1bmN0aW9uX2F0XzBfYW5kXzEnO1xuXG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXGxpbV97XFxcXGVwc2lsb24gXFxcXHRvIDB9JywgdXJsKX17IFxcXFxlcHNpbG9uIFxcXFx6ZXRhKDEgKyBcXFxcZXBzaWxvbikgfX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFVzaW5nIHRoZSBpbmZpbml0ZSBnZW9tZXRyaWMgc2VyaWVzIHJ1bGU6IFdoZW4g4oiSMTx4PDEsIHN1bW1hdGlvbiBmcm9tIGkgPSAwIHRvIGluZmluaXR5IG9mIHJeaSA9IDEvKDEtcikgb3IgKHItMSkvci5cbiAgICAgICAgLy8gRGVjaW1hbCBjYW4gYmUgcmVwcmVzZW50ZWQgYXMgZnJhY3Rpb24gdG9vLiBlLmcgKDAuMjUpXmkgPSAoMS80KV5pID0gNF4taVxuICAgICAgICBsZXQgeDEgPSBudW1iZXJUaGVvcnlFbmFibGVkID8gbnVtYmVyVGhlb3J5RnVuY3Rpb25zKG4gLSAxKSA6IG4gLSAxO1xuICAgICAgICBsZXQgeDIgPSBudW1iZXJUaGVvcnlFbmFibGVkID8gbnVtYmVyVGhlb3J5RnVuY3Rpb25zKG4pIDogbjtcbiAgICAgICAgcmV0dXJuIGB7XFxcXHN1bVxcXFxsaW1pdHNfe2s9MH1eXFxcXGluZnR5IHtcXFxcbGVmdCh7XFxcXGZyYWN7JHt4MX19eyR7eDJ9fX1cXFxccmlnaHQpXntrfX19YDtcbiAgICB9XG59O1xuXG4vLyBVc2luZyB0aGUgdHJpZyBpZGVudGl0eSAoY29zXjIpeCArIChzaW5eMil4ID0gMVxuY29uc3QgdHJpZ0lkZW50aXR5ID0gKGV4cHJlc3Npb246IHN0cmluZykgPT4ge1xuICAgIGxldCByYW5kb21WYWx1ZSA9IE1hdGgucmFuZG9tKCk7XG4gICAgaWYgKHJhbmRvbVZhbHVlIDwgMC4yNSkge1xuICAgICAgICByZXR1cm4gYFxcXFxsZWZ0KFxcXFxmcmFjeyR7ZXhwcmVzc2lvbn19eyhcXFxcY29zXjJ4ICsgXFxcXHNpbl4yeCl9XFxcXHJpZ2h0KWA7XG4gICAgfSBlbHNlIGlmIChyYW5kb21WYWx1ZSA8IDAuNSkge1xuICAgICAgICByZXR1cm4gYFxcXFxsZWZ0KHske2V4cHJlc3Npb259IFxcXFx0aW1lcyAoXFxcXGNvc14yeCArIFxcXFxzaW5eMngpfVxcXFxyaWdodClgO1xuICAgIH1cbn07XG5cbi8qIFVzaW5nIHRoZSBkaWZmZXJlbmNlIG9mIHR3byBzcXVhcmVzIGluIGxpbWl0cyAqL1xuY29uc3QgbGltRGlmZlR3b1NxdWFyZXMgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgbGV0IHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkgKyAxO1xuICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC41KSB7XG4gICAgICAgIHZhciB0ZXggPSBgXFxcXGxpbV97eCBcXFxcdG8gJHtuIC0gcn19IFxcXFxmcmFje3heMiAtICR7ciAqKiAyfX17eCAtICR7cn19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdGV4ID0gYFxcXFxsaW1fe3ggXFxcXHRvICR7biArIHJ9fSBcXFxcZnJhY3t4XjIgLSAke3IgKiogMn19e3ggKyAke3J9fWA7XG4gICAgfVxuICAgIHJldHVybiBgeyR7dGV4fX1gO1xufTtcblxuY29uc3Qgc2FtZU51bWJlciA9IChuOiBudW1iZXIpID0+IGAke259YDtcblxuZXhwb3J0IHtcbiAgICBudW1iZXJUaGVvcnlGdW5jdGlvbnMsXG4gICAgZmFjdG9yaWFsLFxuICAgIHBvdzJDaG9vc2UsXG4gICAgbGltaXROYXR1cmFsTG9nLFxuICAgIGxpbWl0RXhwb25lbnRpYWwsXG4gICAgbGltaXRQb2x5bm9taWFsLFxuICAgIGV1bGVyc0lkZW50aXR5LFxuICAgIGluZmluaXRlR2VvbWV0cmljU2VyaWVzLFxuICAgIHRyaWdJZGVudGl0eSxcbiAgICBsaW1EaWZmVHdvU3F1YXJlcyxcbiAgICBzYW1lTnVtYmVyLFxufTtcbiIsIi8qKlxuICogVGhpcyBmaWxlIGNvbnRhaW5zIGRlY29tcG9zaXRpb24gZnVuY3Rpb25zLiBUaGV5IGJyZWFrIGxhcmdlciBudW1iZXJzICgzLWRpZ2l0KSBpbnRvIHNtYWxsZXIgb25lcyAoMi0xIGRpZ2l0cyksXG4gKiB3aGVyZSB0aGUgW1N0cm9uZyBsYXcgb2Ygc21hbGwgbnVtYmVyc10oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU3Ryb25nX2xhd19vZl9zbWFsbF9udW1iZXJzKSBjYW4gdGFrZSBvZiB0aGVtXG4gKiBhcyB0aGV5IGhhdmUgbXVjaCBtb3JlIHByb3BlcnRpZXMgdGhhbiBsYXJnZXIgbnVtYmVycy5cbiAqL1xuXG5pbXBvcnQge1xuICAgIG9wZXJhdGlvbixcbiAgICBnZXRGYWN0b3JzLFxuICAgIGdldFByaW1lRmFjdG9ycyxcbiAgICBDb252ZXJ0T3B0aW9ucyxcbiAgICBpc0ZhY3RvcmlhbCxcbiAgICBpc1BvdzIsXG4gICAgc2h1ZmZsZSxcbiAgICBpc1ByaW1lLFxuICAgIGlzU3F1YXJlLFxuICAgIGlzT2RkLFxuICAgIGNvbnRpbnVlZEZyYWN0aW9uLFxufSBmcm9tICcuL3V0aWxzJztcblxudHlwZSBkZWNvbXBvc2l0aW9uID0gKG46IG51bWJlciwgb3BzOiBvcGVyYXRpb25bXSkgPT4gc3RyaW5nO1xuXG5pbXBvcnQgKiBhcyByZXByZXNlbnRhdGlvbnMgZnJvbSAnLi9yZXByZXNlbnRhdGlvbnMnO1xuXG4vLyBmb3IgbiA9IGFiIGFuZCDiiIBjLCBlaXRoZXIgcmV0dXJuIG4gPSBhYiBvciAoYS1jKShiK2MpICsgYyhiLWErYylcbmNvbnN0IGRlY29tcG9zZUFCQyA9IChudW1iZXI6IG51bWJlciwgb3BzOiBvcGVyYXRpb25bXSkgPT4ge1xuICAgIGxldCBmYWN0b3JzID0gZ2V0RmFjdG9ycyhudW1iZXIpO1xuICAgIGxldCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGZhY3RvcnMubGVuZ3RoKTtcbiAgICBsZXQgYSA9IGZhY3RvcnNbcmFuZG9tSW5kZXhdO1xuICAgIGxldCBiID0gbnVtYmVyIC8gYTtcbiAgICBsZXQgYyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMwKSArIDE7XG5cbiAgICAvLyBhYlxuICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4yKSB7XG4gICAgICAgIHJldHVybiBge3tcXFxcbGVmdCh7JHtvcHNbMF0oYSl9fVxcXFxyaWdodCl9e1xcXFxsZWZ0KHske29wc1sxXShiKX19XFxcXHJpZ2h0KX19YDtcbiAgICB9XG5cbiAgICAvLyAoYSAtIGMpKGIgKyBjKSArIGMgKGIgLSBhICsgYylcbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGB7IFxcXFxsZWZ0KHske29wc1swXShhKX0gLSAke29wc1sxXShjKX19XFxcXHJpZ2h0KSBcXFxcbGVmdCh7JHtvcHNbMl0oYil9ICsgJHtvcHNbM10oXG4gICAgICAgICAgICBjXG4gICAgICAgICl9fVxcXFxyaWdodCkgKyB7JHtvcHNbM10oYyl9fXtcXFxcbGVmdCh7JHtvcHNbM10oYil9IC0gJHtvcHNbM10oYSl9ICsgJHtvcHNbM10oXG4gICAgICAgICAgICBjXG4gICAgICAgICl9fSBcXFxccmlnaHQpfSB9YDtcbiAgICB9XG59O1xuXG4vLyA1ID0gc3FydCgyNSlcbmNvbnN0IGRlY29tcG9zZVNxcnQgPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgbGV0IHNxdWFyZSA9IG4gKiogMjtcbiAgICByZXR1cm4gYHtcXFxcc3FydHske29wc1swXShzcXVhcmUpfX19YDtcbn07XG5cbi8vIDI1ID0gMSArIDMgKyA1ICsgNyArIDlcbmNvbnN0IGRlY29tcG9zZVNxdWFyZSA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgc3F1YXJlUm9vdCA9IE1hdGguc3FydChuKTtcbiAgICBsZXQgc3VtID0gYCR7b3BzWzBdKDEpfWA7XG4gICAgbGV0IG9kZFZhbCA9IDE7XG5cbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMikge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNxdWFyZVJvb3QgLSAxOyBpKyspIHtcbiAgICAgICAgICAgIG9kZFZhbCArPSAyO1xuICAgICAgICAgICAgc3VtICs9IGArICR7b3BzWzNdKG9kZFZhbCl9YDtcbiAgICAgICAgfVxuICAgICAgICBzdW0gPSBgeyAke3N1bX0gfWA7XG4gICAgICAgIHJldHVybiBzdW07XG4gICAgfVxuXG4gICAgLy8gKGEgKyBiKV4yID0gYV4yICsgMmFiICsgYl4yXG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBhID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc3F1YXJlUm9vdCAtIDEpICsgMTtcbiAgICAgICAgbGV0IGIgPSBzcXVhcmVSb290IC0gYTtcblxuICAgICAgICAvLyBSZXByZXNlbnRpbmcgKGEgKyBiKV4yXG4gICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC41KSB7XG4gICAgICAgICAgICByZXR1cm4gYHsge1xcXFxsZWZ0KCR7b3BzWzBdKGEpfSArICR7b3BzWzBdKGIpfVxcXFxyaWdodCl9XjJ9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlcHJlc2VudGluZyBhXjIgKyAyYWIgKyBiXjJcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYHsge1xcXFxsZWZ0KCR7b3BzWzBdKGEpfVxcXFxyaWdodCl9XjIgKyB7JHtvcHNbM10oMil9fXtcXFxcbGVmdCgke29wc1sxXShcbiAgICAgICAgICAgICAgICBhXG4gICAgICAgICAgICApfVxcXFxyaWdodCl9e1xcXFxsZWZ0KCR7b3BzWzJdKGIpfVxcXFxyaWdodCl9ICsge1xcXFxsZWZ0KCR7b3BzWzNdKGIpfVxcXFxyaWdodCl9XjJ9YDtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbi8vIDI1ID0gMTNeMiAtIDEyXjJcbmNvbnN0IGRlY29tcG9zZURpZmZlcmVuY2VTcXVhcmVzID0gKG46IG51bWJlciwgb3BzOiBvcGVyYXRpb25bXSkgPT4ge1xuICAgIGxldCBhID0gTWF0aC5mbG9vcihuIC8gMik7XG4gICAgbGV0IGIgPSBNYXRoLmNlaWwobiAvIDIpO1xuXG4gICAgaWYgKE1hdGguY2VpbChuIC8gMikgKiogMiA8IDEwMCAmJiBNYXRoLnJhbmRvbSgpIDwgMC43KSB7XG4gICAgICAgIHJldHVybiBgeyR7b3BzWzBdKGIgKiogMil9IC0gJHtvcHNbMF0oYSAqKiAyKX19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYHsgXFxcXGxlZnQoeyR7b3BzWzBdKGIpfX1cXFxccmlnaHQpXjIgLSAgXFxcXGxlZnQoeyR7b3BzWzFdKGEpfX1cXFxccmlnaHQpXjJ9YDtcbiAgICB9XG59O1xuXG4vLyA3ID0gMiAqIDMgKyAxXG5jb25zdCBkZWNvbXBvc2VBZGRNdWx0aXBseSA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgcmFuZE51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG4gKyAxKSArIDE7XG4gICAgbGV0IHIgPSBuICUgcmFuZE51bTtcbiAgICBsZXQgYSA9IE1hdGguZmxvb3IobiAvIHJhbmROdW0pO1xuICAgIHJldHVybiBgJHtvcHNbMF0oYSl9IFxcXFx0aW1lcyB7JHtvcHNbMV0ocmFuZE51bSl9fSArICR7b3BzWzJdKHIpfWA7XG59O1xuXG4vLyA3ID0gNyo4LzhcbmNvbnN0IGRlY29tcG9zZU11bERpdmlkZSA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDUpICsgMTtcbiAgICByZXR1cm4gYFxcXFxmcmFjeyR7b3BzWzBdKG4gKiByKX19IHske29wc1sxXShyKX19YDtcbn07XG5cbmNvbnN0IGRlY29tcG9zZUxjbSA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICAvLyBhbGwgZmFjdG9ycywgZS5nLiBbMiwgMiwgMiwgMywgMywgLi4uXVxuICAgIGNvbnN0IGZhY3RvcnMgPSBnZXRQcmltZUZhY3RvcnMobik7XG5cbiAgICAvLyBmYWN0b3JzIHdpdGggY29ycmVzcG9uZGluZyBleHBvbmVudHMsIGUuZy4gezI6IDMsIDM6IDIsIDc6IDEsIC4uLn1cbiAgICBsZXQgZmFjdG9yRXhwOiBNYXA8bnVtYmVyLCBudW1iZXI+ID0gbmV3IE1hcCgpO1xuICAgIGZvciAoY29uc3QgZiBvZiBmYWN0b3JzKSB7XG4gICAgICAgIGZhY3RvckV4cC5zZXQoZiwgZmFjdG9yRXhwLmhhcyhmKSA/IGZhY3RvckV4cC5nZXQoZikhICsgMSA6IDEpO1xuICAgIH1cblxuICAgIC8vIGRpc3RpbmN0IHByaW1lIGZhY3RvcnMsIGUuZy4gWzcsIDMsIDUsIDJdXG4gICAgY29uc3QgcHJpbWVGYWN0b3JzID0gc2h1ZmZsZShBcnJheS5mcm9tKGZhY3RvckV4cC5rZXlzKCkpKTtcblxuICAgIC8vIGluIHJhbmdlIFsxLCBsZW5ndGgtMV1cbiAgICBsZXQgc2xpY2VJZHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAocHJpbWVGYWN0b3JzLmxlbmd0aCAtIDEpKSArIDE7XG5cbiAgICAvLyBzcGxpdCBpbnRvIGNvbXBsZW1lbnRzXG4gICAgbGV0IGdyb3VwMSA9IHByaW1lRmFjdG9ycy5zbGljZSgwLCBzbGljZUlkeCk7XG4gICAgbGV0IGdyb3VwMiA9IHByaW1lRmFjdG9ycy5zbGljZShzbGljZUlkeCk7XG5cbiAgICBsZXQgZ3JvdXAxVmFsdWUgPSBncm91cDEubWFwKG0gPT4gbSAqKiBmYWN0b3JFeHAuZ2V0KG0pISkucmVkdWNlKChhLCBiKSA9PiBhICogYiwgMSk7XG4gICAgbGV0IGdyb3VwMlZhbHVlID0gZ3JvdXAyLm1hcChtID0+IG0gKiogZmFjdG9yRXhwLmdldChtKSEpLnJlZHVjZSgoYSwgYikgPT4gYSAqIGIsIDEpO1xuXG4gICAgcmV0dXJuIGBcXFxcb3BlcmF0b3JuYW1le2xjbX1cXFxcbGVmdCgke29wc1swXShncm91cDFWYWx1ZSl9LCAke29wc1sxXShncm91cDJWYWx1ZSl9XFxcXHJpZ2h0KWA7XG59O1xuXG5jb25zdCBkZWNvbXBvc2VTdW1Db25zZWN1dGl2ZSA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBjb25zdCBvZGRGYWN0b3JzID0gZ2V0RmFjdG9ycyhuKS5maWx0ZXIoZiA9PiBmICUgMiA9PSAxICYmIGYgIT09IDEpO1xuXG4gICAgY29uc3QgY2hvc2VuRmFjdG9yID0gb2RkRmFjdG9yc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBvZGRGYWN0b3JzLmxlbmd0aCldO1xuICAgIGNvbnN0IG1pZGRsZSA9IG4gLyBjaG9zZW5GYWN0b3I7XG5cbiAgICBjb25zdCBzaWRlTGVuZ3RoID0gKGNob3NlbkZhY3RvciAtIDEpIC8gMjtcblxuICAgIGNvbnN0IG1pblZhbHVlID0gbWlkZGxlIC0gc2lkZUxlbmd0aDtcbiAgICBjb25zdCBtaW5WYWx1ZVNpZ24gPSBtaW5WYWx1ZSA8IDAgPyAnLScgOiAnKyc7XG5cbiAgICByZXR1cm4gYFxcXFxzdW1fe2s9MH1eeyR7b3BzWzBdKGNob3NlbkZhY3RvciAtIDEpfX0gXFxcXGxlZnQoayAke21pblZhbHVlU2lnbn0gJHtvcHNbMV0oXG4gICAgICAgIE1hdGguYWJzKG1pblZhbHVlKVxuICAgICl9XFxcXHJpZ2h0KWA7XG59O1xuXG5jb25zdCBkZWNvbXBvc2VDb250aW51ZWRGcmFjdGlvbiA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICAvLyBsb2dfMTAobikgKyB4LCB3aGVyZSB4IGlzIGluIFswLCAxLCAyXVxuICAgIGNvbnN0IHIgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgICAgIHJldHVybiBvcHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogb3BzLmxlbmd0aCldKG4pO1xuICAgIH07XG5cbiAgICBjb25zdCBleHAxMCA9IE1hdGguZmxvb3IoTWF0aC5sb2cxMChuKSkgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzKTtcblxuICAgIGNvbnN0IFtsZWFkaW5nLCBzZXFdID0gY29udGludWVkRnJhY3Rpb24obiwgMTAgKiogZXhwMTApO1xuXG4gICAgcmV0dXJuIGB7MTBeeyR7ZXhwMTB9fVxcXFxsZWZ0WyR7cihsZWFkaW5nKX07JHtzZXEubWFwKG0gPT4gcihtKSkuam9pbignLCcpfVxcXFxyaWdodF19YDtcbn07XG5cbi8qIGVuZCBkZWNvbXBvc2UgZnVuY3Rpb25zICovXG5cbmNvbnN0IGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiA9IChcbiAgICB3cmFwcGVkRnVuY3Rpb246IG9wZXJhdGlvbixcbiAgICBvcHRpb25zOiBDb252ZXJ0T3B0aW9uc1xuKTogb3BlcmF0aW9uID0+IHtcbiAgICByZXR1cm4gKG46IG51bWJlcikgPT4ge1xuICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8PSAwLjUpIHtcbiAgICAgICAgICAgIC8vIGludmVyc2UgZmFjdG9yaWFsIG9mIG4sIHN1Y2ggdGhhdCBmYWMhID0gblxuICAgICAgICAgICAgY29uc3QgZmFjID0gaXNGYWN0b3JpYWwobik7XG4gICAgICAgICAgICBpZiAoZmFjKSB7XG4gICAgICAgICAgICAgICAgLy8gZmFjdG9yaWFsKGZhYykgPSBmYWMhID0gblxuICAgICAgICAgICAgICAgIHJldHVybiByZXByZXNlbnRhdGlvbnMuZmFjdG9yaWFsKGZhYywgb3B0aW9ucy5nYW1tYUZ1bmN0aW9uKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGlzUG93MihuKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXByZXNlbnRhdGlvbnMucG93MkNob29zZShNYXRoLmxvZzIobiksIG9wdGlvbnMubnVtYmVyVGhlb3J5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB3cmFwcGVkRnVuY3Rpb24obik7XG4gICAgfTtcbn07XG5cbi8vIEJyZWFrIGEgbnVtYmVyIGRvd24gaW50byBzbWFsbGVyIG51bWJlcnMgc2VwYXJhdGVkIGJ5IG9wZXJhdG9yc1xuY29uc3QgZGVjb21wb3NlID0gKG46IG51bWJlciwgYXZhaWxhYmxlX29wZXJhdGlvbnM6IG9wZXJhdGlvbltdLCBvcHRpb25zOiBDb252ZXJ0T3B0aW9ucykgPT4ge1xuICAgIGxldCBvcGVyYXRpb25zID0gYXZhaWxhYmxlX29wZXJhdGlvbnM7XG5cbiAgICAvLyBwYWQgb3BlcmF0aW9ucyB0byBhdCBsZWFzdCA0IGVsZW1lbnRzXG4gICAgd2hpbGUgKG9wZXJhdGlvbnMubGVuZ3RoIDwgNCkge1xuICAgICAgICBvcGVyYXRpb25zLnB1c2gocmVwcmVzZW50YXRpb25zLnNhbWVOdW1iZXIpO1xuICAgIH1cblxuICAgIG9wZXJhdGlvbnMgPSBzaHVmZmxlKG9wZXJhdGlvbnMpLnNsaWNlKDAsIDQpO1xuXG4gICAgY29uc3QgZGVjb21wb3NpdGlvbnM6IGRlY29tcG9zaXRpb25bXSA9IFtdO1xuXG4gICAgLy8gMS4gYWIgPSAoYSAtIGMpKGIgKyBjKSArIGMgKGIgLSBhICsgYyksIHdoZXJlIGMgaXMgYW55IHJhbmRvbSBwb3NpdGl2ZSBudW1iZXJcbiAgICBpZiAobiAhPT0gMCAmJiBuIDwgMTAwICYmIChuID09PSAyIHx8ICFpc1ByaW1lKG4pKSkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZUFCQyk7XG4gICAgfVxuXG4gICAgLy8gMi4gUmVwcmVzZW50IChzbWFsbCkgbnVtYmVycyB1c2luZyB0aGVpciBzcXVhcmUgYW5kIHNxdWFyZSByb290XG4gICAgaWYgKG4gPCAxMCkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZVNxcnQpO1xuICAgIH1cblxuICAgIC8vIDMuIFRoZSBzdW0gb2YgdGhlIGZpcnN0IG4gb2RkIG51bWJlcnMgaXMgZXF1YWwgdG8gbl4yIGUuZyAxICsgMyArIDUgPSAzXjJcbiAgICBpZiAobiA+IDEgJiYgaXNTcXVhcmUobikgJiYgbiA8IDEwMCkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZVNxdWFyZSk7XG4gICAgfVxuXG4gICAgLy8gNC4gVGhlIHN1bSBvZiB0d28gY29uc2VjdXRpdmUgaW50ZWdlcnMgaXMgdGhlIGRpZmZlcmVuY2Ugb2YgdGhlaXIgc3F1YXJlcyBlLmcgMyArIDIgPSAzXjIgLSAyXjJcbiAgICBpZiAoaXNPZGQobikpIHtcbiAgICAgICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VEaWZmZXJlbmNlU3F1YXJlcyk7XG4gICAgfVxuXG4gICAgLy8gNS4gRXhwcmVzcyBhIG51bWJlciB1c2luZyBtdWx0aXBsaWNhdGlvbiBhbmQgYWRkaXRpb24uIEUuZyA0ID0gMSAqIDMgKyAxXG4gICAgaWYgKG4gPD0gMjAwKSB7XG4gICAgICAgIGRlY29tcG9zaXRpb25zLnB1c2goZGVjb21wb3NlTXVsRGl2aWRlKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzUHJpbWUobikgJiYgbiA+IDEpIHtcbiAgICAgICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VMY20pO1xuICAgIH1cblxuICAgIGlmICghaXNQb3cyKG4pICYmIG4gPiAxKSB7XG4gICAgICAgIGRlY29tcG9zaXRpb25zLnB1c2goZGVjb21wb3NlU3VtQ29uc2VjdXRpdmUpO1xuICAgIH1cblxuICAgIGlmIChuID4gMSAmJiBvcHRpb25zLmNvbnRpbnVlZEZyYWN0aW9ucykge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZUNvbnRpbnVlZEZyYWN0aW9uKTtcbiAgICB9XG5cbiAgICAvLyA2LiBNdWx0aXBseSBhbmQgZGl2aWRlIGJ5IGEgcmFuZG9tIG51bWJlci4gZS5nIDIgPSAoMio1KS81XG4gICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VBZGRNdWx0aXBseSk7XG5cbiAgICByZXR1cm4gc2h1ZmZsZShkZWNvbXBvc2l0aW9ucylbMF0obiwgb3BlcmF0aW9ucyk7XG59O1xuXG5leHBvcnQgeyBkZWNvbXBvc2UsIGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiB9O1xuIiwiLyoqXG4gKiBDb252ZXJ0cyB0aGUgTWF0aEpheCBTVkcgKFRPRE86IHRoaXMgY29kZSBwcm9kdWNlcyB0aGUgZXJyb3IgaWYgdGhlIE1hdGhKYXggaXMgaHRtbCkgdG8gYSBwbmcsXG4gKiBieSBzZXJpYWxpemluZyB0aGUgc3ZnIGludG8gYSBkYXRhIHVybCBhbmQgZHJhd2luZyB0byB0aGUgY2FudmFzLCB3aGVyZSBpdCBjYW4gdGhhbiBiZSBzZXJpYWxpemVkXG4gKiBpbnRvIGEgcG5nLlxuICovXG5cbmxldCBkb3dubG9hZEJ0biA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQtaW1nJyk7XG5cbi8vIEluaXRpYXRlIGRvd25sb2FkIG9mIGJsb2JcbmNvbnN0IGRvd25sb2FkID0gKGZpbGVuYW1lOiBzdHJpbmcsIGJsb2I6IEJsb2IpID0+IHtcbiAgICBjb25zdCBlbGVtID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBlbGVtLmhyZWYgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICBlbGVtLmRvd25sb2FkID0gZmlsZW5hbWU7XG4gICAgZWxlbS5jbGljaygpO1xufTtcblxuY29uc3QgZG93bmxvYWRQTkcgPSAoKSA9PiB7XG4gICAgLy8gR2V0IHRoZSBzdmcgZnJvbSB0aGUgcGFnZVxuICAgIHZhciBzdmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdzdmcnKSE7XG5cbiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgbnVtYmVyXG4gICAgdmFyIG51bWJlciA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5wdXQnKSkudmFsdWU7XG5cbiAgICAvLyBJbmNyZWFzZSB0aGUgU1ZHJ3Mgd2lkdGggYW5kIGhlaWdodCB0byBwcm9kdWNlIGEgYmlnZ2VyIGltYWdlXG4gICAgbGV0IHcgPSBwYXJzZUludChzdmcuZ2V0QXR0cmlidXRlKCd3aWR0aCcpISk7XG4gICAgbGV0IGggPSBwYXJzZUludChzdmcuZ2V0QXR0cmlidXRlKCdoZWlnaHQnKSEpO1xuXG4gICAgLy8gQ29udmVydCBTVkcgdG8gc3RyaW5nIGRhdGFcbiAgICBjb25zdCBkYXRhID0gbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyhzdmcpO1xuXG4gICAgY29uc3Qgc3ZnRGF0YVVybCA9IGBkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCR7YnRvYShkYXRhKX1gO1xuXG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgLy8gdXBzY2FsZSBoZWlnaHQgdG8gYXQgbGVhc3QgODAwcHhcbiAgICBsZXQgc2NhbGVGYWN0b3IgPSBNYXRoLm1heCgyLCA4MDAgLyBoKTtcbiAgICBjYW52YXMud2lkdGggPSB3ICogc2NhbGVGYWN0b3I7XG4gICAgY2FudmFzLmhlaWdodCA9IGggKiBzY2FsZUZhY3RvcjtcblxuICAgIGNvbnNvbGUubG9nKHsgdzogY2FudmFzLndpZHRoLCBoOiBjYW52YXMuaGVpZ2h0IH0pO1xuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpITtcblxuICAgIGNvbnN0IHN2Z0RhdGFJbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIHN2Z0RhdGFJbWFnZS5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2Uoc3ZnRGF0YUltYWdlLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgICAgIGNhbnZhcy50b0Jsb2IoYmxvYiA9PiB7XG4gICAgICAgICAgICBpZiAoYmxvYiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHNlcmlhbGl6ZSBjYW52YXMgdG8gYmxvYicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZG93bmxvYWQoYGNvbXBsaWNhdGVkLWV4cHJlc3Npb24tdGhhdC1lcXVhbHMtJHtudW1iZXJ9YCwgYmxvYik7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBzdmdEYXRhSW1hZ2Uuc3JjID0gc3ZnRGF0YVVybDtcbn07XG5cbmNvbnN0IG1haW4gPSAoKSA9PiB7XG4gICAgZG93bmxvYWRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBkb3dubG9hZFBORyk7XG59O1xuZXhwb3J0IHsgbWFpbiB9O1xuIiwiZGVjbGFyZSB2YXIgTWF0aEpheDogYW55O1xuXG5pbXBvcnQgKiBhcyByZXByZXNlbnRhdGlvbnMgZnJvbSAnLi9yZXByZXNlbnRhdGlvbnMnO1xuaW1wb3J0IHsgQ29udmVydE9wdGlvbnMsIG9wZXJhdGlvbiB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgZGVjb21wb3NlLCBjb25kaXRpb25hbERlY29tcG9zaXRpb24gfSBmcm9tICcuL2RlY29tcG9zaXRpb25zJztcbmltcG9ydCAqIGFzIGRvd25sb2FkX3BuZyBmcm9tICcuL2Rvd25sb2FkLXBuZyc7XG5cbmNvbnN0IGNvbnZlcnQgPSAobnVtYmVyOiBudW1iZXIsIG9wdGlvbnM6IENvbnZlcnRPcHRpb25zKSA9PiB7XG4gICAgLy8gVmFsaWRhdGluZyBpbnB1dFxuICAgIGlmIChpc05hTihudW1iZXIpIHx8IG51bWJlciA8IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qIE5lZWQgdG8gYWRkIGFub3RoZXIgc2xhc2ggdG8gbGF0ZXggc3RyaW5ncyB0byBwcmV2ZW50IHNsYXNoIGVzY2FwZSAqL1xuXG4gICAgLy8gTGlzdCBvZiBmdW5jdGlvbnMgdGhhdCBnZW5lcmF0ZSBMYVRlWCBtYXRoIGV4cHJlc3Npb25zXG4gICAgLy8gRnVuY3Rpb25zIGFyZSBjaG9zZW4gcmFuZG9tbHlcbiAgICBsZXQgcG9zc2libGVfb3B0aW9uczogb3BlcmF0aW9uW10gPSBbXTtcblxuICAgIGlmIChvcHRpb25zLmV1bGVyc0lkZW50aXR5KSB7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChyZXByZXNlbnRhdGlvbnMuZXVsZXJzSWRlbnRpdHkpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5leHBvbmVudGlhbExpbWl0cykge1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gobiA9PiByZXByZXNlbnRhdGlvbnMubGltaXROYXR1cmFsTG9nKG4sIG9wdGlvbnMubnVtYmVyVGhlb3J5KSk7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChuID0+IHJlcHJlc2VudGF0aW9ucy5saW1pdEV4cG9uZW50aWFsKG4sIG9wdGlvbnMubnVtYmVyVGhlb3J5KSk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnBvbHlub21pYWxMaW1pdHMpIHtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKHJlcHJlc2VudGF0aW9ucy5saW1EaWZmVHdvU3F1YXJlcyk7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChyZXByZXNlbnRhdGlvbnMubGltaXRQb2x5bm9taWFsKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5nZW9tZXRyaWNTZXJpZXMpIHtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKG4gPT5cbiAgICAgICAgICAgIHJlcHJlc2VudGF0aW9ucy5pbmZpbml0ZUdlb21ldHJpY1NlcmllcyhuLCBvcHRpb25zLm51bWJlclRoZW9yeSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBkZWNvcmF0ZSBlYWNoIG9wZXJhdGlvbiB3aXRoIGEgZnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgdGhlIGlucHV0IGlzIG9mIGEgY2VydGFpbiBmb3JtLCBhbmQgaWYgaXQgaXMgaXQgb3ZlcnJpZGVzIHRoZSBkZWNvcmF0ZWQgZnVuY3Rpb24ncyB1c3VhbCByZXN1bHQgd2l0aCBpdCdzIG93bi5cbiAgICBwb3NzaWJsZV9vcHRpb25zID0gcG9zc2libGVfb3B0aW9ucy5tYXAoZiA9PiB7XG4gICAgICAgIHJldHVybiBjb25kaXRpb25hbERlY29tcG9zaXRpb24oZiwgb3B0aW9ucyk7XG4gICAgfSk7XG5cbiAgICBsZXQgaW5wdXQgPSBkZWNvbXBvc2UobnVtYmVyLCBwb3NzaWJsZV9vcHRpb25zLCBvcHRpb25zKTtcblxuICAgIC8vICBEaXNhYmxlIHRoZSBkaXNwbGF5IGFuZCByZW5kZXIgYnV0dG9ucyB1bnRpbCBNYXRoSmF4IGlzIGRvbmVcbiAgICB2YXIgZGlzcGxheSA9IDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXNwbGF5Jyk7XG4gICAgdmFyIGJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVuZGVyJyk7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gZGlzcGxheS5kaXNhYmxlZCA9IHRydWU7XG4gICAgbGV0IGRvd25sb2FkQnRuID0gPEhUTUxCdXR0b25FbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZC1pbWcnKTtcblxuICAgIC8vICBDbGVhciB0aGUgb2xkIG91dHB1dFxuXG4gICAgbGV0IG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdXRwdXQnKSE7XG4gICAgb3V0cHV0LmlubmVySFRNTCA9ICcnO1xuXG4gICAgLy8gIFJlc2V0IHRoZSB0ZXggbGFiZWxzIChhbmQgYXV0b21hdGljIGVxdWF0aW9uIG51bWJlcnMsIHRob3VnaCB0aGVyZSBhcmVuJ3QgYW55IGhlcmUpLlxuICAgIC8vICBHZXQgdGhlIGNvbnZlcnNpb24gb3B0aW9ucyAobWV0cmljcyBhbmQgZGlzcGxheSBzZXR0aW5ncylcbiAgICAvLyAgQ29udmVydCB0aGUgaW5wdXQgdG8gQ29tbW9uSFRNTCBvdXRwdXQgYW5kIHVzZSBhIHByb21pc2UgdG8gd2FpdCBmb3IgaXQgdG8gYmUgcmVhZHlcbiAgICAvLyAgICAoaW4gY2FzZSBhbiBleHRlbnNpb24gbmVlZHMgdG8gYmUgbG9hZGVkIGR5bmFtaWNhbGx5KS5cbiAgICBNYXRoSmF4LnRleFJlc2V0KCk7XG4gICAgdmFyIG1hdGhKYXhPcHRpb25zID0gTWF0aEpheC5nZXRNZXRyaWNzRm9yKG91dHB1dCk7XG4gICAgbWF0aEpheE9wdGlvbnMuZGlzcGxheSA9IGRpc3BsYXkuY2hlY2tlZDtcbiAgICBNYXRoSmF4LnRleDJzdmdQcm9taXNlKGlucHV0LCBtYXRoSmF4T3B0aW9ucylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24obm9kZTogYW55KSB7XG4gICAgICAgICAgICAvLyAgVGhlIHByb21pc2UgcmV0dXJucyB0aGUgdHlwZXNldCBub2RlLCB3aGljaCB3ZSBhZGQgdG8gdGhlIG91dHB1dFxuICAgICAgICAgICAgLy8gIFRoZW4gdXBkYXRlIHRoZSBkb2N1bWVudCB0byBpbmNsdWRlIHRoZSBhZGp1c3RlZCBDU1MgZm9yIHRoZVxuICAgICAgICAgICAgLy8gICAgY29udGVudCBvZiB0aGUgbmV3IGVxdWF0aW9uLlxuICAgICAgICAgICAgb3V0cHV0LmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgICAgICAgTWF0aEpheC5zdGFydHVwLmRvY3VtZW50LmNsZWFyKCk7XG4gICAgICAgICAgICBNYXRoSmF4LnN0YXJ0dXAuZG9jdW1lbnQudXBkYXRlRG9jdW1lbnQoKTtcbiAgICAgICAgICAgIC8vIERpc3BsYXkgZG93bmxvYWQgYnV0dG9uXG4gICAgICAgICAgICBkb3dubG9hZEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycjogRXJyb3IpIHtcbiAgICAgICAgICAgIC8vICBJZiB0aGVyZSB3YXMgYW4gZXJyb3IsIHB1dCB0aGUgbWVzc2FnZSBpbnRvIHRoZSBvdXRwdXQgaW5zdGVhZFxuICAgICAgICAgICAgb3V0cHV0XG4gICAgICAgICAgICAgICAgLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpKVxuICAgICAgICAgICAgICAgIC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShlcnIubWVzc2FnZSkpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vICBFcnJvciBvciBub3QsIHJlLWVuYWJsZSB0aGUgZGlzcGxheSBhbmQgcmVuZGVyIGJ1dHRvbnNcbiAgICAgICAgICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGRpc3BsYXkuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG59O1xuY29uc3QgbWFpbiA9ICgpID0+IHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm0nKSBhcyBIVE1MRm9ybUVsZW1lbnQ7XG4gICAgY29uc3QgbnVtYmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIGNvbnN0IGdhbW1hRnVuY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtbWEtZnVuY3Rpb24nKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGV1bGVyc0lkZW50aXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V1bGVycy1pZGVudGl0eScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgZXhwb25lbnRpYWxMaW1pdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGltaXRzLWV4cG9uZW50aWFsJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBwb2x5bm9taWFsTGltaXRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpbWl0cy1wb2x5bm9taWFsJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBudW1iZXJUaGVvcnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtYmVyLXRoZW9yeScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgZ2VvbWV0cmljU2VyaWVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlb21ldHJpYy1zZXJpZXMnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGNvbnRpbnVlZEZyYWN0aW9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250aW51ZWQtZnJhY3Rpb25zJykgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZXZlbnQgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGNvbnZlcnQocGFyc2VJbnQobnVtYmVyLnZhbHVlKSwge1xuICAgICAgICAgICAgZ2FtbWFGdW5jdGlvbjogZ2FtbWFGdW5jdGlvbi5jaGVja2VkLFxuICAgICAgICAgICAgZXVsZXJzSWRlbnRpdHk6IGV1bGVyc0lkZW50aXR5LmNoZWNrZWQsXG4gICAgICAgICAgICBleHBvbmVudGlhbExpbWl0czogZXhwb25lbnRpYWxMaW1pdHMuY2hlY2tlZCxcbiAgICAgICAgICAgIHBvbHlub21pYWxMaW1pdHM6IHBvbHlub21pYWxMaW1pdHMuY2hlY2tlZCxcbiAgICAgICAgICAgIG51bWJlclRoZW9yeTogbnVtYmVyVGhlb3J5LmNoZWNrZWQsXG4gICAgICAgICAgICBnZW9tZXRyaWNTZXJpZXM6IGdlb21ldHJpY1Nlcmllcy5jaGVja2VkLFxuICAgICAgICAgICAgY29udGludWVkRnJhY3Rpb25zOiBjb250aW51ZWRGcmFjdGlvbnMuY2hlY2tlZCxcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkb3dubG9hZF9wbmcubWFpbigpO1xufTtcblxubWFpbigpO1xuIl0sIm5hbWVzIjpbInJhbmRvbUVsZW1lbnQiLCJhcnJheSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsInNodWZmbGUiLCJyYW5kb21JbmRleCIsImN1cnJlbnRJbmRleCIsImlzUHJpbWUiLCJuIiwiaSIsInNxcnQiLCJnZXRGYWN0b3JzIiwiZmFjdG9ycyIsInB1c2giLCJpc1BvdzIiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJsb2cyIiwiZ2NkIiwiYSIsImIiLCJocmVmIiwicyIsInVybCIsIl9ldWxlclBoaSIsIngiLCJfY2FjaGVkUHJpbWVzIiwicHJpbWVTaWV2ZSIsInAiLCJyZXNQcmltZXMiLCJfcHJpbWVTaWV2ZSIsIl9wcmltZUNvdW50aW5nRnVuY3Rpb24iLCJmaWx0ZXIiLCJudW1iZXJUaGVvcnlGdW5jdGlvbnMiLCJtYXRjaGluZ1BoaUlucHV0cyIsIm1hdGNoaW5nUGlJbnB1dHMiLCJmdW5jdGlvbk9wdGlvbnMiLCJtYXRjaGluZ0lucHV0IiwibGltaXRQb2x5bm9taWFsIiwiciIsIm0iLCJoaWdoZXN0UG93ZXIiLCJkZW5vbWluYXRvck51bWJlck9mVGVybXMiLCJzaWducyIsIm51bWVyYXRvciIsImRlbm9taW5hdG9yIiwiY29lZiIsInBvd2VyIiwiZXVsZXJzSWRlbnRpdHkiLCJsaW1EaWZmVHdvU3F1YXJlcyIsInRleCIsInNhbWVOdW1iZXIiLCJkZWNvbXBvc2VBQkMiLCJudW1iZXIiLCJvcHMiLCJjIiwiZGVjb21wb3NlU3FydCIsInNxdWFyZSIsImRlY29tcG9zZVNxdWFyZSIsInNxdWFyZVJvb3QiLCJzdW0iLCJvZGRWYWwiLCJkZWNvbXBvc2VEaWZmZXJlbmNlU3F1YXJlcyIsImNlaWwiLCJkZWNvbXBvc2VBZGRNdWx0aXBseSIsInJhbmROdW0iLCJkZWNvbXBvc2VNdWxEaXZpZGUiLCJkZWNvbXBvc2VMY20iLCJkaXZpc29yIiwiZ2V0UHJpbWVGYWN0b3JzIiwiZmFjdG9yRXhwIiwiTWFwIiwiZiIsInNldCIsImhhcyIsImdldCIsInByaW1lRmFjdG9ycyIsIkFycmF5IiwiZnJvbSIsImtleXMiLCJzbGljZUlkeCIsImdyb3VwMSIsInNsaWNlIiwiZ3JvdXAyIiwiZ3JvdXAxVmFsdWUiLCJtYXAiLCJyZWR1Y2UiLCJncm91cDJWYWx1ZSIsImRlY29tcG9zZVN1bUNvbnNlY3V0aXZlIiwib2RkRmFjdG9ycyIsImNob3NlbkZhY3RvciIsIm1pblZhbHVlIiwibWluVmFsdWVTaWduIiwiYWJzIiwiZGVjb21wb3NlQ29udGludWVkRnJhY3Rpb24iLCJleHAxMCIsImxvZzEwIiwibGVhZGluZyIsInNlcSIsImNvbnRpbnVlZEZyYWN0aW9uV2hvbGVQYXJ0IiwiY29udGludWVkRnJhY3Rpb25QYXJ0Iiwid2hvbGVQYXJ0IiwidW5kZWZpbmVkIiwiY29udGludWVkRnJhY3Rpb24iLCJqb2luIiwiZG93bmxvYWRCdG4iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZG93bmxvYWRQTkciLCJzdmciLCJxdWVyeVNlbGVjdG9yIiwidmFsdWUiLCJ3IiwicGFyc2VJbnQiLCJnZXRBdHRyaWJ1dGUiLCJoIiwiZGF0YSIsIlhNTFNlcmlhbGl6ZXIiLCJzZXJpYWxpemVUb1N0cmluZyIsInN2Z0RhdGFVcmwiLCJidG9hIiwiY2FudmFzIiwiY3JlYXRlRWxlbWVudCIsInNjYWxlRmFjdG9yIiwibWF4Iiwid2lkdGgiLCJoZWlnaHQiLCJjb25zb2xlIiwibG9nIiwiY3R4IiwiZ2V0Q29udGV4dCIsInN2Z0RhdGFJbWFnZSIsIkltYWdlIiwib25sb2FkIiwiZHJhd0ltYWdlIiwidG9CbG9iIiwiYmxvYiIsIkVycm9yIiwiZmlsZW5hbWUiLCJlbGVtIiwid2luZG93IiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwiZG93bmxvYWQiLCJjbGljayIsInNyYyIsImNvbnZlcnQiLCJvcHRpb25zIiwiaXNOYU4iLCJwb3NzaWJsZV9vcHRpb25zIiwiZXhwb25lbnRpYWxMaW1pdHMiLCJudW1iZXJUaGVvcnlFbmFibGVkIiwibnVtYmVyVGhlb3J5IiwicG9seW5vbWlhbExpbWl0cyIsImdlb21ldHJpY1NlcmllcyIsIndyYXBwZWRGdW5jdGlvbiIsImZhYyIsImZhY3RvcmlhbHMiLCJpc0ZhY3RvcmlhbCIsImdhbW1hRnVuY3Rpb25FbmFibGVkIiwiZ2FtbWFGdW5jdGlvbiIsImNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiIsImlucHV0IiwiYXZhaWxhYmxlX29wZXJhdGlvbnMiLCJvcGVyYXRpb25zIiwiZGVjb21wb3NpdGlvbnMiLCJpc1NxdWFyZSIsImlzT2RkIiwiY29udGludWVkRnJhY3Rpb25zIiwiZGVjb21wb3NlIiwiZGlzcGxheSIsImJ1dHRvbiIsImRpc2FibGVkIiwib3V0cHV0IiwiaW5uZXJIVE1MIiwiTWF0aEpheCIsInRleFJlc2V0IiwibWF0aEpheE9wdGlvbnMiLCJnZXRNZXRyaWNzRm9yIiwiY2hlY2tlZCIsInRleDJzdmdQcm9taXNlIiwidGhlbiIsIm5vZGUiLCJhcHBlbmRDaGlsZCIsInN0YXJ0dXAiLCJjbGVhciIsInVwZGF0ZURvY3VtZW50Iiwic3R5bGUiLCJjYXRjaCIsImVyciIsImNyZWF0ZVRleHROb2RlIiwibWVzc2FnZSIsImZvcm0iLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCJdLCJzb3VyY2VSb290IjoiIn0=