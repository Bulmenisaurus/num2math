(()=>{"use strict";const t=t=>t[Math.floor(Math.random()*t.length)],e=(t,r)=>r?e(r,t%r):t,r=t=>{let r=0;for(let n=1;n<=t;n++)1===e(n,t)&&r++;return r},n=(t=>{const e=[];for(let r=0;r<=t;r++)e.push(!0);e[0]=!1,e[1]=!1;for(let r=2;r*r<=t;r++)if(!0===e[r])for(let n=r*r;n<=t;n+=r)e[n]=!1;let r=[];for(let n=0;n<=t;n++)e[n]&&r.push(n);return r})(999),o=t=>n.filter((e=>e<=t)).length,a=e=>{let n=[],a=[],l=[];for(let t=1;t<=999;t++)r(t)===e&&n.push(t),o(t)===e&&a.push(t);if(n.length>0){let e=t(n);l.push(`\\varphi(${e})`)}if(a.length>0){let e=t(a);l.push(`\\pi(${e})`)}return(0===l.length||Math.random()<.3)&&l.push(`${e}`),t(l)},l=t=>{if(0===t)return`{\\lim_{x \\to \\infty}{${Math.floor(20*Math.random())}x^{-1}}}`;if(1===t)return"{\\lim_{x \\to \\infty}{x^{1/x}}}";{let e=Math.floor(5*Math.random())+1,r=Math.floor(3*Math.random())+2,n=r-1,o=["-","+"],a=`${e*t}x^{${r}} `,l=`${e}x^{${r}} `;for(let t=r-1;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;a+=`${o[Math.floor(2*Math.random())]} ${e}x${r} `}for(let t=n;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;l+=`${o[Math.floor(2*Math.random())]} ${e}x${r} `}return`{ \\lim_{x \\to \\infty} { \\frac{${a}}{${l}}} }`}},i=t=>0!==t?`{-${t}e^{\\pi i}}`:"{(e^{\\pi i} + 1)}",h=t=>{let e=Math.floor(10*Math.random())+1;if(Math.random()<.5)var r=`\\lim_{x \\to ${t-e}} \\frac{x^2 - ${e**2}}{x - ${e}}`;else r=`\\lim_{x \\to ${t+e}} \\frac{x^2 - ${e**2}}{x + ${e}}`;return`{${r}}`},m=t=>`${t}`;let d=document.getElementById("download-img");const u=()=>{var t=document.querySelector("svg"),e=document.getElementById("input").value;let r=parseInt(t.getAttribute("width")),n=parseInt(t.getAttribute("height"));const o=(new XMLSerializer).serializeToString(t),a=`data:image/svg+xml;base64,${btoa(o)}`,l=document.createElement("canvas");let i=Math.max(2,800/n);l.width=r*i,l.height=n*i,console.log({w:l.width,h:l.height});const h=l.getContext("2d"),m=new Image;m.onload=()=>{h.drawImage(m,0,0,l.width,l.height),l.toBlob((t=>{if(null===t)throw new Error("Failed to serialize canvas to blob");((t,e)=>{const r=window.document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t,r.click()})(`complicated-expression-that-equals-${e}`,t)}))},m.src=a},c=(t,e)=>{if(isNaN(t)||t>1e3||t<0)return;let r=[];e.eulersIdentity&&r.push(i),e.exponentialLimits&&(r.push((t=>((t,e)=>0===t?"{\\lim_{x \\to \\infty}{ \\frac{\\ln(x)}{x} }}":1===t?"{\\lim_{x \\to 1}  {\\frac{\\ln(x)}{x - 1}}}":`{\\lim_{x \\to 0}{ \\frac{-\\ln(1 + ${e?a(t):t}(e^{-x} - 1))}{x} }}`)(t,e.numberTheory))),r.push((t=>((t,e)=>0===t?"{\\lim_{x \\to \\infty}{xe^{-x}}}":1===t?"{\\lim_{x \\to 0}{ \\frac{e^x - 1}{x} }}":`{\\lim_{x \\to 0}{ \\frac{e^{${e?a(t):t}x} - 1}{x} }}`)(t,e.numberTheory)))),e.polynomialLimits&&(r.push(h),r.push(l)),e.geometricSeries&&r.push((t=>((t,e)=>{if(0===t){let t=Math.floor(10*Math.random())+3;return`{\\sum\\limits_{k=0}^{${t-1}} {\\sin \\left({ \\frac{2 \\pi k}{${t}} } \\right)}}`}return 1===t?"{\\lim_{\\epsilon \\to 0}{ \\epsilon \\zeta(1 + \\epsilon) }}":`{\\sum\\limits_{k=0}^\\infty {\\left({\\frac{${e?a(t-1):t-1}}{${e?a(t):t}}}\\right)^{k}}}`})(t,e.numberTheory))),r=r.map((t=>((t,e)=>r=>{if(Math.random()<=.5){const t=(t=>{const e={2:2,6:3,24:4,120:5,720:6};return t in e&&e[t]})(r);if(t)return((t,e)=>Math.random()<.5&&e?`{\\Gamma (${t+1})}`:`{\\prod_{k=1}^{${t}} k}`)(t,e.gammaFunction);if((t=>t>=2&&Number.isInteger(Math.log2(t)))(r))return((t,e)=>`{\\sum_{k=0}^{${e?a(t):t}} {${t} \\choose k}}`)(Math.log2(r),e.numberTheory)}return t(r)})(t,e)));let n=((t,e)=>{let r=t=>e[Math.floor(Math.random()*e.length)](t),n=r,o=r,a=r;0===e.length&&(n=m,o=m,a=m,r=m),e.length>=3&&([n,o,a]=(t=>{let e,r=t.length;for(;0!=r;)e=Math.floor(Math.random()*r),r--,[t[r],t[e]]=[t[e],t[r]];return t})(e).slice(0,3));const l=Math.random(),i=1/6;return l<i&&0!==t&&t<100&&(2===t||!(t=>{if(t<=1||t%2==0&&t>2)return!1;for(let e=3;e<=Math.sqrt(t);e+=2)if(t%e==0)return!1;return!0})(t))?((t,e,r,n,o)=>{let a=(t=>{let e=[];for(let r=0;r<=t;r++)t%r==0&&e.push(r);return e})(t),l=a[Math.floor(Math.random()*a.length)],i=t/l,h=Math.floor(30*Math.random())+1;return Math.random()<.2?`{{\\left({${e(l)}}\\right)}{\\left({${r(i)}}\\right)}}`:`{ \\left({${e(l)} - ${r(h)}}\\right) \\left({${n(i)} + ${o(h)}}\\right) + {${o(h)}}{\\left({${o(i)} - ${o(l)} + ${o(h)}} \\right)} }`})(t,n,o,a,r):l<2*i&&t<10?((t,e)=>`{\\sqrt{${e(t**2)}}}`)(t,n):l<.5&&t>1&&(t=>Number.isInteger(Math.sqrt(t)))(t)?((t,e,r,n,o)=>{let a=Math.sqrt(t),l=`${e(1)}`,i=1;if(Math.random()<.2){for(let t=0;t<a-1;t++)i+=2,l+=`+ ${o(i)}`;return l=`{ ${l} }`,l}{let t=Math.floor(Math.random()*a-1)+1,l=a-t;return Math.random()<.5?`{ {\\left(${e(t)} + ${e(l)}\\right)}^2}`:`{ {\\left(${e(t)}\\right)}^2 + {${o(2)}}{\\left(${r(t)}\\right)}{\\left(${n(l)}\\right)} + {\\left(${o(l)}\\right)}^2}`}})(t,n,o,a,r):l<4*i&&(t=>t%2!=0)(t)&&l<.7?((t,e,r)=>{let n=Math.floor(t/2),o=Math.ceil(t/2);return Math.ceil(t/2)**2<100&&Math.random()<.7?`{${e(o**2)} - ${r(n**2)}}`:`{ \\left({${e(o)}}\\right)^2 -  \\left({${r(n)}}\\right)^2}`})(t,n,o):l<5*i&&t<=200?((t,e,r)=>{let n=Math.floor(5*Math.random())+1;return`\\frac{${e(t*n)}} {${r(n)}}`})(t,n,o):((t,e,r,n)=>{let o=Math.floor(Math.random()*t+1)+1,a=t%o;return`${e(Math.floor(t/o))} \\times {${r(o)}} + ${n(a)}`})(t,n,o,a)})(t,r);var o=document.getElementById("display"),d=document.getElementById("render");d.disabled=o.disabled=!0;let u=document.getElementById("download-img"),c=document.getElementById("output");c.innerHTML="",MathJax.texReset();var s=MathJax.getMetricsFor(c);s.display=o.checked,MathJax.tex2svgPromise(n,s).then((function(t){c.appendChild(t),MathJax.startup.document.clear(),MathJax.startup.document.updateDocument(),u.style.display="block"})).catch((function(t){c.appendChild(document.createElement("pre")).appendChild(document.createTextNode(t.message))})).then((function(){d.disabled=o.disabled=!1}))};(()=>{const t=document.getElementById("form"),e=document.getElementById("input"),r=document.getElementById("gamma-function"),n=document.getElementById("eulers-identity"),o=document.getElementById("limits-exponential"),a=document.getElementById("limits-polynomial"),l=document.getElementById("number-theory"),i=document.getElementById("geometric-series");t.addEventListener("submit",(t=>{t.preventDefault(),c(parseInt(e.value),{gammaFunction:r.checked,eulersIdentity:n.checked,exponentialLimits:o.checked,polynomialLimits:a.checked,numberTheory:l.checked,geometricSeries:i.checked})})),d.addEventListener("click",u)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy91dGlscy50cyIsIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy9yZXByZXNlbnRhdGlvbnMudHMiLCJ3ZWJwYWNrOi8vbnVtMm1hdGgvLi9zcmMvZG93bmxvYWQtcG5nLnRzIiwid2VicGFjazovL251bTJtYXRoLy4vc3JjL3NjcmlwdC50cyIsIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy9kZWNvbXBvc2l0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIG9wZXJhdGlvbiA9IChuOiBudW1iZXIpID0+IHN0cmluZztcblxudHlwZSBDb252ZXJ0T3B0aW9ucyA9IHtcbiAgICBnYW1tYUZ1bmN0aW9uOiBib29sZWFuO1xuICAgIGV1bGVyc0lkZW50aXR5OiBib29sZWFuO1xuICAgIGV4cG9uZW50aWFsTGltaXRzOiBib29sZWFuO1xuICAgIHBvbHlub21pYWxMaW1pdHM6IGJvb2xlYW47XG4gICAgbnVtYmVyVGhlb3J5OiBib29sZWFuO1xuICAgIGdlb21ldHJpY1NlcmllczogYm9vbGVhbjtcbn07XG5cbmNvbnN0IHJhbmRvbUVsZW1lbnQgPSA8QT4oYXJyYXk6IEFbXSkgPT4ge1xuICAgIHJldHVybiBhcnJheVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcnJheS5sZW5ndGgpXTtcbn07XG5cbmNvbnN0IHNodWZmbGUgPSA8QT4oYXJyYXk6IEFbXSkgPT4ge1xuICAgIGxldCBjdXJyZW50SW5kZXggPSBhcnJheS5sZW5ndGgsXG4gICAgICAgIHJhbmRvbUluZGV4O1xuXG4gICAgLy8gV2hpbGUgdGhlcmUgcmVtYWluIGVsZW1lbnRzIHRvIHNodWZmbGUuXG4gICAgd2hpbGUgKGN1cnJlbnRJbmRleCAhPSAwKSB7XG4gICAgICAgIC8vIFBpY2sgYSByZW1haW5pbmcgZWxlbWVudC5cbiAgICAgICAgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjdXJyZW50SW5kZXgpO1xuICAgICAgICBjdXJyZW50SW5kZXgtLTtcblxuICAgICAgICAvLyBBbmQgc3dhcCBpdCB3aXRoIHRoZSBjdXJyZW50IGVsZW1lbnQuXG4gICAgICAgIFthcnJheVtjdXJyZW50SW5kZXhdLCBhcnJheVtyYW5kb21JbmRleF1dID0gW2FycmF5W3JhbmRvbUluZGV4XSwgYXJyYXlbY3VycmVudEluZGV4XV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGFycmF5O1xufTtcblxuY29uc3QgaXNPZGQgPSAobjogbnVtYmVyKSA9PiBuICUgMiAhPT0gMDtcblxuY29uc3QgaXNTcXVhcmUgPSAobjogbnVtYmVyKSA9PiBOdW1iZXIuaXNJbnRlZ2VyKE1hdGguc3FydChuKSk7XG5cbmNvbnN0IGlzUHJpbWUgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgaWYgKG4gPD0gMSB8fCAobiAlIDIgPT0gMCAmJiBuID4gMikpIHJldHVybiBmYWxzZTtcblxuICAgIGZvciAobGV0IGkgPSAzOyBpIDw9IE1hdGguc3FydChuKTsgaSArPSAyKSB7XG4gICAgICAgIGlmIChuICUgaSA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5cbmNvbnN0IGdldEZhY3RvcnMgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgbGV0IGZhY3RvcnMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgaWYgKG4gJSBpID09PSAwKSB7XG4gICAgICAgICAgICBmYWN0b3JzLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhY3RvcnM7XG59O1xuXG4vLyBDaGVja2luZyBpZiBhIG51bWJlciBjYW4gYmUgZm9ybWVkIHVzaW5nIGZhY3RvcmlhbFxuY29uc3QgaXNGYWN0b3JpYWwgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgZmFjdG9yaWFsczogeyBba2V5OiBudW1iZXJdOiBudW1iZXIgfSA9IHtcbiAgICAgICAgMjogMixcbiAgICAgICAgNjogMyxcbiAgICAgICAgMjQ6IDQsXG4gICAgICAgIDEyMDogNSxcbiAgICAgICAgNzIwOiA2LFxuICAgIH07XG5cbiAgICBpZiAobiBpbiBmYWN0b3JpYWxzKSB7XG4gICAgICAgIHJldHVybiBmYWN0b3JpYWxzW25dO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59O1xuXG5jb25zdCBpc1BvdzIgPSAobjogbnVtYmVyKSA9PiBuID49IDIgJiYgTnVtYmVyLmlzSW50ZWdlcihNYXRoLmxvZzIobikpO1xuXG5jb25zdCBnY2QgPSAoYTogbnVtYmVyLCBiOiBudW1iZXIpOiBudW1iZXIgPT4ge1xuICAgIGlmICghYikge1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ2NkKGIsIGEgJSBiKTtcbn07XG5cbmV4cG9ydCB7XG4gICAgb3BlcmF0aW9uLFxuICAgIENvbnZlcnRPcHRpb25zLFxuICAgIHJhbmRvbUVsZW1lbnQsXG4gICAgc2h1ZmZsZSxcbiAgICBpc09kZCxcbiAgICBpc1NxdWFyZSxcbiAgICBpc1ByaW1lLFxuICAgIGdldEZhY3RvcnMsXG4gICAgaXNGYWN0b3JpYWwsXG4gICAgaXNQb3cyLFxuICAgIGdjZCxcbn07XG4iLCIvKipcbiAqIEV4cGxvaXRzIHRoZSBbU3Ryb25nIGxhdyBvZiBzbWFsbCBudW1iZXJzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TdHJvbmdfbGF3X29mX3NtYWxsX251bWJlcnMpIHRvXG4gKiBmaW5kIHByb3BlcnRpZXMgb2YgdGhlIHNtYWxsZXIgbnVtYmVycyBnaXZlbiBieSB0aGUgZGVjb21wb3NpdGlvbnMsIHN1Y2ggYXMgdGhlIGV1bGVyIHBoaSBhbmQgcHJpbWUgY291bnRpbmcgZnVuY3Rpb25zLFxuICogZmFjdG9yaWFsL2dhbW1hLCBhbmQgbW9yZS5cbiAqL1xuXG5pbXBvcnQgeyBnY2QsIHJhbmRvbUVsZW1lbnQgfSBmcm9tICcuL3V0aWxzJztcblxuY29uc3QgX2V1bGVyUGhpID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCB4ID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IG47IGkrKykge1xuICAgICAgICBpZiAoZ2NkKGksIG4pID09PSAxKSB7XG4gICAgICAgICAgICB4Kys7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geDtcbn07XG5cbmNvbnN0IF9wcmltZVNpZXZlID0gKG46IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHByaW1lU2lldmUgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgcHJpbWVTaWV2ZS5wdXNoKHRydWUpO1xuICAgIH1cbiAgICBwcmltZVNpZXZlWzBdID0gZmFsc2U7XG4gICAgcHJpbWVTaWV2ZVsxXSA9IGZhbHNlO1xuXG4gICAgZm9yIChsZXQgcCA9IDI7IHAgKiBwIDw9IG47IHArKykge1xuICAgICAgICBpZiAocHJpbWVTaWV2ZVtwXSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHAgKiBwOyBpIDw9IG47IGkgKz0gcCkge1xuICAgICAgICAgICAgICAgIHByaW1lU2lldmVbaV0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxldCByZXNQcmltZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgaWYgKHByaW1lU2lldmVbaV0pIHtcbiAgICAgICAgICAgIHJlc1ByaW1lcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXNQcmltZXM7XG59O1xuXG5jb25zdCBfY2FjaGVkUHJpbWVzID0gX3ByaW1lU2lldmUoOTk5KTtcblxuY29uc3QgX3ByaW1lQ291bnRpbmdGdW5jdGlvbiA9IChuOiBudW1iZXIpID0+IHtcbiAgICByZXR1cm4gX2NhY2hlZFByaW1lcy5maWx0ZXIoeCA9PiB4IDw9IG4pLmxlbmd0aDtcbn07XG5cbmNvbnN0IG51bWJlclRoZW9yeUZ1bmN0aW9ucyA9IChuOiBudW1iZXIpID0+IHtcbiAgICBsZXQgbWF0Y2hpbmdQaGlJbnB1dHMgPSBbXTtcbiAgICBsZXQgbWF0Y2hpbmdQaUlucHV0cyA9IFtdO1xuICAgIGxldCBmdW5jdGlvbk9wdGlvbnMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDk5OTsgaSsrKSB7XG4gICAgICAgIGlmIChfZXVsZXJQaGkoaSkgPT09IG4pIHtcbiAgICAgICAgICAgIG1hdGNoaW5nUGhpSW5wdXRzLnB1c2goaSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoX3ByaW1lQ291bnRpbmdGdW5jdGlvbihpKSA9PT0gbikge1xuICAgICAgICAgICAgbWF0Y2hpbmdQaUlucHV0cy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1hdGNoaW5nUGhpSW5wdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IG1hdGNoaW5nSW5wdXQgPSByYW5kb21FbGVtZW50KG1hdGNoaW5nUGhpSW5wdXRzKTtcbiAgICAgICAgZnVuY3Rpb25PcHRpb25zLnB1c2goYFxcXFx2YXJwaGkoJHttYXRjaGluZ0lucHV0fSlgKTtcbiAgICB9XG5cbiAgICBpZiAobWF0Y2hpbmdQaUlucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBtYXRjaGluZ0lucHV0ID0gcmFuZG9tRWxlbWVudChtYXRjaGluZ1BpSW5wdXRzKTtcbiAgICAgICAgZnVuY3Rpb25PcHRpb25zLnB1c2goYFxcXFxwaSgke21hdGNoaW5nSW5wdXR9KWApO1xuICAgIH1cblxuICAgIGlmIChmdW5jdGlvbk9wdGlvbnMubGVuZ3RoID09PSAwIHx8IE1hdGgucmFuZG9tKCkgPCAwLjMpIHtcbiAgICAgICAgZnVuY3Rpb25PcHRpb25zLnB1c2goYCR7bn1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmFuZG9tRWxlbWVudChmdW5jdGlvbk9wdGlvbnMpO1xufTtcblxuY29uc3QgZmFjdG9yaWFsID0gKG46IG51bWJlciwgZ2FtbWFGdW5jdGlvbkVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSAmJiBnYW1tYUZ1bmN0aW9uRW5hYmxlZCkge1xuICAgICAgICAvLyDOkyhuKSA9IChuLTEpIVxuICAgICAgICByZXR1cm4gYHtcXFxcR2FtbWEgKCR7biArIDF9KX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFVzaW5nIHRoZSBwaSBwcm9kdWN0IG5vdGF0aW9uIG9mIGZhY3RvcmlhbFxuICAgICAgICByZXR1cm4gYHtcXFxccHJvZF97az0xfV57JHtufX0ga31gO1xuICAgIH1cbn07XG5cbi8vIHJlcHJlc2VudGF0aW9uIG9mIDJeblxuY29uc3QgcG93MkNob29zZSA9IChuOiBudW1iZXIsIG51bWJlclRoZW9yeUVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBsZXQgeCA9IG51bWJlclRoZW9yeUVuYWJsZWQgPyBudW1iZXJUaGVvcnlGdW5jdGlvbnMobikgOiBuO1xuICAgIHJldHVybiBge1xcXFxzdW1fe2s9MH1eeyR7eH19IHske259IFxcXFxjaG9vc2Uga319YDtcbn07XG5cbi8vIExpbWl0cyBvZiBuYXR1cmFsIGxvZyBmdW5jdGlvbnM6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI05hdHVyYWxfbG9nYXJpdGhtc1xuY29uc3QgbGltaXROYXR1cmFsTG9nID0gKG46IG51bWJlciwgbnVtYmVyVGhlb3J5RW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIHJldHVybiBge1xcXFxsaW1fe3ggXFxcXHRvIFxcXFxpbmZ0eX17IFxcXFxmcmFje1xcXFxsbih4KX17eH0gfX1gO1xuICAgIH0gZWxzZSBpZiAobiA9PT0gMSkge1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byAxfSAge1xcXFxmcmFje1xcXFxsbih4KX17eCAtIDF9fX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCB4ID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuKSA6IG47XG4gICAgICAgIHJldHVybiBge1xcXFxsaW1fe3ggXFxcXHRvIDB9eyBcXFxcZnJhY3stXFxcXGxuKDEgKyAke3h9KGVeey14fSAtIDEpKX17eH0gfX1gO1xuICAgIH1cbn07XG5cbi8vIExpbWl0cyBvZiBleHBvbmVudGlhbCBmdW5jdGlvbnM6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI1N1bXMsX3Byb2R1Y3RzX2FuZF9jb21wb3NpdGVzXG5jb25zdCBsaW1pdEV4cG9uZW50aWFsID0gKG46IG51bWJlciwgbnVtYmVyVGhlb3J5RW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIHJldHVybiBge1xcXFxsaW1fe3ggXFxcXHRvIFxcXFxpbmZ0eX17eGVeey14fX19YDtcbiAgICB9IGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGB7XFxcXGxpbV97eCBcXFxcdG8gMH17IFxcXFxmcmFje2VeeCAtIDF9e3h9IH19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgeCA9IG51bWJlclRoZW9yeUVuYWJsZWQgPyBudW1iZXJUaGVvcnlGdW5jdGlvbnMobikgOiBuO1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byAwfXsgXFxcXGZyYWN7ZV57JHt4fXh9IC0gMX17eH0gfX1gO1xuICAgIH1cbn07XG5cbi8vIExpbWl0cyBvZiBwb2x5bm9taWFsIGZ1bmN0aW9uc1xuY29uc3QgbGltaXRQb2x5bm9taWFsID0gKG46IG51bWJlcikgPT4ge1xuICAgIC8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI0Z1bmN0aW9uc19vZl90aGVfZm9ybV94YVxuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjApO1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9eyR7cn14XnstMX19fWA7XG4gICAgfVxuXG4gICAgLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjRnVuY3Rpb25zX29mX3RoZV9mb3JtX3hnKHgpXG4gICAgZWxzZSBpZiAobiA9PT0gMSkge1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9e3heezEveH19fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZ2VuZXJhdGUgcmFuZG9tIHBvbHlub21pYWwgbGltaXRzIGxpa2UgbGltIHggLT4g4oieICgyOHheMiAtIDExeCkvKDR4XjIgKyAxMHgpXG4gICAgICAgIC8vIHNpbmNlIHRoZSBoaWdoZXN0IHBvd2VyIHRlcm1zIGRvbWluYXRlIGluIHRoZSBsaW1pdHMsIHRoZSByZXN0IGFyZSBpZ25vcmVkIGFuZCBjYW4gYmUgcmFuZG9tXG5cbiAgICAgICAgLy8gR2V0IHJhbmRvbSBtdWx0aXBsaWVyIGdyZWF0ZXIgdGhhbiAxXG4gICAgICAgIGxldCBtID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNSkgKyAxO1xuICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gaGlnaGVzdCBwb3dlci4gVGhpcyBkZXRlcm1pbmVzIHRoZSBmaW5hbCBzb2x1dGlvbiBvZiB0aGUgbGltaXRcbiAgICAgICAgbGV0IGhpZ2hlc3RQb3dlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMpICsgMjtcblxuICAgICAgICBsZXQgbnVtZXJhdG9yTnVtYmVyT2ZUZXJtcyA9IGhpZ2hlc3RQb3dlciAtIDE7XG4gICAgICAgIGxldCBkZW5vbWluYXRvck51bWJlck9mVGVybXMgPSBoaWdoZXN0UG93ZXIgLSAxO1xuXG4gICAgICAgIGxldCBzaWducyA9IFsnLScsICcrJ107XG4gICAgICAgIGxldCBudW1lcmF0b3IgPSBgJHttICogbn14Xnske2hpZ2hlc3RQb3dlcn19IGA7XG4gICAgICAgIGxldCBkZW5vbWluYXRvciA9IGAke219eF57JHtoaWdoZXN0UG93ZXJ9fSBgO1xuXG4gICAgICAgIC8vIEdlbmVyYXRlIGEgcG9seW5vbWlhbCBudW1lcmF0b3Igd2l0aCByYW5kb20gbGVuZ3RoIGFuZCBjb2VmZmljaWVudHNcbiAgICAgICAgLy9leDogMTV4XjJcbiAgICAgICAgZm9yIChsZXQgaSA9IG51bWVyYXRvck51bWJlck9mVGVybXM7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgIGxldCBjb2VmID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMjtcblxuICAgICAgICAgICAgbGV0IHBvd2VyID0gaSA8IDIgPyAnJyA6IGBeeyR7aX19YDtcbiAgICAgICAgICAgIGxldCBzaWduID0gc2lnbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMildO1xuXG4gICAgICAgICAgICBudW1lcmF0b3IgKz0gYCR7c2lnbn0gJHtjb2VmfXgke3Bvd2VyfSBgO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBwb2x5bm9taWFsIGRlbm9taW5hdG9yIHdpdGggcmFuZG9tIGxlbmd0aCBhbmQgY29lZmZpY2llbnRzXG4gICAgICAgIGZvciAobGV0IGkgPSBkZW5vbWluYXRvck51bWJlck9mVGVybXM7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgIGxldCBjb2VmID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMjtcblxuICAgICAgICAgICAgbGV0IHBvd2VyID0gaSA8IDIgPyAnJyA6IGBeeyR7aX19YDtcbiAgICAgICAgICAgIGxldCBzaWduID0gc2lnbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMildO1xuXG4gICAgICAgICAgICBkZW5vbWluYXRvciArPSBgJHtzaWdufSAke2NvZWZ9eCR7cG93ZXJ9IGA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYHsgXFxcXGxpbV97eCBcXFxcdG8gXFxcXGluZnR5fSB7IFxcXFxmcmFjeyR7bnVtZXJhdG9yfX17JHtkZW5vbWluYXRvcn19fSB9YDtcbiAgICB9XG59O1xuXG4vLyBVc2luZyBldWxlcidzIGlkZW50aXR5LiBUaGF0IGlzLCBlXihwaSppKSA9IC0xXG5jb25zdCBldWxlcnNJZGVudGl0eSA9IChuOiBudW1iZXIpID0+IHtcbiAgICAvLyBlLmcg4oiSNmVeKHBpKmkpPTZcblxuICAgIGlmIChuICE9PSAwKSB7XG4gICAgICAgIHJldHVybiBgey0ke259ZV57XFxcXHBpIGl9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGB7KGVee1xcXFxwaSBpfSArIDEpfWA7XG4gICAgfVxufTtcblxuLy8gSW5maW5pdGUgZ2VvbWV0cmljIHNlcmllcyB0aGF0IGV2YWx1YXRlcyB0byBhIGZpbml0ZSB2YWx1ZVxuY29uc3QgaW5maW5pdGVHZW9tZXRyaWNTZXJpZXMgPSAobjogbnVtYmVyLCBudW1iZXJUaGVvcnlFbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9tYXRoZW1hdGljYWxfc2VyaWVzI1RyaWdvbm9tZXRyaWNfZnVuY3Rpb25zXG4gICAgaWYgKG4gPT09IDApIHtcbiAgICAgICAgbGV0IHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkgKyAzO1xuICAgICAgICByZXR1cm4gYHtcXFxcc3VtXFxcXGxpbWl0c197az0wfV57JHtyIC1cbiAgICAgICAgICAgIDF9fSB7XFxcXHNpbiBcXFxcbGVmdCh7IFxcXFxmcmFjezIgXFxcXHBpIGt9eyR7cn19IH0gXFxcXHJpZ2h0KX19YDtcbiAgICB9XG5cbiAgICAvLyBVc2luZyB0aGUgUmllbWFubiB6ZXRhIGZ1bmN0aW9uOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9QYXJ0aWN1bGFyX3ZhbHVlc19vZl90aGVfUmllbWFubl96ZXRhX2Z1bmN0aW9uI1RoZV9SaWVtYW5uX3pldGFfZnVuY3Rpb25fYXRfMF9hbmRfMVxuICAgIGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGB7XFxcXGxpbV97XFxcXGVwc2lsb24gXFxcXHRvIDB9eyBcXFxcZXBzaWxvbiBcXFxcemV0YSgxICsgXFxcXGVwc2lsb24pIH19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBVc2luZyB0aGUgaW5maW5pdGUgZ2VvbWV0cmljIHNlcmllcyBydWxlOiBXaGVuIOKIkjE8eDwxLCBzdW1tYXRpb24gZnJvbSBpID0gMCB0byBpbmZpbml0eSBvZiByXmkgPSAxLygxLXIpIG9yIChyLTEpL3IuXG4gICAgICAgIC8vIERlY2ltYWwgY2FuIGJlIHJlcHJlc2VudGVkIGFzIGZyYWN0aW9uIHRvby4gZS5nICgwLjI1KV5pID0gKDEvNCleaSA9IDReLWlcbiAgICAgICAgbGV0IHgxID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuIC0gMSkgOiBuIC0gMTtcbiAgICAgICAgbGV0IHgyID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuKSA6IG47XG4gICAgICAgIHJldHVybiBge1xcXFxzdW1cXFxcbGltaXRzX3trPTB9XlxcXFxpbmZ0eSB7XFxcXGxlZnQoe1xcXFxmcmFjeyR7eDF9fXske3gyfX19XFxcXHJpZ2h0KV57a319fWA7XG4gICAgfVxufTtcblxuLy8gVXNpbmcgdGhlIHRyaWcgaWRlbnRpdHkgKGNvc14yKXggKyAoc2luXjIpeCA9IDFcbmNvbnN0IHRyaWdJZGVudGl0eSA9IChleHByZXNzaW9uOiBzdHJpbmcpID0+IHtcbiAgICBsZXQgcmFuZG9tVmFsdWUgPSBNYXRoLnJhbmRvbSgpO1xuICAgIGlmIChyYW5kb21WYWx1ZSA8IDAuMjUpIHtcbiAgICAgICAgcmV0dXJuIGBcXFxcbGVmdChcXFxcZnJhY3ske2V4cHJlc3Npb259fXsoXFxcXGNvc14yeCArIFxcXFxzaW5eMngpfVxcXFxyaWdodClgO1xuICAgIH0gZWxzZSBpZiAocmFuZG9tVmFsdWUgPCAwLjUpIHtcbiAgICAgICAgcmV0dXJuIGBcXFxcbGVmdCh7JHtleHByZXNzaW9ufSBcXFxcdGltZXMgKFxcXFxjb3NeMnggKyBcXFxcc2luXjJ4KX1cXFxccmlnaHQpYDtcbiAgICB9XG59O1xuXG4vKiBVc2luZyB0aGUgZGlmZmVyZW5jZSBvZiB0d28gc3F1YXJlcyBpbiBsaW1pdHMgKi9cbmNvbnN0IGxpbURpZmZUd29TcXVhcmVzID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMTtcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSkge1xuICAgICAgICB2YXIgdGV4ID0gYFxcXFxsaW1fe3ggXFxcXHRvICR7biAtIHJ9fSBcXFxcZnJhY3t4XjIgLSAke3IgKiogMn19e3ggLSAke3J9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHRleCA9IGBcXFxcbGltX3t4IFxcXFx0byAke24gKyByfX0gXFxcXGZyYWN7eF4yIC0gJHtyICoqIDJ9fXt4ICsgJHtyfX1gO1xuICAgIH1cbiAgICByZXR1cm4gYHske3RleH19YDtcbn07XG5cbmNvbnN0IHNhbWVOdW1iZXIgPSAobjogbnVtYmVyKSA9PiBgJHtufWA7XG5cbmV4cG9ydCB7XG4gICAgbnVtYmVyVGhlb3J5RnVuY3Rpb25zLFxuICAgIGZhY3RvcmlhbCxcbiAgICBwb3cyQ2hvb3NlLFxuICAgIGxpbWl0TmF0dXJhbExvZyxcbiAgICBsaW1pdEV4cG9uZW50aWFsLFxuICAgIGxpbWl0UG9seW5vbWlhbCxcbiAgICBldWxlcnNJZGVudGl0eSxcbiAgICBpbmZpbml0ZUdlb21ldHJpY1NlcmllcyxcbiAgICB0cmlnSWRlbnRpdHksXG4gICAgbGltRGlmZlR3b1NxdWFyZXMsXG4gICAgc2FtZU51bWJlcixcbn07XG4iLCIvKipcbiAqIENvbnZlcnRzIHRoZSBNYXRoSmF4IFNWRyAoVE9ETzogdGhpcyBjb2RlIHByb2R1Y2VzIHRoZSBlcnJvciBpZiB0aGUgTWF0aEpheCBpcyBodG1sKSB0byBhIHBuZyxcbiAqIGJ5IHNlcmlhbGl6aW5nIHRoZSBzdmcgaW50byBhIGRhdGEgdXJsIGFuZCBkcmF3aW5nIHRvIHRoZSBjYW52YXMsIHdoZXJlIGl0IGNhbiB0aGFuIGJlIHNlcmlhbGl6ZWRcbiAqIGludG8gYSBwbmcuXG4gKi9cblxubGV0IGRvd25sb2FkQnRuID0gPEhUTUxCdXR0b25FbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZC1pbWcnKTtcblxuLy8gSW5pdGlhdGUgZG93bmxvYWQgb2YgYmxvYlxuY29uc3QgZG93bmxvYWQgPSAoZmlsZW5hbWU6IHN0cmluZywgYmxvYjogQmxvYikgPT4ge1xuICAgIGNvbnN0IGVsZW0gPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgIGVsZW0uaHJlZiA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgIGVsZW0uZG93bmxvYWQgPSBmaWxlbmFtZTtcbiAgICBlbGVtLmNsaWNrKCk7XG59O1xuXG5jb25zdCBkb3dubG9hZFBORyA9ICgpID0+IHtcbiAgICAvLyBHZXQgdGhlIHN2ZyBmcm9tIHRoZSBwYWdlXG4gICAgdmFyIHN2ZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpITtcblxuICAgIC8vIEdldCB0aGUgY3VycmVudCBudW1iZXJcbiAgICB2YXIgbnVtYmVyID0gKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnB1dCcpKS52YWx1ZTtcblxuICAgIC8vIEluY3JlYXNlIHRoZSBTVkcncyB3aWR0aCBhbmQgaGVpZ2h0IHRvIHByb2R1Y2UgYSBiaWdnZXIgaW1hZ2VcbiAgICBsZXQgdyA9IHBhcnNlSW50KHN2Zy5nZXRBdHRyaWJ1dGUoJ3dpZHRoJykhKTtcbiAgICBsZXQgaCA9IHBhcnNlSW50KHN2Zy5nZXRBdHRyaWJ1dGUoJ2hlaWdodCcpISk7XG5cbiAgICAvLyBDb252ZXJ0IFNWRyB0byBzdHJpbmcgZGF0YVxuICAgIGNvbnN0IGRhdGEgPSBuZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKHN2Zyk7XG5cbiAgICBjb25zdCBzdmdEYXRhVXJsID0gYGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJHtidG9hKGRhdGEpfWA7XG5cbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAvLyB1cHNjYWxlIGhlaWdodCB0byBhdCBsZWFzdCA4MDBweFxuICAgIGxldCBzY2FsZUZhY3RvciA9IE1hdGgubWF4KDIsIDgwMCAvIGgpO1xuICAgIGNhbnZhcy53aWR0aCA9IHcgKiBzY2FsZUZhY3RvcjtcbiAgICBjYW52YXMuaGVpZ2h0ID0gaCAqIHNjYWxlRmFjdG9yO1xuXG4gICAgY29uc29sZS5sb2coeyB3OiBjYW52YXMud2lkdGgsIGg6IGNhbnZhcy5oZWlnaHQgfSk7XG4gICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJykhO1xuXG4gICAgY29uc3Qgc3ZnRGF0YUltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgc3ZnRGF0YUltYWdlLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgY3R4LmRyYXdJbWFnZShzdmdEYXRhSW1hZ2UsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cbiAgICAgICAgY2FudmFzLnRvQmxvYihibG9iID0+IHtcbiAgICAgICAgICAgIGlmIChibG9iID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2VyaWFsaXplIGNhbnZhcyB0byBibG9iJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb3dubG9hZChgY29tcGxpY2F0ZWQtZXhwcmVzc2lvbi10aGF0LWVxdWFscy0ke251bWJlcn1gLCBibG9iKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHN2Z0RhdGFJbWFnZS5zcmMgPSBzdmdEYXRhVXJsO1xufTtcblxuY29uc3QgbWFpbiA9ICgpID0+IHtcbiAgICBkb3dubG9hZEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGRvd25sb2FkUE5HKTtcbn07XG5leHBvcnQgeyBtYWluIH07XG4iLCJkZWNsYXJlIHZhciBNYXRoSmF4OiBhbnk7XG5cbmltcG9ydCAqIGFzIHJlcHJlc2VudGF0aW9ucyBmcm9tICcuL3JlcHJlc2VudGF0aW9ucyc7XG5pbXBvcnQgeyBDb252ZXJ0T3B0aW9ucywgb3BlcmF0aW9uIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyBkZWNvbXBvc2UsIGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiB9IGZyb20gJy4vZGVjb21wb3NpdGlvbnMnO1xuaW1wb3J0ICogYXMgZG93bmxvYWRfcG5nIGZyb20gJy4vZG93bmxvYWQtcG5nJztcblxuY29uc3QgY29udmVydCA9IChudW1iZXI6IG51bWJlciwgb3B0aW9uczogQ29udmVydE9wdGlvbnMpID0+IHtcbiAgICAvLyBWYWxpZGF0aW5nIGlucHV0XG4gICAgaWYgKGlzTmFOKG51bWJlcikgfHwgbnVtYmVyID4gMTAwMCB8fCBudW1iZXIgPCAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKiBOZWVkIHRvIGFkZCBhbm90aGVyIHNsYXNoIHRvIGxhdGV4IHN0cmluZ3MgdG8gcHJldmVudCBzbGFzaCBlc2NhcGUgKi9cblxuICAgIC8vIExpc3Qgb2YgZnVuY3Rpb25zIHRoYXQgZ2VuZXJhdGUgTGFUZVggbWF0aCBleHByZXNzaW9uc1xuICAgIC8vIEZ1bmN0aW9ucyBhcmUgY2hvc2VuIHJhbmRvbWx5XG4gICAgbGV0IHBvc3NpYmxlX29wdGlvbnM6IG9wZXJhdGlvbltdID0gW107XG5cbiAgICBpZiAob3B0aW9ucy5ldWxlcnNJZGVudGl0eSkge1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gocmVwcmVzZW50YXRpb25zLmV1bGVyc0lkZW50aXR5KTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuZXhwb25lbnRpYWxMaW1pdHMpIHtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKG4gPT4gcmVwcmVzZW50YXRpb25zLmxpbWl0TmF0dXJhbExvZyhuLCBvcHRpb25zLm51bWJlclRoZW9yeSkpO1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gobiA9PiByZXByZXNlbnRhdGlvbnMubGltaXRFeHBvbmVudGlhbChuLCBvcHRpb25zLm51bWJlclRoZW9yeSkpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5wb2x5bm9taWFsTGltaXRzKSB7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChyZXByZXNlbnRhdGlvbnMubGltRGlmZlR3b1NxdWFyZXMpO1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gocmVwcmVzZW50YXRpb25zLmxpbWl0UG9seW5vbWlhbCk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuZ2VvbWV0cmljU2VyaWVzKSB7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChuID0+XG4gICAgICAgICAgICByZXByZXNlbnRhdGlvbnMuaW5maW5pdGVHZW9tZXRyaWNTZXJpZXMobiwgb3B0aW9ucy5udW1iZXJUaGVvcnkpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gZGVjb3JhdGUgZWFjaCBvcGVyYXRpb24gd2l0aCBhIGZ1bmN0aW9uIHRoYXQgY2hlY2tzIGlmIHRoZSBpbnB1dCBpcyBvZiBhIGNlcnRhaW4gZm9ybSwgYW5kIGlmIGl0IGlzIGl0IG92ZXJyaWRlcyB0aGUgZGVjb3JhdGVkIGZ1bmN0aW9uJ3MgdXN1YWwgcmVzdWx0IHdpdGggaXQncyBvd24uXG4gICAgcG9zc2libGVfb3B0aW9ucyA9IHBvc3NpYmxlX29wdGlvbnMubWFwKGYgPT4ge1xuICAgICAgICByZXR1cm4gY29uZGl0aW9uYWxEZWNvbXBvc2l0aW9uKGYsIG9wdGlvbnMpO1xuICAgIH0pO1xuXG4gICAgbGV0IGlucHV0ID0gZGVjb21wb3NlKG51bWJlciwgcG9zc2libGVfb3B0aW9ucyk7XG5cbiAgICAvLyAgRGlzYWJsZSB0aGUgZGlzcGxheSBhbmQgcmVuZGVyIGJ1dHRvbnMgdW50aWwgTWF0aEpheCBpcyBkb25lXG4gICAgdmFyIGRpc3BsYXkgPSA8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlzcGxheScpO1xuICAgIHZhciBidXR0b24gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbmRlcicpO1xuICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGRpc3BsYXkuZGlzYWJsZWQgPSB0cnVlO1xuICAgIGxldCBkb3dubG9hZEJ0biA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQtaW1nJyk7XG5cbiAgICAvLyAgQ2xlYXIgdGhlIG9sZCBvdXRwdXRcblxuICAgIGxldCBvdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3V0cHV0JykhO1xuICAgIG91dHB1dC5pbm5lckhUTUwgPSAnJztcblxuICAgIC8vICBSZXNldCB0aGUgdGV4IGxhYmVscyAoYW5kIGF1dG9tYXRpYyBlcXVhdGlvbiBudW1iZXJzLCB0aG91Z2ggdGhlcmUgYXJlbid0IGFueSBoZXJlKS5cbiAgICAvLyAgR2V0IHRoZSBjb252ZXJzaW9uIG9wdGlvbnMgKG1ldHJpY3MgYW5kIGRpc3BsYXkgc2V0dGluZ3MpXG4gICAgLy8gIENvbnZlcnQgdGhlIGlucHV0IHRvIENvbW1vbkhUTUwgb3V0cHV0IGFuZCB1c2UgYSBwcm9taXNlIHRvIHdhaXQgZm9yIGl0IHRvIGJlIHJlYWR5XG4gICAgLy8gICAgKGluIGNhc2UgYW4gZXh0ZW5zaW9uIG5lZWRzIHRvIGJlIGxvYWRlZCBkeW5hbWljYWxseSkuXG4gICAgTWF0aEpheC50ZXhSZXNldCgpO1xuICAgIHZhciBtYXRoSmF4T3B0aW9ucyA9IE1hdGhKYXguZ2V0TWV0cmljc0ZvcihvdXRwdXQpO1xuICAgIG1hdGhKYXhPcHRpb25zLmRpc3BsYXkgPSBkaXNwbGF5LmNoZWNrZWQ7XG4gICAgTWF0aEpheC50ZXgyc3ZnUHJvbWlzZShpbnB1dCwgbWF0aEpheE9wdGlvbnMpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKG5vZGU6IGFueSkge1xuICAgICAgICAgICAgLy8gIFRoZSBwcm9taXNlIHJldHVybnMgdGhlIHR5cGVzZXQgbm9kZSwgd2hpY2ggd2UgYWRkIHRvIHRoZSBvdXRwdXRcbiAgICAgICAgICAgIC8vICBUaGVuIHVwZGF0ZSB0aGUgZG9jdW1lbnQgdG8gaW5jbHVkZSB0aGUgYWRqdXN0ZWQgQ1NTIGZvciB0aGVcbiAgICAgICAgICAgIC8vICAgIGNvbnRlbnQgb2YgdGhlIG5ldyBlcXVhdGlvbi5cbiAgICAgICAgICAgIG91dHB1dC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgICAgICAgIE1hdGhKYXguc3RhcnR1cC5kb2N1bWVudC5jbGVhcigpO1xuICAgICAgICAgICAgTWF0aEpheC5zdGFydHVwLmRvY3VtZW50LnVwZGF0ZURvY3VtZW50KCk7XG4gICAgICAgICAgICAvLyBEaXNwbGF5IGRvd25sb2FkIGJ1dHRvblxuICAgICAgICAgICAgZG93bmxvYWRCdG4uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnI6IEVycm9yKSB7XG4gICAgICAgICAgICAvLyAgSWYgdGhlcmUgd2FzIGFuIGVycm9yLCBwdXQgdGhlIG1lc3NhZ2UgaW50byB0aGUgb3V0cHV0IGluc3RlYWRcbiAgICAgICAgICAgIG91dHB1dFxuICAgICAgICAgICAgICAgIC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwcmUnKSlcbiAgICAgICAgICAgICAgICAuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZXJyLm1lc3NhZ2UpKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyAgRXJyb3Igb3Igbm90LCByZS1lbmFibGUgdGhlIGRpc3BsYXkgYW5kIHJlbmRlciBidXR0b25zXG4gICAgICAgICAgICBidXR0b24uZGlzYWJsZWQgPSBkaXNwbGF5LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIH0pO1xufTtcbmNvbnN0IG1haW4gPSAoKSA9PiB7XG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JtJykgYXMgSFRNTEZvcm1FbGVtZW50O1xuICAgIGNvbnN0IG51bWJlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG5cbiAgICBjb25zdCBnYW1tYUZ1bmN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbW1hLWZ1bmN0aW9uJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBldWxlcnNJZGVudGl0eSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldWxlcnMtaWRlbnRpdHknKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGV4cG9uZW50aWFsTGltaXRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpbWl0cy1leHBvbmVudGlhbCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgcG9seW5vbWlhbExpbWl0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW1pdHMtcG9seW5vbWlhbCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgbnVtYmVyVGhlb3J5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bWJlci10aGVvcnknKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGdlb21ldHJpY1NlcmllcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW9tZXRyaWMtc2VyaWVzJykgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZXZlbnQgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIGNvbnZlcnQocGFyc2VJbnQobnVtYmVyLnZhbHVlKSwge1xuICAgICAgICAgICAgZ2FtbWFGdW5jdGlvbjogZ2FtbWFGdW5jdGlvbi5jaGVja2VkLFxuICAgICAgICAgICAgZXVsZXJzSWRlbnRpdHk6IGV1bGVyc0lkZW50aXR5LmNoZWNrZWQsXG4gICAgICAgICAgICBleHBvbmVudGlhbExpbWl0czogZXhwb25lbnRpYWxMaW1pdHMuY2hlY2tlZCxcbiAgICAgICAgICAgIHBvbHlub21pYWxMaW1pdHM6IHBvbHlub21pYWxMaW1pdHMuY2hlY2tlZCxcbiAgICAgICAgICAgIG51bWJlclRoZW9yeTogbnVtYmVyVGhlb3J5LmNoZWNrZWQsXG4gICAgICAgICAgICBnZW9tZXRyaWNTZXJpZXM6IGdlb21ldHJpY1Nlcmllcy5jaGVja2VkLFxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRvd25sb2FkX3BuZy5tYWluKCk7XG59O1xuXG5tYWluKCk7XG4iLCIvKipcbiAqIFRoaXMgZmlsZSBjb250YWlucyBkZWNvbXBvc2l0aW9uIGZ1bmN0aW9ucy4gVGhleSBicmVhayBsYXJnZXIgbnVtYmVycyAoMy1kaWdpdCkgaW50byBzbWFsbGVyIG9uZXMgKDItMSBkaWdpdHMpLFxuICogd2hlcmUgdGhlIFtTdHJvbmcgbGF3IG9mIHNtYWxsIG51bWJlcnNdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1N0cm9uZ19sYXdfb2Zfc21hbGxfbnVtYmVycykgY2FuIHRha2Ugb2YgdGhlbVxuICogYXMgdGhleSBoYXZlIG11Y2ggbW9yZSBwcm9wZXJ0aWVzIHRoYW4gbGFyZ2VyIG51bWJlcnMuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBvcGVyYXRpb24sXG4gICAgZ2V0RmFjdG9ycyxcbiAgICBDb252ZXJ0T3B0aW9ucyxcbiAgICBpc0ZhY3RvcmlhbCxcbiAgICBpc1BvdzIsXG4gICAgc2h1ZmZsZSxcbiAgICBpc1ByaW1lLFxuICAgIGlzU3F1YXJlLFxuICAgIGlzT2RkLFxufSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCAqIGFzIHJlcHJlc2VudGF0aW9ucyBmcm9tICcuL3JlcHJlc2VudGF0aW9ucyc7XG4vLyBmb3IgbiA9IGFiIGFuZCDiiIBjLCBlaXRoZXIgcmV0dXJuIG4gPSBhYiBvciAoYS1jKShiK2MpICsgYyhiLWErYylcbmNvbnN0IGRlY29tcG9zZUFCQyA9IChcbiAgICBudW1iZXI6IG51bWJlcixcbiAgICBvcDE6IG9wZXJhdGlvbixcbiAgICBvcDI6IG9wZXJhdGlvbixcbiAgICBvcDM6IG9wZXJhdGlvbixcbiAgICBtb3JlUmFuZG9tT3B0aW9uczogb3BlcmF0aW9uXG4pID0+IHtcbiAgICBsZXQgZmFjdG9ycyA9IGdldEZhY3RvcnMobnVtYmVyKTtcbiAgICBsZXQgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBmYWN0b3JzLmxlbmd0aCk7XG4gICAgbGV0IGEgPSBmYWN0b3JzW3JhbmRvbUluZGV4XTtcbiAgICBsZXQgYiA9IG51bWJlciAvIGE7XG4gICAgbGV0IGMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzMCkgKyAxO1xuXG4gICAgLy8gYWJcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMikge1xuICAgICAgICByZXR1cm4gYHt7XFxcXGxlZnQoeyR7b3AxKGEpfX1cXFxccmlnaHQpfXtcXFxcbGVmdCh7JHtvcDIoYil9fVxcXFxyaWdodCl9fWA7XG4gICAgfVxuXG4gICAgLy8gKGEgLSBjKShiICsgYykgKyBjIChiIC0gYSArIGMpXG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBgeyBcXFxcbGVmdCh7JHtvcDEoYSl9IC0gJHtvcDIoYyl9fVxcXFxyaWdodCkgXFxcXGxlZnQoeyR7b3AzKGIpfSArICR7bW9yZVJhbmRvbU9wdGlvbnMoXG4gICAgICAgICAgICBjXG4gICAgICAgICl9fVxcXFxyaWdodCkgKyB7JHttb3JlUmFuZG9tT3B0aW9ucyhjKX19e1xcXFxsZWZ0KHske21vcmVSYW5kb21PcHRpb25zKFxuICAgICAgICAgICAgYlxuICAgICAgICApfSAtICR7bW9yZVJhbmRvbU9wdGlvbnMoYSl9ICsgJHttb3JlUmFuZG9tT3B0aW9ucyhjKX19IFxcXFxyaWdodCl9IH1gO1xuICAgIH1cbn07XG5cbi8vIDUgPSBzcXJ0KDI1KVxuY29uc3QgZGVjb21wb3NlU3FydCA9IChuOiBudW1iZXIsIG9wMTogb3BlcmF0aW9uKSA9PiB7XG4gICAgbGV0IHNxdWFyZSA9IG4gKiogMjtcbiAgICByZXR1cm4gYHtcXFxcc3FydHske29wMShzcXVhcmUpfX19YDtcbn07XG5cbi8vIDI1ID0gMSArIDMgKyA1ICsgNyArIDlcbmNvbnN0IGRlY29tcG9zZVNxdWFyZSA9IChcbiAgICBuOiBudW1iZXIsXG4gICAgb3AxOiBvcGVyYXRpb24sXG4gICAgb3AyOiBvcGVyYXRpb24sXG4gICAgb3AzOiBvcGVyYXRpb24sXG4gICAgbW9yZVJhbmRvbU9wdGlvbnM6IG9wZXJhdGlvblxuKSA9PiB7XG4gICAgbGV0IHNxdWFyZVJvb3QgPSBNYXRoLnNxcnQobik7XG4gICAgbGV0IHN1bSA9IGAke29wMSgxKX1gO1xuICAgIGxldCBvZGRWYWwgPSAxO1xuXG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzcXVhcmVSb290IC0gMTsgaSsrKSB7XG4gICAgICAgICAgICBvZGRWYWwgKz0gMjtcbiAgICAgICAgICAgIHN1bSArPSBgKyAke21vcmVSYW5kb21PcHRpb25zKG9kZFZhbCl9YDtcbiAgICAgICAgfVxuICAgICAgICBzdW0gPSBgeyAke3N1bX0gfWA7XG4gICAgICAgIHJldHVybiBzdW07XG4gICAgfVxuXG4gICAgLy8gKGEgKyBiKV4yID0gYV4yICsgMmFiICsgYl4yXG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBhID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc3F1YXJlUm9vdCAtIDEpICsgMTtcbiAgICAgICAgbGV0IGIgPSBzcXVhcmVSb290IC0gYTtcblxuICAgICAgICAvLyBSZXByZXNlbnRpbmcgKGEgKyBiKV4yXG4gICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC41KSB7XG4gICAgICAgICAgICByZXR1cm4gYHsge1xcXFxsZWZ0KCR7b3AxKGEpfSArICR7b3AxKGIpfVxcXFxyaWdodCl9XjJ9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlcHJlc2VudGluZyBhXjIgKyAyYWIgKyBiXjJcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYHsge1xcXFxsZWZ0KCR7b3AxKGEpfVxcXFxyaWdodCl9XjIgKyB7JHttb3JlUmFuZG9tT3B0aW9ucygyKX19e1xcXFxsZWZ0KCR7b3AyKFxuICAgICAgICAgICAgICAgIGFcbiAgICAgICAgICAgICl9XFxcXHJpZ2h0KX17XFxcXGxlZnQoJHtvcDMoYil9XFxcXHJpZ2h0KX0gKyB7XFxcXGxlZnQoJHttb3JlUmFuZG9tT3B0aW9ucyhiKX1cXFxccmlnaHQpfV4yfWA7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vLyAyNSA9IDEzXjIgLSAxMl4yXG5jb25zdCBkZWNvbXBvc2VEaWZmZXJlbmNlU3F1YXJlcyA9IChuOiBudW1iZXIsIG9wMTogb3BlcmF0aW9uLCBvcDI6IG9wZXJhdGlvbikgPT4ge1xuICAgIGxldCBhID0gTWF0aC5mbG9vcihuIC8gMik7XG4gICAgbGV0IGIgPSBNYXRoLmNlaWwobiAvIDIpO1xuXG4gICAgaWYgKE1hdGguY2VpbChuIC8gMikgKiogMiA8IDEwMCAmJiBNYXRoLnJhbmRvbSgpIDwgMC43KSB7XG4gICAgICAgIHJldHVybiBgeyR7b3AxKGIgKiogMil9IC0gJHtvcDIoYSAqKiAyKX19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYHsgXFxcXGxlZnQoeyR7b3AxKGIpfX1cXFxccmlnaHQpXjIgLSAgXFxcXGxlZnQoeyR7b3AyKGEpfX1cXFxccmlnaHQpXjJ9YDtcbiAgICB9XG59O1xuXG4vLyA3ID0gMiAqIDMgKyAxXG5jb25zdCBkZWNvbXBvc2VBZGRNdWx0aXBseSA9IChuOiBudW1iZXIsIG9wMTogb3BlcmF0aW9uLCBvcDI6IG9wZXJhdGlvbiwgb3AzOiBvcGVyYXRpb24pID0+IHtcbiAgICBsZXQgcmFuZE51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG4gKyAxKSArIDE7XG4gICAgbGV0IHIgPSBuICUgcmFuZE51bTtcbiAgICBsZXQgYSA9IE1hdGguZmxvb3IobiAvIHJhbmROdW0pO1xuICAgIHJldHVybiBgJHtvcDEoYSl9IFxcXFx0aW1lcyB7JHtvcDIocmFuZE51bSl9fSArICR7b3AzKHIpfWA7XG59O1xuXG4vLyA3ID0gNyo4LzhcbmNvbnN0IGRlY29tcG9zZU11bERpdmlkZSA9IChuOiBudW1iZXIsIG9wMTogb3BlcmF0aW9uLCBvcDI6IG9wZXJhdGlvbikgPT4ge1xuICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNSkgKyAxO1xuICAgIHJldHVybiBgXFxcXGZyYWN7JHtvcDEobiAqIHIpfX0geyR7b3AyKHIpfX1gO1xufTtcbi8qIGVuZCBkZWNvbXBvc2UgZnVuY3Rpb25zICovXG5cbmNvbnN0IGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiA9IChcbiAgICB3cmFwcGVkRnVuY3Rpb246IG9wZXJhdGlvbixcbiAgICBvcHRpb25zOiBDb252ZXJ0T3B0aW9uc1xuKTogb3BlcmF0aW9uID0+IHtcbiAgICByZXR1cm4gKG46IG51bWJlcikgPT4ge1xuICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8PSAwLjUpIHtcbiAgICAgICAgICAgIC8vIGludmVyc2UgZmFjdG9yaWFsIG9mIG4sIHN1Y2ggdGhhdCBmYWMhID0gblxuICAgICAgICAgICAgY29uc3QgZmFjID0gaXNGYWN0b3JpYWwobik7XG4gICAgICAgICAgICBpZiAoZmFjKSB7XG4gICAgICAgICAgICAgICAgLy8gZmFjdG9yaWFsKGZhYykgPSBmYWMhID0gblxuICAgICAgICAgICAgICAgIHJldHVybiByZXByZXNlbnRhdGlvbnMuZmFjdG9yaWFsKGZhYywgb3B0aW9ucy5nYW1tYUZ1bmN0aW9uKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGlzUG93MihuKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXByZXNlbnRhdGlvbnMucG93MkNob29zZShNYXRoLmxvZzIobiksIG9wdGlvbnMubnVtYmVyVGhlb3J5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB3cmFwcGVkRnVuY3Rpb24obik7XG4gICAgfTtcbn07XG5cbi8vIEJyZWFrIGEgbnVtYmVyIGRvd24gaW50byBzbWFsbGVyIG51bWJlcnMgc2VwYXJhdGVkIGJ5IG9wZXJhdG9yc1xuY29uc3QgZGVjb21wb3NlID0gKG46IG51bWJlciwgb3BlcmF0aW9uczogb3BlcmF0aW9uW10pID0+IHtcbiAgICAvLyBHZXQgdGhyZWUgb3BlcmF0aW9ucyB0aGF0IGNhbiBiZSB1c2VkXG4gICAgbGV0IG1vcmVSYW5kb21PcHRpb25zID0gKG51bTogbnVtYmVyKSA9PiB7XG4gICAgICAgIHJldHVybiBvcGVyYXRpb25zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG9wZXJhdGlvbnMubGVuZ3RoKV0obnVtKTtcbiAgICB9O1xuXG4gICAgbGV0IHJhbmRvbU9wdGlvbjEgPSBtb3JlUmFuZG9tT3B0aW9ucztcbiAgICBsZXQgcmFuZG9tT3B0aW9uMiA9IG1vcmVSYW5kb21PcHRpb25zO1xuICAgIGxldCByYW5kb21PcHRpb24zID0gbW9yZVJhbmRvbU9wdGlvbnM7XG5cbiAgICAvLyBpZiB0aGVyZSBhcmUgbm8gb3BlcmF0aW9ucyB0byBiZSBkb25lXG4gICAgaWYgKG9wZXJhdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJhbmRvbU9wdGlvbjEgPSByZXByZXNlbnRhdGlvbnMuc2FtZU51bWJlcjtcbiAgICAgICAgcmFuZG9tT3B0aW9uMiA9IHJlcHJlc2VudGF0aW9ucy5zYW1lTnVtYmVyO1xuICAgICAgICByYW5kb21PcHRpb24zID0gcmVwcmVzZW50YXRpb25zLnNhbWVOdW1iZXI7XG4gICAgICAgIG1vcmVSYW5kb21PcHRpb25zID0gcmVwcmVzZW50YXRpb25zLnNhbWVOdW1iZXI7XG4gICAgfVxuXG4gICAgaWYgKG9wZXJhdGlvbnMubGVuZ3RoID49IDMpIHtcbiAgICAgICAgW3JhbmRvbU9wdGlvbjEsIHJhbmRvbU9wdGlvbjIsIHJhbmRvbU9wdGlvbjNdID0gc2h1ZmZsZShvcGVyYXRpb25zKS5zbGljZSgwLCAzKTtcbiAgICB9XG5cbiAgICAvLyBNYWtlIGVhY2ggb3V0Y29tZSBlcXVhbGx5IGxpa2VseSAoYXNzdW1pbmcgYWxsIGNoYXJhY3RlcmlzdGljcyBhcmUgZnVsZmlsbGVkLCB3aGljaCB0aGV5IGFyZSBub3QpXG4gICAgY29uc3QgcmFuZG9tVmFsdWUgPSBNYXRoLnJhbmRvbSgpO1xuICAgIGNvbnN0IHVuaXRUaHJlc2hvbGQgPSAxIC8gNjtcblxuICAgIC8vIDEuIGFiID0gKGEgLSBjKShiICsgYykgKyBjIChiIC0gYSArIGMpLCB3aGVyZSBjIGlzIGFueSByYW5kb20gcG9zaXRpdmUgbnVtYmVyXG4gICAgaWYgKHJhbmRvbVZhbHVlIDwgdW5pdFRocmVzaG9sZCAmJiBuICE9PSAwICYmIG4gPCAxMDAgJiYgKG4gPT09IDIgfHwgIWlzUHJpbWUobikpKSB7XG4gICAgICAgIHJldHVybiBkZWNvbXBvc2VBQkMobiwgcmFuZG9tT3B0aW9uMSwgcmFuZG9tT3B0aW9uMiwgcmFuZG9tT3B0aW9uMywgbW9yZVJhbmRvbU9wdGlvbnMpO1xuICAgIH1cblxuICAgIC8vIDIuIFJlcHJlc2VudCAoc21hbGwpIG51bWJlcnMgdXNpbmcgdGhlaXIgc3F1YXJlIGFuZCBzcXVhcmUgcm9vdFxuICAgIGlmIChyYW5kb21WYWx1ZSA8IHVuaXRUaHJlc2hvbGQgKiAyICYmIG4gPCAxMCkge1xuICAgICAgICByZXR1cm4gZGVjb21wb3NlU3FydChuLCByYW5kb21PcHRpb24xKTtcbiAgICB9XG5cbiAgICAvLyAzLiBUaGUgc3VtIG9mIHRoZSBmaXJzdCBuIG9kZCBudW1iZXJzIGlzIGVxdWFsIHRvIG5eMiBlLmcgMSArIDMgKyA1ID0gM14yXG4gICAgaWYgKHJhbmRvbVZhbHVlIDwgdW5pdFRocmVzaG9sZCAqIDMgJiYgbiA+IDEgJiYgaXNTcXVhcmUobikpIHtcbiAgICAgICAgcmV0dXJuIGRlY29tcG9zZVNxdWFyZShuLCByYW5kb21PcHRpb24xLCByYW5kb21PcHRpb24yLCByYW5kb21PcHRpb24zLCBtb3JlUmFuZG9tT3B0aW9ucyk7XG4gICAgfVxuXG4gICAgLy8gNC4gVGhlIHN1bSBvZiB0d28gY29uc2VjdXRpdmUgaW50ZWdlcnMgaXMgdGhlIGRpZmZlcmVuY2Ugb2YgdGhlaXIgc3F1YXJlcyBlLmcgMyArIDIgPSAzXjIgLSAyXjJcbiAgICBpZiAocmFuZG9tVmFsdWUgPCB1bml0VGhyZXNob2xkICogNCAmJiBpc09kZChuKSAmJiByYW5kb21WYWx1ZSA8IDAuNykge1xuICAgICAgICByZXR1cm4gZGVjb21wb3NlRGlmZmVyZW5jZVNxdWFyZXMobiwgcmFuZG9tT3B0aW9uMSwgcmFuZG9tT3B0aW9uMik7XG4gICAgfVxuXG4gICAgLy8gNS4gRXhwcmVzcyBhIG51bWJlciB1c2luZyBtdWx0aXBsaWNhdGlvbiBhbmQgYWRkaXRpb24uIEUuZyA0ID0gMSAqIDMgKyAxXG4gICAgaWYgKHJhbmRvbVZhbHVlIDwgdW5pdFRocmVzaG9sZCAqIDUgJiYgbiA8PSAyMDApIHtcbiAgICAgICAgcmV0dXJuIGRlY29tcG9zZU11bERpdmlkZShuLCByYW5kb21PcHRpb24xLCByYW5kb21PcHRpb24yKTtcbiAgICB9XG4gICAgLy8gNi4gTXVsdGlwbHkgYW5kIGRpdmlkZSBieSBhIHJhbmRvbSBudW1iZXIuIGUuZyAyID0gKDIqNSkvNVxuICAgIHJldHVybiBkZWNvbXBvc2VBZGRNdWx0aXBseShuLCByYW5kb21PcHRpb24xLCByYW5kb21PcHRpb24yLCByYW5kb21PcHRpb24zKTtcbn07XG5cbmV4cG9ydCB7IGRlY29tcG9zZSwgY29uZGl0aW9uYWxEZWNvbXBvc2l0aW9uIH07XG4iXSwibmFtZXMiOlsicmFuZG9tRWxlbWVudCIsImFycmF5IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibGVuZ3RoIiwiZ2NkIiwiYSIsImIiLCJfZXVsZXJQaGkiLCJuIiwieCIsImkiLCJfY2FjaGVkUHJpbWVzIiwicHJpbWVTaWV2ZSIsInB1c2giLCJwIiwicmVzUHJpbWVzIiwiX3ByaW1lU2lldmUiLCJfcHJpbWVDb3VudGluZ0Z1bmN0aW9uIiwiZmlsdGVyIiwibnVtYmVyVGhlb3J5RnVuY3Rpb25zIiwibWF0Y2hpbmdQaGlJbnB1dHMiLCJtYXRjaGluZ1BpSW5wdXRzIiwiZnVuY3Rpb25PcHRpb25zIiwibWF0Y2hpbmdJbnB1dCIsImxpbWl0UG9seW5vbWlhbCIsIm0iLCJoaWdoZXN0UG93ZXIiLCJkZW5vbWluYXRvck51bWJlck9mVGVybXMiLCJzaWducyIsIm51bWVyYXRvciIsImRlbm9taW5hdG9yIiwiY29lZiIsInBvd2VyIiwiZXVsZXJzSWRlbnRpdHkiLCJsaW1EaWZmVHdvU3F1YXJlcyIsInIiLCJ0ZXgiLCJzYW1lTnVtYmVyIiwiZG93bmxvYWRCdG4iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZG93bmxvYWRQTkciLCJzdmciLCJxdWVyeVNlbGVjdG9yIiwibnVtYmVyIiwidmFsdWUiLCJ3IiwicGFyc2VJbnQiLCJnZXRBdHRyaWJ1dGUiLCJoIiwiZGF0YSIsIlhNTFNlcmlhbGl6ZXIiLCJzZXJpYWxpemVUb1N0cmluZyIsInN2Z0RhdGFVcmwiLCJidG9hIiwiY2FudmFzIiwiY3JlYXRlRWxlbWVudCIsInNjYWxlRmFjdG9yIiwibWF4Iiwid2lkdGgiLCJoZWlnaHQiLCJjb25zb2xlIiwibG9nIiwiY3R4IiwiZ2V0Q29udGV4dCIsInN2Z0RhdGFJbWFnZSIsIkltYWdlIiwib25sb2FkIiwiZHJhd0ltYWdlIiwidG9CbG9iIiwiYmxvYiIsIkVycm9yIiwiZmlsZW5hbWUiLCJlbGVtIiwid2luZG93IiwiaHJlZiIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsImRvd25sb2FkIiwiY2xpY2siLCJzcmMiLCJjb252ZXJ0Iiwib3B0aW9ucyIsImlzTmFOIiwicG9zc2libGVfb3B0aW9ucyIsImV4cG9uZW50aWFsTGltaXRzIiwibnVtYmVyVGhlb3J5RW5hYmxlZCIsIm51bWJlclRoZW9yeSIsInBvbHlub21pYWxMaW1pdHMiLCJnZW9tZXRyaWNTZXJpZXMiLCJtYXAiLCJmIiwid3JhcHBlZEZ1bmN0aW9uIiwiZmFjIiwiZmFjdG9yaWFscyIsImlzRmFjdG9yaWFsIiwiZ2FtbWFGdW5jdGlvbkVuYWJsZWQiLCJnYW1tYUZ1bmN0aW9uIiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwibG9nMiIsImlzUG93MiIsImNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiIsImlucHV0Iiwib3BlcmF0aW9ucyIsIm1vcmVSYW5kb21PcHRpb25zIiwibnVtIiwicmFuZG9tT3B0aW9uMSIsInJhbmRvbU9wdGlvbjIiLCJyYW5kb21PcHRpb24zIiwicmFuZG9tSW5kZXgiLCJjdXJyZW50SW5kZXgiLCJzaHVmZmxlIiwic2xpY2UiLCJyYW5kb21WYWx1ZSIsInVuaXRUaHJlc2hvbGQiLCJzcXJ0IiwiaXNQcmltZSIsIm9wMSIsIm9wMiIsIm9wMyIsImZhY3RvcnMiLCJnZXRGYWN0b3JzIiwiYyIsImRlY29tcG9zZUFCQyIsImRlY29tcG9zZVNxcnQiLCJpc1NxdWFyZSIsInNxdWFyZVJvb3QiLCJzdW0iLCJvZGRWYWwiLCJkZWNvbXBvc2VTcXVhcmUiLCJpc09kZCIsImNlaWwiLCJkZWNvbXBvc2VEaWZmZXJlbmNlU3F1YXJlcyIsImRlY29tcG9zZU11bERpdmlkZSIsInJhbmROdW0iLCJkZWNvbXBvc2VBZGRNdWx0aXBseSIsImRlY29tcG9zZSIsImRpc3BsYXkiLCJidXR0b24iLCJkaXNhYmxlZCIsIm91dHB1dCIsImlubmVySFRNTCIsIk1hdGhKYXgiLCJ0ZXhSZXNldCIsIm1hdGhKYXhPcHRpb25zIiwiZ2V0TWV0cmljc0ZvciIsImNoZWNrZWQiLCJ0ZXgyc3ZnUHJvbWlzZSIsInRoZW4iLCJub2RlIiwiYXBwZW5kQ2hpbGQiLCJzdGFydHVwIiwiY2xlYXIiLCJ1cGRhdGVEb2N1bWVudCIsInN0eWxlIiwiY2F0Y2giLCJlcnIiLCJjcmVhdGVUZXh0Tm9kZSIsIm1lc3NhZ2UiLCJmb3JtIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwicHJldmVudERlZmF1bHQiXSwic291cmNlUm9vdCI6IiJ9