(()=>{"use strict";const t=t=>t[Math.floor(Math.random()*t.length)],e=t=>{let e,r=t.length;for(;0!=r;)e=Math.floor(Math.random()*r),r--,[t[r],t[e]]=[t[e],t[r]];return t},r=(t,e)=>e?r(e,t%e):t,i=(t,e)=>`\\href{${e}}{\\color{black}{${t}}}`,n=t=>{let e=0;for(let i=1;i<=t;i++)1===r(i,t)&&e++;return e},o=(t=>{const e=[];for(let r=0;r<=t;r++)e.push(!0);e[0]=!1,e[1]=!1;for(let r=2;r*r<=t;r++)if(!0===e[r])for(let i=r*r;i<=t;i+=r)e[i]=!1;let r=[];for(let i=0;i<=t;i++)e[i]&&r.push(i);return r})(999),a=t=>o.filter((e=>e<=t)).length,l=e=>{let r=[],o=[],l=[];for(let t=1;t<=999;t++)n(t)===e&&r.push(t),a(t)===e&&o.push(t);if(r.length>0){let e=t(r);l.push(`${i("\\varphi","https://en.wikipedia.org/wiki/Euler%27s_totient_function")}(${e})`)}if(o.length>0){let e=t(o);l.push(`${i("\\pi","https://en.wikipedia.org/wiki/Prime-counting_function")}(${e})`)}return(0===l.length||Math.random()<.3)&&l.push(`${e}`),t(l)},h=t=>{if(0===t){let t=Math.floor(20*Math.random());return`{${i("\\lim_{x \\to \\infty}","https://en.wikipedia.org/wiki/List_of_limits#Functions_of_the_form_xa")}{${t}x^{-1}}}`}if(1===t)return`{${i("\\lim_{x \\to \\infty}","https://en.wikipedia.org/wiki/List_of_limits#Functions_of_the_form_xg(x)")}{x^{1/x}}}`;{let e=Math.floor(5*Math.random())+1,r=Math.floor(3*Math.random())+2,i=r-1,n=["-","+"],o=`${e*t}x^{${r}} `,a=`${e}x^{${r}} `;for(let t=r-1;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;o+=`${n[Math.floor(2*Math.random())]} ${e}x${r} `}for(let t=i;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;a+=`${n[Math.floor(2*Math.random())]} ${e}x${r} `}return`{ \\lim_{x \\to \\infty} { \\frac{${o}}{${a}}} }`}},m=t=>{const e="https://en.wikipedia.org/wiki/Euler%27s_identity";return 0!==t?`{-${t}${i("e^{\\pi i}",e)}}`:`{(${i("e^{\\pi i}",e)} + 1)}`},s=t=>{let e=Math.floor(10*Math.random())+1;if(Math.random()<.5)var r=`\\lim_{x \\to ${t-e}} \\frac{x^2 - ${e**2}}{x - ${e}}`;else r=`\\lim_{x \\to ${t+e}} \\frac{x^2 - ${e**2}}{x + ${e}}`;return`{${r}}`},u=t=>`${t}`,d=(t,e)=>{let r=(t=>{let e=[];for(let r=0;r<=t;r++)t%r==0&&e.push(r);return e})(t),i=r[Math.floor(Math.random()*r.length)],n=t/i,o=Math.floor(30*Math.random())+1;return Math.random()<.2?`{{\\left({${e[0](i)}}\\right)}{\\left({${e[1](n)}}\\right)}}`:`{ \\left({${e[0](i)} - ${e[1](o)}}\\right) \\left({${e[2](n)} + ${e[3](o)}}\\right) + {${e[3](o)}}{\\left({${e[3](n)} - ${e[3](i)} + ${e[3](o)}} \\right)} }`},c=(t,e)=>{let r=t**2;return`{\\sqrt{${e[0](r)}}}`},f=(t,e)=>{let r=Math.sqrt(t),i=`${e[0](1)}`,n=1;if(Math.random()<.2){for(let t=0;t<r-1;t++)n+=2,i+=`+ ${e[3](n)}`;return i=`{ ${i} }`,i}{let t=Math.floor(Math.random()*r-1)+1,i=r-t;return Math.random()<.5?`{ {\\left(${e[0](t)} + ${e[0](i)}\\right)}^2}`:`{ {\\left(${e[0](t)}\\right)}^2 + {${e[3](2)}}{\\left(${e[1](t)}\\right)}{\\left(${e[2](i)}\\right)} + {\\left(${e[3](i)}\\right)}^2}`}},$=(t,e)=>{let r=Math.floor(t/2),i=Math.ceil(t/2);return Math.ceil(t/2)**2<100&&Math.random()<.7?`{${e[0](i**2)} - ${e[0](r**2)}}`:`{ \\left({${e[0](i)}}\\right)^2 -  \\left({${e[1](r)}}\\right)^2}`},p=(t,e)=>{let r=Math.floor(Math.random()*t+1)+1,i=t%r,n=Math.floor(t/r);return`${e[0](n)} \\times {${e[1](r)}} + ${e[2](i)}`},g=(t,e)=>{let r=Math.floor(5*Math.random())+1;return`\\frac{${e[0](t*r)}} {${e[1](r)}}`};let _=document.getElementById("download-img");const M=()=>{var t=document.querySelector("svg"),e=document.getElementById("input").value;let r=parseInt(t.getAttribute("width")),i=parseInt(t.getAttribute("height"));const n=(new XMLSerializer).serializeToString(t),o=`data:image/svg+xml;base64,${btoa(n)}`,a=document.createElement("canvas");let l=Math.max(2,800/i);a.width=r*l,a.height=i*l,console.log({w:a.width,h:a.height});const h=a.getContext("2d"),m=new Image;m.onload=()=>{h.drawImage(m,0,0,a.width,a.height),a.toBlob((t=>{if(null===t)throw new Error("Failed to serialize canvas to blob");((t,e)=>{const r=window.document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t,r.click()})(`complicated-expression-that-equals-${e}`,t)}))},m.src=o},x=(t,r)=>{if(isNaN(t)||t>1e3||t<0)return;let n=[];r.eulersIdentity&&n.push(m),r.exponentialLimits&&(n.push((t=>((t,e)=>{const r="https://en.wikipedia.org/wiki/List_of_limits#Natural_logarithms";if(0===t)return`{${i("\\lim_{x \\to \\infty}",r)}{ \\frac{\\ln(x)}{x} }}`;if(1===t)return`{${i("\\lim_{x \\to 1}",r)}  {\\frac{\\ln(x)}{x - 1}}}`;{let n=e?l(t):t;return`{${i("\\lim_{x \\to 0}",r)}{ \\frac{-\\ln(1 + ${n}(e^{-x} - 1))}{x} }}`}})(t,r.numberTheory))),n.push((t=>((t,e)=>{const r="https://en.wikipedia.org/wiki/List_of_limits#Sums,_products_and_composites";if(0===t)return`{${i("\\lim_{x \\to \\infty}",r)}{xe^{-x}}}`;if(1===t)return`{${i("\\lim_{x \\to 0}",r)}{ \\frac{e^x - 1}{x} }}`;{let n=e?l(t):t;return`{${i("\\lim_{x \\to 0}",r)}{ \\frac{e^{${n}x} - 1}{x} }}`}})(t,r.numberTheory)))),r.polynomialLimits&&(n.push(s),n.push(h)),r.geometricSeries&&n.push((t=>((t,e)=>{if(0===t){let t="https://en.wikipedia.org/wiki/List_of_mathematical_series#Trigonometric_functions",e=Math.floor(10*Math.random())+3;return`{${i("\\sum",t)}\\limits_{k=0}^{${e-1}} {\\sin \\left({ \\frac{2 \\pi k}{${e}} } \\right)}}`}return 1===t?`{${i("\\lim_{\\epsilon \\to 0}","https://en.wikipedia.org/wiki/Particular_values_of_the_Riemann_zeta_function#The_Riemann_zeta_function_at_0_and_1")}{ \\epsilon \\zeta(1 + \\epsilon) }}`:`{\\sum\\limits_{k=0}^\\infty {\\left({\\frac{${e?l(t-1):t-1}}{${e?l(t):t}}}\\right)^{k}}}`})(t,r.numberTheory))),n=n.map((t=>((t,e)=>r=>{if(Math.random()<=.5){const t=(t=>{const e={2:2,6:3,24:4,120:5,720:6};return t in e&&e[t]})(r);if(t)return((t,e)=>Math.random()<.5&&e?`{${i("\\Gamma","https://en.wikipedia.org/wiki/Gamma_function")} (${t+1})}`:`{\\prod_{k=1}^{${t}} k}`)(t,e.gammaFunction);if((t=>t>=2&&Number.isInteger(Math.log2(t)))(r))return((t,e)=>{let r=e?l(t):t;return`{${i("\\sum","https://en.wikipedia.org/wiki/List_of_mathematical_series#Binomial_coefficients_2")}_{k=0}^{${r}} {${t} \\choose k}}`})(Math.log2(r),e.numberTheory)}return t(r)})(t,r)));let o=((t,r)=>{let i=r;for(;i.length<4;)i.push(u);i=e(i).slice(0,4);const n=[];return 0!==t&&t<100&&(2===t||!(t=>{if(t<=1||t%2==0&&t>2)return!1;for(let e=3;e<=Math.sqrt(t);e+=2)if(t%e==0)return!1;return!0})(t))&&n.push(d),t<10&&n.push(c),t>1&&(t=>Number.isInteger(Math.sqrt(t)))(t)&&t<100&&n.push(f),(t=>t%2!=0)(t)&&n.push($),t<=200&&n.push(g),n.push(p),e(n)[0](t,i)})(t,n);var a=document.getElementById("display"),_=document.getElementById("render");_.disabled=a.disabled=!0;let M=document.getElementById("download-img"),x=document.getElementById("output");x.innerHTML="",MathJax.texReset();var k=MathJax.getMetricsFor(x);k.display=a.checked,MathJax.tex2svgPromise(o,k).then((function(t){x.appendChild(t),MathJax.startup.document.clear(),MathJax.startup.document.updateDocument(),M.style.display="block"})).catch((function(t){x.appendChild(document.createElement("pre")).appendChild(document.createTextNode(t.message))})).then((function(){_.disabled=a.disabled=!1}))};(()=>{const t=document.getElementById("form"),e=document.getElementById("input"),r=document.getElementById("gamma-function"),i=document.getElementById("eulers-identity"),n=document.getElementById("limits-exponential"),o=document.getElementById("limits-polynomial"),a=document.getElementById("number-theory"),l=document.getElementById("geometric-series");t.addEventListener("submit",(t=>{t.preventDefault(),x(parseInt(e.value),{gammaFunction:r.checked,eulersIdentity:i.checked,exponentialLimits:n.checked,polynomialLimits:o.checked,numberTheory:a.checked,geometricSeries:l.checked})})),_.addEventListener("click",M)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwibWFwcGluZ3MiOiJtQkFXQSxNQUFNQSxFQUFvQkMsR0FDZkEsRUFBTUMsS0FBS0MsTUFBTUQsS0FBS0UsU0FBV0gsRUFBTUksU0FHNUNDLEVBQWNMLElBQ2hCLElBQ0lNLEVBREFDLEVBQWVQLEVBQU1JLE9BSXpCLEtBQXVCLEdBQWhCRyxHQUVIRCxFQUFjTCxLQUFLQyxNQUFNRCxLQUFLRSxTQUFXSSxHQUN6Q0EsS0FHQ1AsRUFBTU8sR0FBZVAsRUFBTU0sSUFBZ0IsQ0FBQ04sRUFBTU0sR0FBY04sRUFBTU8sSUFHM0UsT0FBT1AsQ0FBSyxFQTZDVlEsRUFBTSxDQUFDQyxFQUFXQyxJQUNmQSxFQUlFRixFQUFJRSxFQUFHRCxFQUFJQyxHQUhQRCxFQU1URSxFQUFPLENBQUNDLEVBQVdDLElBQ2QsVUFBVUEscUJBQXVCRCxNQzNFdENFLEVBQWFDLElBQ2YsSUFBSUMsRUFBSSxFQUVSLElBQUssSUFBSUMsRUFBSSxFQUFHQSxHQUFLRixFQUFHRSxJQUNGLElBQWRULEVBQUlTLEVBQUdGLElBQ1BDLElBSVIsT0FBT0EsQ0FBQyxFQTRCTkUsRUF6QmMsQ0FBQ0gsSUFDakIsTUFBTUksRUFBYSxHQUNuQixJQUFLLElBQUlGLEVBQUksRUFBR0EsR0FBS0YsRUFBR0UsSUFDcEJFLEVBQVdDLE1BQUssR0FFcEJELEVBQVcsSUFBSyxFQUNoQkEsRUFBVyxJQUFLLEVBRWhCLElBQUssSUFBSUUsRUFBSSxFQUFHQSxFQUFJQSxHQUFLTixFQUFHTSxJQUN4QixJQUFzQixJQUFsQkYsRUFBV0UsR0FDWCxJQUFLLElBQUlKLEVBQUlJLEVBQUlBLEVBQUdKLEdBQUtGLEVBQUdFLEdBQUtJLEVBQzdCRixFQUFXRixJQUFLLEVBSzVCLElBQUlLLEVBQVksR0FDaEIsSUFBSyxJQUFJTCxFQUFJLEVBQUdBLEdBQUtGLEVBQUdFLElBQ2hCRSxFQUFXRixJQUNYSyxFQUFVRixLQUFLSCxHQUd2QixPQUFPSyxDQUFTLEVBR0VDLENBQVksS0FFNUJDLEVBQTBCVCxHQUNyQkcsRUFBY08sUUFBT1QsR0FBS0EsR0FBS0QsSUFBR1gsT0FHdkNzQixFQUF5QlgsSUFDM0IsSUFBSVksRUFBb0IsR0FDcEJDLEVBQW1CLEdBQ25CQyxFQUFrQixHQUV0QixJQUFLLElBQUlaLEVBQUksRUFBR0EsR0FBSyxJQUFLQSxJQUNsQkgsRUFBVUcsS0FBT0YsR0FDakJZLEVBQWtCUCxLQUFLSCxHQUd2Qk8sRUFBdUJQLEtBQU9GLEdBQzlCYSxFQUFpQlIsS0FBS0gsR0FJOUIsR0FBSVUsRUFBa0J2QixPQUFTLEVBQUcsQ0FDOUIsSUFBSTBCLEVBQWdCL0IsRUFBYzRCLEdBRWxDRSxFQUFnQlQsS0FDWixHQUFHVCxFQUNDLFdBQ0EsK0RBQ0NtQixLLENBSWIsR0FBSUYsRUFBaUJ4QixPQUFTLEVBQUcsQ0FDN0IsSUFBSTBCLEVBQWdCL0IsRUFBYzZCLEdBQ2xDQyxFQUFnQlQsS0FDWixHQUFHVCxFQUNDLE9BQ0EsNERBQ0NtQixLLENBUWIsT0FKK0IsSUFBM0JELEVBQWdCekIsUUFBZ0JILEtBQUtFLFNBQVcsS0FDaEQwQixFQUFnQlQsS0FBSyxHQUFHTCxLQUdyQmhCLEVBQWM4QixFQUFnQixFQW1EbkNFLEVBQW1CaEIsSUFFckIsR0FBVSxJQUFOQSxFQUFTLENBQ1QsSUFBSWlCLEVBQUkvQixLQUFLQyxNQUFzQixHQUFoQkQsS0FBS0UsVUFDeEIsTUFBTyxJQUFJUSxFQUFLLHlCQUhSLDRFQUcwQ3FCLFcsQ0FDL0MsR0FBVSxJQUFOakIsRUFFUCxNQUFPLElBQUlKLEVBQUsseUJBREgsd0ZBRVYsQ0FLSCxJQUFJc0IsRUFBSWhDLEtBQUtDLE1BQXNCLEVBQWhCRCxLQUFLRSxVQUFnQixFQUVwQytCLEVBQWVqQyxLQUFLQyxNQUFzQixFQUFoQkQsS0FBS0UsVUFBZ0IsRUFHL0NnQyxFQUEyQkQsRUFBZSxFQUUxQ0UsRUFBUSxDQUFDLElBQUssS0FDZEMsRUFBWSxHQUFHSixFQUFJbEIsT0FBT21CLE1BQzFCSSxFQUFjLEdBQUdMLE9BQU9DLE1BSTVCLElBQUssSUFBSWpCLEVBVG9CaUIsRUFBZSxFQVNQakIsRUFBSSxFQUFHQSxJQUFLLENBQzdDLElBQUlzQixFQUFPdEMsS0FBS0MsTUFBc0IsR0FBaEJELEtBQUtFLFVBQWlCLEVBRXhDcUMsRUFBUXZCLEVBQUksRUFBSSxHQUFLLEtBQUtBLEtBRzlCb0IsR0FBYSxHQUZGRCxFQUFNbkMsS0FBS0MsTUFBc0IsRUFBaEJELEtBQUtFLGNBRVRvQyxLQUFRQyxJLENBSXBDLElBQUssSUFBSXZCLEVBQUlrQixFQUEwQmxCLEVBQUksRUFBR0EsSUFBSyxDQUMvQyxJQUFJc0IsRUFBT3RDLEtBQUtDLE1BQXNCLEdBQWhCRCxLQUFLRSxVQUFpQixFQUV4Q3FDLEVBQVF2QixFQUFJLEVBQUksR0FBSyxLQUFLQSxLQUc5QnFCLEdBQWUsR0FGSkYsRUFBTW5DLEtBQUtDLE1BQXNCLEVBQWhCRCxLQUFLRSxjQUVQb0MsS0FBUUMsSSxDQUd0QyxNQUFPLHFDQUFxQ0gsTUFBY0MsTyxHQUs1REcsRUFBa0IxQixJQUdwQixNQUFNRixFQUFNLG1EQUVaLE9BQVUsSUFBTkUsRUFDTyxLQUFLQSxJQUFJSixFQUFLLGFBQWNFLE1BRTVCLEtBQUtGLEVBQUssYUFBY0UsVSxFQXdDakM2QixFQUFxQjNCLElBQ3ZCLElBQUlpQixFQUFJL0IsS0FBS0MsTUFBc0IsR0FBaEJELEtBQUtFLFVBQWlCLEVBQ3pDLEdBQUlGLEtBQUtFLFNBQVcsR0FDaEIsSUFBSXdDLEVBQU0saUJBQWlCNUIsRUFBSWlCLG1CQUFtQkEsR0FBSyxVQUFVQSxVQUU3RFcsRUFBTSxpQkFBaUI1QixFQUFJaUIsbUJBQW1CQSxHQUFLLFVBQVVBLEtBRXJFLE1BQU8sSUFBSVcsSUFBTSxFQUdmQyxFQUFjN0IsR0FBYyxHQUFHQSxJQ25PL0I4QixFQUFlLENBQUNDLEVBQWdCQyxLQUNsQyxJQUFJQyxFRnFCVyxDQUFDakMsSUFDaEIsSUFBSWlDLEVBQVUsR0FDZCxJQUFLLElBQUkvQixFQUFJLEVBQUdBLEdBQUtGLEVBQUdFLElBQ2hCRixFQUFJRSxHQUFNLEdBQ1YrQixFQUFRNUIsS0FBS0gsR0FHckIsT0FBTytCLENBQU8sRUU1QkFDLENBQVdILEdBRXJCckMsRUFBSXVDLEVBRFUvQyxLQUFLQyxNQUFNRCxLQUFLRSxTQUFXNkMsRUFBUTVDLFNBRWpETSxFQUFJb0MsRUFBU3JDLEVBQ2J5QyxFQUFJakQsS0FBS0MsTUFBc0IsR0FBaEJELEtBQUtFLFVBQWlCLEVBR3pDLE9BQUlGLEtBQUtFLFNBQVcsR0FDVCxhQUFhNEMsRUFBSSxHQUFHdEMsd0JBQXdCc0MsRUFBSSxHQUFHckMsZ0JBS25ELGFBQWFxQyxFQUFJLEdBQUd0QyxRQUFRc0MsRUFBSSxHQUFHRyx1QkFBdUJILEVBQUksR0FBR3JDLFFBQVFxQyxFQUFJLEdBQ2hGRyxrQkFDYUgsRUFBSSxHQUFHRyxlQUFlSCxFQUFJLEdBQUdyQyxRQUFRcUMsRUFBSSxHQUFHdEMsUUFBUXNDLEVBQUksR0FDckVHLGlCLEVBTU5DLEVBQWdCLENBQUNwQyxFQUFXZ0MsS0FDOUIsSUFBSUssRUFBU3JDLEdBQUssRUFDbEIsTUFBTyxXQUFXZ0MsRUFBSSxHQUFHSyxNQUFXLEVBSWxDQyxFQUFrQixDQUFDdEMsRUFBV2dDLEtBQ2hDLElBQUlPLEVBQWFyRCxLQUFLc0QsS0FBS3hDLEdBQ3ZCeUMsRUFBTSxHQUFHVCxFQUFJLEdBQUcsS0FDaEJVLEVBQVMsRUFFYixHQUFJeEQsS0FBS0UsU0FBVyxHQUFLLENBQ3JCLElBQUssSUFBSWMsRUFBSSxFQUFHQSxFQUFJcUMsRUFBYSxFQUFHckMsSUFDaEN3QyxHQUFVLEVBQ1ZELEdBQU8sS0FBS1QsRUFBSSxHQUFHVSxLQUd2QixPQURBRCxFQUFNLEtBQUtBLE1BQ0pBLEMsQ0FJTixDQUNELElBQUkvQyxFQUFJUixLQUFLQyxNQUFNRCxLQUFLRSxTQUFXbUQsRUFBYSxHQUFLLEVBQ2pENUMsRUFBSTRDLEVBQWE3QyxFQUdyQixPQUFJUixLQUFLRSxTQUFXLEdBQ1QsYUFBYTRDLEVBQUksR0FBR3RDLFFBQVFzQyxFQUFJLEdBQUdyQyxpQkFLbkMsYUFBYXFDLEVBQUksR0FBR3RDLG9CQUFvQnNDLEVBQUksR0FBRyxjQUFjQSxFQUFJLEdBQ3BFdEMsc0JBQ2lCc0MsRUFBSSxHQUFHckMseUJBQXlCcUMsRUFBSSxHQUFHckMsZ0IsR0FNbEVnRCxFQUE2QixDQUFDM0MsRUFBV2dDLEtBQzNDLElBQUl0QyxFQUFJUixLQUFLQyxNQUFNYSxFQUFJLEdBQ25CTCxFQUFJVCxLQUFLMEQsS0FBSzVDLEVBQUksR0FFdEIsT0FBSWQsS0FBSzBELEtBQUs1QyxFQUFJLElBQU0sRUFBSSxLQUFPZCxLQUFLRSxTQUFXLEdBQ3hDLElBQUk0QyxFQUFJLEdBQUdyQyxHQUFLLFFBQVFxQyxFQUFJLEdBQUd0QyxHQUFLLE1BRXBDLGFBQWFzQyxFQUFJLEdBQUdyQyw0QkFBNEJxQyxFQUFJLEdBQUd0QyxnQixFQUtoRW1ELEVBQXVCLENBQUM3QyxFQUFXZ0MsS0FDckMsSUFBSWMsRUFBVTVELEtBQUtDLE1BQU1ELEtBQUtFLFNBQVdZLEVBQUksR0FBSyxFQUM5Q2lCLEVBQUlqQixFQUFJOEMsRUFDUnBELEVBQUlSLEtBQUtDLE1BQU1hLEVBQUk4QyxHQUN2QixNQUFPLEdBQUdkLEVBQUksR0FBR3RDLGVBQWVzQyxFQUFJLEdBQUdjLFNBQWVkLEVBQUksR0FBR2YsSUFBSSxFQUkvRDhCLEVBQXFCLENBQUMvQyxFQUFXZ0MsS0FDbkMsSUFBSWYsRUFBSS9CLEtBQUtDLE1BQXNCLEVBQWhCRCxLQUFLRSxVQUFnQixFQUN4QyxNQUFPLFVBQVU0QyxFQUFJLEdBQUdoQyxFQUFJaUIsUUFBUWUsRUFBSSxHQUFHZixLQUFLLEVDdEdwRCxJQUFJK0IsRUFBaUNDLFNBQVNDLGVBQWUsZ0JBRzdELE1BT01DLEVBQWMsS0FFaEIsSUFBSUMsRUFBTUgsU0FBU0ksY0FBYyxPQUc3QnRCLEVBQTRCa0IsU0FBU0MsZUFBZSxTQUFVSSxNQUdsRSxJQUFJQyxFQUFJQyxTQUFTSixFQUFJSyxhQUFhLFVBQzlCQyxFQUFJRixTQUFTSixFQUFJSyxhQUFhLFdBR2xDLE1BQU1FLEdBQU8sSUFBSUMsZUFBZ0JDLGtCQUFrQlQsR0FFN0NVLEVBQWEsNkJBQTZCQyxLQUFLSixLQUUvQ0ssRUFBU2YsU0FBU2dCLGNBQWMsVUFFdEMsSUFBSUMsRUFBY2hGLEtBQUtpRixJQUFJLEVBQUcsSUFBTVQsR0FDcENNLEVBQU9JLE1BQVFiLEVBQUlXLEVBQ25CRixFQUFPSyxPQUFTWCxFQUFJUSxFQUVwQkksUUFBUUMsSUFBSSxDQUFFaEIsRUFBR1MsRUFBT0ksTUFBT1YsRUFBR00sRUFBT0ssU0FDekMsTUFBTUcsRUFBTVIsRUFBT1MsV0FBVyxNQUV4QkMsRUFBZSxJQUFJQyxNQUN6QkQsRUFBYUUsT0FBUyxLQUNsQkosRUFBSUssVUFBVUgsRUFBYyxFQUFHLEVBQUdWLEVBQU9JLE1BQU9KLEVBQU9LLFFBRXZETCxFQUFPYyxRQUFPQyxJQUNWLEdBQWEsT0FBVEEsRUFDQSxNQUFNLElBQUlDLE1BQU0sc0NBdENmLEVBQUNDLEVBQWtCRixLQUNoQyxNQUFNRyxFQUFPQyxPQUFPbEMsU0FBU2dCLGNBQWMsS0FDM0NpQixFQUFLdEYsS0FBT3VGLE9BQU9DLElBQUlDLGdCQUFnQk4sR0FDdkNHLEVBQUtJLFNBQVdMLEVBQ2hCQyxFQUFLSyxPQUFPLEVBb0NKRCxDQUFTLHNDQUFzQ3ZELElBQVVnRCxFQUFLLEdBQ2hFLEVBR05MLEVBQWFjLElBQU0xQixDQUFVLEVDOUMzQjJCLEVBQVUsQ0FBQzFELEVBQWdCMkQsS0FFN0IsR0FBSUMsTUFBTTVELElBQVdBLEVBQVMsS0FBUUEsRUFBUyxFQUMzQyxPQU9KLElBQUk2RCxFQUFnQyxHQUVoQ0YsRUFBUWhFLGdCQUNSa0UsRUFBaUJ2RixLQUFLLEdBRXRCcUYsRUFBUUcsb0JBQ1JELEVBQWlCdkYsTUFBS0wsR0gyRk4sRUFBQ0EsRUFBVzhGLEtBQ2hDLE1BQU1oRyxFQUFNLGtFQUVaLEdBQVUsSUFBTkUsRUFDQSxNQUFPLElBQUlKLEVBQUsseUJBQTBCRSw0QkFDdkMsR0FBVSxJQUFORSxFQUNQLE1BQU8sSUFBSUosRUFBSyxtQkFBb0JFLGdDQUNqQyxDQUNILElBQUlHLEVBQUk2RixFQUFzQm5GLEVBQXNCWCxHQUFLQSxFQUN6RCxNQUFPLElBQUlKLEVBQUssbUJBQW9CRSx3QkFBMEJHLHVCLEdHcEduQyxDQUFnQ0QsRUFBRzBGLEVBQVFLLGdCQUN0RUgsRUFBaUJ2RixNQUFLTCxHSHdHTCxFQUFDQSxFQUFXOEYsS0FDakMsTUFBTWhHLEVBQU0sNkVBRVosR0FBVSxJQUFORSxFQUNBLE1BQU8sSUFBSUosRUFBSyx5QkFBMEJFLGVBQ3ZDLEdBQVUsSUFBTkUsRUFDUCxNQUFPLElBQUlKLEVBQUssbUJBQW9CRSw0QkFDakMsQ0FDSCxJQUFJRyxFQUFJNkYsRUFBc0JuRixFQUFzQlgsR0FBS0EsRUFDekQsTUFBTyxJQUFJSixFQUFLLG1CQUFvQkUsaUJBQW1CRyxnQixHR2pINUIsQ0FBaUNELEVBQUcwRixFQUFRSyxpQkFFdkVMLEVBQVFNLG1CQUNSSixFQUFpQnZGLEtBQUssR0FDdEJ1RixFQUFpQnZGLEtBQUssSUFHdEJxRixFQUFRTyxpQkFDUkwsRUFBaUJ2RixNQUFLTCxHSDZLRSxFQUFDQSxFQUFXOEYsS0FDeEMsR0FBVSxJQUFOOUYsRUFBUyxDQUNULElBQUlGLEVBQ0Esb0ZBQ0FtQixFQUFJL0IsS0FBS0MsTUFBc0IsR0FBaEJELEtBQUtFLFVBQWlCLEVBQ3pDLE1BQU8sSUFBSVEsRUFBSyxRQUFTRSxxQkFBdUJtQixFQUM1Qyx1Q0FBdUNBLGlCLENBSTFDLE9BQVUsSUFBTmpCLEVBSUUsSUFBSUosRUFBSywyQkFGWiwySkFRRyxnREFGRWtHLEVBQXNCbkYsRUFBc0JYLEVBQUksR0FBS0EsRUFBSSxNQUN6RDhGLEVBQXNCbkYsRUFBc0JYLEdBQUtBLG1CLEVHL0x0RCxDQUF3Q0EsRUFBRzBGLEVBQVFLLGdCQUszREgsRUFBbUJBLEVBQWlCTSxLQUFJQyxHRjBFWCxFQUM3QkMsRUFDQVYsSUFFUTFGLElBQ0osR0FBSWQsS0FBS0UsVUFBWSxHQUFLLENBRXRCLE1BQU1pSCxFRi9ERSxDQUFDckcsSUFDakIsTUFBTXNHLEVBQXdDLENBQzFDLEVBQUcsRUFDSCxFQUFHLEVBQ0gsR0FBSSxFQUNKLElBQUssRUFDTCxJQUFLLEdBR1QsT0FBSXRHLEtBQUtzRyxHQUNFQSxFQUFXdEcsRSxFRXFERnVHLENBQVl2RyxHQUN4QixHQUFJcUcsRUFFQSxNRDVCRSxFQUFDckcsRUFBV3dHLElBQ3RCdEgsS0FBS0UsU0FBVyxJQUFPb0gsRUFFaEIsSUFBSTVHLEVBQUssVUFBVyxvREFBb0RJLEVBQUksTUFHNUUsa0JBQWtCQSxRQ3NCVixDQUEwQnFHLEVBQUtYLEVBQVFlLGVBR2xELEdGckRHLENBQUN6RyxHQUFjQSxHQUFLLEdBQUswRyxPQUFPQyxVQUFVekgsS0FBSzBILEtBQUs1RyxJRXFEbkQ2RyxDQUFPN0csR0FDUCxNRHJCRyxFQUFDQSxFQUFXOEYsS0FDM0IsSUFBSTdGLEVBQUk2RixFQUFzQm5GLEVBQXNCWCxHQUFLQSxFQUN6RCxNQUFPLElBQUlKLEVBQ1AsUUFDQSwrRkFDUUssT0FBT0QsZ0JBQWdCLEVDZ0JoQixDQUEyQmQsS0FBSzBILEtBQUs1RyxHQUFJMEYsRUFBUUssYSxDQUloRSxPQUFPSyxFQUFnQnBHLEVBQUUsRUUzRmxCOEcsQ0FBeUJYLEVBQUdULEtBR3ZDLElBQUlxQixFRjZGVSxFQUFDL0csRUFBV2dILEtBQzFCLElBQUlDLEVBQWFELEVBR2pCLEtBQU9DLEVBQVc1SCxPQUFTLEdBQ3ZCNEgsRUFBVzVHLEtBQUssR0FHcEI0RyxFQUFhM0gsRUFBUTJILEdBQVlDLE1BQU0sRUFBRyxHQUUxQyxNQUFNQyxFQUFrQyxHQThCeEMsT0EzQlUsSUFBTm5ILEdBQVdBLEVBQUksTUFBYyxJQUFOQSxJRmhIZixDQUFDQSxJQUNiLEdBQUlBLEdBQUssR0FBTUEsRUFBSSxHQUFLLEdBQUtBLEVBQUksRUFBSSxPQUFPLEVBRTVDLElBQUssSUFBSUUsRUFBSSxFQUFHQSxHQUFLaEIsS0FBS3NELEtBQUt4QyxHQUFJRSxHQUFLLEVBQ3BDLEdBQUlGLEVBQUlFLEdBQU0sRUFBRyxPQUFPLEVBRTVCLE9BQU8sQ0FBSSxFRTBHNEJrSCxDQUFRcEgsS0FDM0NtSCxFQUFlOUcsS0FBS3lCLEdBSXBCOUIsRUFBSSxJQUNKbUgsRUFBZTlHLEtBQUsrQixHQUlwQnBDLEVBQUksR0Y1SEssQ0FBQ0EsR0FBYzBHLE9BQU9DLFVBQVV6SCxLQUFLc0QsS0FBS3hDLElFNEgxQ3FILENBQVNySCxJQUFNQSxFQUFJLEtBQzVCbUgsRUFBZTlHLEtBQUtpQyxHRi9IZCxDQUFDdEMsR0FBY0EsRUFBSSxHQUFNLEVFbUkvQnNILENBQU10SCxJQUNObUgsRUFBZTlHLEtBQUtzQyxHQUlwQjNDLEdBQUssS0FDTG1ILEVBQWU5RyxLQUFLMEMsR0FJeEJvRSxFQUFlOUcsS0FBS3dDLEdBRWJ2RCxFQUFRNkgsR0FBZ0IsR0FBR25ILEVBQUdpSCxFQUFXLEVFcklwQ00sQ0FBVXhGLEVBQVE2RCxHQUc5QixJQUFJNEIsRUFBNEJ2RSxTQUFTQyxlQUFlLFdBQ3BEdUUsRUFBNEJ4RSxTQUFTQyxlQUFlLFVBQ3hEdUUsRUFBT0MsU0FBV0YsRUFBUUUsVUFBVyxFQUNyQyxJQUFJMUUsRUFBaUNDLFNBQVNDLGVBQWUsZ0JBSXpEeUUsRUFBUzFFLFNBQVNDLGVBQWUsVUFDckN5RSxFQUFPQyxVQUFZLEdBTW5CQyxRQUFRQyxXQUNSLElBQUlDLEVBQWlCRixRQUFRRyxjQUFjTCxHQUMzQ0ksRUFBZVAsUUFBVUEsRUFBUVMsUUFDakNKLFFBQVFLLGVBQWVuQixFQUFPZ0IsR0FDekJJLE1BQUssU0FBU0MsR0FJWFQsRUFBT1UsWUFBWUQsR0FDbkJQLFFBQVFTLFFBQVFyRixTQUFTc0YsUUFDekJWLFFBQVFTLFFBQVFyRixTQUFTdUYsaUJBRXpCeEYsRUFBWXlGLE1BQU1qQixRQUFVLE9BQ2hDLElBQ0NrQixPQUFNLFNBQVNDLEdBRVpoQixFQUNLVSxZQUFZcEYsU0FBU2dCLGNBQWMsUUFDbkNvRSxZQUFZcEYsU0FBUzJGLGVBQWVELEVBQUlFLFNBQ2pELElBQ0NWLE1BQUssV0FFRlYsRUFBT0MsU0FBV0YsRUFBUUUsVUFBVyxDQUN6QyxHQUFFLEVBRUcsTUFDVCxNQUFNb0IsRUFBTzdGLFNBQVNDLGVBQWUsUUFDL0JuQixFQUFTa0IsU0FBU0MsZUFBZSxTQUVqQ3VELEVBQWdCeEQsU0FBU0MsZUFBZSxrQkFDeEN4QixFQUFpQnVCLFNBQVNDLGVBQWUsbUJBQ3pDMkMsRUFBb0I1QyxTQUFTQyxlQUFlLHNCQUM1QzhDLEVBQW1CL0MsU0FBU0MsZUFBZSxxQkFDM0M2QyxFQUFlOUMsU0FBU0MsZUFBZSxpQkFDdkMrQyxFQUFrQmhELFNBQVNDLGVBQWUsb0JBRWhENEYsRUFBS0MsaUJBQWlCLFVBQVVDLElBQzVCQSxFQUFNQyxpQkFFTnhELEVBQVFqQyxTQUFTekIsRUFBT3VCLE9BQVEsQ0FDNUJtRCxjQUFlQSxFQUFjd0IsUUFDN0J2RyxlQUFnQkEsRUFBZXVHLFFBQy9CcEMsa0JBQW1CQSxFQUFrQm9DLFFBQ3JDakMsaUJBQWtCQSxFQUFpQmlDLFFBQ25DbEMsYUFBY0EsRUFBYWtDLFFBQzNCaEMsZ0JBQWlCQSxFQUFnQmdDLFNBQ25DLElEaEROakYsRUFBWStGLGlCQUFpQixRQUFTNUYsRUNtRG5CLEVBR3ZCLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy91dGlscy50cyIsIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy9yZXByZXNlbnRhdGlvbnMudHMiLCJ3ZWJwYWNrOi8vbnVtMm1hdGgvLi9zcmMvZGVjb21wb3NpdGlvbnMudHMiLCJ3ZWJwYWNrOi8vbnVtMm1hdGgvLi9zcmMvZG93bmxvYWQtcG5nLnRzIiwid2VicGFjazovL251bTJtYXRoLy4vc3JjL3NjcmlwdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIG9wZXJhdGlvbiA9IChuOiBudW1iZXIpID0+IHN0cmluZztcblxudHlwZSBDb252ZXJ0T3B0aW9ucyA9IHtcbiAgICBnYW1tYUZ1bmN0aW9uOiBib29sZWFuO1xuICAgIGV1bGVyc0lkZW50aXR5OiBib29sZWFuO1xuICAgIGV4cG9uZW50aWFsTGltaXRzOiBib29sZWFuO1xuICAgIHBvbHlub21pYWxMaW1pdHM6IGJvb2xlYW47XG4gICAgbnVtYmVyVGhlb3J5OiBib29sZWFuO1xuICAgIGdlb21ldHJpY1NlcmllczogYm9vbGVhbjtcbn07XG5cbmNvbnN0IHJhbmRvbUVsZW1lbnQgPSA8QT4oYXJyYXk6IEFbXSkgPT4ge1xuICAgIHJldHVybiBhcnJheVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcnJheS5sZW5ndGgpXTtcbn07XG5cbmNvbnN0IHNodWZmbGUgPSA8QT4oYXJyYXk6IEFbXSkgPT4ge1xuICAgIGxldCBjdXJyZW50SW5kZXggPSBhcnJheS5sZW5ndGgsXG4gICAgICAgIHJhbmRvbUluZGV4O1xuXG4gICAgLy8gV2hpbGUgdGhlcmUgcmVtYWluIGVsZW1lbnRzIHRvIHNodWZmbGUuXG4gICAgd2hpbGUgKGN1cnJlbnRJbmRleCAhPSAwKSB7XG4gICAgICAgIC8vIFBpY2sgYSByZW1haW5pbmcgZWxlbWVudC5cbiAgICAgICAgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjdXJyZW50SW5kZXgpO1xuICAgICAgICBjdXJyZW50SW5kZXgtLTtcblxuICAgICAgICAvLyBBbmQgc3dhcCBpdCB3aXRoIHRoZSBjdXJyZW50IGVsZW1lbnQuXG4gICAgICAgIFthcnJheVtjdXJyZW50SW5kZXhdLCBhcnJheVtyYW5kb21JbmRleF1dID0gW2FycmF5W3JhbmRvbUluZGV4XSwgYXJyYXlbY3VycmVudEluZGV4XV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGFycmF5O1xufTtcblxuY29uc3QgaXNPZGQgPSAobjogbnVtYmVyKSA9PiBuICUgMiAhPT0gMDtcblxuY29uc3QgaXNTcXVhcmUgPSAobjogbnVtYmVyKSA9PiBOdW1iZXIuaXNJbnRlZ2VyKE1hdGguc3FydChuKSk7XG5cbmNvbnN0IGlzUHJpbWUgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgaWYgKG4gPD0gMSB8fCAobiAlIDIgPT0gMCAmJiBuID4gMikpIHJldHVybiBmYWxzZTtcblxuICAgIGZvciAobGV0IGkgPSAzOyBpIDw9IE1hdGguc3FydChuKTsgaSArPSAyKSB7XG4gICAgICAgIGlmIChuICUgaSA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5cbmNvbnN0IGdldEZhY3RvcnMgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgbGV0IGZhY3RvcnMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgaWYgKG4gJSBpID09PSAwKSB7XG4gICAgICAgICAgICBmYWN0b3JzLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhY3RvcnM7XG59O1xuXG4vLyBDaGVja2luZyBpZiBhIG51bWJlciBjYW4gYmUgZm9ybWVkIHVzaW5nIGZhY3RvcmlhbFxuY29uc3QgaXNGYWN0b3JpYWwgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgZmFjdG9yaWFsczogeyBba2V5OiBudW1iZXJdOiBudW1iZXIgfSA9IHtcbiAgICAgICAgMjogMixcbiAgICAgICAgNjogMyxcbiAgICAgICAgMjQ6IDQsXG4gICAgICAgIDEyMDogNSxcbiAgICAgICAgNzIwOiA2LFxuICAgIH07XG5cbiAgICBpZiAobiBpbiBmYWN0b3JpYWxzKSB7XG4gICAgICAgIHJldHVybiBmYWN0b3JpYWxzW25dO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59O1xuXG5jb25zdCBpc1BvdzIgPSAobjogbnVtYmVyKSA9PiBuID49IDIgJiYgTnVtYmVyLmlzSW50ZWdlcihNYXRoLmxvZzIobikpO1xuXG5jb25zdCBnY2QgPSAoYTogbnVtYmVyLCBiOiBudW1iZXIpOiBudW1iZXIgPT4ge1xuICAgIGlmICghYikge1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ2NkKGIsIGEgJSBiKTtcbn07XG5cbmNvbnN0IGhyZWYgPSAoczogc3RyaW5nLCB1cmw6IHN0cmluZykgPT4ge1xuICAgIHJldHVybiBgXFxcXGhyZWZ7JHt1cmx9fXtcXFxcY29sb3J7YmxhY2t9eyR7c319fWA7XG59O1xuXG5leHBvcnQge1xuICAgIG9wZXJhdGlvbixcbiAgICBDb252ZXJ0T3B0aW9ucyxcbiAgICByYW5kb21FbGVtZW50LFxuICAgIHNodWZmbGUsXG4gICAgaXNPZGQsXG4gICAgaXNTcXVhcmUsXG4gICAgaXNQcmltZSxcbiAgICBnZXRGYWN0b3JzLFxuICAgIGlzRmFjdG9yaWFsLFxuICAgIGlzUG93MixcbiAgICBnY2QsXG4gICAgaHJlZixcbn07XG4iLCIvKipcbiAqIEV4cGxvaXRzIHRoZSBbU3Ryb25nIGxhdyBvZiBzbWFsbCBudW1iZXJzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TdHJvbmdfbGF3X29mX3NtYWxsX251bWJlcnMpIHRvXG4gKiBmaW5kIHByb3BlcnRpZXMgb2YgdGhlIHNtYWxsZXIgbnVtYmVycyBnaXZlbiBieSB0aGUgZGVjb21wb3NpdGlvbnMsIHN1Y2ggYXMgdGhlIGV1bGVyIHBoaSBhbmQgcHJpbWUgY291bnRpbmcgZnVuY3Rpb25zLFxuICogZmFjdG9yaWFsL2dhbW1hLCBhbmQgbW9yZS5cbiAqL1xuXG5pbXBvcnQgeyBnY2QsIHJhbmRvbUVsZW1lbnQsIGhyZWYgfSBmcm9tICcuL3V0aWxzJztcblxuY29uc3QgX2V1bGVyUGhpID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCB4ID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IG47IGkrKykge1xuICAgICAgICBpZiAoZ2NkKGksIG4pID09PSAxKSB7XG4gICAgICAgICAgICB4Kys7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geDtcbn07XG5cbmNvbnN0IF9wcmltZVNpZXZlID0gKG46IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHByaW1lU2lldmUgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgcHJpbWVTaWV2ZS5wdXNoKHRydWUpO1xuICAgIH1cbiAgICBwcmltZVNpZXZlWzBdID0gZmFsc2U7XG4gICAgcHJpbWVTaWV2ZVsxXSA9IGZhbHNlO1xuXG4gICAgZm9yIChsZXQgcCA9IDI7IHAgKiBwIDw9IG47IHArKykge1xuICAgICAgICBpZiAocHJpbWVTaWV2ZVtwXSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHAgKiBwOyBpIDw9IG47IGkgKz0gcCkge1xuICAgICAgICAgICAgICAgIHByaW1lU2lldmVbaV0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxldCByZXNQcmltZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgaWYgKHByaW1lU2lldmVbaV0pIHtcbiAgICAgICAgICAgIHJlc1ByaW1lcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXNQcmltZXM7XG59O1xuXG5jb25zdCBfY2FjaGVkUHJpbWVzID0gX3ByaW1lU2lldmUoOTk5KTtcblxuY29uc3QgX3ByaW1lQ291bnRpbmdGdW5jdGlvbiA9IChuOiBudW1iZXIpID0+IHtcbiAgICByZXR1cm4gX2NhY2hlZFByaW1lcy5maWx0ZXIoeCA9PiB4IDw9IG4pLmxlbmd0aDtcbn07XG5cbmNvbnN0IG51bWJlclRoZW9yeUZ1bmN0aW9ucyA9IChuOiBudW1iZXIpID0+IHtcbiAgICBsZXQgbWF0Y2hpbmdQaGlJbnB1dHMgPSBbXTtcbiAgICBsZXQgbWF0Y2hpbmdQaUlucHV0cyA9IFtdO1xuICAgIGxldCBmdW5jdGlvbk9wdGlvbnMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDk5OTsgaSsrKSB7XG4gICAgICAgIGlmIChfZXVsZXJQaGkoaSkgPT09IG4pIHtcbiAgICAgICAgICAgIG1hdGNoaW5nUGhpSW5wdXRzLnB1c2goaSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoX3ByaW1lQ291bnRpbmdGdW5jdGlvbihpKSA9PT0gbikge1xuICAgICAgICAgICAgbWF0Y2hpbmdQaUlucHV0cy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1hdGNoaW5nUGhpSW5wdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IG1hdGNoaW5nSW5wdXQgPSByYW5kb21FbGVtZW50KG1hdGNoaW5nUGhpSW5wdXRzKTtcblxuICAgICAgICBmdW5jdGlvbk9wdGlvbnMucHVzaChcbiAgICAgICAgICAgIGAke2hyZWYoXG4gICAgICAgICAgICAgICAgJ1xcXFx2YXJwaGknLFxuICAgICAgICAgICAgICAgICdodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdWxlciUyN3NfdG90aWVudF9mdW5jdGlvbidcbiAgICAgICAgICAgICl9KCR7bWF0Y2hpbmdJbnB1dH0pYFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGlmIChtYXRjaGluZ1BpSW5wdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IG1hdGNoaW5nSW5wdXQgPSByYW5kb21FbGVtZW50KG1hdGNoaW5nUGlJbnB1dHMpO1xuICAgICAgICBmdW5jdGlvbk9wdGlvbnMucHVzaChcbiAgICAgICAgICAgIGAke2hyZWYoXG4gICAgICAgICAgICAgICAgJ1xcXFxwaScsXG4gICAgICAgICAgICAgICAgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1ByaW1lLWNvdW50aW5nX2Z1bmN0aW9uJ1xuICAgICAgICAgICAgKX0oJHttYXRjaGluZ0lucHV0fSlgXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGZ1bmN0aW9uT3B0aW9ucy5sZW5ndGggPT09IDAgfHwgTWF0aC5yYW5kb20oKSA8IDAuMykge1xuICAgICAgICBmdW5jdGlvbk9wdGlvbnMucHVzaChgJHtufWApO1xuICAgIH1cblxuICAgIHJldHVybiByYW5kb21FbGVtZW50KGZ1bmN0aW9uT3B0aW9ucyk7XG59O1xuXG5jb25zdCBmYWN0b3JpYWwgPSAobjogbnVtYmVyLCBnYW1tYUZ1bmN0aW9uRW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC41ICYmIGdhbW1hRnVuY3Rpb25FbmFibGVkKSB7XG4gICAgICAgIC8vIM6TKG4pID0gKG4tMSkhXG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXEdhbW1hJywgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0dhbW1hX2Z1bmN0aW9uJyl9ICgke24gKyAxfSl9YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBVc2luZyB0aGUgcGkgcHJvZHVjdCBub3RhdGlvbiBvZiBmYWN0b3JpYWxcbiAgICAgICAgcmV0dXJuIGB7XFxcXHByb2Rfe2s9MX1eeyR7bn19IGt9YDtcbiAgICB9XG59O1xuXG4vLyByZXByZXNlbnRhdGlvbiBvZiAyXm5cbmNvbnN0IHBvdzJDaG9vc2UgPSAobjogbnVtYmVyLCBudW1iZXJUaGVvcnlFbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgbGV0IHggPSBudW1iZXJUaGVvcnlFbmFibGVkID8gbnVtYmVyVGhlb3J5RnVuY3Rpb25zKG4pIDogbjtcbiAgICByZXR1cm4gYHske2hyZWYoXG4gICAgICAgICdcXFxcc3VtJyxcbiAgICAgICAgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbWF0aGVtYXRpY2FsX3NlcmllcyNCaW5vbWlhbF9jb2VmZmljaWVudHNfMidcbiAgICApfV97az0wfV57JHt4fX0geyR7bn0gXFxcXGNob29zZSBrfX1gO1xufTtcblxuLy8gTGltaXRzIG9mIG5hdHVyYWwgbG9nIGZ1bmN0aW9uczogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjTmF0dXJhbF9sb2dhcml0aG1zXG5jb25zdCBsaW1pdE5hdHVyYWxMb2cgPSAobjogbnVtYmVyLCBudW1iZXJUaGVvcnlFbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI05hdHVyYWxfbG9nYXJpdGhtcyc7XG5cbiAgICBpZiAobiA9PT0gMCkge1xuICAgICAgICByZXR1cm4gYHske2hyZWYoJ1xcXFxsaW1fe3ggXFxcXHRvIFxcXFxpbmZ0eX0nLCB1cmwpfXsgXFxcXGZyYWN7XFxcXGxuKHgpfXt4fSB9fWA7XG4gICAgfSBlbHNlIGlmIChuID09PSAxKSB7XG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXGxpbV97eCBcXFxcdG8gMX0nLCB1cmwpfSAge1xcXFxmcmFje1xcXFxsbih4KX17eCAtIDF9fX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCB4ID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuKSA6IG47XG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXGxpbV97eCBcXFxcdG8gMH0nLCB1cmwpfXsgXFxcXGZyYWN7LVxcXFxsbigxICsgJHt4fShlXnsteH0gLSAxKSl9e3h9IH19YDtcbiAgICB9XG59O1xuXG4vLyBMaW1pdHMgb2YgZXhwb25lbnRpYWwgZnVuY3Rpb25zOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX2xpbWl0cyNTdW1zLF9wcm9kdWN0c19hbmRfY29tcG9zaXRlc1xuY29uc3QgbGltaXRFeHBvbmVudGlhbCA9IChuOiBudW1iZXIsIG51bWJlclRoZW9yeUVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjU3VtcyxfcHJvZHVjdHNfYW5kX2NvbXBvc2l0ZXMnO1xuXG4gICAgaWYgKG4gPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9JywgdXJsKX17eGVeey14fX19YDtcbiAgICB9IGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byAwfScsIHVybCl9eyBcXFxcZnJhY3tlXnggLSAxfXt4fSB9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHggPSBudW1iZXJUaGVvcnlFbmFibGVkID8gbnVtYmVyVGhlb3J5RnVuY3Rpb25zKG4pIDogbjtcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byAwfScsIHVybCl9eyBcXFxcZnJhY3tlXnske3h9eH0gLSAxfXt4fSB9fWA7XG4gICAgfVxufTtcblxuLy8gTGltaXRzIG9mIHBvbHlub21pYWwgZnVuY3Rpb25zXG5jb25zdCBsaW1pdFBvbHlub21pYWwgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgdXJsID0gJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI0Z1bmN0aW9uc19vZl90aGVfZm9ybV94YSc7XG4gICAgaWYgKG4gPT09IDApIHtcbiAgICAgICAgbGV0IHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyMCk7XG4gICAgICAgIHJldHVybiBgeyR7aHJlZignXFxcXGxpbV97eCBcXFxcdG8gXFxcXGluZnR5fScsIHVybCl9eyR7cn14XnstMX19fWA7XG4gICAgfSBlbHNlIGlmIChuID09PSAxKSB7XG4gICAgICAgIGNvbnN0IHVybDIgPSAnaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjRnVuY3Rpb25zX29mX3RoZV9mb3JtX3hnKHgpJztcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9JywgdXJsMil9e3heezEveH19fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZ2VuZXJhdGUgcmFuZG9tIHBvbHlub21pYWwgbGltaXRzIGxpa2UgbGltIHggLT4g4oieICgyOHheMiAtIDExeCkvKDR4XjIgKyAxMHgpXG4gICAgICAgIC8vIHNpbmNlIHRoZSBoaWdoZXN0IHBvd2VyIHRlcm1zIGRvbWluYXRlIGluIHRoZSBsaW1pdHMsIHRoZSByZXN0IGFyZSBpZ25vcmVkIGFuZCBjYW4gYmUgcmFuZG9tXG5cbiAgICAgICAgLy8gR2V0IHJhbmRvbSBtdWx0aXBsaWVyIGdyZWF0ZXIgdGhhbiAxXG4gICAgICAgIGxldCBtID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNSkgKyAxO1xuICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gaGlnaGVzdCBwb3dlci4gVGhpcyBkZXRlcm1pbmVzIHRoZSBmaW5hbCBzb2x1dGlvbiBvZiB0aGUgbGltaXRcbiAgICAgICAgbGV0IGhpZ2hlc3RQb3dlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMpICsgMjtcblxuICAgICAgICBsZXQgbnVtZXJhdG9yTnVtYmVyT2ZUZXJtcyA9IGhpZ2hlc3RQb3dlciAtIDE7XG4gICAgICAgIGxldCBkZW5vbWluYXRvck51bWJlck9mVGVybXMgPSBoaWdoZXN0UG93ZXIgLSAxO1xuXG4gICAgICAgIGxldCBzaWducyA9IFsnLScsICcrJ107XG4gICAgICAgIGxldCBudW1lcmF0b3IgPSBgJHttICogbn14Xnske2hpZ2hlc3RQb3dlcn19IGA7XG4gICAgICAgIGxldCBkZW5vbWluYXRvciA9IGAke219eF57JHtoaWdoZXN0UG93ZXJ9fSBgO1xuXG4gICAgICAgIC8vIEdlbmVyYXRlIGEgcG9seW5vbWlhbCBudW1lcmF0b3Igd2l0aCByYW5kb20gbGVuZ3RoIGFuZCBjb2VmZmljaWVudHNcbiAgICAgICAgLy9leDogMTV4XjJcbiAgICAgICAgZm9yIChsZXQgaSA9IG51bWVyYXRvck51bWJlck9mVGVybXM7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgIGxldCBjb2VmID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMjtcblxuICAgICAgICAgICAgbGV0IHBvd2VyID0gaSA8IDIgPyAnJyA6IGBeeyR7aX19YDtcbiAgICAgICAgICAgIGxldCBzaWduID0gc2lnbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMildO1xuXG4gICAgICAgICAgICBudW1lcmF0b3IgKz0gYCR7c2lnbn0gJHtjb2VmfXgke3Bvd2VyfSBgO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBwb2x5bm9taWFsIGRlbm9taW5hdG9yIHdpdGggcmFuZG9tIGxlbmd0aCBhbmQgY29lZmZpY2llbnRzXG4gICAgICAgIGZvciAobGV0IGkgPSBkZW5vbWluYXRvck51bWJlck9mVGVybXM7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgIGxldCBjb2VmID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMjtcblxuICAgICAgICAgICAgbGV0IHBvd2VyID0gaSA8IDIgPyAnJyA6IGBeeyR7aX19YDtcbiAgICAgICAgICAgIGxldCBzaWduID0gc2lnbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMildO1xuXG4gICAgICAgICAgICBkZW5vbWluYXRvciArPSBgJHtzaWdufSAke2NvZWZ9eCR7cG93ZXJ9IGA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYHsgXFxcXGxpbV97eCBcXFxcdG8gXFxcXGluZnR5fSB7IFxcXFxmcmFjeyR7bnVtZXJhdG9yfX17JHtkZW5vbWluYXRvcn19fSB9YDtcbiAgICB9XG59O1xuXG4vLyBVc2luZyBldWxlcidzIGlkZW50aXR5LiBUaGF0IGlzLCBlXihwaSppKSA9IC0xXG5jb25zdCBldWxlcnNJZGVudGl0eSA9IChuOiBudW1iZXIpID0+IHtcbiAgICAvLyBlLmcg4oiSNmVeKHBpKmkpPTZcblxuICAgIGNvbnN0IHVybCA9ICdodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdWxlciUyN3NfaWRlbnRpdHknO1xuXG4gICAgaWYgKG4gIT09IDApIHtcbiAgICAgICAgcmV0dXJuIGB7LSR7bn0ke2hyZWYoJ2Vee1xcXFxwaSBpfScsIHVybCl9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGB7KCR7aHJlZignZV57XFxcXHBpIGl9JywgdXJsKX0gKyAxKX1gO1xuICAgIH1cbn07XG5cbi8vIEluZmluaXRlIGdlb21ldHJpYyBzZXJpZXMgdGhhdCBldmFsdWF0ZXMgdG8gYSBmaW5pdGUgdmFsdWVcbmNvbnN0IGluZmluaXRlR2VvbWV0cmljU2VyaWVzID0gKG46IG51bWJlciwgbnVtYmVyVGhlb3J5RW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIGxldCB1cmwgPVxuICAgICAgICAgICAgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbWF0aGVtYXRpY2FsX3NlcmllcyNUcmlnb25vbWV0cmljX2Z1bmN0aW9ucyc7XG4gICAgICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMztcbiAgICAgICAgcmV0dXJuIGB7JHtocmVmKCdcXFxcc3VtJywgdXJsKX1cXFxcbGltaXRzX3trPTB9Xnske3IgLVxuICAgICAgICAgICAgMX19IHtcXFxcc2luIFxcXFxsZWZ0KHsgXFxcXGZyYWN7MiBcXFxccGkga317JHtyfX0gfSBcXFxccmlnaHQpfX1gO1xuICAgIH1cblxuICAgIC8vIFVzaW5nIHRoZSBSaWVtYW5uIHpldGEgZnVuY3Rpb25cbiAgICBlbHNlIGlmIChuID09PSAxKSB7XG4gICAgICAgIGxldCB1cmwgPVxuICAgICAgICAgICAgJ2h0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1BhcnRpY3VsYXJfdmFsdWVzX29mX3RoZV9SaWVtYW5uX3pldGFfZnVuY3Rpb24jVGhlX1JpZW1hbm5femV0YV9mdW5jdGlvbl9hdF8wX2FuZF8xJztcblxuICAgICAgICByZXR1cm4gYHske2hyZWYoJ1xcXFxsaW1fe1xcXFxlcHNpbG9uIFxcXFx0byAwfScsIHVybCl9eyBcXFxcZXBzaWxvbiBcXFxcemV0YSgxICsgXFxcXGVwc2lsb24pIH19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBVc2luZyB0aGUgaW5maW5pdGUgZ2VvbWV0cmljIHNlcmllcyBydWxlOiBXaGVuIOKIkjE8eDwxLCBzdW1tYXRpb24gZnJvbSBpID0gMCB0byBpbmZpbml0eSBvZiByXmkgPSAxLygxLXIpIG9yIChyLTEpL3IuXG4gICAgICAgIC8vIERlY2ltYWwgY2FuIGJlIHJlcHJlc2VudGVkIGFzIGZyYWN0aW9uIHRvby4gZS5nICgwLjI1KV5pID0gKDEvNCleaSA9IDReLWlcbiAgICAgICAgbGV0IHgxID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuIC0gMSkgOiBuIC0gMTtcbiAgICAgICAgbGV0IHgyID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuKSA6IG47XG4gICAgICAgIHJldHVybiBge1xcXFxzdW1cXFxcbGltaXRzX3trPTB9XlxcXFxpbmZ0eSB7XFxcXGxlZnQoe1xcXFxmcmFjeyR7eDF9fXske3gyfX19XFxcXHJpZ2h0KV57a319fWA7XG4gICAgfVxufTtcblxuLy8gVXNpbmcgdGhlIHRyaWcgaWRlbnRpdHkgKGNvc14yKXggKyAoc2luXjIpeCA9IDFcbmNvbnN0IHRyaWdJZGVudGl0eSA9IChleHByZXNzaW9uOiBzdHJpbmcpID0+IHtcbiAgICBsZXQgcmFuZG9tVmFsdWUgPSBNYXRoLnJhbmRvbSgpO1xuICAgIGlmIChyYW5kb21WYWx1ZSA8IDAuMjUpIHtcbiAgICAgICAgcmV0dXJuIGBcXFxcbGVmdChcXFxcZnJhY3ske2V4cHJlc3Npb259fXsoXFxcXGNvc14yeCArIFxcXFxzaW5eMngpfVxcXFxyaWdodClgO1xuICAgIH0gZWxzZSBpZiAocmFuZG9tVmFsdWUgPCAwLjUpIHtcbiAgICAgICAgcmV0dXJuIGBcXFxcbGVmdCh7JHtleHByZXNzaW9ufSBcXFxcdGltZXMgKFxcXFxjb3NeMnggKyBcXFxcc2luXjJ4KX1cXFxccmlnaHQpYDtcbiAgICB9XG59O1xuXG4vKiBVc2luZyB0aGUgZGlmZmVyZW5jZSBvZiB0d28gc3F1YXJlcyBpbiBsaW1pdHMgKi9cbmNvbnN0IGxpbURpZmZUd29TcXVhcmVzID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMTtcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSkge1xuICAgICAgICB2YXIgdGV4ID0gYFxcXFxsaW1fe3ggXFxcXHRvICR7biAtIHJ9fSBcXFxcZnJhY3t4XjIgLSAke3IgKiogMn19e3ggLSAke3J9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHRleCA9IGBcXFxcbGltX3t4IFxcXFx0byAke24gKyByfX0gXFxcXGZyYWN7eF4yIC0gJHtyICoqIDJ9fXt4ICsgJHtyfX1gO1xuICAgIH1cbiAgICByZXR1cm4gYHske3RleH19YDtcbn07XG5cbmNvbnN0IHNhbWVOdW1iZXIgPSAobjogbnVtYmVyKSA9PiBgJHtufWA7XG5cbmV4cG9ydCB7XG4gICAgbnVtYmVyVGhlb3J5RnVuY3Rpb25zLFxuICAgIGZhY3RvcmlhbCxcbiAgICBwb3cyQ2hvb3NlLFxuICAgIGxpbWl0TmF0dXJhbExvZyxcbiAgICBsaW1pdEV4cG9uZW50aWFsLFxuICAgIGxpbWl0UG9seW5vbWlhbCxcbiAgICBldWxlcnNJZGVudGl0eSxcbiAgICBpbmZpbml0ZUdlb21ldHJpY1NlcmllcyxcbiAgICB0cmlnSWRlbnRpdHksXG4gICAgbGltRGlmZlR3b1NxdWFyZXMsXG4gICAgc2FtZU51bWJlcixcbn07XG4iLCIvKipcbiAqIFRoaXMgZmlsZSBjb250YWlucyBkZWNvbXBvc2l0aW9uIGZ1bmN0aW9ucy4gVGhleSBicmVhayBsYXJnZXIgbnVtYmVycyAoMy1kaWdpdCkgaW50byBzbWFsbGVyIG9uZXMgKDItMSBkaWdpdHMpLFxuICogd2hlcmUgdGhlIFtTdHJvbmcgbGF3IG9mIHNtYWxsIG51bWJlcnNdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1N0cm9uZ19sYXdfb2Zfc21hbGxfbnVtYmVycykgY2FuIHRha2Ugb2YgdGhlbVxuICogYXMgdGhleSBoYXZlIG11Y2ggbW9yZSBwcm9wZXJ0aWVzIHRoYW4gbGFyZ2VyIG51bWJlcnMuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBvcGVyYXRpb24sXG4gICAgZ2V0RmFjdG9ycyxcbiAgICBDb252ZXJ0T3B0aW9ucyxcbiAgICBpc0ZhY3RvcmlhbCxcbiAgICBpc1BvdzIsXG4gICAgc2h1ZmZsZSxcbiAgICBpc1ByaW1lLFxuICAgIGlzU3F1YXJlLFxuICAgIGlzT2RkLFxufSBmcm9tICcuL3V0aWxzJztcblxudHlwZSBkZWNvbXBvc2l0aW9uID0gKG46IG51bWJlciwgb3BzOiBvcGVyYXRpb25bXSkgPT4gc3RyaW5nO1xuXG5pbXBvcnQgKiBhcyByZXByZXNlbnRhdGlvbnMgZnJvbSAnLi9yZXByZXNlbnRhdGlvbnMnO1xuXG4vLyBmb3IgbiA9IGFiIGFuZCDiiIBjLCBlaXRoZXIgcmV0dXJuIG4gPSBhYiBvciAoYS1jKShiK2MpICsgYyhiLWErYylcbmNvbnN0IGRlY29tcG9zZUFCQyA9IChudW1iZXI6IG51bWJlciwgb3BzOiBvcGVyYXRpb25bXSkgPT4ge1xuICAgIGxldCBmYWN0b3JzID0gZ2V0RmFjdG9ycyhudW1iZXIpO1xuICAgIGxldCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGZhY3RvcnMubGVuZ3RoKTtcbiAgICBsZXQgYSA9IGZhY3RvcnNbcmFuZG9tSW5kZXhdO1xuICAgIGxldCBiID0gbnVtYmVyIC8gYTtcbiAgICBsZXQgYyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMwKSArIDE7XG5cbiAgICAvLyBhYlxuICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4yKSB7XG4gICAgICAgIHJldHVybiBge3tcXFxcbGVmdCh7JHtvcHNbMF0oYSl9fVxcXFxyaWdodCl9e1xcXFxsZWZ0KHske29wc1sxXShiKX19XFxcXHJpZ2h0KX19YDtcbiAgICB9XG5cbiAgICAvLyAoYSAtIGMpKGIgKyBjKSArIGMgKGIgLSBhICsgYylcbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGB7IFxcXFxsZWZ0KHske29wc1swXShhKX0gLSAke29wc1sxXShjKX19XFxcXHJpZ2h0KSBcXFxcbGVmdCh7JHtvcHNbMl0oYil9ICsgJHtvcHNbM10oXG4gICAgICAgICAgICBjXG4gICAgICAgICl9fVxcXFxyaWdodCkgKyB7JHtvcHNbM10oYyl9fXtcXFxcbGVmdCh7JHtvcHNbM10oYil9IC0gJHtvcHNbM10oYSl9ICsgJHtvcHNbM10oXG4gICAgICAgICAgICBjXG4gICAgICAgICl9fSBcXFxccmlnaHQpfSB9YDtcbiAgICB9XG59O1xuXG4vLyA1ID0gc3FydCgyNSlcbmNvbnN0IGRlY29tcG9zZVNxcnQgPSAobjogbnVtYmVyLCBvcHM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgbGV0IHNxdWFyZSA9IG4gKiogMjtcbiAgICByZXR1cm4gYHtcXFxcc3FydHske29wc1swXShzcXVhcmUpfX19YDtcbn07XG5cbi8vIDI1ID0gMSArIDMgKyA1ICsgNyArIDlcbmNvbnN0IGRlY29tcG9zZVNxdWFyZSA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgc3F1YXJlUm9vdCA9IE1hdGguc3FydChuKTtcbiAgICBsZXQgc3VtID0gYCR7b3BzWzBdKDEpfWA7XG4gICAgbGV0IG9kZFZhbCA9IDE7XG5cbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMikge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNxdWFyZVJvb3QgLSAxOyBpKyspIHtcbiAgICAgICAgICAgIG9kZFZhbCArPSAyO1xuICAgICAgICAgICAgc3VtICs9IGArICR7b3BzWzNdKG9kZFZhbCl9YDtcbiAgICAgICAgfVxuICAgICAgICBzdW0gPSBgeyAke3N1bX0gfWA7XG4gICAgICAgIHJldHVybiBzdW07XG4gICAgfVxuXG4gICAgLy8gKGEgKyBiKV4yID0gYV4yICsgMmFiICsgYl4yXG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBhID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc3F1YXJlUm9vdCAtIDEpICsgMTtcbiAgICAgICAgbGV0IGIgPSBzcXVhcmVSb290IC0gYTtcblxuICAgICAgICAvLyBSZXByZXNlbnRpbmcgKGEgKyBiKV4yXG4gICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC41KSB7XG4gICAgICAgICAgICByZXR1cm4gYHsge1xcXFxsZWZ0KCR7b3BzWzBdKGEpfSArICR7b3BzWzBdKGIpfVxcXFxyaWdodCl9XjJ9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlcHJlc2VudGluZyBhXjIgKyAyYWIgKyBiXjJcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYHsge1xcXFxsZWZ0KCR7b3BzWzBdKGEpfVxcXFxyaWdodCl9XjIgKyB7JHtvcHNbM10oMil9fXtcXFxcbGVmdCgke29wc1sxXShcbiAgICAgICAgICAgICAgICBhXG4gICAgICAgICAgICApfVxcXFxyaWdodCl9e1xcXFxsZWZ0KCR7b3BzWzJdKGIpfVxcXFxyaWdodCl9ICsge1xcXFxsZWZ0KCR7b3BzWzNdKGIpfVxcXFxyaWdodCl9XjJ9YDtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbi8vIDI1ID0gMTNeMiAtIDEyXjJcbmNvbnN0IGRlY29tcG9zZURpZmZlcmVuY2VTcXVhcmVzID0gKG46IG51bWJlciwgb3BzOiBvcGVyYXRpb25bXSkgPT4ge1xuICAgIGxldCBhID0gTWF0aC5mbG9vcihuIC8gMik7XG4gICAgbGV0IGIgPSBNYXRoLmNlaWwobiAvIDIpO1xuXG4gICAgaWYgKE1hdGguY2VpbChuIC8gMikgKiogMiA8IDEwMCAmJiBNYXRoLnJhbmRvbSgpIDwgMC43KSB7XG4gICAgICAgIHJldHVybiBgeyR7b3BzWzBdKGIgKiogMil9IC0gJHtvcHNbMF0oYSAqKiAyKX19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYHsgXFxcXGxlZnQoeyR7b3BzWzBdKGIpfX1cXFxccmlnaHQpXjIgLSAgXFxcXGxlZnQoeyR7b3BzWzFdKGEpfX1cXFxccmlnaHQpXjJ9YDtcbiAgICB9XG59O1xuXG4vLyA3ID0gMiAqIDMgKyAxXG5jb25zdCBkZWNvbXBvc2VBZGRNdWx0aXBseSA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgcmFuZE51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG4gKyAxKSArIDE7XG4gICAgbGV0IHIgPSBuICUgcmFuZE51bTtcbiAgICBsZXQgYSA9IE1hdGguZmxvb3IobiAvIHJhbmROdW0pO1xuICAgIHJldHVybiBgJHtvcHNbMF0oYSl9IFxcXFx0aW1lcyB7JHtvcHNbMV0ocmFuZE51bSl9fSArICR7b3BzWzJdKHIpfWA7XG59O1xuXG4vLyA3ID0gNyo4LzhcbmNvbnN0IGRlY29tcG9zZU11bERpdmlkZSA9IChuOiBudW1iZXIsIG9wczogb3BlcmF0aW9uW10pID0+IHtcbiAgICBsZXQgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDUpICsgMTtcbiAgICByZXR1cm4gYFxcXFxmcmFjeyR7b3BzWzBdKG4gKiByKX19IHske29wc1sxXShyKX19YDtcbn07XG4vKiBlbmQgZGVjb21wb3NlIGZ1bmN0aW9ucyAqL1xuXG5jb25zdCBjb25kaXRpb25hbERlY29tcG9zaXRpb24gPSAoXG4gICAgd3JhcHBlZEZ1bmN0aW9uOiBvcGVyYXRpb24sXG4gICAgb3B0aW9uczogQ29udmVydE9wdGlvbnNcbik6IG9wZXJhdGlvbiA9PiB7XG4gICAgcmV0dXJuIChuOiBudW1iZXIpID0+IHtcbiAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPD0gMC41KSB7XG4gICAgICAgICAgICAvLyBpbnZlcnNlIGZhY3RvcmlhbCBvZiBuLCBzdWNoIHRoYXQgZmFjISA9IG5cbiAgICAgICAgICAgIGNvbnN0IGZhYyA9IGlzRmFjdG9yaWFsKG4pO1xuICAgICAgICAgICAgaWYgKGZhYykge1xuICAgICAgICAgICAgICAgIC8vIGZhY3RvcmlhbChmYWMpID0gZmFjISA9IG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVwcmVzZW50YXRpb25zLmZhY3RvcmlhbChmYWMsIG9wdGlvbnMuZ2FtbWFGdW5jdGlvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc1BvdzIobikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVwcmVzZW50YXRpb25zLnBvdzJDaG9vc2UoTWF0aC5sb2cyKG4pLCBvcHRpb25zLm51bWJlclRoZW9yeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gd3JhcHBlZEZ1bmN0aW9uKG4pO1xuICAgIH07XG59O1xuXG4vLyBCcmVhayBhIG51bWJlciBkb3duIGludG8gc21hbGxlciBudW1iZXJzIHNlcGFyYXRlZCBieSBvcGVyYXRvcnNcbmNvbnN0IGRlY29tcG9zZSA9IChuOiBudW1iZXIsIGF2YWlsYWJsZV9vcGVyYXRpb25zOiBvcGVyYXRpb25bXSkgPT4ge1xuICAgIGxldCBvcGVyYXRpb25zID0gYXZhaWxhYmxlX29wZXJhdGlvbnM7XG5cbiAgICAvLyBwYWQgb3BlcmF0aW9ucyB0byBhdCBsZWFzdCA0IGVsZW1lbnRzXG4gICAgd2hpbGUgKG9wZXJhdGlvbnMubGVuZ3RoIDwgNCkge1xuICAgICAgICBvcGVyYXRpb25zLnB1c2gocmVwcmVzZW50YXRpb25zLnNhbWVOdW1iZXIpO1xuICAgIH1cblxuICAgIG9wZXJhdGlvbnMgPSBzaHVmZmxlKG9wZXJhdGlvbnMpLnNsaWNlKDAsIDQpO1xuXG4gICAgY29uc3QgZGVjb21wb3NpdGlvbnM6IGRlY29tcG9zaXRpb25bXSA9IFtdO1xuXG4gICAgLy8gMS4gYWIgPSAoYSAtIGMpKGIgKyBjKSArIGMgKGIgLSBhICsgYyksIHdoZXJlIGMgaXMgYW55IHJhbmRvbSBwb3NpdGl2ZSBudW1iZXJcbiAgICBpZiAobiAhPT0gMCAmJiBuIDwgMTAwICYmIChuID09PSAyIHx8ICFpc1ByaW1lKG4pKSkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZUFCQyk7XG4gICAgfVxuXG4gICAgLy8gMi4gUmVwcmVzZW50IChzbWFsbCkgbnVtYmVycyB1c2luZyB0aGVpciBzcXVhcmUgYW5kIHNxdWFyZSByb290XG4gICAgaWYgKG4gPCAxMCkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZVNxcnQpO1xuICAgIH1cblxuICAgIC8vIDMuIFRoZSBzdW0gb2YgdGhlIGZpcnN0IG4gb2RkIG51bWJlcnMgaXMgZXF1YWwgdG8gbl4yIGUuZyAxICsgMyArIDUgPSAzXjJcbiAgICBpZiAobiA+IDEgJiYgaXNTcXVhcmUobikgJiYgbiA8IDEwMCkge1xuICAgICAgICBkZWNvbXBvc2l0aW9ucy5wdXNoKGRlY29tcG9zZVNxdWFyZSk7XG4gICAgfVxuXG4gICAgLy8gNC4gVGhlIHN1bSBvZiB0d28gY29uc2VjdXRpdmUgaW50ZWdlcnMgaXMgdGhlIGRpZmZlcmVuY2Ugb2YgdGhlaXIgc3F1YXJlcyBlLmcgMyArIDIgPSAzXjIgLSAyXjJcbiAgICBpZiAoaXNPZGQobikpIHtcbiAgICAgICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VEaWZmZXJlbmNlU3F1YXJlcyk7XG4gICAgfVxuXG4gICAgLy8gNS4gRXhwcmVzcyBhIG51bWJlciB1c2luZyBtdWx0aXBsaWNhdGlvbiBhbmQgYWRkaXRpb24uIEUuZyA0ID0gMSAqIDMgKyAxXG4gICAgaWYgKG4gPD0gMjAwKSB7XG4gICAgICAgIGRlY29tcG9zaXRpb25zLnB1c2goZGVjb21wb3NlTXVsRGl2aWRlKTtcbiAgICB9XG5cbiAgICAvLyA2LiBNdWx0aXBseSBhbmQgZGl2aWRlIGJ5IGEgcmFuZG9tIG51bWJlci4gZS5nIDIgPSAoMio1KS81XG4gICAgZGVjb21wb3NpdGlvbnMucHVzaChkZWNvbXBvc2VBZGRNdWx0aXBseSk7XG5cbiAgICByZXR1cm4gc2h1ZmZsZShkZWNvbXBvc2l0aW9ucylbMF0obiwgb3BlcmF0aW9ucyk7XG59O1xuXG5leHBvcnQgeyBkZWNvbXBvc2UsIGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiB9O1xuIiwiLyoqXG4gKiBDb252ZXJ0cyB0aGUgTWF0aEpheCBTVkcgKFRPRE86IHRoaXMgY29kZSBwcm9kdWNlcyB0aGUgZXJyb3IgaWYgdGhlIE1hdGhKYXggaXMgaHRtbCkgdG8gYSBwbmcsXG4gKiBieSBzZXJpYWxpemluZyB0aGUgc3ZnIGludG8gYSBkYXRhIHVybCBhbmQgZHJhd2luZyB0byB0aGUgY2FudmFzLCB3aGVyZSBpdCBjYW4gdGhhbiBiZSBzZXJpYWxpemVkXG4gKiBpbnRvIGEgcG5nLlxuICovXG5cbmxldCBkb3dubG9hZEJ0biA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQtaW1nJyk7XG5cbi8vIEluaXRpYXRlIGRvd25sb2FkIG9mIGJsb2JcbmNvbnN0IGRvd25sb2FkID0gKGZpbGVuYW1lOiBzdHJpbmcsIGJsb2I6IEJsb2IpID0+IHtcbiAgICBjb25zdCBlbGVtID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBlbGVtLmhyZWYgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICBlbGVtLmRvd25sb2FkID0gZmlsZW5hbWU7XG4gICAgZWxlbS5jbGljaygpO1xufTtcblxuY29uc3QgZG93bmxvYWRQTkcgPSAoKSA9PiB7XG4gICAgLy8gR2V0IHRoZSBzdmcgZnJvbSB0aGUgcGFnZVxuICAgIHZhciBzdmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdzdmcnKSE7XG5cbiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgbnVtYmVyXG4gICAgdmFyIG51bWJlciA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5wdXQnKSkudmFsdWU7XG5cbiAgICAvLyBJbmNyZWFzZSB0aGUgU1ZHJ3Mgd2lkdGggYW5kIGhlaWdodCB0byBwcm9kdWNlIGEgYmlnZ2VyIGltYWdlXG4gICAgbGV0IHcgPSBwYXJzZUludChzdmcuZ2V0QXR0cmlidXRlKCd3aWR0aCcpISk7XG4gICAgbGV0IGggPSBwYXJzZUludChzdmcuZ2V0QXR0cmlidXRlKCdoZWlnaHQnKSEpO1xuXG4gICAgLy8gQ29udmVydCBTVkcgdG8gc3RyaW5nIGRhdGFcbiAgICBjb25zdCBkYXRhID0gbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyhzdmcpO1xuXG4gICAgY29uc3Qgc3ZnRGF0YVVybCA9IGBkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCR7YnRvYShkYXRhKX1gO1xuXG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgLy8gdXBzY2FsZSBoZWlnaHQgdG8gYXQgbGVhc3QgODAwcHhcbiAgICBsZXQgc2NhbGVGYWN0b3IgPSBNYXRoLm1heCgyLCA4MDAgLyBoKTtcbiAgICBjYW52YXMud2lkdGggPSB3ICogc2NhbGVGYWN0b3I7XG4gICAgY2FudmFzLmhlaWdodCA9IGggKiBzY2FsZUZhY3RvcjtcblxuICAgIGNvbnNvbGUubG9nKHsgdzogY2FudmFzLndpZHRoLCBoOiBjYW52YXMuaGVpZ2h0IH0pO1xuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpITtcblxuICAgIGNvbnN0IHN2Z0RhdGFJbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIHN2Z0RhdGFJbWFnZS5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2Uoc3ZnRGF0YUltYWdlLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgICAgIGNhbnZhcy50b0Jsb2IoYmxvYiA9PiB7XG4gICAgICAgICAgICBpZiAoYmxvYiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHNlcmlhbGl6ZSBjYW52YXMgdG8gYmxvYicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZG93bmxvYWQoYGNvbXBsaWNhdGVkLWV4cHJlc3Npb24tdGhhdC1lcXVhbHMtJHtudW1iZXJ9YCwgYmxvYik7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBzdmdEYXRhSW1hZ2Uuc3JjID0gc3ZnRGF0YVVybDtcbn07XG5cbmNvbnN0IG1haW4gPSAoKSA9PiB7XG4gICAgZG93bmxvYWRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBkb3dubG9hZFBORyk7XG59O1xuZXhwb3J0IHsgbWFpbiB9O1xuIiwiZGVjbGFyZSB2YXIgTWF0aEpheDogYW55O1xuXG5pbXBvcnQgKiBhcyByZXByZXNlbnRhdGlvbnMgZnJvbSAnLi9yZXByZXNlbnRhdGlvbnMnO1xuaW1wb3J0IHsgQ29udmVydE9wdGlvbnMsIG9wZXJhdGlvbiB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgZGVjb21wb3NlLCBjb25kaXRpb25hbERlY29tcG9zaXRpb24gfSBmcm9tICcuL2RlY29tcG9zaXRpb25zJztcbmltcG9ydCAqIGFzIGRvd25sb2FkX3BuZyBmcm9tICcuL2Rvd25sb2FkLXBuZyc7XG5cbmNvbnN0IGNvbnZlcnQgPSAobnVtYmVyOiBudW1iZXIsIG9wdGlvbnM6IENvbnZlcnRPcHRpb25zKSA9PiB7XG4gICAgLy8gVmFsaWRhdGluZyBpbnB1dFxuICAgIGlmIChpc05hTihudW1iZXIpIHx8IG51bWJlciA+IDEwMDAgfHwgbnVtYmVyIDwgMCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyogTmVlZCB0byBhZGQgYW5vdGhlciBzbGFzaCB0byBsYXRleCBzdHJpbmdzIHRvIHByZXZlbnQgc2xhc2ggZXNjYXBlICovXG5cbiAgICAvLyBMaXN0IG9mIGZ1bmN0aW9ucyB0aGF0IGdlbmVyYXRlIExhVGVYIG1hdGggZXhwcmVzc2lvbnNcbiAgICAvLyBGdW5jdGlvbnMgYXJlIGNob3NlbiByYW5kb21seVxuICAgIGxldCBwb3NzaWJsZV9vcHRpb25zOiBvcGVyYXRpb25bXSA9IFtdO1xuXG4gICAgaWYgKG9wdGlvbnMuZXVsZXJzSWRlbnRpdHkpIHtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKHJlcHJlc2VudGF0aW9ucy5ldWxlcnNJZGVudGl0eSk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmV4cG9uZW50aWFsTGltaXRzKSB7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChuID0+IHJlcHJlc2VudGF0aW9ucy5saW1pdE5hdHVyYWxMb2cobiwgb3B0aW9ucy5udW1iZXJUaGVvcnkpKTtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKG4gPT4gcmVwcmVzZW50YXRpb25zLmxpbWl0RXhwb25lbnRpYWwobiwgb3B0aW9ucy5udW1iZXJUaGVvcnkpKTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMucG9seW5vbWlhbExpbWl0cykge1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gocmVwcmVzZW50YXRpb25zLmxpbURpZmZUd29TcXVhcmVzKTtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKHJlcHJlc2VudGF0aW9ucy5saW1pdFBvbHlub21pYWwpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLmdlb21ldHJpY1Nlcmllcykge1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gobiA9PlxuICAgICAgICAgICAgcmVwcmVzZW50YXRpb25zLmluZmluaXRlR2VvbWV0cmljU2VyaWVzKG4sIG9wdGlvbnMubnVtYmVyVGhlb3J5KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vIGRlY29yYXRlIGVhY2ggb3BlcmF0aW9uIHdpdGggYSBmdW5jdGlvbiB0aGF0IGNoZWNrcyBpZiB0aGUgaW5wdXQgaXMgb2YgYSBjZXJ0YWluIGZvcm0sIGFuZCBpZiBpdCBpcyBpdCBvdmVycmlkZXMgdGhlIGRlY29yYXRlZCBmdW5jdGlvbidzIHVzdWFsIHJlc3VsdCB3aXRoIGl0J3Mgb3duLlxuICAgIHBvc3NpYmxlX29wdGlvbnMgPSBwb3NzaWJsZV9vcHRpb25zLm1hcChmID0+IHtcbiAgICAgICAgcmV0dXJuIGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbihmLCBvcHRpb25zKTtcbiAgICB9KTtcblxuICAgIGxldCBpbnB1dCA9IGRlY29tcG9zZShudW1iZXIsIHBvc3NpYmxlX29wdGlvbnMpO1xuXG4gICAgLy8gIERpc2FibGUgdGhlIGRpc3BsYXkgYW5kIHJlbmRlciBidXR0b25zIHVudGlsIE1hdGhKYXggaXMgZG9uZVxuICAgIHZhciBkaXNwbGF5ID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpc3BsYXknKTtcbiAgICB2YXIgYnV0dG9uID0gPEhUTUxCdXR0b25FbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZW5kZXInKTtcbiAgICBidXR0b24uZGlzYWJsZWQgPSBkaXNwbGF5LmRpc2FibGVkID0gdHJ1ZTtcbiAgICBsZXQgZG93bmxvYWRCdG4gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rvd25sb2FkLWltZycpO1xuXG4gICAgLy8gIENsZWFyIHRoZSBvbGQgb3V0cHV0XG5cbiAgICBsZXQgb3V0cHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ291dHB1dCcpITtcbiAgICBvdXRwdXQuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAvLyAgUmVzZXQgdGhlIHRleCBsYWJlbHMgKGFuZCBhdXRvbWF0aWMgZXF1YXRpb24gbnVtYmVycywgdGhvdWdoIHRoZXJlIGFyZW4ndCBhbnkgaGVyZSkuXG4gICAgLy8gIEdldCB0aGUgY29udmVyc2lvbiBvcHRpb25zIChtZXRyaWNzIGFuZCBkaXNwbGF5IHNldHRpbmdzKVxuICAgIC8vICBDb252ZXJ0IHRoZSBpbnB1dCB0byBDb21tb25IVE1MIG91dHB1dCBhbmQgdXNlIGEgcHJvbWlzZSB0byB3YWl0IGZvciBpdCB0byBiZSByZWFkeVxuICAgIC8vICAgIChpbiBjYXNlIGFuIGV4dGVuc2lvbiBuZWVkcyB0byBiZSBsb2FkZWQgZHluYW1pY2FsbHkpLlxuICAgIE1hdGhKYXgudGV4UmVzZXQoKTtcbiAgICB2YXIgbWF0aEpheE9wdGlvbnMgPSBNYXRoSmF4LmdldE1ldHJpY3NGb3Iob3V0cHV0KTtcbiAgICBtYXRoSmF4T3B0aW9ucy5kaXNwbGF5ID0gZGlzcGxheS5jaGVja2VkO1xuICAgIE1hdGhKYXgudGV4MnN2Z1Byb21pc2UoaW5wdXQsIG1hdGhKYXhPcHRpb25zKVxuICAgICAgICAudGhlbihmdW5jdGlvbihub2RlOiBhbnkpIHtcbiAgICAgICAgICAgIC8vICBUaGUgcHJvbWlzZSByZXR1cm5zIHRoZSB0eXBlc2V0IG5vZGUsIHdoaWNoIHdlIGFkZCB0byB0aGUgb3V0cHV0XG4gICAgICAgICAgICAvLyAgVGhlbiB1cGRhdGUgdGhlIGRvY3VtZW50IHRvIGluY2x1ZGUgdGhlIGFkanVzdGVkIENTUyBmb3IgdGhlXG4gICAgICAgICAgICAvLyAgICBjb250ZW50IG9mIHRoZSBuZXcgZXF1YXRpb24uXG4gICAgICAgICAgICBvdXRwdXQuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgICAgICAgICBNYXRoSmF4LnN0YXJ0dXAuZG9jdW1lbnQuY2xlYXIoKTtcbiAgICAgICAgICAgIE1hdGhKYXguc3RhcnR1cC5kb2N1bWVudC51cGRhdGVEb2N1bWVudCgpO1xuICAgICAgICAgICAgLy8gRGlzcGxheSBkb3dubG9hZCBidXR0b25cbiAgICAgICAgICAgIGRvd25sb2FkQnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyOiBFcnJvcikge1xuICAgICAgICAgICAgLy8gIElmIHRoZXJlIHdhcyBhbiBlcnJvciwgcHV0IHRoZSBtZXNzYWdlIGludG8gdGhlIG91dHB1dCBpbnN0ZWFkXG4gICAgICAgICAgICBvdXRwdXRcbiAgICAgICAgICAgICAgICAuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncHJlJykpXG4gICAgICAgICAgICAgICAgLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGVyci5tZXNzYWdlKSk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gIEVycm9yIG9yIG5vdCwgcmUtZW5hYmxlIHRoZSBkaXNwbGF5IGFuZCByZW5kZXIgYnV0dG9uc1xuICAgICAgICAgICAgYnV0dG9uLmRpc2FibGVkID0gZGlzcGxheS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB9KTtcbn07XG5jb25zdCBtYWluID0gKCkgPT4ge1xuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9ybScpIGFzIEhUTUxGb3JtRWxlbWVudDtcbiAgICBjb25zdCBudW1iZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuXG4gICAgY29uc3QgZ2FtbWFGdW5jdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1tYS1mdW5jdGlvbicpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgZXVsZXJzSWRlbnRpdHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXVsZXJzLWlkZW50aXR5JykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBleHBvbmVudGlhbExpbWl0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW1pdHMtZXhwb25lbnRpYWwnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IHBvbHlub21pYWxMaW1pdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGltaXRzLXBvbHlub21pYWwnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IG51bWJlclRoZW9yeSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudW1iZXItdGhlb3J5JykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBnZW9tZXRyaWNTZXJpZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VvbWV0cmljLXNlcmllcycpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG5cbiAgICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGV2ZW50ID0+IHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBjb252ZXJ0KHBhcnNlSW50KG51bWJlci52YWx1ZSksIHtcbiAgICAgICAgICAgIGdhbW1hRnVuY3Rpb246IGdhbW1hRnVuY3Rpb24uY2hlY2tlZCxcbiAgICAgICAgICAgIGV1bGVyc0lkZW50aXR5OiBldWxlcnNJZGVudGl0eS5jaGVja2VkLFxuICAgICAgICAgICAgZXhwb25lbnRpYWxMaW1pdHM6IGV4cG9uZW50aWFsTGltaXRzLmNoZWNrZWQsXG4gICAgICAgICAgICBwb2x5bm9taWFsTGltaXRzOiBwb2x5bm9taWFsTGltaXRzLmNoZWNrZWQsXG4gICAgICAgICAgICBudW1iZXJUaGVvcnk6IG51bWJlclRoZW9yeS5jaGVja2VkLFxuICAgICAgICAgICAgZ2VvbWV0cmljU2VyaWVzOiBnZW9tZXRyaWNTZXJpZXMuY2hlY2tlZCxcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkb3dubG9hZF9wbmcubWFpbigpO1xufTtcblxubWFpbigpO1xuIl0sIm5hbWVzIjpbInJhbmRvbUVsZW1lbnQiLCJhcnJheSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsInNodWZmbGUiLCJyYW5kb21JbmRleCIsImN1cnJlbnRJbmRleCIsImdjZCIsImEiLCJiIiwiaHJlZiIsInMiLCJ1cmwiLCJfZXVsZXJQaGkiLCJuIiwieCIsImkiLCJfY2FjaGVkUHJpbWVzIiwicHJpbWVTaWV2ZSIsInB1c2giLCJwIiwicmVzUHJpbWVzIiwiX3ByaW1lU2lldmUiLCJfcHJpbWVDb3VudGluZ0Z1bmN0aW9uIiwiZmlsdGVyIiwibnVtYmVyVGhlb3J5RnVuY3Rpb25zIiwibWF0Y2hpbmdQaGlJbnB1dHMiLCJtYXRjaGluZ1BpSW5wdXRzIiwiZnVuY3Rpb25PcHRpb25zIiwibWF0Y2hpbmdJbnB1dCIsImxpbWl0UG9seW5vbWlhbCIsInIiLCJtIiwiaGlnaGVzdFBvd2VyIiwiZGVub21pbmF0b3JOdW1iZXJPZlRlcm1zIiwic2lnbnMiLCJudW1lcmF0b3IiLCJkZW5vbWluYXRvciIsImNvZWYiLCJwb3dlciIsImV1bGVyc0lkZW50aXR5IiwibGltRGlmZlR3b1NxdWFyZXMiLCJ0ZXgiLCJzYW1lTnVtYmVyIiwiZGVjb21wb3NlQUJDIiwibnVtYmVyIiwib3BzIiwiZmFjdG9ycyIsImdldEZhY3RvcnMiLCJjIiwiZGVjb21wb3NlU3FydCIsInNxdWFyZSIsImRlY29tcG9zZVNxdWFyZSIsInNxdWFyZVJvb3QiLCJzcXJ0Iiwic3VtIiwib2RkVmFsIiwiZGVjb21wb3NlRGlmZmVyZW5jZVNxdWFyZXMiLCJjZWlsIiwiZGVjb21wb3NlQWRkTXVsdGlwbHkiLCJyYW5kTnVtIiwiZGVjb21wb3NlTXVsRGl2aWRlIiwiZG93bmxvYWRCdG4iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZG93bmxvYWRQTkciLCJzdmciLCJxdWVyeVNlbGVjdG9yIiwidmFsdWUiLCJ3IiwicGFyc2VJbnQiLCJnZXRBdHRyaWJ1dGUiLCJoIiwiZGF0YSIsIlhNTFNlcmlhbGl6ZXIiLCJzZXJpYWxpemVUb1N0cmluZyIsInN2Z0RhdGFVcmwiLCJidG9hIiwiY2FudmFzIiwiY3JlYXRlRWxlbWVudCIsInNjYWxlRmFjdG9yIiwibWF4Iiwid2lkdGgiLCJoZWlnaHQiLCJjb25zb2xlIiwibG9nIiwiY3R4IiwiZ2V0Q29udGV4dCIsInN2Z0RhdGFJbWFnZSIsIkltYWdlIiwib25sb2FkIiwiZHJhd0ltYWdlIiwidG9CbG9iIiwiYmxvYiIsIkVycm9yIiwiZmlsZW5hbWUiLCJlbGVtIiwid2luZG93IiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwiZG93bmxvYWQiLCJjbGljayIsInNyYyIsImNvbnZlcnQiLCJvcHRpb25zIiwiaXNOYU4iLCJwb3NzaWJsZV9vcHRpb25zIiwiZXhwb25lbnRpYWxMaW1pdHMiLCJudW1iZXJUaGVvcnlFbmFibGVkIiwibnVtYmVyVGhlb3J5IiwicG9seW5vbWlhbExpbWl0cyIsImdlb21ldHJpY1NlcmllcyIsIm1hcCIsImYiLCJ3cmFwcGVkRnVuY3Rpb24iLCJmYWMiLCJmYWN0b3JpYWxzIiwiaXNGYWN0b3JpYWwiLCJnYW1tYUZ1bmN0aW9uRW5hYmxlZCIsImdhbW1hRnVuY3Rpb24iLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJsb2cyIiwiaXNQb3cyIiwiY29uZGl0aW9uYWxEZWNvbXBvc2l0aW9uIiwiaW5wdXQiLCJhdmFpbGFibGVfb3BlcmF0aW9ucyIsIm9wZXJhdGlvbnMiLCJzbGljZSIsImRlY29tcG9zaXRpb25zIiwiaXNQcmltZSIsImlzU3F1YXJlIiwiaXNPZGQiLCJkZWNvbXBvc2UiLCJkaXNwbGF5IiwiYnV0dG9uIiwiZGlzYWJsZWQiLCJvdXRwdXQiLCJpbm5lckhUTUwiLCJNYXRoSmF4IiwidGV4UmVzZXQiLCJtYXRoSmF4T3B0aW9ucyIsImdldE1ldHJpY3NGb3IiLCJjaGVja2VkIiwidGV4MnN2Z1Byb21pc2UiLCJ0aGVuIiwibm9kZSIsImFwcGVuZENoaWxkIiwic3RhcnR1cCIsImNsZWFyIiwidXBkYXRlRG9jdW1lbnQiLCJzdHlsZSIsImNhdGNoIiwiZXJyIiwiY3JlYXRlVGV4dE5vZGUiLCJtZXNzYWdlIiwiZm9ybSIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInByZXZlbnREZWZhdWx0Il0sInNvdXJjZVJvb3QiOiIifQ==