(()=>{"use strict";const t=t=>t[Math.floor(Math.random()*t.length)],e=(t,r)=>r?e(r,t%r):t,r=t=>{let r=0;for(let n=1;n<=t;n++)1===e(n,t)&&r++;return r},n=(t=>{const e=[];for(let r=0;r<=t;r++)e.push(!0);e[0]=!1,e[1]=!1;for(let r=2;r*r<=t;r++)if(!0===e[r])for(let n=r*r;n<=t;n+=r)e[n]=!1;let r=[];for(let n=0;n<=t;n++)e[n]&&r.push(n);return r})(999),o=t=>n.filter((e=>e<=t)).length,a=e=>{let n=[],a=[],l=[];for(let t=1;t<=999;t++)r(t)===e&&n.push(t),o(t)===e&&a.push(t);if(n.length>0){let e=t(n);l.push(`\\varphi(${e})`)}if(a.length>0){let e=t(a);l.push(`\\pi(${e})`)}return(0===l.length||Math.random()<.3)&&l.push(`${e}`),t(l)},l=t=>{if(0===t)return`{\\lim_{x \\to \\infty}{${Math.floor(20*Math.random())}x^{-1}}}`;if(1===t)return"{\\lim_{x \\to \\infty}{x^{1/x}}}";{let e=Math.floor(5*Math.random())+1,r=Math.floor(3*Math.random())+2,n=r-1,o=["-","+"],a=`${e*t}x^{${r}} `,l=`${e}x^{${r}} `;for(let t=r-1;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;a+=`${o[Math.floor(2*Math.random())]} ${e}x${r} `}for(let t=n;t>0;t--){let e=Math.floor(10*Math.random())+2,r=t<2?"":`^{${t}}`;l+=`${o[Math.floor(2*Math.random())]} ${e}x${r} `}return`{ \\lim_{x \\to \\infty} { \\frac{${a}}{${l}}} }`}},i=t=>0!==t?`{-${t}e^{\\pi i}}`:"{(e^{\\pi i} + 1)}",h=t=>{let e=Math.floor(10*Math.random())+1;if(Math.random()<.5)var r=`\\lim_{x \\to ${t-e}} \\frac{x^2 - ${e**2}}{x - ${e}}`;else r=`\\lim_{x \\to ${t+e}} \\frac{x^2 - ${e**2}}{x + ${e}}`;return`{${r}}`},m=t=>`${t}`;let d=document.getElementById("download-img");const u=()=>{var t=document.querySelector("svg"),e=document.getElementById("input").value;let r=parseInt(t.getAttribute("width")),n=parseInt(t.getAttribute("height"));const o=(new XMLSerializer).serializeToString(t),a=`data:image/svg+xml;base64,${btoa(o)}`,l=document.createElement("canvas");let i=Math.max(2,800/n);l.width=r*i,l.height=n*i,console.log({w:l.width,h:l.height});const h=l.getContext("2d"),m=new Image;m.onload=()=>{h.drawImage(m,0,0,l.width,l.height),l.toBlob((t=>{if(null===t)throw new Error("Failed to serialize canvas to blob");((t,e)=>{const r=window.document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t,r.click()})(`complicated-expression-that-equals-${e}`,t)}))},m.src=a},c=(t,e)=>{if(isNaN(t)||t>1e3||t<0)return;let r=[];e.eulersIdentity&&r.push(i),e.exponentialLimits&&(r.push((t=>((t,e)=>0===t?"{\\lim_{x \\to \\infty}{ \\frac{\\ln(x)}{x} }}":1===t?"{\\lim_{x \\to 1}  {\\frac{\\ln(x)}{x - 1}}}":`{\\lim_{x \\to 0}{ \\frac{-\\ln(1 + ${e?a(t):t}(e^{-x} - 1))}{x} }}`)(t,e.numberTheory))),r.push((t=>((t,e)=>0===t?"{\\lim_{x \\to \\infty}{xe^{-x}}}":1===t?"{\\lim_{x \\to 0}{ \\frac{e^x - 1}{x} }}":`{\\lim_{x \\to 0}{ \\frac{e^{${e?a(t):t}x} - 1}{x} }}`)(t,e.numberTheory)))),e.polynomialLimits&&(r.push(h),r.push(l)),e.geometricSeries&&r.push((t=>((t,e)=>{if(0===t){let t=Math.floor(10*Math.random())+3;return`{\\sum\\limits_{k=0}^{${t-1}} {\\sin \\left({ \\frac{2 \\pi k}{${t}} } \\right)}}`}return 1===t?"{\\lim_{\\epsilon \\to 0}{ \\epsilon \\zeta(1 + \\epsilon) }}":`{\\sum\\limits_{k=0}^\\infty {\\left({\\frac{${e?a(t-1):t-1}}{${e?a(t):t}}}\\right)^{k}}}`})(t,e.numberTheory))),r=r.map((t=>((t,e)=>r=>{if(Math.random()<=.5){const t=(t=>{const e={2:2,6:3,24:4,120:5,720:6};return t in e&&e[t]})(r);if(t)return((t,e)=>Math.random()<.5&&e?`{\\Gamma (${t+1})}`:`{\\prod_{k=1}^{${t}} k}`)(t,e.gammaFunction);if((t=>t>=2&&Number.isInteger(Math.log2(t)))(r))return((t,e)=>`{\\sum_{k=0}^{${e?a(t):t}} {${t} \\choose k}}`)(Math.log2(r),e.numberTheory)}return t(r)})(t,e)));let n=((t,e)=>{let r=t=>e[Math.floor(Math.random()*e.length)](t),n=r,o=r,a=r;0===e.length&&(n=m,o=m,a=m,r=m),e.length>=3&&([n,o,a]=(t=>{let e,r=t.length;for(;0!=r;)e=Math.floor(Math.random()*r),r--,[t[r],t[e]]=[t[e],t[r]];return t})(e).slice(0,3));const l=Math.random(),i=1/6;return l<i&&0!==t&&t<100&&(2===t||!(t=>{if(t<=1||t%2==0&&t>2)return!1;for(let e=3;e<=Math.sqrt(t);e+=2)if(t%e==0)return!1;return!0})(t))?((t,e,r,n,o)=>{let a=(t=>{let e=[];for(let r=0;r<=t;r++)t%r==0&&e.push(r);return e})(t),l=a[Math.floor(Math.random()*a.length)],i=t/l,h=Math.floor(30*Math.random())+1;return Math.random()<.2?`{{\\left({${e(l)}}\\right)}{\\left({${r(i)}}\\right)}}`:`{ \\left({${e(l)} - ${r(h)}}\\right) \\left({${n(i)} + ${o(h)}}\\right) + {${o(h)}}{\\left({${o(i)} - ${o(l)} + ${o(h)}} \\right)} }`})(t,n,o,a,r):l<2*i&&t<10?((t,e)=>`{\\sqrt{${e(t**2)}}}`)(t,n):l<.5&&t>1&&(t=>Number.isInteger(Math.sqrt(t)))(t)?((t,e,r,n,o)=>{let a=Math.sqrt(t),l=`${e(1)}`,i=1;if(Math.random()<.2){for(let t=0;t<a-1;t++)i+=2,l+=`+ ${o(i)}`;return l=`{ ${l} }`,l}{let t=Math.floor(Math.random()*a-1)+1,l=a-t;return Math.random()<.5?`{ {\\left(${e(t)} + ${e(l)}\\right)}^2}`:`{ {\\left(${e(t)}\\right)}^2 + {${o(2)}}{\\left(${r(t)}\\right)}{\\left(${n(l)}\\right)} + {\\left(${o(l)}\\right)}^2}`}})(t,n,o,a,r):l<4*i&&(t=>t%2!=0)(t)&&l<.7?((t,e,r)=>{let n=Math.floor(t/2),o=Math.ceil(t/2);return Math.ceil(t/2)**2<100&&Math.random()<.7?`{${e(o**2)} - ${r(n**2)}}`:`{ \\left({${e(o)}}\\right)^2 -  \\left({${r(n)}}\\right)^2}`})(t,n,o):l<5*i&&t<=200?((t,e,r)=>{let n=Math.floor(5*Math.random())+1;return`\\frac{${e(t*n)}} {${r(n)}}`})(t,n,o):((t,e,r,n)=>{let o=Math.floor(Math.random()*t+1)+1,a=t%o;return`${e(Math.floor(t/o))} \\times {${r(o)}} + ${n(a)}`})(t,n,o,a)})(t,r);var o=document.getElementById("display"),d=document.getElementById("render");d.disabled=o.disabled=!0;let u=document.getElementById("download-img"),c=document.getElementById("output");c.innerHTML="",MathJax.texReset();var s=MathJax.getMetricsFor(c);s.display=o.checked,MathJax.tex2svgPromise(n,s).then((function(t){c.appendChild(t),MathJax.startup.document.clear(),MathJax.startup.document.updateDocument(),u.style.display="block"})).catch((function(t){c.appendChild(document.createElement("pre")).appendChild(document.createTextNode(t.message))})).then((function(){d.disabled=o.disabled=!1}))};(()=>{const t=document.getElementById("form"),e=document.getElementById("input"),r=document.getElementById("gamma-function"),n=document.getElementById("eulers-identity"),o=document.getElementById("limits-exponential"),a=document.getElementById("limits-polynomial"),l=document.getElementById("number-theory"),i=document.getElementById("geometric-series");t.addEventListener("submit",(t=>{t.preventDefault(),c(parseInt(e.value),{gammaFunction:r.checked,eulersIdentity:n.checked,exponentialLimits:o.checked,polynomialLimits:a.checked,numberTheory:l.checked,geometricSeries:i.checked})})),d.addEventListener("click",u)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy91dGlscy50cyIsIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy9yZXByZXNlbnRhdGlvbnMudHMiLCJ3ZWJwYWNrOi8vbnVtMm1hdGgvLi9zcmMvZG93bmxvYWQtcG5nLnRzIiwid2VicGFjazovL251bTJtYXRoLy4vc3JjL3NjcmlwdC50cyIsIndlYnBhY2s6Ly9udW0ybWF0aC8uL3NyYy9kZWNvbXBvc2l0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIG9wZXJhdGlvbiA9IChuOiBudW1iZXIpID0+IHN0cmluZztcblxudHlwZSBDb252ZXJ0T3B0aW9ucyA9IHtcbiAgICBnYW1tYUZ1bmN0aW9uOiBib29sZWFuO1xuICAgIGV1bGVyc0lkZW50aXR5OiBib29sZWFuO1xuICAgIGV4cG9uZW50aWFsTGltaXRzOiBib29sZWFuO1xuICAgIHBvbHlub21pYWxMaW1pdHM6IGJvb2xlYW47XG4gICAgbnVtYmVyVGhlb3J5OiBib29sZWFuO1xuICAgIGdlb21ldHJpY1NlcmllczogYm9vbGVhbjtcbn07XG5cbmNvbnN0IHJhbmRvbUVsZW1lbnQgPSA8QT4oYXJyYXk6IEFbXSkgPT4ge1xuICAgIHJldHVybiBhcnJheVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcnJheS5sZW5ndGgpXTtcbn07XG5cbmNvbnN0IHNodWZmbGUgPSA8QT4oYXJyYXk6IEFbXSkgPT4ge1xuICAgIGxldCBjdXJyZW50SW5kZXggPSBhcnJheS5sZW5ndGgsXG4gICAgICAgIHJhbmRvbUluZGV4O1xuXG4gICAgLy8gV2hpbGUgdGhlcmUgcmVtYWluIGVsZW1lbnRzIHRvIHNodWZmbGUuXG4gICAgd2hpbGUgKGN1cnJlbnRJbmRleCAhPSAwKSB7XG4gICAgICAgIC8vIFBpY2sgYSByZW1haW5pbmcgZWxlbWVudC5cbiAgICAgICAgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjdXJyZW50SW5kZXgpO1xuICAgICAgICBjdXJyZW50SW5kZXgtLTtcblxuICAgICAgICAvLyBBbmQgc3dhcCBpdCB3aXRoIHRoZSBjdXJyZW50IGVsZW1lbnQuXG4gICAgICAgIFthcnJheVtjdXJyZW50SW5kZXhdLCBhcnJheVtyYW5kb21JbmRleF1dID0gW2FycmF5W3JhbmRvbUluZGV4XSwgYXJyYXlbY3VycmVudEluZGV4XV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGFycmF5O1xufTtcblxuY29uc3QgaXNPZGQgPSAobjogbnVtYmVyKSA9PiBuICUgMiAhPT0gMDtcblxuY29uc3QgaXNTcXVhcmUgPSAobjogbnVtYmVyKSA9PiBOdW1iZXIuaXNJbnRlZ2VyKE1hdGguc3FydChuKSk7XG5cbmNvbnN0IGlzUHJpbWUgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgaWYgKG4gPD0gMSB8fCAobiAlIDIgPT0gMCAmJiBuID4gMikpIHJldHVybiBmYWxzZTtcblxuICAgIGZvciAobGV0IGkgPSAzOyBpIDw9IE1hdGguc3FydChuKTsgaSArPSAyKSB7XG4gICAgICAgIGlmIChuICUgaSA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5cbmNvbnN0IGdldEZhY3RvcnMgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgbGV0IGZhY3RvcnMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgaWYgKG4gJSBpID09PSAwKSB7XG4gICAgICAgICAgICBmYWN0b3JzLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhY3RvcnM7XG59O1xuXG4vLyBDaGVja2luZyBpZiBhIG51bWJlciBjYW4gYmUgZm9ybWVkIHVzaW5nIGZhY3RvcmlhbFxuY29uc3QgaXNGYWN0b3JpYWwgPSAobjogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgZmFjdG9yaWFsczogeyBba2V5OiBudW1iZXJdOiBudW1iZXIgfSA9IHtcbiAgICAgICAgMjogMixcbiAgICAgICAgNjogMyxcbiAgICAgICAgMjQ6IDQsXG4gICAgICAgIDEyMDogNSxcbiAgICAgICAgNzIwOiA2LFxuICAgIH07XG5cbiAgICBpZiAobiBpbiBmYWN0b3JpYWxzKSB7XG4gICAgICAgIHJldHVybiBmYWN0b3JpYWxzW25dO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59O1xuXG5jb25zdCBpc1BvdzIgPSAobjogbnVtYmVyKSA9PiBuID49IDIgJiYgTnVtYmVyLmlzSW50ZWdlcihNYXRoLmxvZzIobikpO1xuXG5jb25zdCBnY2QgPSAoYTogbnVtYmVyLCBiOiBudW1iZXIpOiBudW1iZXIgPT4ge1xuICAgIGlmICghYikge1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ2NkKGIsIGEgJSBiKTtcbn07XG5cbmV4cG9ydCB7XG4gICAgb3BlcmF0aW9uLFxuICAgIENvbnZlcnRPcHRpb25zLFxuICAgIHJhbmRvbUVsZW1lbnQsXG4gICAgc2h1ZmZsZSxcbiAgICBpc09kZCxcbiAgICBpc1NxdWFyZSxcbiAgICBpc1ByaW1lLFxuICAgIGdldEZhY3RvcnMsXG4gICAgaXNGYWN0b3JpYWwsXG4gICAgaXNQb3cyLFxuICAgIGdjZCxcbn07XG4iLCJpbXBvcnQgeyBnY2QsIHJhbmRvbUVsZW1lbnQgfSBmcm9tICcuL3V0aWxzJztcblxuY29uc3QgX2V1bGVyUGhpID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCB4ID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IG47IGkrKykge1xuICAgICAgICBpZiAoZ2NkKGksIG4pID09PSAxKSB7XG4gICAgICAgICAgICB4Kys7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geDtcbn07XG5cbmNvbnN0IF9wcmltZVNpZXZlID0gKG46IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHByaW1lU2lldmUgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgcHJpbWVTaWV2ZS5wdXNoKHRydWUpO1xuICAgIH1cbiAgICBwcmltZVNpZXZlWzBdID0gZmFsc2U7XG4gICAgcHJpbWVTaWV2ZVsxXSA9IGZhbHNlO1xuXG4gICAgZm9yIChsZXQgcCA9IDI7IHAgKiBwIDw9IG47IHArKykge1xuICAgICAgICBpZiAocHJpbWVTaWV2ZVtwXSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHAgKiBwOyBpIDw9IG47IGkgKz0gcCkge1xuICAgICAgICAgICAgICAgIHByaW1lU2lldmVbaV0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxldCByZXNQcmltZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBuOyBpKyspIHtcbiAgICAgICAgaWYgKHByaW1lU2lldmVbaV0pIHtcbiAgICAgICAgICAgIHJlc1ByaW1lcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXNQcmltZXM7XG59O1xuXG5jb25zdCBfY2FjaGVkUHJpbWVzID0gX3ByaW1lU2lldmUoOTk5KTtcblxuY29uc3QgX3ByaW1lQ291bnRpbmdGdW5jdGlvbiA9IChuOiBudW1iZXIpID0+IHtcbiAgICByZXR1cm4gX2NhY2hlZFByaW1lcy5maWx0ZXIoeCA9PiB4IDw9IG4pLmxlbmd0aDtcbn07XG5cbmNvbnN0IG51bWJlclRoZW9yeUZ1bmN0aW9ucyA9IChuOiBudW1iZXIpID0+IHtcbiAgICBsZXQgbWF0Y2hpbmdQaGlJbnB1dHMgPSBbXTtcbiAgICBsZXQgbWF0Y2hpbmdQaUlucHV0cyA9IFtdO1xuICAgIGxldCBmdW5jdGlvbk9wdGlvbnMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDk5OTsgaSsrKSB7XG4gICAgICAgIGlmIChfZXVsZXJQaGkoaSkgPT09IG4pIHtcbiAgICAgICAgICAgIG1hdGNoaW5nUGhpSW5wdXRzLnB1c2goaSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoX3ByaW1lQ291bnRpbmdGdW5jdGlvbihpKSA9PT0gbikge1xuICAgICAgICAgICAgbWF0Y2hpbmdQaUlucHV0cy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1hdGNoaW5nUGhpSW5wdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IG1hdGNoaW5nSW5wdXQgPSByYW5kb21FbGVtZW50KG1hdGNoaW5nUGhpSW5wdXRzKTtcbiAgICAgICAgZnVuY3Rpb25PcHRpb25zLnB1c2goYFxcXFx2YXJwaGkoJHttYXRjaGluZ0lucHV0fSlgKTtcbiAgICB9XG5cbiAgICBpZiAobWF0Y2hpbmdQaUlucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBtYXRjaGluZ0lucHV0ID0gcmFuZG9tRWxlbWVudChtYXRjaGluZ1BpSW5wdXRzKTtcbiAgICAgICAgZnVuY3Rpb25PcHRpb25zLnB1c2goYFxcXFxwaSgke21hdGNoaW5nSW5wdXR9KWApO1xuICAgIH1cblxuICAgIGlmIChmdW5jdGlvbk9wdGlvbnMubGVuZ3RoID09PSAwIHx8IE1hdGgucmFuZG9tKCkgPCAwLjMpIHtcbiAgICAgICAgZnVuY3Rpb25PcHRpb25zLnB1c2goYCR7bn1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmFuZG9tRWxlbWVudChmdW5jdGlvbk9wdGlvbnMpO1xufTtcblxuY29uc3QgZmFjdG9yaWFsID0gKG46IG51bWJlciwgZ2FtbWFGdW5jdGlvbkVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSAmJiBnYW1tYUZ1bmN0aW9uRW5hYmxlZCkge1xuICAgICAgICAvLyDOkyhuKSA9IChuLTEpIVxuICAgICAgICByZXR1cm4gYHtcXFxcR2FtbWEgKCR7biArIDF9KX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFVzaW5nIHRoZSBwaSBwcm9kdWN0IG5vdGF0aW9uIG9mIGZhY3RvcmlhbFxuICAgICAgICByZXR1cm4gYHtcXFxccHJvZF97az0xfV57JHtufX0ga31gO1xuICAgIH1cbn07XG5cbi8vIHJlcHJlc2VudGF0aW9uIG9mIDJeblxuY29uc3QgcG93MkNob29zZSA9IChuOiBudW1iZXIsIG51bWJlclRoZW9yeUVuYWJsZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBsZXQgeCA9IG51bWJlclRoZW9yeUVuYWJsZWQgPyBudW1iZXJUaGVvcnlGdW5jdGlvbnMobikgOiBuO1xuICAgIHJldHVybiBge1xcXFxzdW1fe2s9MH1eeyR7eH19IHske259IFxcXFxjaG9vc2Uga319YDtcbn07XG5cbi8vIExpbWl0cyBvZiBuYXR1cmFsIGxvZyBmdW5jdGlvbnM6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI05hdHVyYWxfbG9nYXJpdGhtc1xuY29uc3QgbGltaXROYXR1cmFsTG9nID0gKG46IG51bWJlciwgbnVtYmVyVGhlb3J5RW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIHJldHVybiBge1xcXFxsaW1fe3ggXFxcXHRvIFxcXFxpbmZ0eX17IFxcXFxmcmFje1xcXFxsbih4KX17eH0gfX1gO1xuICAgIH0gZWxzZSBpZiAobiA9PT0gMSkge1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byAxfSAge1xcXFxmcmFje1xcXFxsbih4KX17eCAtIDF9fX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCB4ID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuKSA6IG47XG4gICAgICAgIHJldHVybiBge1xcXFxsaW1fe3ggXFxcXHRvIDB9eyBcXFxcZnJhY3stXFxcXGxuKDEgKyAke3h9KGVeey14fSAtIDEpKX17eH0gfX1gO1xuICAgIH1cbn07XG5cbi8vIExpbWl0cyBvZiBleHBvbmVudGlhbCBmdW5jdGlvbnM6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI1N1bXMsX3Byb2R1Y3RzX2FuZF9jb21wb3NpdGVzXG5jb25zdCBsaW1pdEV4cG9uZW50aWFsID0gKG46IG51bWJlciwgbnVtYmVyVGhlb3J5RW5hYmxlZDogYm9vbGVhbikgPT4ge1xuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIHJldHVybiBge1xcXFxsaW1fe3ggXFxcXHRvIFxcXFxpbmZ0eX17eGVeey14fX19YDtcbiAgICB9IGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGB7XFxcXGxpbV97eCBcXFxcdG8gMH17IFxcXFxmcmFje2VeeCAtIDF9e3h9IH19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgeCA9IG51bWJlclRoZW9yeUVuYWJsZWQgPyBudW1iZXJUaGVvcnlGdW5jdGlvbnMobikgOiBuO1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byAwfXsgXFxcXGZyYWN7ZV57JHt4fXh9IC0gMX17eH0gfX1gO1xuICAgIH1cbn07XG5cbi8vIExpbWl0cyBvZiBwb2x5bm9taWFsIGZ1bmN0aW9uc1xuY29uc3QgbGltaXRQb2x5bm9taWFsID0gKG46IG51bWJlcikgPT4ge1xuICAgIC8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbGltaXRzI0Z1bmN0aW9uc19vZl90aGVfZm9ybV94YVxuICAgIGlmIChuID09PSAwKSB7XG4gICAgICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjApO1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9eyR7cn14XnstMX19fWA7XG4gICAgfVxuXG4gICAgLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9saW1pdHMjRnVuY3Rpb25zX29mX3RoZV9mb3JtX3hnKHgpXG4gICAgZWxzZSBpZiAobiA9PT0gMSkge1xuICAgICAgICByZXR1cm4gYHtcXFxcbGltX3t4IFxcXFx0byBcXFxcaW5mdHl9e3heezEveH19fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZ2VuZXJhdGUgcmFuZG9tIHBvbHlub21pYWwgbGltaXRzIGxpa2UgbGltIHggLT4g4oieICgyOHheMiAtIDExeCkvKDR4XjIgKyAxMHgpXG4gICAgICAgIC8vIHNpbmNlIHRoZSBoaWdoZXN0IHBvd2VyIHRlcm1zIGRvbWluYXRlIGluIHRoZSBsaW1pdHMsIHRoZSByZXN0IGFyZSBpZ25vcmVkIGFuZCBjYW4gYmUgcmFuZG9tXG5cbiAgICAgICAgLy8gR2V0IHJhbmRvbSBtdWx0aXBsaWVyIGdyZWF0ZXIgdGhhbiAxXG4gICAgICAgIGxldCBtID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNSkgKyAxO1xuICAgICAgICAvLyBDaG9vc2UgYSByYW5kb20gaGlnaGVzdCBwb3dlci4gVGhpcyBkZXRlcm1pbmVzIHRoZSBmaW5hbCBzb2x1dGlvbiBvZiB0aGUgbGltaXRcbiAgICAgICAgbGV0IGhpZ2hlc3RQb3dlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMpICsgMjtcblxuICAgICAgICBsZXQgbnVtZXJhdG9yTnVtYmVyT2ZUZXJtcyA9IGhpZ2hlc3RQb3dlciAtIDE7XG4gICAgICAgIGxldCBkZW5vbWluYXRvck51bWJlck9mVGVybXMgPSBoaWdoZXN0UG93ZXIgLSAxO1xuXG4gICAgICAgIGxldCBzaWducyA9IFsnLScsICcrJ107XG4gICAgICAgIGxldCBudW1lcmF0b3IgPSBgJHttICogbn14Xnske2hpZ2hlc3RQb3dlcn19IGA7XG4gICAgICAgIGxldCBkZW5vbWluYXRvciA9IGAke219eF57JHtoaWdoZXN0UG93ZXJ9fSBgO1xuXG4gICAgICAgIC8vIEdlbmVyYXRlIGEgcG9seW5vbWlhbCBudW1lcmF0b3Igd2l0aCByYW5kb20gbGVuZ3RoIGFuZCBjb2VmZmljaWVudHNcbiAgICAgICAgLy9leDogMTV4XjJcbiAgICAgICAgZm9yIChsZXQgaSA9IG51bWVyYXRvck51bWJlck9mVGVybXM7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgIGxldCBjb2VmID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMjtcblxuICAgICAgICAgICAgbGV0IHBvd2VyID0gaSA8IDIgPyAnJyA6IGBeeyR7aX19YDtcbiAgICAgICAgICAgIGxldCBzaWduID0gc2lnbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMildO1xuXG4gICAgICAgICAgICBudW1lcmF0b3IgKz0gYCR7c2lnbn0gJHtjb2VmfXgke3Bvd2VyfSBgO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSBwb2x5bm9taWFsIGRlbm9taW5hdG9yIHdpdGggcmFuZG9tIGxlbmd0aCBhbmQgY29lZmZpY2llbnRzXG4gICAgICAgIGZvciAobGV0IGkgPSBkZW5vbWluYXRvck51bWJlck9mVGVybXM7IGkgPiAwOyBpLS0pIHtcbiAgICAgICAgICAgIGxldCBjb2VmID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMjtcblxuICAgICAgICAgICAgbGV0IHBvd2VyID0gaSA8IDIgPyAnJyA6IGBeeyR7aX19YDtcbiAgICAgICAgICAgIGxldCBzaWduID0gc2lnbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMildO1xuXG4gICAgICAgICAgICBkZW5vbWluYXRvciArPSBgJHtzaWdufSAke2NvZWZ9eCR7cG93ZXJ9IGA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYHsgXFxcXGxpbV97eCBcXFxcdG8gXFxcXGluZnR5fSB7IFxcXFxmcmFjeyR7bnVtZXJhdG9yfX17JHtkZW5vbWluYXRvcn19fSB9YDtcbiAgICB9XG59O1xuXG4vLyBVc2luZyBldWxlcidzIGlkZW50aXR5LiBUaGF0IGlzLCBlXihwaSppKSA9IC0xXG5jb25zdCBldWxlcnNJZGVudGl0eSA9IChuOiBudW1iZXIpID0+IHtcbiAgICAvLyBlLmcg4oiSNmVeKHBpKmkpPTZcblxuICAgIGlmIChuICE9PSAwKSB7XG4gICAgICAgIHJldHVybiBgey0ke259ZV57XFxcXHBpIGl9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGB7KGVee1xcXFxwaSBpfSArIDEpfWA7XG4gICAgfVxufTtcblxuLy8gSW5maW5pdGUgZ2VvbWV0cmljIHNlcmllcyB0aGF0IGV2YWx1YXRlcyB0byBhIGZpbml0ZSB2YWx1ZVxuY29uc3QgaW5maW5pdGVHZW9tZXRyaWNTZXJpZXMgPSAobjogbnVtYmVyLCBudW1iZXJUaGVvcnlFbmFibGVkOiBib29sZWFuKSA9PiB7XG4gICAgLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9tYXRoZW1hdGljYWxfc2VyaWVzI1RyaWdvbm9tZXRyaWNfZnVuY3Rpb25zXG4gICAgaWYgKG4gPT09IDApIHtcbiAgICAgICAgbGV0IHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkgKyAzO1xuICAgICAgICByZXR1cm4gYHtcXFxcc3VtXFxcXGxpbWl0c197az0wfV57JHtyIC1cbiAgICAgICAgICAgIDF9fSB7XFxcXHNpbiBcXFxcbGVmdCh7IFxcXFxmcmFjezIgXFxcXHBpIGt9eyR7cn19IH0gXFxcXHJpZ2h0KX19YDtcbiAgICB9XG5cbiAgICAvLyBVc2luZyB0aGUgUmllbWFubiB6ZXRhIGZ1bmN0aW9uOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9QYXJ0aWN1bGFyX3ZhbHVlc19vZl90aGVfUmllbWFubl96ZXRhX2Z1bmN0aW9uI1RoZV9SaWVtYW5uX3pldGFfZnVuY3Rpb25fYXRfMF9hbmRfMVxuICAgIGVsc2UgaWYgKG4gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGB7XFxcXGxpbV97XFxcXGVwc2lsb24gXFxcXHRvIDB9eyBcXFxcZXBzaWxvbiBcXFxcemV0YSgxICsgXFxcXGVwc2lsb24pIH19YDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBVc2luZyB0aGUgaW5maW5pdGUgZ2VvbWV0cmljIHNlcmllcyBydWxlOiBXaGVuIOKIkjE8eDwxLCBzdW1tYXRpb24gZnJvbSBpID0gMCB0byBpbmZpbml0eSBvZiByXmkgPSAxLygxLXIpIG9yIChyLTEpL3IuXG4gICAgICAgIC8vIERlY2ltYWwgY2FuIGJlIHJlcHJlc2VudGVkIGFzIGZyYWN0aW9uIHRvby4gZS5nICgwLjI1KV5pID0gKDEvNCleaSA9IDReLWlcbiAgICAgICAgbGV0IHgxID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuIC0gMSkgOiBuIC0gMTtcbiAgICAgICAgbGV0IHgyID0gbnVtYmVyVGhlb3J5RW5hYmxlZCA/IG51bWJlclRoZW9yeUZ1bmN0aW9ucyhuKSA6IG47XG4gICAgICAgIHJldHVybiBge1xcXFxzdW1cXFxcbGltaXRzX3trPTB9XlxcXFxpbmZ0eSB7XFxcXGxlZnQoe1xcXFxmcmFjeyR7eDF9fXske3gyfX19XFxcXHJpZ2h0KV57a319fWA7XG4gICAgfVxufTtcblxuLy8gVXNpbmcgdGhlIHRyaWcgaWRlbnRpdHkgKGNvc14yKXggKyAoc2luXjIpeCA9IDFcbmNvbnN0IHRyaWdJZGVudGl0eSA9IChleHByZXNzaW9uOiBzdHJpbmcpID0+IHtcbiAgICBsZXQgcmFuZG9tVmFsdWUgPSBNYXRoLnJhbmRvbSgpO1xuICAgIGlmIChyYW5kb21WYWx1ZSA8IDAuMjUpIHtcbiAgICAgICAgcmV0dXJuIGBcXFxcbGVmdChcXFxcZnJhY3ske2V4cHJlc3Npb259fXsoXFxcXGNvc14yeCArIFxcXFxzaW5eMngpfVxcXFxyaWdodClgO1xuICAgIH0gZWxzZSBpZiAocmFuZG9tVmFsdWUgPCAwLjUpIHtcbiAgICAgICAgcmV0dXJuIGBcXFxcbGVmdCh7JHtleHByZXNzaW9ufSBcXFxcdGltZXMgKFxcXFxjb3NeMnggKyBcXFxcc2luXjJ4KX1cXFxccmlnaHQpYDtcbiAgICB9XG59O1xuXG4vKiBVc2luZyB0aGUgZGlmZmVyZW5jZSBvZiB0d28gc3F1YXJlcyBpbiBsaW1pdHMgKi9cbmNvbnN0IGxpbURpZmZUd29TcXVhcmVzID0gKG46IG51bWJlcikgPT4ge1xuICAgIGxldCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApICsgMTtcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSkge1xuICAgICAgICB2YXIgdGV4ID0gYFxcXFxsaW1fe3ggXFxcXHRvICR7biAtIHJ9fSBcXFxcZnJhY3t4XjIgLSAke3IgKiogMn19e3ggLSAke3J9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHRleCA9IGBcXFxcbGltX3t4IFxcXFx0byAke24gKyByfX0gXFxcXGZyYWN7eF4yIC0gJHtyICoqIDJ9fXt4ICsgJHtyfX1gO1xuICAgIH1cbiAgICByZXR1cm4gYHske3RleH19YDtcbn07XG5cbmNvbnN0IHNhbWVOdW1iZXIgPSAobjogbnVtYmVyKSA9PiBgJHtufWA7XG5cbmV4cG9ydCB7XG4gICAgbnVtYmVyVGhlb3J5RnVuY3Rpb25zLFxuICAgIGZhY3RvcmlhbCxcbiAgICBwb3cyQ2hvb3NlLFxuICAgIGxpbWl0TmF0dXJhbExvZyxcbiAgICBsaW1pdEV4cG9uZW50aWFsLFxuICAgIGxpbWl0UG9seW5vbWlhbCxcbiAgICBldWxlcnNJZGVudGl0eSxcbiAgICBpbmZpbml0ZUdlb21ldHJpY1NlcmllcyxcbiAgICB0cmlnSWRlbnRpdHksXG4gICAgbGltRGlmZlR3b1NxdWFyZXMsXG4gICAgc2FtZU51bWJlcixcbn07XG4iLCJsZXQgZG93bmxvYWRCdG4gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rvd25sb2FkLWltZycpO1xuXG4vLyBJbml0aWF0ZSBkb3dubG9hZCBvZiBibG9iXG5jb25zdCBkb3dubG9hZCA9IChmaWxlbmFtZTogc3RyaW5nLCBibG9iOiBCbG9iKSA9PiB7XG4gICAgY29uc3QgZWxlbSA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgZWxlbS5ocmVmID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgZWxlbS5kb3dubG9hZCA9IGZpbGVuYW1lO1xuICAgIGVsZW0uY2xpY2soKTtcbn07XG5cbmNvbnN0IGRvd25sb2FkUE5HID0gKCkgPT4ge1xuICAgIC8vIEdldCB0aGUgc3ZnIGZyb20gdGhlIHBhZ2VcbiAgICB2YXIgc3ZnID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc3ZnJykhO1xuXG4gICAgLy8gR2V0IHRoZSBjdXJyZW50IG51bWJlclxuICAgIHZhciBudW1iZXIgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lucHV0JykpLnZhbHVlO1xuXG4gICAgLy8gLy8gSW5jcmVhc2UgdGhlIFNWRydzIHdpZHRoIGFuZCBoZWlnaHQgdG8gcHJvZHVjZSBhIGJpZ2dlciBpbWFnZVxuICAgIGxldCB3ID0gcGFyc2VJbnQoc3ZnLmdldEF0dHJpYnV0ZSgnd2lkdGgnKSEpO1xuICAgIGxldCBoID0gcGFyc2VJbnQoc3ZnLmdldEF0dHJpYnV0ZSgnaGVpZ2h0JykhKTtcbiAgICAvLyBgYDtcbiAgICAvLyAvLyBDbG9uZSB0aGUgc3ZnIGJlZm9yZSBjaGFuZ2luZyB3aWR0aCBhbmQgaGVpZ2h0IHNvIHRoYXQgaXQgZG9lcyBub3QgYWZmZWN0IHRoZSBzdmcgb24gdGhlIHBhZ2VcbiAgICAvLyBzdmcgPSA8U1ZHU1ZHRWxlbWVudD5zdmcuY2xvbmVOb2RlKHRydWUpO1xuICAgIC8vIHN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgYCR7d31leGApO1xuICAgIC8vIHN2Zy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGAke2h9ZXhgKTtcblxuICAgIC8vIENvbnZlcnQgU1ZHIHRvIHN0cmluZyBkYXRhXG4gICAgY29uc3QgZGF0YSA9IG5ldyBYTUxTZXJpYWxpemVyKCkuc2VyaWFsaXplVG9TdHJpbmcoc3ZnKTtcblxuICAgIGNvbnN0IHN2Z0RhdGFVcmwgPSBgZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwke2J0b2EoZGF0YSl9YDtcblxuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIC8vIHVwc2NhbGUgaGVpZ2h0IHRvIGF0IGxlYXN0IDgwMHB4XG4gICAgbGV0IHNjYWxlRmFjdG9yID0gTWF0aC5tYXgoMiwgODAwIC8gaCk7XG4gICAgY2FudmFzLndpZHRoID0gdyAqIHNjYWxlRmFjdG9yO1xuICAgIGNhbnZhcy5oZWlnaHQgPSBoICogc2NhbGVGYWN0b3I7XG5cbiAgICBjb25zb2xlLmxvZyh7IHc6IGNhbnZhcy53aWR0aCwgaDogY2FudmFzLmhlaWdodCB9KTtcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSE7XG5cbiAgICBjb25zdCBzdmdEYXRhSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICBzdmdEYXRhSW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICBjdHguZHJhd0ltYWdlKHN2Z0RhdGFJbWFnZSwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcblxuICAgICAgICBjYW52YXMudG9CbG9iKGJsb2IgPT4ge1xuICAgICAgICAgICAgaWYgKGJsb2IgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBzZXJpYWxpemUgY2FudmFzIHRvIGJsb2InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRvd25sb2FkKGBjb21wbGljYXRlZC1leHByZXNzaW9uLXRoYXQtZXF1YWxzLSR7bnVtYmVyfWAsIGJsb2IpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgc3ZnRGF0YUltYWdlLnNyYyA9IHN2Z0RhdGFVcmw7XG59O1xuXG5jb25zdCBtYWluID0gKCkgPT4ge1xuICAgIGRvd25sb2FkQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZG93bmxvYWRQTkcpO1xufTtcbmV4cG9ydCB7IG1haW4gfTtcbiIsImRlY2xhcmUgdmFyIE1hdGhKYXg6IGFueTtcblxuaW1wb3J0ICogYXMgcmVwcmVzZW50YXRpb25zIGZyb20gJy4vcmVwcmVzZW50YXRpb25zJztcbmltcG9ydCB7IENvbnZlcnRPcHRpb25zLCBvcGVyYXRpb24gfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IGRlY29tcG9zZSwgY29uZGl0aW9uYWxEZWNvbXBvc2l0aW9uIH0gZnJvbSAnLi9kZWNvbXBvc2l0aW9ucyc7XG5pbXBvcnQgKiBhcyBkb3dubG9hZF9wbmcgZnJvbSAnLi9kb3dubG9hZC1wbmcnO1xuXG5jb25zdCBjb252ZXJ0ID0gKG51bWJlcjogbnVtYmVyLCBvcHRpb25zOiBDb252ZXJ0T3B0aW9ucykgPT4ge1xuICAgIC8vIFZhbGlkYXRpbmcgaW5wdXRcbiAgICBpZiAoaXNOYU4obnVtYmVyKSB8fCBudW1iZXIgPiAxMDAwIHx8IG51bWJlciA8IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qIE5lZWQgdG8gYWRkIGFub3RoZXIgc2xhc2ggdG8gbGF0ZXggc3RyaW5ncyB0byBwcmV2ZW50IHNsYXNoIGVzY2FwZSAqL1xuXG4gICAgLy8gTGlzdCBvZiBmdW5jdGlvbnMgdGhhdCBnZW5lcmF0ZSBMYVRlWCBtYXRoIGV4cHJlc3Npb25zXG4gICAgLy8gRnVuY3Rpb25zIGFyZSBjaG9zZW4gcmFuZG9tbHlcbiAgICBsZXQgcG9zc2libGVfb3B0aW9uczogb3BlcmF0aW9uW10gPSBbXTtcblxuICAgIGlmIChvcHRpb25zLmV1bGVyc0lkZW50aXR5KSB7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChyZXByZXNlbnRhdGlvbnMuZXVsZXJzSWRlbnRpdHkpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5leHBvbmVudGlhbExpbWl0cykge1xuICAgICAgICBwb3NzaWJsZV9vcHRpb25zLnB1c2gobiA9PiByZXByZXNlbnRhdGlvbnMubGltaXROYXR1cmFsTG9nKG4sIG9wdGlvbnMubnVtYmVyVGhlb3J5KSk7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChuID0+IHJlcHJlc2VudGF0aW9ucy5saW1pdEV4cG9uZW50aWFsKG4sIG9wdGlvbnMubnVtYmVyVGhlb3J5KSk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnBvbHlub21pYWxMaW1pdHMpIHtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKHJlcHJlc2VudGF0aW9ucy5saW1EaWZmVHdvU3F1YXJlcyk7XG4gICAgICAgIHBvc3NpYmxlX29wdGlvbnMucHVzaChyZXByZXNlbnRhdGlvbnMubGltaXRQb2x5bm9taWFsKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5nZW9tZXRyaWNTZXJpZXMpIHtcbiAgICAgICAgcG9zc2libGVfb3B0aW9ucy5wdXNoKG4gPT5cbiAgICAgICAgICAgIHJlcHJlc2VudGF0aW9ucy5pbmZpbml0ZUdlb21ldHJpY1NlcmllcyhuLCBvcHRpb25zLm51bWJlclRoZW9yeSlcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBkZWNvcmF0ZSBlYWNoIG9wZXJhdGlvbiB3aXRoIGEgZnVuY3Rpb24gdGhhdCBjaGVja3MgaWYgdGhlIGlucHV0IGlzIG9mIGEgY2VydGFpbiBmb3JtLCBhbmQgaWYgaXQgaXMgaXQgb3ZlcnJpZGVzIHRoZSBkZWNvcmF0ZWQgZnVuY3Rpb24ncyB1c3VhbCByZXN1bHQgd2l0aCBpdCdzIG93bi5cbiAgICBwb3NzaWJsZV9vcHRpb25zID0gcG9zc2libGVfb3B0aW9ucy5tYXAoZiA9PiB7XG4gICAgICAgIHJldHVybiBjb25kaXRpb25hbERlY29tcG9zaXRpb24oZiwgb3B0aW9ucyk7XG4gICAgfSk7XG5cbiAgICBsZXQgaW5wdXQgPSBkZWNvbXBvc2UobnVtYmVyLCBwb3NzaWJsZV9vcHRpb25zKTtcblxuICAgIC8vICBEaXNhYmxlIHRoZSBkaXNwbGF5IGFuZCByZW5kZXIgYnV0dG9ucyB1bnRpbCBNYXRoSmF4IGlzIGRvbmVcbiAgICB2YXIgZGlzcGxheSA9IDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXNwbGF5Jyk7XG4gICAgdmFyIGJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVuZGVyJyk7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gZGlzcGxheS5kaXNhYmxlZCA9IHRydWU7XG4gICAgbGV0IGRvd25sb2FkQnRuID0gPEhUTUxCdXR0b25FbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZC1pbWcnKTtcblxuICAgIC8vICBDbGVhciB0aGUgb2xkIG91dHB1dFxuXG4gICAgbGV0IG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdXRwdXQnKSE7XG4gICAgb3V0cHV0LmlubmVySFRNTCA9ICcnO1xuXG4gICAgLy8gIFJlc2V0IHRoZSB0ZXggbGFiZWxzIChhbmQgYXV0b21hdGljIGVxdWF0aW9uIG51bWJlcnMsIHRob3VnaCB0aGVyZSBhcmVuJ3QgYW55IGhlcmUpLlxuICAgIC8vICBHZXQgdGhlIGNvbnZlcnNpb24gb3B0aW9ucyAobWV0cmljcyBhbmQgZGlzcGxheSBzZXR0aW5ncylcbiAgICAvLyAgQ29udmVydCB0aGUgaW5wdXQgdG8gQ29tbW9uSFRNTCBvdXRwdXQgYW5kIHVzZSBhIHByb21pc2UgdG8gd2FpdCBmb3IgaXQgdG8gYmUgcmVhZHlcbiAgICAvLyAgICAoaW4gY2FzZSBhbiBleHRlbnNpb24gbmVlZHMgdG8gYmUgbG9hZGVkIGR5bmFtaWNhbGx5KS5cbiAgICBNYXRoSmF4LnRleFJlc2V0KCk7XG4gICAgdmFyIG1hdGhKYXhPcHRpb25zID0gTWF0aEpheC5nZXRNZXRyaWNzRm9yKG91dHB1dCk7XG4gICAgbWF0aEpheE9wdGlvbnMuZGlzcGxheSA9IGRpc3BsYXkuY2hlY2tlZDtcbiAgICBNYXRoSmF4LnRleDJzdmdQcm9taXNlKGlucHV0LCBtYXRoSmF4T3B0aW9ucylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24obm9kZTogYW55KSB7XG4gICAgICAgICAgICAvLyAgVGhlIHByb21pc2UgcmV0dXJucyB0aGUgdHlwZXNldCBub2RlLCB3aGljaCB3ZSBhZGQgdG8gdGhlIG91dHB1dFxuICAgICAgICAgICAgLy8gIFRoZW4gdXBkYXRlIHRoZSBkb2N1bWVudCB0byBpbmNsdWRlIHRoZSBhZGp1c3RlZCBDU1MgZm9yIHRoZVxuICAgICAgICAgICAgLy8gICAgY29udGVudCBvZiB0aGUgbmV3IGVxdWF0aW9uLlxuICAgICAgICAgICAgb3V0cHV0LmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgICAgICAgTWF0aEpheC5zdGFydHVwLmRvY3VtZW50LmNsZWFyKCk7XG4gICAgICAgICAgICBNYXRoSmF4LnN0YXJ0dXAuZG9jdW1lbnQudXBkYXRlRG9jdW1lbnQoKTtcbiAgICAgICAgICAgIC8vIERpc3BsYXkgZG93bmxvYWQgYnV0dG9uXG4gICAgICAgICAgICBkb3dubG9hZEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycjogRXJyb3IpIHtcbiAgICAgICAgICAgIC8vICBJZiB0aGVyZSB3YXMgYW4gZXJyb3IsIHB1dCB0aGUgbWVzc2FnZSBpbnRvIHRoZSBvdXRwdXQgaW5zdGVhZFxuICAgICAgICAgICAgb3V0cHV0XG4gICAgICAgICAgICAgICAgLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpKVxuICAgICAgICAgICAgICAgIC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShlcnIubWVzc2FnZSkpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vICBFcnJvciBvciBub3QsIHJlLWVuYWJsZSB0aGUgZGlzcGxheSBhbmQgcmVuZGVyIGJ1dHRvbnNcbiAgICAgICAgICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGRpc3BsYXkuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG59O1xuY29uc3QgbWFpbiA9ICgpID0+IHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm0nKSBhcyBIVE1MRm9ybUVsZW1lbnQ7XG4gICAgY29uc3QgbnVtYmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIGNvbnN0IGdhbW1hRnVuY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtbWEtZnVuY3Rpb24nKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IGV1bGVyc0lkZW50aXR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V1bGVycy1pZGVudGl0eScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgZXhwb25lbnRpYWxMaW1pdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGltaXRzLWV4cG9uZW50aWFsJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBwb2x5bm9taWFsTGltaXRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpbWl0cy1wb2x5bm9taWFsJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBudW1iZXJUaGVvcnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtYmVyLXRoZW9yeScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgY29uc3QgZ2VvbWV0cmljU2VyaWVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlb21ldHJpYy1zZXJpZXMnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuXG4gICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBldmVudCA9PiB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgY29udmVydChwYXJzZUludChudW1iZXIudmFsdWUpLCB7XG4gICAgICAgICAgICBnYW1tYUZ1bmN0aW9uOiBnYW1tYUZ1bmN0aW9uLmNoZWNrZWQsXG4gICAgICAgICAgICBldWxlcnNJZGVudGl0eTogZXVsZXJzSWRlbnRpdHkuY2hlY2tlZCxcbiAgICAgICAgICAgIGV4cG9uZW50aWFsTGltaXRzOiBleHBvbmVudGlhbExpbWl0cy5jaGVja2VkLFxuICAgICAgICAgICAgcG9seW5vbWlhbExpbWl0czogcG9seW5vbWlhbExpbWl0cy5jaGVja2VkLFxuICAgICAgICAgICAgbnVtYmVyVGhlb3J5OiBudW1iZXJUaGVvcnkuY2hlY2tlZCxcbiAgICAgICAgICAgIGdlb21ldHJpY1NlcmllczogZ2VvbWV0cmljU2VyaWVzLmNoZWNrZWQsXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZG93bmxvYWRfcG5nLm1haW4oKTtcbn07XG5cbm1haW4oKTtcbiIsImltcG9ydCB7XG4gICAgb3BlcmF0aW9uLFxuICAgIGdldEZhY3RvcnMsXG4gICAgQ29udmVydE9wdGlvbnMsXG4gICAgaXNGYWN0b3JpYWwsXG4gICAgaXNQb3cyLFxuICAgIHNodWZmbGUsXG4gICAgaXNQcmltZSxcbiAgICBpc1NxdWFyZSxcbiAgICBpc09kZCxcbn0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgKiBhcyByZXByZXNlbnRhdGlvbnMgZnJvbSAnLi9yZXByZXNlbnRhdGlvbnMnO1xuLy8gZm9yIG4gPSBhYiBhbmQg4oiAYywgZWl0aGVyIHJldHVybiBuID0gYWIgb3IgKGEtYykoYitjKSArIGMoYi1hK2MpXG5jb25zdCBkZWNvbXBvc2VBQkMgPSAoXG4gICAgbnVtYmVyOiBudW1iZXIsXG4gICAgb3AxOiBvcGVyYXRpb24sXG4gICAgb3AyOiBvcGVyYXRpb24sXG4gICAgb3AzOiBvcGVyYXRpb24sXG4gICAgbW9yZVJhbmRvbU9wdGlvbnM6IG9wZXJhdGlvblxuKSA9PiB7XG4gICAgbGV0IGZhY3RvcnMgPSBnZXRGYWN0b3JzKG51bWJlcik7XG4gICAgbGV0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogZmFjdG9ycy5sZW5ndGgpO1xuICAgIGxldCBhID0gZmFjdG9yc1tyYW5kb21JbmRleF07XG4gICAgbGV0IGIgPSBudW1iZXIgLyBhO1xuICAgIGxldCBjID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMzApICsgMTtcblxuICAgIC8vIGFiXG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjIpIHtcbiAgICAgICAgcmV0dXJuIGB7e1xcXFxsZWZ0KHske29wMShhKX19XFxcXHJpZ2h0KX17XFxcXGxlZnQoeyR7b3AyKGIpfX1cXFxccmlnaHQpfX1gO1xuICAgIH1cblxuICAgIC8vIChhIC0gYykoYiArIGMpICsgYyAoYiAtIGEgKyBjKVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gYHsgXFxcXGxlZnQoeyR7b3AxKGEpfSAtICR7b3AyKGMpfX1cXFxccmlnaHQpIFxcXFxsZWZ0KHske29wMyhiKX0gKyAke21vcmVSYW5kb21PcHRpb25zKFxuICAgICAgICAgICAgY1xuICAgICAgICApfX1cXFxccmlnaHQpICsgeyR7bW9yZVJhbmRvbU9wdGlvbnMoYyl9fXtcXFxcbGVmdCh7JHttb3JlUmFuZG9tT3B0aW9ucyhcbiAgICAgICAgICAgIGJcbiAgICAgICAgKX0gLSAke21vcmVSYW5kb21PcHRpb25zKGEpfSArICR7bW9yZVJhbmRvbU9wdGlvbnMoYyl9fSBcXFxccmlnaHQpfSB9YDtcbiAgICB9XG59O1xuXG4vLyA1ID0gc3FydCgyNSlcbmNvbnN0IGRlY29tcG9zZVNxcnQgPSAobjogbnVtYmVyLCBvcDE6IG9wZXJhdGlvbikgPT4ge1xuICAgIGxldCBzcXVhcmUgPSBuICoqIDI7XG4gICAgcmV0dXJuIGB7XFxcXHNxcnR7JHtvcDEoc3F1YXJlKX19fWA7XG59O1xuXG4vLyAyNSA9IDEgKyAzICsgNSArIDcgKyA5XG5jb25zdCBkZWNvbXBvc2VTcXVhcmUgPSAoXG4gICAgbjogbnVtYmVyLFxuICAgIG9wMTogb3BlcmF0aW9uLFxuICAgIG9wMjogb3BlcmF0aW9uLFxuICAgIG9wMzogb3BlcmF0aW9uLFxuICAgIG1vcmVSYW5kb21PcHRpb25zOiBvcGVyYXRpb25cbikgPT4ge1xuICAgIGxldCBzcXVhcmVSb290ID0gTWF0aC5zcXJ0KG4pO1xuICAgIGxldCBzdW0gPSBgJHtvcDEoMSl9YDtcbiAgICBsZXQgb2RkVmFsID0gMTtcblxuICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4yKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3F1YXJlUm9vdCAtIDE7IGkrKykge1xuICAgICAgICAgICAgb2RkVmFsICs9IDI7XG4gICAgICAgICAgICBzdW0gKz0gYCsgJHttb3JlUmFuZG9tT3B0aW9ucyhvZGRWYWwpfWA7XG4gICAgICAgIH1cbiAgICAgICAgc3VtID0gYHsgJHtzdW19IH1gO1xuICAgICAgICByZXR1cm4gc3VtO1xuICAgIH1cblxuICAgIC8vIChhICsgYileMiA9IGFeMiArIDJhYiArIGJeMlxuICAgIGVsc2Uge1xuICAgICAgICBsZXQgYSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHNxdWFyZVJvb3QgLSAxKSArIDE7XG4gICAgICAgIGxldCBiID0gc3F1YXJlUm9vdCAtIGE7XG5cbiAgICAgICAgLy8gUmVwcmVzZW50aW5nIChhICsgYileMlxuICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSkge1xuICAgICAgICAgICAgcmV0dXJuIGB7IHtcXFxcbGVmdCgke29wMShhKX0gKyAke29wMShiKX1cXFxccmlnaHQpfV4yfWA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXByZXNlbnRpbmcgYV4yICsgMmFiICsgYl4yXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGB7IHtcXFxcbGVmdCgke29wMShhKX1cXFxccmlnaHQpfV4yICsgeyR7bW9yZVJhbmRvbU9wdGlvbnMoMil9fXtcXFxcbGVmdCgke29wMihcbiAgICAgICAgICAgICAgICBhXG4gICAgICAgICAgICApfVxcXFxyaWdodCl9e1xcXFxsZWZ0KCR7b3AzKGIpfVxcXFxyaWdodCl9ICsge1xcXFxsZWZ0KCR7bW9yZVJhbmRvbU9wdGlvbnMoYil9XFxcXHJpZ2h0KX1eMn1gO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuLy8gMjUgPSAxM14yIC0gMTJeMlxuY29uc3QgZGVjb21wb3NlRGlmZmVyZW5jZVNxdWFyZXMgPSAobjogbnVtYmVyLCBvcDE6IG9wZXJhdGlvbiwgb3AyOiBvcGVyYXRpb24pID0+IHtcbiAgICBsZXQgYSA9IE1hdGguZmxvb3IobiAvIDIpO1xuICAgIGxldCBiID0gTWF0aC5jZWlsKG4gLyAyKTtcblxuICAgIGlmIChNYXRoLmNlaWwobiAvIDIpICoqIDIgPCAxMDAgJiYgTWF0aC5yYW5kb20oKSA8IDAuNykge1xuICAgICAgICByZXR1cm4gYHske29wMShiICoqIDIpfSAtICR7b3AyKGEgKiogMil9fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGB7IFxcXFxsZWZ0KHske29wMShiKX19XFxcXHJpZ2h0KV4yIC0gIFxcXFxsZWZ0KHske29wMihhKX19XFxcXHJpZ2h0KV4yfWA7XG4gICAgfVxufTtcblxuLy8gNyA9IDIgKiAzICsgMVxuY29uc3QgZGVjb21wb3NlQWRkTXVsdGlwbHkgPSAobjogbnVtYmVyLCBvcDE6IG9wZXJhdGlvbiwgb3AyOiBvcGVyYXRpb24sIG9wMzogb3BlcmF0aW9uKSA9PiB7XG4gICAgbGV0IHJhbmROdW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBuICsgMSkgKyAxO1xuICAgIGxldCByID0gbiAlIHJhbmROdW07XG4gICAgbGV0IGEgPSBNYXRoLmZsb29yKG4gLyByYW5kTnVtKTtcbiAgICByZXR1cm4gYCR7b3AxKGEpfSBcXFxcdGltZXMgeyR7b3AyKHJhbmROdW0pfX0gKyAke29wMyhyKX1gO1xufTtcblxuLy8gNyA9IDcqOC84XG5jb25zdCBkZWNvbXBvc2VNdWxEaXZpZGUgPSAobjogbnVtYmVyLCBvcDE6IG9wZXJhdGlvbiwgb3AyOiBvcGVyYXRpb24pID0+IHtcbiAgICBsZXQgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDUpICsgMTtcbiAgICByZXR1cm4gYFxcXFxmcmFjeyR7b3AxKG4gKiByKX19IHske29wMihyKX19YDtcbn07XG4vKiBlbmQgZGVjb21wb3NlIGZ1bmN0aW9ucyAqL1xuXG5jb25zdCBjb25kaXRpb25hbERlY29tcG9zaXRpb24gPSAoXG4gICAgd3JhcHBlZEZ1bmN0aW9uOiBvcGVyYXRpb24sXG4gICAgb3B0aW9uczogQ29udmVydE9wdGlvbnNcbik6IG9wZXJhdGlvbiA9PiB7XG4gICAgcmV0dXJuIChuOiBudW1iZXIpID0+IHtcbiAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPD0gMC41KSB7XG4gICAgICAgICAgICAvLyBpbnZlcnNlIGZhY3RvcmlhbCBvZiBuLCBzdWNoIHRoYXQgZmFjISA9IG5cbiAgICAgICAgICAgIGNvbnN0IGZhYyA9IGlzRmFjdG9yaWFsKG4pO1xuICAgICAgICAgICAgaWYgKGZhYykge1xuICAgICAgICAgICAgICAgIC8vIGZhY3RvcmlhbChmYWMpID0gZmFjISA9IG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVwcmVzZW50YXRpb25zLmZhY3RvcmlhbChmYWMsIG9wdGlvbnMuZ2FtbWFGdW5jdGlvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc1BvdzIobikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVwcmVzZW50YXRpb25zLnBvdzJDaG9vc2UoTWF0aC5sb2cyKG4pLCBvcHRpb25zLm51bWJlclRoZW9yeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gd3JhcHBlZEZ1bmN0aW9uKG4pO1xuICAgIH07XG59O1xuXG4vLyBCcmVhayBhIG51bWJlciBkb3duIGludG8gc21hbGxlciBudW1iZXJzIHNlcGFyYXRlZCBieSBvcGVyYXRvcnNcbmNvbnN0IGRlY29tcG9zZSA9IChuOiBudW1iZXIsIG9wZXJhdGlvbnM6IG9wZXJhdGlvbltdKSA9PiB7XG4gICAgLy8gR2V0IHRocmVlIG9wZXJhdGlvbnMgdGhhdCBjYW4gYmUgdXNlZFxuICAgIGxldCBtb3JlUmFuZG9tT3B0aW9ucyA9IChudW06IG51bWJlcikgPT4ge1xuICAgICAgICByZXR1cm4gb3BlcmF0aW9uc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBvcGVyYXRpb25zLmxlbmd0aCldKG51bSk7XG4gICAgfTtcblxuICAgIGxldCByYW5kb21PcHRpb24xID0gbW9yZVJhbmRvbU9wdGlvbnM7XG4gICAgbGV0IHJhbmRvbU9wdGlvbjIgPSBtb3JlUmFuZG9tT3B0aW9ucztcbiAgICBsZXQgcmFuZG9tT3B0aW9uMyA9IG1vcmVSYW5kb21PcHRpb25zO1xuXG4gICAgLy8gaWYgdGhlcmUgYXJlIG5vIG9wZXJhdGlvbnMgdG8gYmUgZG9uZVxuICAgIGlmIChvcGVyYXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByYW5kb21PcHRpb24xID0gcmVwcmVzZW50YXRpb25zLnNhbWVOdW1iZXI7XG4gICAgICAgIHJhbmRvbU9wdGlvbjIgPSByZXByZXNlbnRhdGlvbnMuc2FtZU51bWJlcjtcbiAgICAgICAgcmFuZG9tT3B0aW9uMyA9IHJlcHJlc2VudGF0aW9ucy5zYW1lTnVtYmVyO1xuICAgICAgICBtb3JlUmFuZG9tT3B0aW9ucyA9IHJlcHJlc2VudGF0aW9ucy5zYW1lTnVtYmVyO1xuICAgIH1cblxuICAgIGlmIChvcGVyYXRpb25zLmxlbmd0aCA+PSAzKSB7XG4gICAgICAgIFtyYW5kb21PcHRpb24xLCByYW5kb21PcHRpb24yLCByYW5kb21PcHRpb24zXSA9IHNodWZmbGUob3BlcmF0aW9ucykuc2xpY2UoMCwgMyk7XG4gICAgfVxuXG4gICAgLy8gTWFrZSBlYWNoIG91dGNvbWUgZXF1YWxseSBsaWtlbHkgKGFzc3VtaW5nIGFsbCBjaGFyYWN0ZXJpc3RpY3MgYXJlIGZ1bGZpbGxlZCwgd2hpY2ggdGhleSBhcmUgbm90KVxuICAgIGNvbnN0IHJhbmRvbVZhbHVlID0gTWF0aC5yYW5kb20oKTtcbiAgICBjb25zdCB1bml0VGhyZXNob2xkID0gMSAvIDY7XG5cbiAgICAvLyAxLiBhYiA9IChhIC0gYykoYiArIGMpICsgYyAoYiAtIGEgKyBjKSwgd2hlcmUgYyBpcyBhbnkgcmFuZG9tIHBvc2l0aXZlIG51bWJlclxuICAgIGlmIChyYW5kb21WYWx1ZSA8IHVuaXRUaHJlc2hvbGQgJiYgbiAhPT0gMCAmJiBuIDwgMTAwICYmIChuID09PSAyIHx8ICFpc1ByaW1lKG4pKSkge1xuICAgICAgICByZXR1cm4gZGVjb21wb3NlQUJDKG4sIHJhbmRvbU9wdGlvbjEsIHJhbmRvbU9wdGlvbjIsIHJhbmRvbU9wdGlvbjMsIG1vcmVSYW5kb21PcHRpb25zKTtcbiAgICB9XG5cbiAgICAvLyAyLiBSZXByZXNlbnQgKHNtYWxsKSBudW1iZXJzIHVzaW5nIHRoZWlyIHNxdWFyZSBhbmQgc3F1YXJlIHJvb3RcbiAgICBpZiAocmFuZG9tVmFsdWUgPCB1bml0VGhyZXNob2xkICogMiAmJiBuIDwgMTApIHtcbiAgICAgICAgcmV0dXJuIGRlY29tcG9zZVNxcnQobiwgcmFuZG9tT3B0aW9uMSk7XG4gICAgfVxuXG4gICAgLy8gMy4gVGhlIHN1bSBvZiB0aGUgZmlyc3QgbiBvZGQgbnVtYmVycyBpcyBlcXVhbCB0byBuXjIgZS5nIDEgKyAzICsgNSA9IDNeMlxuICAgIGlmIChyYW5kb21WYWx1ZSA8IHVuaXRUaHJlc2hvbGQgKiAzICYmIG4gPiAxICYmIGlzU3F1YXJlKG4pKSB7XG4gICAgICAgIHJldHVybiBkZWNvbXBvc2VTcXVhcmUobiwgcmFuZG9tT3B0aW9uMSwgcmFuZG9tT3B0aW9uMiwgcmFuZG9tT3B0aW9uMywgbW9yZVJhbmRvbU9wdGlvbnMpO1xuICAgIH1cblxuICAgIC8vIDQuIFRoZSBzdW0gb2YgdHdvIGNvbnNlY3V0aXZlIGludGVnZXJzIGlzIHRoZSBkaWZmZXJlbmNlIG9mIHRoZWlyIHNxdWFyZXMgZS5nIDMgKyAyID0gM14yIC0gMl4yXG4gICAgaWYgKHJhbmRvbVZhbHVlIDwgdW5pdFRocmVzaG9sZCAqIDQgJiYgaXNPZGQobikgJiYgcmFuZG9tVmFsdWUgPCAwLjcpIHtcbiAgICAgICAgcmV0dXJuIGRlY29tcG9zZURpZmZlcmVuY2VTcXVhcmVzKG4sIHJhbmRvbU9wdGlvbjEsIHJhbmRvbU9wdGlvbjIpO1xuICAgIH1cblxuICAgIC8vIDUuIEV4cHJlc3MgYSBudW1iZXIgdXNpbmcgbXVsdGlwbGljYXRpb24gYW5kIGFkZGl0aW9uLiBFLmcgNCA9IDEgKiAzICsgMVxuICAgIGlmIChyYW5kb21WYWx1ZSA8IHVuaXRUaHJlc2hvbGQgKiA1ICYmIG4gPD0gMjAwKSB7XG4gICAgICAgIHJldHVybiBkZWNvbXBvc2VNdWxEaXZpZGUobiwgcmFuZG9tT3B0aW9uMSwgcmFuZG9tT3B0aW9uMik7XG4gICAgfVxuICAgIC8vIDYuIE11bHRpcGx5IGFuZCBkaXZpZGUgYnkgYSByYW5kb20gbnVtYmVyLiBlLmcgMiA9ICgyKjUpLzVcbiAgICByZXR1cm4gZGVjb21wb3NlQWRkTXVsdGlwbHkobiwgcmFuZG9tT3B0aW9uMSwgcmFuZG9tT3B0aW9uMiwgcmFuZG9tT3B0aW9uMyk7XG59O1xuXG5leHBvcnQgeyBkZWNvbXBvc2UsIGNvbmRpdGlvbmFsRGVjb21wb3NpdGlvbiB9O1xuIl0sIm5hbWVzIjpbInJhbmRvbUVsZW1lbnQiLCJhcnJheSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsImdjZCIsImEiLCJiIiwiX2V1bGVyUGhpIiwibiIsIngiLCJpIiwiX2NhY2hlZFByaW1lcyIsInByaW1lU2lldmUiLCJwdXNoIiwicCIsInJlc1ByaW1lcyIsIl9wcmltZVNpZXZlIiwiX3ByaW1lQ291bnRpbmdGdW5jdGlvbiIsImZpbHRlciIsIm51bWJlclRoZW9yeUZ1bmN0aW9ucyIsIm1hdGNoaW5nUGhpSW5wdXRzIiwibWF0Y2hpbmdQaUlucHV0cyIsImZ1bmN0aW9uT3B0aW9ucyIsIm1hdGNoaW5nSW5wdXQiLCJsaW1pdFBvbHlub21pYWwiLCJtIiwiaGlnaGVzdFBvd2VyIiwiZGVub21pbmF0b3JOdW1iZXJPZlRlcm1zIiwic2lnbnMiLCJudW1lcmF0b3IiLCJkZW5vbWluYXRvciIsImNvZWYiLCJwb3dlciIsImV1bGVyc0lkZW50aXR5IiwibGltRGlmZlR3b1NxdWFyZXMiLCJyIiwidGV4Iiwic2FtZU51bWJlciIsImRvd25sb2FkQnRuIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImRvd25sb2FkUE5HIiwic3ZnIiwicXVlcnlTZWxlY3RvciIsIm51bWJlciIsInZhbHVlIiwidyIsInBhcnNlSW50IiwiZ2V0QXR0cmlidXRlIiwiaCIsImRhdGEiLCJYTUxTZXJpYWxpemVyIiwic2VyaWFsaXplVG9TdHJpbmciLCJzdmdEYXRhVXJsIiwiYnRvYSIsImNhbnZhcyIsImNyZWF0ZUVsZW1lbnQiLCJzY2FsZUZhY3RvciIsIm1heCIsIndpZHRoIiwiaGVpZ2h0IiwiY29uc29sZSIsImxvZyIsImN0eCIsImdldENvbnRleHQiLCJzdmdEYXRhSW1hZ2UiLCJJbWFnZSIsIm9ubG9hZCIsImRyYXdJbWFnZSIsInRvQmxvYiIsImJsb2IiLCJFcnJvciIsImZpbGVuYW1lIiwiZWxlbSIsIndpbmRvdyIsImhyZWYiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJkb3dubG9hZCIsImNsaWNrIiwic3JjIiwiY29udmVydCIsIm9wdGlvbnMiLCJpc05hTiIsInBvc3NpYmxlX29wdGlvbnMiLCJleHBvbmVudGlhbExpbWl0cyIsIm51bWJlclRoZW9yeUVuYWJsZWQiLCJudW1iZXJUaGVvcnkiLCJwb2x5bm9taWFsTGltaXRzIiwiZ2VvbWV0cmljU2VyaWVzIiwibWFwIiwiZiIsIndyYXBwZWRGdW5jdGlvbiIsImZhYyIsImZhY3RvcmlhbHMiLCJpc0ZhY3RvcmlhbCIsImdhbW1hRnVuY3Rpb25FbmFibGVkIiwiZ2FtbWFGdW5jdGlvbiIsIk51bWJlciIsImlzSW50ZWdlciIsImxvZzIiLCJpc1BvdzIiLCJjb25kaXRpb25hbERlY29tcG9zaXRpb24iLCJpbnB1dCIsIm9wZXJhdGlvbnMiLCJtb3JlUmFuZG9tT3B0aW9ucyIsIm51bSIsInJhbmRvbU9wdGlvbjEiLCJyYW5kb21PcHRpb24yIiwicmFuZG9tT3B0aW9uMyIsInJhbmRvbUluZGV4IiwiY3VycmVudEluZGV4Iiwic2h1ZmZsZSIsInNsaWNlIiwicmFuZG9tVmFsdWUiLCJ1bml0VGhyZXNob2xkIiwic3FydCIsImlzUHJpbWUiLCJvcDEiLCJvcDIiLCJvcDMiLCJmYWN0b3JzIiwiZ2V0RmFjdG9ycyIsImMiLCJkZWNvbXBvc2VBQkMiLCJkZWNvbXBvc2VTcXJ0IiwiaXNTcXVhcmUiLCJzcXVhcmVSb290Iiwic3VtIiwib2RkVmFsIiwiZGVjb21wb3NlU3F1YXJlIiwiaXNPZGQiLCJjZWlsIiwiZGVjb21wb3NlRGlmZmVyZW5jZVNxdWFyZXMiLCJkZWNvbXBvc2VNdWxEaXZpZGUiLCJyYW5kTnVtIiwiZGVjb21wb3NlQWRkTXVsdGlwbHkiLCJkZWNvbXBvc2UiLCJkaXNwbGF5IiwiYnV0dG9uIiwiZGlzYWJsZWQiLCJvdXRwdXQiLCJpbm5lckhUTUwiLCJNYXRoSmF4IiwidGV4UmVzZXQiLCJtYXRoSmF4T3B0aW9ucyIsImdldE1ldHJpY3NGb3IiLCJjaGVja2VkIiwidGV4MnN2Z1Byb21pc2UiLCJ0aGVuIiwibm9kZSIsImFwcGVuZENoaWxkIiwic3RhcnR1cCIsImNsZWFyIiwidXBkYXRlRG9jdW1lbnQiLCJzdHlsZSIsImNhdGNoIiwiZXJyIiwiY3JlYXRlVGV4dE5vZGUiLCJtZXNzYWdlIiwiZm9ybSIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInByZXZlbnREZWZhdWx0Il0sInNvdXJjZVJvb3QiOiIifQ==